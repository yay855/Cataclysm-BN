<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cataclysm BN: src/ranged.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cataclysm BN
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('ranged_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle"><div class="title">ranged.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="ranged_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="preprocessor">#include &quot;<a class="code" href="ranged_8h.html">ranged.h</a>&quot;</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span> </div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="preprocessor">#include &lt;cstdio&gt;</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="preprocessor">#include &lt;cstdlib&gt;</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="preprocessor">#include &lt;iterator&gt;</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="preprocessor">#include &lt;set&gt;</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="preprocessor">#include &lt;tuple&gt;</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="preprocessor">#include &lt;utility&gt;</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span> </div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="preprocessor">#include &quot;<a class="code" href="activity__actor__definitions_8h.html">activity_actor_definitions.h</a>&quot;</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="preprocessor">#include &quot;<a class="code" href="avatar_8h.html">avatar.h</a>&quot;</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="preprocessor">#include &quot;<a class="code" href="ballistics_8h.html">ballistics.h</a>&quot;</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">#include &quot;<a class="code" href="bodypart_8h.html">bodypart.h</a>&quot;</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#include &quot;<a class="code" href="calendar_8h.html">calendar.h</a>&quot;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">#include &quot;<a class="code" href="cata__utility_8h.html">cata_utility.h</a>&quot;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#include &quot;<a class="code" href="catacharset_8h.html">catacharset.h</a>&quot;</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#include &quot;<a class="code" href="character_8h.html">character.h</a>&quot;</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">#include &quot;<a class="code" href="color_8h.html">color.h</a>&quot;</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor">#include &quot;<a class="code" href="creature_8h.html">creature.h</a>&quot;</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="preprocessor">#include &quot;<a class="code" href="cursesdef_8h.html">cursesdef.h</a>&quot;</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="preprocessor">#include &quot;<a class="code" href="damage_8h.html">damage.h</a>&quot;</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="preprocessor">#include &quot;<a class="code" href="debug_8h.html">debug.h</a>&quot;</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="preprocessor">#include &quot;<a class="code" href="dispersion_8h.html">dispersion.h</a>&quot;</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="preprocessor">#include &quot;<a class="code" href="enums_8h.html">enums.h</a>&quot;</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="preprocessor">#include &quot;<a class="code" href="event_8h.html">event.h</a>&quot;</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="preprocessor">#include &quot;<a class="code" href="event__bus_8h.html">event_bus.h</a>&quot;</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="preprocessor">#include &quot;<a class="code" href="game_8h.html">game.h</a>&quot;</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="preprocessor">#include &quot;<a class="code" href="game__constants_8h.html">game_constants.h</a>&quot;</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="preprocessor">#include &quot;<a class="code" href="gun__mode_8h.html">gun_mode.h</a>&quot;</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="preprocessor">#include &quot;<a class="code" href="input_8h.html">input.h</a>&quot;</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="preprocessor">#include &quot;<a class="code" href="item_8h.html">item.h</a>&quot;</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="preprocessor">#include &quot;<a class="code" href="item__location_8h.html">item_location.h</a>&quot;</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="preprocessor">#include &quot;<a class="code" href="itype_8h.html">itype.h</a>&quot;</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="preprocessor">#include &quot;<a class="code" href="line_8h.html">line.h</a>&quot;</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="preprocessor">#include &quot;<a class="code" href="magic_8h.html">magic.h</a>&quot;</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="preprocessor">#include &quot;<a class="code" href="map_8h.html">map.h</a>&quot;</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="preprocessor">#include &quot;<a class="code" href="material_8h.html">material.h</a>&quot;</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="preprocessor">#include &quot;<a class="code" href="math__defines_8h.html">math_defines.h</a>&quot;</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="preprocessor">#include &quot;<a class="code" href="messages_8h.html">messages.h</a>&quot;</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span><span class="preprocessor">#include &quot;<a class="code" href="monster_8h.html">monster.h</a>&quot;</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="preprocessor">#include &quot;<a class="code" href="morale__types_8h.html">morale_types.h</a>&quot;</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span><span class="preprocessor">#include &quot;<a class="code" href="mtype_8h.html">mtype.h</a>&quot;</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="preprocessor">#include &quot;<a class="code" href="npc_8h.html">npc.h</a>&quot;</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="preprocessor">#include &quot;<a class="code" href="optional_8h.html">optional.h</a>&quot;</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="preprocessor">#include &quot;<a class="code" href="options_8h.html">options.h</a>&quot;</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span><span class="preprocessor">#include &quot;<a class="code" href="output_8h.html">output.h</a>&quot;</span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span><span class="preprocessor">#include &quot;<a class="code" href="panels_8h.html">panels.h</a>&quot;</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span><span class="preprocessor">#include &quot;<a class="code" href="player_8h.html">player.h</a>&quot;</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span><span class="preprocessor">#include &quot;<a class="code" href="player__activity_8h.html">player_activity.h</a>&quot;</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span><span class="preprocessor">#include &quot;<a class="code" href="point_8h.html">point.h</a>&quot;</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span><span class="preprocessor">#include &quot;<a class="code" href="projectile_8h.html">projectile.h</a>&quot;</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span><span class="preprocessor">#include &quot;<a class="code" href="rng_8h.html">rng.h</a>&quot;</span></div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span><span class="preprocessor">#include &quot;<a class="code" href="skill_8h.html">skill.h</a>&quot;</span></div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span><span class="preprocessor">#include &quot;<a class="code" href="sounds_8h.html">sounds.h</a>&quot;</span></div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span><span class="preprocessor">#include &quot;<a class="code" href="string__formatter_8h.html">string_formatter.h</a>&quot;</span></div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span><span class="preprocessor">#include &quot;<a class="code" href="string__id_8h.html">string_id.h</a>&quot;</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span><span class="preprocessor">#include &quot;<a class="code" href="translations_8h.html">translations.h</a>&quot;</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span><span class="preprocessor">#include &quot;<a class="code" href="trap_8h.html">trap.h</a>&quot;</span></div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span><span class="preprocessor">#include &quot;<a class="code" href="type__id_8h.html">type_id.h</a>&quot;</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span><span class="preprocessor">#include &quot;<a class="code" href="ui__manager_8h.html">ui_manager.h</a>&quot;</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span><span class="preprocessor">#include &quot;<a class="code" href="units_8h.html">units.h</a>&quot;</span></div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span><span class="preprocessor">#include &quot;<a class="code" href="units__angle_8h.html">units_angle.h</a>&quot;</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span><span class="preprocessor">#include &quot;<a class="code" href="units__utility_8h.html">units_utility.h</a>&quot;</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span><span class="preprocessor">#include &quot;<a class="code" href="value__ptr_8h.html">value_ptr.h</a>&quot;</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span><span class="preprocessor">#include &quot;<a class="code" href="vehicle_8h.html">vehicle.h</a>&quot;</span></div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span><span class="preprocessor">#include &quot;<a class="code" href="vpart__position_8h.html">vpart_position.h</a>&quot;</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span> </div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span><span class="keyword">struct </span><a class="code hl_struct" href="structammo__effect.html">ammo_effect</a>;</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span> </div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a162c25498e3347a41712a4746b8b5100">   75</a></span><span class="keyword">using</span> <a class="code hl_class" href="classstring__id.html">ammo_effect_str_id</a> = <a class="code hl_class" href="classstring__id.html">string_id&lt;ammo_effect&gt;</a>;</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span> </div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a4832c47fe321946202cd17b211b27862">   77</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">ammo_effect_str_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a4832c47fe321946202cd17b211b27862">ammo_effect_ACT_ON_RANGED_HIT</a>( <span class="stringliteral">&quot;ACT_ON_RANGED_HIT&quot;</span> );</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a680b9ce8c9824607142f83b2260dd3ef">   78</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">ammo_effect_str_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a680b9ce8c9824607142f83b2260dd3ef">ammo_effect_BLACKPOWDER</a>( <span class="stringliteral">&quot;BLACKPOWDER&quot;</span> );</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a2e2f893aee74eb40d2c1609963133838">   79</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">ammo_effect_str_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a2e2f893aee74eb40d2c1609963133838">ammo_effect_BOUNCE</a>( <span class="stringliteral">&quot;BOUNCE&quot;</span> );</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a336ae362f6bd28ffde9cd73ccf9be4ae">   80</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">ammo_effect_str_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a336ae362f6bd28ffde9cd73ccf9be4ae">ammo_effect_BURST</a>( <span class="stringliteral">&quot;BURST&quot;</span> );</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ab656471d666816a9cd8ae082f81ac021">   81</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">ammo_effect_str_id</a> <a class="code hl_variable" href="ranged_8cpp.html#ab656471d666816a9cd8ae082f81ac021">ammo_effect_CUSTOM_EXPLOSION</a>( <span class="stringliteral">&quot;CUSTOM_EXPLOSION&quot;</span> );</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a02a98acfc0759dc42a3683ec82f936a9">   82</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">ammo_effect_str_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a02a98acfc0759dc42a3683ec82f936a9">ammo_effect_EMP</a>( <span class="stringliteral">&quot;EMP&quot;</span> );</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#aac5abe3e4bd613b31a66a3a04df87a87">   83</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">ammo_effect_str_id</a> <a class="code hl_variable" href="ranged_8cpp.html#aac5abe3e4bd613b31a66a3a04df87a87">ammo_effect_EXPLOSIVE</a>( <span class="stringliteral">&quot;EXPLOSIVE&quot;</span> );</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a56ca2e5cfeec3ed46b11661ab0d4a51d">   84</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">ammo_effect_str_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a56ca2e5cfeec3ed46b11661ab0d4a51d">ammo_effect_HEAVY_HIT</a>( <span class="stringliteral">&quot;HEAVY_HIT&quot;</span> );</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ab5bc741878d9b8001686d7776457d9f9">   85</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">ammo_effect_str_id</a> <a class="code hl_variable" href="ranged_8cpp.html#ab5bc741878d9b8001686d7776457d9f9">ammo_effect_IGNITE</a>( <span class="stringliteral">&quot;IGNITE&quot;</span> );</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a4823a8b924c5e1c83c8e1e1a316e1ae7">   86</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">ammo_effect_str_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a4823a8b924c5e1c83c8e1e1a316e1ae7">ammo_effect_LASER</a>( <span class="stringliteral">&quot;LASER&quot;</span> );</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a17d7acb18d1ef9119106898d678fac76">   87</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">ammo_effect_str_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a17d7acb18d1ef9119106898d678fac76">ammo_effect_LIGHTNING</a>( <span class="stringliteral">&quot;LIGHTNING&quot;</span> );</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a99d97c99b6e5d138e7daa56d509e13ed">   88</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">ammo_effect_str_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a99d97c99b6e5d138e7daa56d509e13ed">ammo_effect_NO_CRIT</a>( <span class="stringliteral">&quot;NO_CRIT&quot;</span> );</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a8f6e1a41d7fec5aac1acdc98363c8cc4">   89</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">ammo_effect_str_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a8f6e1a41d7fec5aac1acdc98363c8cc4">ammo_effect_NO_EMBED</a>( <span class="stringliteral">&quot;NO_EMBED&quot;</span> );</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#aa3f58e0db88c98c686cbce467d25fd94">   90</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">ammo_effect_str_id</a> <a class="code hl_variable" href="ranged_8cpp.html#aa3f58e0db88c98c686cbce467d25fd94">ammo_effect_NO_ITEM_DAMAGE</a>( <span class="stringliteral">&quot;NO_ITEM_DAMAGE&quot;</span> );</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ab97e95eba84f451228755a351c0476f7">   91</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">ammo_effect_str_id</a> <a class="code hl_variable" href="ranged_8cpp.html#ab97e95eba84f451228755a351c0476f7">ammo_effect_NON_FOULING</a>( <span class="stringliteral">&quot;NON-FOULING&quot;</span> );</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#aaf09bb55e60a45b1eb81e989d0758e93">   92</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">ammo_effect_str_id</a> <a class="code hl_variable" href="ranged_8cpp.html#aaf09bb55e60a45b1eb81e989d0758e93">ammo_effect_PLASMA</a>( <span class="stringliteral">&quot;PLASMA&quot;</span> );</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#afa18fa10e4bc2e18f3911cebb559b7bd">   93</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">ammo_effect_str_id</a> <a class="code hl_variable" href="ranged_8cpp.html#afa18fa10e4bc2e18f3911cebb559b7bd">ammo_effect_RECYCLED</a>( <span class="stringliteral">&quot;RECYCLED&quot;</span> );</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a7037269f2b6a941bc0e3f2e659450f32">   94</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">ammo_effect_str_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a7037269f2b6a941bc0e3f2e659450f32">ammo_effect_SHATTER_SELF</a>( <span class="stringliteral">&quot;SHATTER_SELF&quot;</span> );</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#adf294508632caed42c2bd4c1bf7a40d0">   95</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">ammo_effect_str_id</a> <a class="code hl_variable" href="ranged_8cpp.html#adf294508632caed42c2bd4c1bf7a40d0">ammo_effect_SHOT</a>( <span class="stringliteral">&quot;SHOT&quot;</span> );</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#aa629b07204a26cf4e57eabe425b3d5c4">   96</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">ammo_effect_str_id</a> <a class="code hl_variable" href="ranged_8cpp.html#aa629b07204a26cf4e57eabe425b3d5c4">ammo_effect_TANGLE</a>( <span class="stringliteral">&quot;TANGLE&quot;</span> );</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a08fa47ab74c2457fe092efe94c352dd7">   97</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">ammo_effect_str_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a08fa47ab74c2457fe092efe94c352dd7">ammo_effect_WHIP</a>( <span class="stringliteral">&quot;WHIP&quot;</span> );</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ad2f60bde7290b0993994d14fad34a3e9">   98</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">ammo_effect_str_id</a> <a class="code hl_variable" href="ranged_8cpp.html#ad2f60bde7290b0993994d14fad34a3e9">ammo_effect_WIDE</a>( <span class="stringliteral">&quot;WIDE&quot;</span> );</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span> </div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a08481f62adb6937636ea44b855311037">  100</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">efftype_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a08481f62adb6937636ea44b855311037">effect_downed</a>( <span class="stringliteral">&quot;downed&quot;</span> );</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a4de2ef4c2e145815427b09adfaa0def5">  101</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">efftype_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a4de2ef4c2e145815427b09adfaa0def5">effect_hit_by_player</a>( <span class="stringliteral">&quot;hit_by_player&quot;</span> );</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a3be9304af3e12dfef2f28becb7b93011">  102</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">efftype_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a3be9304af3e12dfef2f28becb7b93011">effect_on_roof</a>( <span class="stringliteral">&quot;on_roof&quot;</span> );</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span> </div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a21b633b2e3ce24798652a8392b2be96e">  104</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">itype_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a21b633b2e3ce24798652a8392b2be96e">itype_12mm</a>( <span class="stringliteral">&quot;12mm&quot;</span> );</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a72d322a82b6cac799c940f935cbee213">  105</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">itype_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a72d322a82b6cac799c940f935cbee213">itype_40x46mm</a>( <span class="stringliteral">&quot;40x46mm&quot;</span> );</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a7cebe4dcc0fe98d9a37fe19beb640e1f">  106</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">itype_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a7cebe4dcc0fe98d9a37fe19beb640e1f">itype_40x53mm</a>( <span class="stringliteral">&quot;40x53mm&quot;</span> );</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ae3075e5ce833b51beabbbf41bec72156">  107</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">itype_id</a> <a class="code hl_variable" href="ranged_8cpp.html#ae3075e5ce833b51beabbbf41bec72156">itype_66mm</a>( <span class="stringliteral">&quot;66mm&quot;</span> );</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a804a5958c8dea5a130b8a5c7fe686ac6">  108</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">itype_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a804a5958c8dea5a130b8a5c7fe686ac6">itype_84x246mm</a>( <span class="stringliteral">&quot;84x246mm&quot;</span> );</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a1c359a305b979b2e5fc87d15db51e903">  109</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">itype_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a1c359a305b979b2e5fc87d15db51e903">itype_adv_UPS_off</a>( <span class="stringliteral">&quot;adv_UPS_off&quot;</span> );</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#af6105e558342bb67286a7f70682f652f">  110</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">itype_id</a> <a class="code hl_variable" href="ranged_8cpp.html#af6105e558342bb67286a7f70682f652f">itype_arrow</a>( <span class="stringliteral">&quot;arrow&quot;</span> );</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a8003de0be6343d0b891adb019a7b51ea">  111</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">itype_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a8003de0be6343d0b891adb019a7b51ea">itype_bolt</a>( <span class="stringliteral">&quot;bolt&quot;</span> );</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a0ccb4d60ab6785e534c7eaa8ad7d07c6">  112</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">itype_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a0ccb4d60ab6785e534c7eaa8ad7d07c6">itype_brass_catcher</a>( <span class="stringliteral">&quot;brass_catcher&quot;</span> );</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a31e6d6147ad05dd584d1f1e71ac5dce7">  113</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">itype_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a31e6d6147ad05dd584d1f1e71ac5dce7">itype_flammable</a>( <span class="stringliteral">&quot;flammable&quot;</span> );</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a45b1f02f143134444fdec57043934598">  114</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">itype_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a45b1f02f143134444fdec57043934598">itype_m235</a>( <span class="stringliteral">&quot;m235&quot;</span> );</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a8cd1e1b3b0c3c6b1ba13f05f3831279c">  115</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">itype_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a8cd1e1b3b0c3c6b1ba13f05f3831279c">itype_metal_rail</a>( <span class="stringliteral">&quot;metal_rail&quot;</span> );</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a55a80a9bbab1925d5462d46d355c2b6e">  116</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">itype_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a55a80a9bbab1925d5462d46d355c2b6e">itype_UPS</a>( <span class="stringliteral">&quot;UPS&quot;</span> );</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ae89306fd36cf36b57fe05dad0db3f71b">  117</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">itype_id</a> <a class="code hl_variable" href="ranged_8cpp.html#ae89306fd36cf36b57fe05dad0db3f71b">itype_UPS_off</a>( <span class="stringliteral">&quot;UPS_off&quot;</span> );</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span> </div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a26f773999c96865544c00b5496637d56">  119</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">trap_str_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a26f773999c96865544c00b5496637d56">tr_practice_target</a>( <span class="stringliteral">&quot;tr_practice_target&quot;</span> );</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span> </div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a6a67c1570499e9c4ab345a0c6f1ba026">  121</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">fault_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a6a67c1570499e9c4ab345a0c6f1ba026">fault_gun_blackpowder</a>( <span class="stringliteral">&quot;fault_gun_blackpowder&quot;</span> );</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">  122</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">fault_id</a> <a class="code hl_variable" href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a>( <span class="stringliteral">&quot;fault_gun_chamber_spent&quot;</span> );</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a0ea533037e4a6a02394d39e2d62174bc">  123</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">fault_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a0ea533037e4a6a02394d39e2d62174bc">fault_gun_dirt</a>( <span class="stringliteral">&quot;fault_gun_dirt&quot;</span> );</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ad73ddd0cc91027278ca5627eaa4ef206">  124</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">fault_id</a> <a class="code hl_variable" href="ranged_8cpp.html#ad73ddd0cc91027278ca5627eaa4ef206">fault_gun_unlubricated</a>( <span class="stringliteral">&quot;fault_gun_unlubricated&quot;</span> );</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span> </div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a1d5482b7403ee4ac3e70e88ecfee2141">  126</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">skill_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a1d5482b7403ee4ac3e70e88ecfee2141">skill_dodge</a>( <span class="stringliteral">&quot;dodge&quot;</span> );</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#afee8dcfd12a225c469ee6171063d7594">  127</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">skill_id</a> <a class="code hl_variable" href="ranged_8cpp.html#afee8dcfd12a225c469ee6171063d7594">skill_driving</a>( <span class="stringliteral">&quot;driving&quot;</span> );</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a3eadead4a9aa7fee079c0b1acce7965e">  128</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">skill_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a3eadead4a9aa7fee079c0b1acce7965e">skill_gun</a>( <span class="stringliteral">&quot;gun&quot;</span> );</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a0c6f7a1d7eeb2c38d69b568d85eb9f0d">  129</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">skill_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a0c6f7a1d7eeb2c38d69b568d85eb9f0d">skill_launcher</a>( <span class="stringliteral">&quot;launcher&quot;</span> );</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">  130</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">skill_id</a> <a class="code hl_variable" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a>( <span class="stringliteral">&quot;throw&quot;</span> );</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span> </div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a738f726f320c7f5b5edca445777a14fa">  132</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">bionic_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a738f726f320c7f5b5edca445777a14fa">bio_railgun</a>( <span class="stringliteral">&quot;bio_railgun&quot;</span> );</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a0919705e5cea2aa623cbda27d0cae0b6">  133</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">bionic_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a0919705e5cea2aa623cbda27d0cae0b6">bio_targeting</a>( <span class="stringliteral">&quot;bio_targeting&quot;</span> );</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ac48fadf8e0cc0bf9f6800029de9084d6">  134</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">bionic_id</a> <a class="code hl_variable" href="ranged_8cpp.html#ac48fadf8e0cc0bf9f6800029de9084d6">bio_ups</a>( <span class="stringliteral">&quot;bio_ups&quot;</span> );</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span> </div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a916c022e69240915ee6678d0170882d3">  136</a></span><span class="keyword">static</span> <span class="keyword">const</span> std::string <a class="code hl_function" href="ranged_8cpp.html#a916c022e69240915ee6678d0170882d3">flag_CONSUMABLE</a>( <span class="stringliteral">&quot;CONSUMABLE&quot;</span> );</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a02edfa7a6cb1a0f7a67ae1aca7a34753">  137</a></span><span class="keyword">static</span> <span class="keyword">const</span> std::string <a class="code hl_function" href="ranged_8cpp.html#a02edfa7a6cb1a0f7a67ae1aca7a34753">flag_FIRE_TWOHAND</a>( <span class="stringliteral">&quot;FIRE_TWOHAND&quot;</span> );</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#abca795246deac76d5cf0515c16bb75c8">  138</a></span><span class="keyword">static</span> <span class="keyword">const</span> std::string <a class="code hl_function" href="ranged_8cpp.html#abca795246deac76d5cf0515c16bb75c8">flag_MOUNTABLE</a>( <span class="stringliteral">&quot;MOUNTABLE&quot;</span> );</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a9a327f2be95a30526c2d1ab6a31f72b2">  139</a></span><span class="keyword">static</span> <span class="keyword">const</span> std::string <a class="code hl_function" href="ranged_8cpp.html#a9a327f2be95a30526c2d1ab6a31f72b2">flag_MOUNTED_GUN</a>( <span class="stringliteral">&quot;MOUNTED_GUN&quot;</span> );</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ab2dd3d8bd3db68ab02a94d2d26d2fc5a">  140</a></span><span class="keyword">static</span> <span class="keyword">const</span> std::string <a class="code hl_function" href="ranged_8cpp.html#ab2dd3d8bd3db68ab02a94d2d26d2fc5a">flag_NEVER_JAMS</a>( <span class="stringliteral">&quot;NEVER_JAMS&quot;</span> );</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#aa125c6da24f14c1bec090943b0174e58">  141</a></span><span class="keyword">static</span> <span class="keyword">const</span> std::string <a class="code hl_function" href="ranged_8cpp.html#aa125c6da24f14c1bec090943b0174e58">flag_NON_FOULING</a>( <span class="stringliteral">&quot;NON-FOULING&quot;</span> );</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ad23a05e76b668009068f0e453c33692b">  142</a></span><span class="keyword">static</span> <span class="keyword">const</span> std::string <a class="code hl_function" href="ranged_8cpp.html#ad23a05e76b668009068f0e453c33692b">flag_PRIMITIVE_RANGED_WEAPON</a>( <span class="stringliteral">&quot;PRIMITIVE_RANGED_WEAPON&quot;</span> );</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#add0bf5e67088357d1ff569fc62addb60">  143</a></span><span class="keyword">static</span> <span class="keyword">const</span> std::string <a class="code hl_function" href="ranged_8cpp.html#add0bf5e67088357d1ff569fc62addb60">flag_PYROMANIAC_WEAPON</a>( <span class="stringliteral">&quot;PYROMANIAC_WEAPON&quot;</span> );</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a30c9d25adcf2167a8bff0fe6ca21fdaf">  144</a></span><span class="keyword">static</span> <span class="keyword">const</span> std::string <a class="code hl_function" href="ranged_8cpp.html#a30c9d25adcf2167a8bff0fe6ca21fdaf">flag_RELOAD_AND_SHOOT</a>( <span class="stringliteral">&quot;RELOAD_AND_SHOOT&quot;</span> );</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#aeac06317fd010c6001b6b71968bc15c1">  145</a></span><span class="keyword">static</span> <span class="keyword">const</span> std::string <a class="code hl_function" href="ranged_8cpp.html#aeac06317fd010c6001b6b71968bc15c1">flag_RESTRICT_HANDS</a>( <span class="stringliteral">&quot;RESTRICT_HANDS&quot;</span> );</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a3756f1dde5d862fe1b0f0240dfc13e6a">  146</a></span><span class="keyword">static</span> <span class="keyword">const</span> std::string <a class="code hl_function" href="ranged_8cpp.html#a3756f1dde5d862fe1b0f0240dfc13e6a">flag_STR_DRAW</a>( <span class="stringliteral">&quot;STR_DRAW&quot;</span> );</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ab6ca472fa792b69b4a6afa8ca9e63a58">  147</a></span><span class="keyword">static</span> <span class="keyword">const</span> std::string <a class="code hl_function" href="ranged_8cpp.html#ab6ca472fa792b69b4a6afa8ca9e63a58">flag_UNDERWATER_GUN</a>( <span class="stringliteral">&quot;UNDERWATER_GUN&quot;</span> );</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a08cb2ed99917b1260118f74991ece915">  148</a></span><span class="keyword">static</span> <span class="keyword">const</span> std::string <a class="code hl_function" href="ranged_8cpp.html#a08cb2ed99917b1260118f74991ece915">flag_VEHICLE</a>( <span class="stringliteral">&quot;VEHICLE&quot;</span> );</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span> </div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a512959ad2b35ea057f2fed5445fc23c4">  150</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">trait_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a512959ad2b35ea057f2fed5445fc23c4">trait_PYROMANIA</a>( <span class="stringliteral">&quot;PYROMANIA&quot;</span> );</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a7a08490346831114f00f3e44cbe454e3">  151</a></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">trait_id</a> <a class="code hl_variable" href="ranged_8cpp.html#a7a08490346831114f00f3e44cbe454e3">trait_NORANGEDCRIT</a>( <span class="stringliteral">&quot;NO_RANGED_CRIT&quot;</span> );</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span> </div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span><span class="comment">// Maximum duration of aim-and-fire loop, in turns</span></div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ae134db696195500e4ff1835e6f784aca">  154</a></span><span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">int</span> <a class="code hl_variable" href="ranged_8cpp.html#ae134db696195500e4ff1835e6f784aca">AIF_DURATION_LIMIT</a> = 10;</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span> </div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span><span class="keyword">static</span> <a class="code hl_struct" href="structprojectile.html">projectile</a> <a class="code hl_function" href="ranged_8cpp.html#ab0db3d2d826960249b5a1d47fa7881ff">make_gun_projectile</a>( <span class="keyword">const</span> <a class="code hl_class" href="classitem.html">item</a> &amp;gun );</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span><span class="keywordtype">int</span> <a class="code hl_function" href="ranged_8cpp.html#a613a8b59e4b2f2aaf05091d354bb4aa3">time_to_attack</a>( <span class="keyword">const</span> <a class="code hl_class" href="classCharacter.html">Character</a> &amp;p, <span class="keyword">const</span> <a class="code hl_struct" href="structitype.html">itype</a> &amp;firing );</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="ranged_8cpp.html#a8b90a63ce217d881ddad6a7456c4a98e">cycle_action</a>( <a class="code hl_class" href="classitem.html">item</a> &amp;weap, <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;pos );</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span><span class="keywordtype">void</span> <a class="code hl_function" href="ranged_8cpp.html#a9d14a0cc5b70610323cf40b51929fae5">make_gun_sound_effect</a>( <span class="keyword">const</span> <a class="code hl_class" href="classplayer.html">player</a> &amp;p, <span class="keywordtype">bool</span> burst, <a class="code hl_class" href="classitem.html">item</a> *weapon );</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span><span class="keywordtype">bool</span> <a class="code hl_function" href="ranged_8cpp.html#a6bfc75cd10b0d4de99dc6dcb44abc85b">can_use_bipod</a>( <span class="keyword">const</span> <a class="code hl_class" href="classmap.html">map</a> &amp;m, <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;pos );</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span><a class="code hl_class" href="classdispersion__sources.html">dispersion_sources</a> <a class="code hl_function" href="ranged_8cpp.html#a75bb71c29339b16696e3a2eb384bbc3c">calculate_dispersion</a>( <span class="keyword">const</span> <a class="code hl_class" href="classmap.html">map</a> &amp;m, <span class="keyword">const</span> <a class="code hl_class" href="classplayer.html">player</a> &amp;p, <span class="keyword">const</span> <a class="code hl_class" href="classitem.html">item</a> &amp;gun,</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>        <span class="keywordtype">int</span> at_recoil, <span class="keywordtype">bool</span> burst );</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span> </div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno"><a class="line" href="classtarget__ui.html">  164</a></span><span class="keyword">class </span><a class="code hl_class" href="classtarget__ui.html">target_ui</a></div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>{</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>    <span class="keyword">public</span>:</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>        <span class="comment">/* None of the public members (except range) should be modified during execution */</span></div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span> </div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997">  169</a></span>        <span class="keyword">enum class</span> <a class="code hl_enumeration" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997">TargetMode</a> : int {</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>            <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">Fire</a>,</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>            <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8ce61dd2505effd96f937fa743b6491f">Throw</a>,</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>            <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8f61cfb2c3938627416432409d2f6e86">ThrowBlind</a>,</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>            <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">Turrets</a>,</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>            <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70">TurretManual</a>,</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>            <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997ab350f6de1060afddbefbdf47552464ae">Reach</a>,</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>            <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd">Spell</a>,</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>            <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a880c1273b27d27cfc82004c3a4b205c9">Shape</a></div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>        };</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span> </div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>        <span class="comment">// Avatar</span></div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">  181</a></span>        <a class="code hl_class" href="classavatar.html">avatar</a> *<a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>;</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>        <span class="comment">// Interface mode</span></div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno"><a class="line" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">  183</a></span>        <a class="code hl_enumeration" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997">TargetMode</a> <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> = <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a>;</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>        <span class="comment">// Weapon being fired/thrown</span></div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">  185</a></span>        <a class="code hl_class" href="classitem.html">item</a> *<a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>        <span class="comment">// Cached selection range from player&#39;s position</span></div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno"><a class="line" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">  187</a></span>        <span class="keywordtype">int</span> <a class="code hl_variable" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> = 0;</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>        <span class="comment">// Turret being manually fired</span></div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ae9e40adc2b44c3cd4cdbcc62dd8a1e30">  189</a></span>        <a class="code hl_class" href="classturret__data.html">turret_data</a> *<a class="code hl_variable" href="classtarget__ui.html#ae9e40adc2b44c3cd4cdbcc62dd8a1e30">turret</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>        <span class="comment">// Turrets being fired (via vehicle controls)</span></div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ae7a7446b4088911709b2eb6a1d3973e5">  191</a></span>        <span class="keyword">const</span> std::vector&lt;vehicle_part *&gt; *<a class="code hl_variable" href="classtarget__ui.html#ae7a7446b4088911709b2eb6a1d3973e5">vturrets</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>        <span class="comment">// Vehicle that turrets belong to</span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ac2200f3f97047dbc1e1cf14bae201c34">  193</a></span>        <a class="code hl_class" href="classvehicle.html">vehicle</a> *<a class="code hl_variable" href="classtarget__ui.html#ac2200f3f97047dbc1e1cf14bae201c34">veh</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>        <span class="comment">// Spell being cast</span></div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno"><a class="line" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">  195</a></span>        <a class="code hl_class" href="classspell.html">spell</a> *<a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>        <span class="comment">// Spell cannot fail</span></div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a146d794c8cb9c23e6ba71727c9a25852">  197</a></span>        <span class="keywordtype">bool</span> <a class="code hl_variable" href="classtarget__ui.html#a146d794c8cb9c23e6ba71727c9a25852">no_fail</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>        <span class="comment">// Spell does not require mana</span></div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ac9b01fafb341eaec6c8f85582fd7f32f">  199</a></span>        <span class="keywordtype">bool</span> <a class="code hl_variable" href="classtarget__ui.html#ac9b01fafb341eaec6c8f85582fd7f32f">no_mana</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>        <span class="comment">// Relevant activity</span></div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno"><a class="line" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">  201</a></span>        <a class="code hl_class" href="classaim__activity__actor.html">aim_activity_actor</a> *<a class="code hl_variable" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>        <span class="comment">// Generator of AoE shapes</span></div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a2f93a66a18420fd252e275a9c6f536d4">  203</a></span>        <a class="code hl_class" href="classcata_1_1optional.html">cata::optional&lt;shape_factory&gt;</a> <a class="code hl_variable" href="classtarget__ui.html#a2f93a66a18420fd252e275a9c6f536d4">shape_gen</a>;</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span> </div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>        <span class="comment">// Initialize UI and run the event loop</span></div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>        <a class="code hl_typedef" href="namespacetarget__handler.html#aea843144f5e69546ddea88eeda177640">target_handler::trajectory</a> <a class="code hl_function" href="classtarget__ui.html#a11be420f4d6ffd6128dd23d01be6c310">run</a>();</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span> </div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>    <span class="keyword">private</span>:</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno"><a class="line" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6">  209</a></span>        <span class="keyword">enum class</span> <a class="code hl_enumeration" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6">ExitCode</a> : int {</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>            <a class="code hl_enumvalue" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6a727b63583e01fa2b3952dab580c84dc2">Abort</a>,</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>            <a class="code hl_enumvalue" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6abd2b7e5f85a6ea65065c4ebc6d7c95bb">Fire</a>,</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>            <a class="code hl_enumvalue" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6ac85a251cc457840f1e032f1b733e9398">Timeout</a>,</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>            <a class="code hl_enumvalue" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6a4d1c8263ba1036754f8db14a98f9f006">Reload</a></div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>        };</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span> </div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202">  216</a></span>        <span class="keyword">enum class</span> <a class="code hl_enumeration" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202">Status</a> : int {</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>            <a class="code hl_enumvalue" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a0c6ad70beb3a7e76c3fc7adab7c46acc">Good</a>, <span class="comment">// All UI elements are enabled</span></div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>            <a class="code hl_enumvalue" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a45c9ef8264639e178f18806be2b9a408">BadTarget</a>, <span class="comment">// Bad &#39;dst&#39; selected; forbid aiming/firing</span></div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>            <a class="code hl_enumvalue" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202aaa5b08f858f7353c5d012d6706525773">OutOfAmmo</a>, <span class="comment">// Selected gun mode is out of ammo; forbid moving cursor,aiming and firing</span></div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>            <a class="code hl_enumvalue" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a365b2699d38b61ef4b4c8a1066c8468f">OutOfRange</a> <span class="comment">// Selected target is out of range of current gun mode; forbid aiming/firing</span></div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>        };</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span> </div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>        <span class="comment">// Ui status (affects which UI controls are temporarily disabled)</span></div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno"><a class="line" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">  224</a></span>        <a class="code hl_enumeration" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202">Status</a> <a class="code hl_variable" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> = <a class="code hl_enumvalue" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a0c6ad70beb3a7e76c3fc7adab7c46acc">Status::Good</a>;</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span> </div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>        <span class="comment">// Cached current ammo to display</span></div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ae5ae79a739fcab56301077b8802355ce">  227</a></span>        <span class="keyword">const</span> <a class="code hl_struct" href="structitype.html">itype</a> *<a class="code hl_variable" href="classtarget__ui.html#ae5ae79a739fcab56301077b8802355ce">ammo</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>        <span class="comment">// Current trajectory</span></div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">  229</a></span>        std::vector&lt;tripoint&gt; <a class="code hl_variable" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">traj</a>;</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>        <span class="comment">// Aiming source (player&#39;s position)</span></div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno"><a class="line" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">  231</a></span>        <a class="code hl_struct" href="structtripoint.html">tripoint</a> <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>;</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>        <span class="comment">// Aiming destination (cursor position)</span></div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>        <span class="comment">// Use set_cursor_pos() to modify</span></div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">  234</a></span>        <a class="code hl_struct" href="structtripoint.html">tripoint</a> <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a>;</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>        <span class="comment">// Creature currently under cursor. nullptr if aiming at empty tile,</span></div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>        <span class="comment">// yourself or a creature you cannot see</span></div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">  237</a></span>        <a class="code hl_class" href="classCreature.html">Creature</a> *<a class="code hl_variable" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>        <span class="comment">// List of visible hostile targets</span></div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">  239</a></span>        std::vector&lt;Creature *&gt; <a class="code hl_variable" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>;</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span> </div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>        <span class="comment">// &#39;true&#39; if map has z levels and 3D fov is on</span></div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a45f98789c877903961a56a54b17d9e96">  242</a></span>        <span class="keywordtype">bool</span> <a class="code hl_variable" href="classtarget__ui.html#a45f98789c877903961a56a54b17d9e96">allow_zlevel_shift</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>        <span class="comment">// Snap camera to cursor. Can be permanently toggled in settings</span></div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>        <span class="comment">// or temporarily in this window</span></div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a270f72c5bfef55a533d3cd9b3cf57ea0">  245</a></span>        <span class="keywordtype">bool</span> <a class="code hl_variable" href="classtarget__ui.html#a270f72c5bfef55a533d3cd9b3cf57ea0">snap_to_target</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>        <span class="comment">// If true, LEVEL_UP, LEVEL_DOWN and directional keys</span></div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>        <span class="comment">// responsible for moving cursor will shift view instead.</span></div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a122323ec4c1e72c291e76643ccfd3fde">  248</a></span>        <span class="keywordtype">bool</span> <a class="code hl_variable" href="classtarget__ui.html#a122323ec4c1e72c291e76643ccfd3fde">shifting_view</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span> </div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>        <span class="comment">// Compact layout</span></div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a34b69263e28fa4472b51104ec1d2e6f0">  251</a></span>        <span class="keywordtype">bool</span> <a class="code hl_variable" href="classtarget__ui.html#a34b69263e28fa4472b51104ec1d2e6f0">compact</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>        <span class="comment">// Tiny layout - when extremely short on space</span></div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a1e6534092ef1b213639575c914030eb1">  253</a></span>        <span class="keywordtype">bool</span> <a class="code hl_variable" href="classtarget__ui.html#a1e6534092ef1b213639575c914030eb1">tiny</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>        <span class="comment">// Narrow layout - to keep in theme with</span></div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>        <span class="comment">// &quot;compact&quot; and &quot;labels-narrow&quot; sidebar styles.</span></div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a4b525b1e2a39f4748409b97e8984947b">  256</a></span>        <span class="keywordtype">bool</span> <a class="code hl_variable" href="classtarget__ui.html#a4b525b1e2a39f4748409b97e8984947b">narrow</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>        <span class="comment">// Window</span></div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">  258</a></span>        <a class="code hl_class" href="classcatacurses_1_1window.html">catacurses::window</a> <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>;</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>        <span class="comment">// Input context</span></div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">  260</a></span>        <a class="code hl_class" href="classinput__context.html">input_context</a> <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>;</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span> </div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>        <span class="comment">/* These members are relevant for TargetMode::Fire */</span></div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>        <span class="comment">// Weapon sight dispersion</span></div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a2e6f4c9c827b91ce215a1a7b32a4affb">  264</a></span>        <span class="keywordtype">int</span> <a class="code hl_variable" href="classtarget__ui.html#a2e6f4c9c827b91ce215a1a7b32a4affb">sight_dispersion</a> = 0;</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>        <span class="comment">// List of available weapon aim types</span></div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno"><a class="line" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">  266</a></span>        std::vector&lt;aim_type&gt; <a class="code hl_variable" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a>;</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>        <span class="comment">// Currently selected aim mode</span></div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">  268</a></span>        std::vector&lt;aim_type&gt;::iterator <a class="code hl_variable" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">aim_mode</a>;</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>        <span class="comment">// &#39;Recoil&#39; value the player will reach if they</span></div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>        <span class="comment">// start aiming at cursor position. Equals player&#39;s</span></div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>        <span class="comment">// &#39;recoil&#39; while they are actively spending moves to aim,</span></div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>        <span class="comment">// but increases the further away the new aim point will be</span></div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>        <span class="comment">// relative to the current one.</span></div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ac0a5aad7e60b30082e7ec2ff97f8f6d4">  274</a></span>        <span class="keywordtype">double</span> <a class="code hl_variable" href="classtarget__ui.html#ac0a5aad7e60b30082e7ec2ff97f8f6d4">predicted_recoil</a> = 0;</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span> </div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>        <span class="comment">// For AOE spells, list of tiles affected by the spell</span></div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>        <span class="comment">// relevant for TargetMode::Spell</span></div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ab855722580bd112ef0590b5a9b4f3556">  278</a></span>        std::set&lt;tripoint&gt; <a class="code hl_variable" href="classtarget__ui.html#ab855722580bd112ef0590b5a9b4f3556">spell_aoe</a>;</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span> </div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>        <span class="comment">// For shaped attacks, we want both points and coverage</span></div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a6f2c970f904d7b8c06e403dbc4560f4d">  281</a></span>        std::map&lt;tripoint, double&gt; <a class="code hl_variable" href="classtarget__ui.html#a6f2c970f904d7b8c06e403dbc4560f4d">shape_coverage</a>;</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span> </div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>        <span class="comment">// Represents a turret and a straight line from that turret to target</span></div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno"><a class="line" href="structtarget__ui_1_1turret__with__lof.html">  284</a></span>        <span class="keyword">struct </span><a class="code hl_struct" href="structtarget__ui_1_1turret__with__lof.html">turret_with_lof</a> {</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno"><a class="line" href="structtarget__ui_1_1turret__with__lof.html#aaa416c09474e4040a712a05bbb5e99cf">  285</a></span>            <a class="code hl_struct" href="structvehicle__part.html">vehicle_part</a> *<a class="code hl_variable" href="structtarget__ui_1_1turret__with__lof.html#aaa416c09474e4040a712a05bbb5e99cf">turret</a>;</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno"><a class="line" href="structtarget__ui_1_1turret__with__lof.html#a4422bb428b5d266bad798974571c9baf">  286</a></span>            std::vector&lt;tripoint&gt; <a class="code hl_variable" href="structtarget__ui_1_1turret__with__lof.html#a4422bb428b5d266bad798974571c9baf">line</a>;</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>        };</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span> </div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>        <span class="comment">// List of vehicle turrets in range (out of those listed in &#39;vturrets&#39;)</span></div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ae8d4216fdc3f48ee8f6dd5f22c33d9d9">  290</a></span>        std::vector&lt;turret_with_lof&gt; <a class="code hl_variable" href="classtarget__ui.html#ae8d4216fdc3f48ee8f6dd5f22c33d9d9">turrets_in_range</a>;</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span> </div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>        <span class="comment">// If true, draws turret lines</span></div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>        <span class="comment">// relevant for TargetMode::Turrets</span></div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a63ac73585a9794e93d181362f7473b50">  294</a></span>        <span class="keywordtype">bool</span> <a class="code hl_variable" href="classtarget__ui.html#a63ac73585a9794e93d181362f7473b50">draw_turret_lines</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span> </div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>        <span class="comment">// Create window and set up input context</span></div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#af3857720f2059a0a2f23896bc7e808c7">init_window_and_input</a>();</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span> </div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>        <span class="comment">// Handle input related to cursor movement.</span></div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>        <span class="comment">// Returns &#39;true&#39; if action was recognized and processed.</span></div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>        <span class="comment">// &#39;skip_redraw&#39; is set to &#39;true&#39; if there is no need to redraw the UI.</span></div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>        <span class="keywordtype">bool</span> <a class="code hl_function" href="classtarget__ui.html#ab290e475e7cd308b447788ec369053b0">handle_cursor_movement</a>( <span class="keyword">const</span> std::string &amp;<a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>, <span class="keywordtype">bool</span> &amp;skip_redraw );</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span> </div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>        <span class="comment">// Set cursor position. If new position is out of range,</span></div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>        <span class="comment">// selects closest position in range.</span></div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>        <span class="comment">// Returns &#39;false&#39; if cursor position did not change</span></div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>        <span class="keywordtype">bool</span> <a class="code hl_function" href="classtarget__ui.html#a3ead422f4a78394c13bc3f4c6c953f42">set_cursor_pos</a>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;new_pos );</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span> </div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>        <span class="comment">// Called when range/ammo changes (or may have changed)</span></div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#aaf459ec49ad96c44eddeb94d0c22fb36">on_range_ammo_changed</a>();</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span> </div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>        <span class="comment">// Updates &#39;targets&#39; for current range</span></div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#af17fecf6fc24afc0a1af11ee1447b39a">update_target_list</a>();</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span> </div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>        <span class="comment">// Choose where to position the cursor when opening the ui</span></div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>        <a class="code hl_struct" href="structtripoint.html">tripoint</a> <a class="code hl_function" href="classtarget__ui.html#a1591b490e9f8d48547b108ae481f982e">choose_initial_target</a>();</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span><span class="comment"></span> </div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span><span class="comment">        /**</span></div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span><span class="comment">         * Try to re-acquire target for aim-and-fire.</span></div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span><span class="comment">         * @param critter whether were aiming at a critter, or a tile</span></div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span><span class="comment">         * @param new_dst where to move aim cursor (if e.g. critter moved)</span></div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span><span class="comment">         * @returns true on success</span></div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span><span class="comment">         */</span></div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>        <span class="keywordtype">bool</span> <a class="code hl_function" href="classtarget__ui.html#a5c885fc69abc2190e1850b7f23601ac2">try_reacquire_target</a>( <span class="keywordtype">bool</span> critter, <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;new_dst );</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span> </div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>        <span class="comment">// Update &#39;status&#39; variable</span></div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#ad1e40f0212d403109c8969d7308e493f">update_status</a>();</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span> </div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>        <span class="comment">// Calculates distance from &#39;src&#39;. For consistency, prefer using this over rl_dist.</span></div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>        <span class="keywordtype">int</span> <a class="code hl_function" href="classtarget__ui.html#ab236848678058afb7605e6d82a5c8fa9">dist_fn</a>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;p );</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span> </div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>        <span class="comment">// Set creature (or tile) under cursor as player&#39;s last target</span></div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#aa53ba52da62f64baa29130908cf8637b">set_last_target</a>();</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span> </div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>        <span class="comment">// Prompts player to confirm attack on neutral NPC</span></div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>        <span class="comment">// Returns &#39;true&#39; if attack should proceed</span></div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>        <span class="keywordtype">bool</span> <a class="code hl_function" href="classtarget__ui.html#a97d244cde8cae12d0266daf6fc083014">confirm_non_enemy_target</a>();</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span> </div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>        <span class="comment">// Prompts player to re-confirm an ongoing attack if</span></div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>        <span class="comment">// a non-hostile NPC / friendly creatures enters line of fire.</span></div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>        <span class="comment">// Returns &#39;true&#39; if attack should proceed</span></div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>        <span class="keywordtype">bool</span> <a class="code hl_function" href="classtarget__ui.html#ad2ca7887fd647df92c825e8ee153ff84">prompt_friendlies_in_lof</a>();</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span> </div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>        <span class="comment">// List friendly creatures currently occupying line of fire.</span></div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>        std::vector&lt;weak_ptr_fast&lt;Creature&gt;&gt; <a class="code hl_function" href="classtarget__ui.html#ac352f6aae1cb28945f8115b76fea2eb6">list_friendlies_in_lof</a>();</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span> </div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>        <span class="comment">// Toggle snap-to-target</span></div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a779bc721417ab8ee4a6b103d8a1030f5">toggle_snap_to_target</a>();</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span> </div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>        <span class="comment">// Cycle targets. &#39;direction&#39; is either 1 or -1</span></div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#af007dd5fcc266ee10d673299ca90c29c">cycle_targets</a>( <span class="keywordtype">int</span> <a class="code hl_enumeration" href="line_8h.html#a3621d2006812bd84f3ed6999b38f90a3">direction</a> );</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span> </div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>        <span class="comment">// Set new view offset. Updates map cache if necessary</span></div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#abcb5ba4fec5983a480a4f765da7abe23">set_view_offset</a>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;new_offset );</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span> </div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>        <span class="comment">// Updates &#39;turrets_in_range&#39;</span></div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#aa955ab0c7cfbd2c8c5d439f5aed608ef">update_turrets_in_range</a>();</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span> </div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>        <span class="comment">// Recalculate &#39;recoil&#39; penalty. This should be called if</span></div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>        <span class="comment">// avatar&#39;s &#39;recoil&#39; value has been modified</span></div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>        <span class="comment">// Relevant for TargetMode::Fire</span></div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a1403890979533cd6ea29897e3ee81ab5">recalc_aim_turning_penalty</a>();</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span> </div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>        <span class="comment">// Apply penalty to avatar&#39;s &#39;recoil&#39; value based on</span></div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>        <span class="comment">// how much they moved their aim point.</span></div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>        <span class="comment">// Relevant for TargetMode::Fire</span></div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a40bd320b465d966959268698b54a0d98">apply_aim_turning_penalty</a>();</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span> </div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>        <span class="comment">// Switch firing mode.</span></div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a691e0bd6f4c5f82b309fd0e026f77825">action_switch_mode</a>();</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span> </div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>        <span class="comment">// Ensure we&#39;re using ranged gun mode.</span></div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a92256c0cb72fe5b2520a5808a5fcb79a">ensure_ranged_gun_mode</a>();</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span> </div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>        <span class="comment">// Update range &amp; ammo from current gun mode</span></div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a77429c16aec83b5c81d3a1c259259cd5">update_ammo_range_from_gun_mode</a>();</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span> </div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>        <span class="comment">// Switch ammo. Returns &#39;false&#39; if requires a reloading UI.</span></div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>        <span class="keywordtype">bool</span> <a class="code hl_function" href="classtarget__ui.html#acbdcdc8f41dd8bcbf887b12d96c9948d">action_switch_ammo</a>();</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span> </div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>        <span class="comment">// Aim for 10 turns. Returns &#39;false&#39; if ran out of moves</span></div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>        <span class="keywordtype">bool</span> <a class="code hl_function" href="classtarget__ui.html#a6c0468c35f79fb501be1a3a50b4081d4">action_aim</a>();</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span> </div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>        <span class="comment">// Aim and shoot. Returns &#39;false&#39; if ran out of moves</span></div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>        <span class="keywordtype">bool</span> <a class="code hl_function" href="classtarget__ui.html#a21275763803a2ce0d00e02dc0076a36c">action_aim_and_shoot</a>( <span class="keyword">const</span> std::string &amp;<a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> );</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span> </div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>        <span class="comment">// Draw UI-specific terrain overlays</span></div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a15d523ae27fc66cbff7adac5e9fa91dd">draw_terrain_overlay</a>();</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span> </div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>        <span class="comment">// Draw aiming window</span></div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a93a478e95d201324548329f39a087208">draw_ui_window</a>();</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span> </div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>        <span class="comment">// Generate ui window title</span></div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>        std::string <a class="code hl_function" href="classtarget__ui.html#abae2f397600dc6b01bb03f22bcd18666">uitext_title</a>();</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span> </div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>        <span class="comment">// Generate flavor text for &#39;Fire!&#39; key</span></div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>        std::string <a class="code hl_function" href="classtarget__ui.html#a2c23b4913b52b2a5f80357f34d92700c">uitext_fire</a>();</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span> </div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#ad62889056a10382de6835688498cf20e">draw_window_title</a>();</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#acc5b1b952d220d0cd766f9c32ab5eb38">draw_help_notice</a>();</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span> </div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>        <span class="comment">// Draw list of available controls at the bottom of the window.</span></div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>        <span class="comment">// text_y - first free line counting from the top</span></div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a7d5114b61c688d3810c108986ddc8bf7">draw_controls_list</a>( <span class="keywordtype">int</span> text_y );</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span> </div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a86966228ce7aad77c233058bf1285962">panel_cursor_info</a>( <span class="keywordtype">int</span> &amp;text_y );</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a545580558b81b3d44c43b52fc5ff1b77">panel_gun_info</a>( <span class="keywordtype">int</span> &amp;text_y );</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a9f08c10cac1401587f330fb97f5c2183">panel_recoil</a>( <span class="keywordtype">int</span> &amp;text_y );</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a14b8ebef108aaa7ad8c5176a04f600bb">panel_spell_info</a>( <span class="keywordtype">int</span> &amp;text_y );</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a4bb70bd52ece44447bec77880106009d">panel_target_info</a>( <span class="keywordtype">int</span> &amp;text_y, <span class="keywordtype">bool</span> fill_with_blank_if_no_target );</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#aa5c1e8816cd2a0f9c10e3ea2095eefe1">panel_fire_mode_aim</a>( <span class="keywordtype">int</span> &amp;text_y );</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#ad4a9c004a4c4cf26ad705174612584ea">panel_turret_list</a>( <span class="keywordtype">int</span> &amp;text_y );</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span> </div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>        <span class="comment">// On-selected-as-target checks that act as if they are on-hit checks.</span></div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>        <span class="comment">// `harmful` is `false` if using a non-damaging spell</span></div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a9d84b28ee34fdefd76ae987c95a29600">on_target_accepted</a>( <span class="keywordtype">bool</span> harmful );</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>};</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span> </div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno"><a class="line" href="namespacetarget__handler.html#a15e531943e7385d987d87f82f5957821">  419</a></span><a class="code hl_typedef" href="namespacetarget__handler.html#aea843144f5e69546ddea88eeda177640">target_handler::trajectory</a> <a class="code hl_function" href="namespacetarget__handler.html#a15e531943e7385d987d87f82f5957821">target_handler::mode_fire</a>( <a class="code hl_class" href="classavatar.html">avatar</a> &amp;you, <a class="code hl_class" href="classaim__activity__actor.html">aim_activity_actor</a> &amp;activity )</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>{</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>    <a class="code hl_class" href="classtarget__ui.html">target_ui</a> <a class="code hl_namespace" href="namespaceui.html">ui</a> = <a class="code hl_class" href="classtarget__ui.html">target_ui</a>();</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.you = &amp;you;</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.mode = <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">target_ui::TargetMode::Fire</a>;</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.activity = &amp;activity;</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.relevant = activity.get_weapon();</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span> </div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>    <span class="keywordflow">return</span> <a class="code hl_namespace" href="namespaceui.html">ui</a>.run();</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>}</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span> </div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno"><a class="line" href="namespacetarget__handler.html#abf6b4d399e1ef6b51df0dc4621a5720d">  430</a></span><a class="code hl_typedef" href="namespacetarget__handler.html#aea843144f5e69546ddea88eeda177640">target_handler::trajectory</a> <a class="code hl_function" href="namespacetarget__handler.html#abf6b4d399e1ef6b51df0dc4621a5720d">target_handler::mode_throw</a>( <a class="code hl_class" href="classavatar.html">avatar</a> &amp;you, <a class="code hl_class" href="classitem.html">item</a> &amp;relevant,</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>        <span class="keywordtype">bool</span> blind_throwing )</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>{</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>    <a class="code hl_class" href="classtarget__ui.html">target_ui</a> <a class="code hl_namespace" href="namespaceui.html">ui</a> = <a class="code hl_class" href="classtarget__ui.html">target_ui</a>();</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.you = &amp;you;</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.mode = blind_throwing ? <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8f61cfb2c3938627416432409d2f6e86">target_ui::TargetMode::ThrowBlind</a> : <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8ce61dd2505effd96f937fa743b6491f">target_ui::TargetMode::Throw</a>;</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.relevant = &amp;relevant;</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.range = you.<a class="code hl_function" href="classCharacter.html#a455c06bf0dab6e3558f759fe43e27e98">throw_range</a>( relevant );</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span> </div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>    <span class="keywordflow">return</span> <a class="code hl_namespace" href="namespaceui.html">ui</a>.run();</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>}</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span> </div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno"><a class="line" href="namespacetarget__handler.html#aeab5385d86293c622a3796625364be16">  442</a></span><a class="code hl_typedef" href="namespacetarget__handler.html#aea843144f5e69546ddea88eeda177640">target_handler::trajectory</a> <a class="code hl_function" href="namespacetarget__handler.html#aeab5385d86293c622a3796625364be16">target_handler::mode_reach</a>( <a class="code hl_class" href="classavatar.html">avatar</a> &amp;you, <a class="code hl_class" href="classitem.html">item</a> &amp;weapon )</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>{</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>    <a class="code hl_class" href="classtarget__ui.html">target_ui</a> <a class="code hl_namespace" href="namespaceui.html">ui</a> = <a class="code hl_class" href="classtarget__ui.html">target_ui</a>();</div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.you = &amp;you;</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.mode = <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997ab350f6de1060afddbefbdf47552464ae">target_ui::TargetMode::Reach</a>;</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.relevant = &amp;weapon;</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.range = weapon.<a class="code hl_function" href="classitem.html#a04985a2b99688b687432463fb2f0a853">reach_range</a>( you );</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span> </div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>    <span class="keywordflow">return</span> <a class="code hl_namespace" href="namespaceui.html">ui</a>.run();</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>}</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span> </div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno"><a class="line" href="namespacetarget__handler.html#a9f06978559f45ddb20b5a1caec3f9c1f">  453</a></span><a class="code hl_typedef" href="namespacetarget__handler.html#aea843144f5e69546ddea88eeda177640">target_handler::trajectory</a> <a class="code hl_function" href="namespacetarget__handler.html#a9f06978559f45ddb20b5a1caec3f9c1f">target_handler::mode_turret_manual</a>( <a class="code hl_class" href="classavatar.html">avatar</a> &amp;you, <a class="code hl_class" href="classturret__data.html">turret_data</a> &amp;turret )</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>{</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>    <a class="code hl_class" href="classtarget__ui.html">target_ui</a> <a class="code hl_namespace" href="namespaceui.html">ui</a> = <a class="code hl_class" href="classtarget__ui.html">target_ui</a>();</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.you = &amp;you;</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.mode = <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70">target_ui::TargetMode::TurretManual</a>;</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.turret = &amp;turret;</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.relevant = &amp;*turret.<a class="code hl_function" href="classturret__data.html#a737465cce9c8f1e87eec808ee1363421">base</a>();</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span> </div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>    <span class="keywordflow">return</span> <a class="code hl_namespace" href="namespaceui.html">ui</a>.run();</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>}</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span> </div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno"><a class="line" href="namespacetarget__handler.html#a3371a56d7b45012072236fb97eda5cc0">  464</a></span><a class="code hl_typedef" href="namespacetarget__handler.html#aea843144f5e69546ddea88eeda177640">target_handler::trajectory</a> <a class="code hl_function" href="namespacetarget__handler.html#a3371a56d7b45012072236fb97eda5cc0">target_handler::mode_turrets</a>( <a class="code hl_class" href="classavatar.html">avatar</a> &amp;you, <a class="code hl_class" href="classvehicle.html">vehicle</a> &amp;veh,</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>        <span class="keyword">const</span> std::vector&lt;vehicle_part *&gt; &amp;turrets )</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>{</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>    <span class="comment">// Find radius of a circle centered at u encompassing all points turrets can aim at</span></div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>    <span class="comment">// FIXME: this calculation is fine for square distances, but results in an underestimation</span></div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>    <span class="comment">//        when used with real circles</span></div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>    <span class="keywordtype">int</span> range_total = 0;</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>    <span class="keywordflow">for</span>( <a class="code hl_struct" href="structvehicle__part.html">vehicle_part</a> *t : turrets ) {</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>        <span class="keywordtype">int</span> range = veh.<a class="code hl_function" href="classvehicle.html#accfab81af66cd979bdfff4c39e5a3a8e">turret_query</a>( *t ).<a class="code hl_function" href="classturret__data.html#a78df34a41feb7bf25a677dba1e8181d5">range</a>();</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>        <a class="code hl_struct" href="structtripoint.html">tripoint</a> pos = veh.<a class="code hl_function" href="classvehicle.html#ae8132c34a1ea24866889e6e599796adc">global_part_pos3</a>( *t );</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span> </div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>        <span class="keywordtype">int</span> res = 0;</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>        res = std::max( res, <a class="code hl_function" href="coordinates_8h.html#a47953b33a873caa0861b12222842a5ec">rl_dist</a>( you.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>(), pos + <a class="code hl_struct" href="structpoint.html">point</a>( range, 0 ) ) );</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>        res = std::max( res, <a class="code hl_function" href="coordinates_8h.html#a47953b33a873caa0861b12222842a5ec">rl_dist</a>( you.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>(), pos + <a class="code hl_struct" href="structpoint.html">point</a>( -range, 0 ) ) );</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>        res = std::max( res, <a class="code hl_function" href="coordinates_8h.html#a47953b33a873caa0861b12222842a5ec">rl_dist</a>( you.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>(), pos + <a class="code hl_struct" href="structpoint.html">point</a>( 0, range ) ) );</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>        res = std::max( res, <a class="code hl_function" href="coordinates_8h.html#a47953b33a873caa0861b12222842a5ec">rl_dist</a>( you.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>(), pos + <a class="code hl_struct" href="structpoint.html">point</a>( 0, -range ) ) );</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>        range_total = std::max( range_total, res );</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>    }</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span> </div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>    <a class="code hl_class" href="classtarget__ui.html">target_ui</a> <a class="code hl_namespace" href="namespaceui.html">ui</a> = <a class="code hl_class" href="classtarget__ui.html">target_ui</a>();</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.you = &amp;you;</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.mode = <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">target_ui::TargetMode::Turrets</a>;</div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.veh = &amp;veh;</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.vturrets = &amp;turrets;</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.range = range_total;</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span> </div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>    <span class="keywordflow">return</span> <a class="code hl_namespace" href="namespaceui.html">ui</a>.run();</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>}</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span> </div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno"><a class="line" href="namespacetarget__handler.html#a10911d1ab9fa4b1484138f1bc379baa5">  493</a></span><a class="code hl_typedef" href="namespacetarget__handler.html#aea843144f5e69546ddea88eeda177640">target_handler::trajectory</a> <a class="code hl_function" href="namespacetarget__handler.html#a10911d1ab9fa4b1484138f1bc379baa5">target_handler::mode_spell</a>( <a class="code hl_class" href="classavatar.html">avatar</a> &amp;you, <a class="code hl_class" href="classspell.html">spell</a> &amp;casting, <span class="keywordtype">bool</span> no_fail,</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>        <span class="keywordtype">bool</span> no_mana )</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>{</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>    <a class="code hl_class" href="classtarget__ui.html">target_ui</a> <a class="code hl_namespace" href="namespaceui.html">ui</a> = <a class="code hl_class" href="classtarget__ui.html">target_ui</a>();</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.you = &amp;you;</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.mode = <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd">target_ui::TargetMode::Spell</a>;</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.casting = &amp;casting;</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.range = casting.<a class="code hl_function" href="classspell.html#a805518bf44455e4652d16db9922945f5">range</a>();</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.no_fail = no_fail;</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.no_mana = no_mana;</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span> </div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>    <span class="keywordflow">return</span> <a class="code hl_namespace" href="namespaceui.html">ui</a>.run();</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>}</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span> </div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno"><a class="line" href="namespacetarget__handler.html#ae136ff6d4342c12df1e97cb622426869">  507</a></span><a class="code hl_typedef" href="namespacetarget__handler.html#aea843144f5e69546ddea88eeda177640">target_handler::trajectory</a> <a class="code hl_function" href="namespacetarget__handler.html#ae136ff6d4342c12df1e97cb622426869">target_handler::mode_shaped</a>( <a class="code hl_class" href="classavatar.html">avatar</a> &amp;you, <a class="code hl_class" href="classshape__factory.html">shape_factory</a> &amp;shape_fac,</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>        <a class="code hl_class" href="classaim__activity__actor.html">aim_activity_actor</a> &amp;activity )</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>{</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>    <a class="code hl_class" href="classtarget__ui.html">target_ui</a> <a class="code hl_namespace" href="namespaceui.html">ui</a> = <a class="code hl_class" href="classtarget__ui.html">target_ui</a>();</div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.you = &amp;you;</div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.mode = <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a880c1273b27d27cfc82004c3a4b205c9">target_ui::TargetMode::Shape</a>;</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.shape_gen = shape_fac;</div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.range = shape_fac.<a class="code hl_function" href="classshape__factory.html#a9ad58bfa6ae742e4588a0419429d2663">get_range</a>();</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.activity = &amp;activity;</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.relevant = activity.get_weapon();</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span> </div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>    <span class="keywordflow">return</span> <a class="code hl_namespace" href="namespaceui.html">ui</a>.run();</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>}</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span> </div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a463802d3c2fe3f6d4ba8cc36a77912c7">  521</a></span><span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code hl_function" href="ranged_8cpp.html#a463802d3c2fe3f6d4ba8cc36a77912c7">occupied_tile_fraction</a>( <a class="code hl_enumeration" href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592">m_size</a> target_size )</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>{</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>    <span class="keywordflow">switch</span>( target_size ) {</div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592a07b6bf6678272622a1fb127d59cf0614">MS_TINY</a>:</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>            <span class="keywordflow">return</span> 0.1;</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592a6a1920ba558cd6584b689f53519e9e96">MS_SMALL</a>:</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>            <span class="keywordflow">return</span> 0.25;</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592aaef7580aead8b8a18bc50cb6c1f98b31">MS_MEDIUM</a>:</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>            <span class="keywordflow">return</span> 0.5;</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592a50d9f673ed0348953b2715fa33683791">MS_LARGE</a>:</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>            <span class="keywordflow">return</span> 0.75;</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592a75a0e62060c8f624b2c71038a5a77ae9">MS_HUGE</a>:</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>            <span class="keywordflow">return</span> 1.0;</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>    }</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span> </div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>    <span class="keywordflow">return</span> 0.5;</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>}</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span> </div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno"><a class="line" href="classCreature.html#a1c8ea56d06ff96a720201c46a40969aa">  541</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="classCreature.html#a1c8ea56d06ff96a720201c46a40969aa">Creature::ranged_target_size</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="classCreature.html#a993e0edf9322ff4aba71a9a3a4f5485c">has_flag</a>( <a class="code hl_enumvalue" href="mtype_8h.html#afa4c966d04d2ddb261a7cde725eca842a37c58dddbff266cb28888d8547d91175">MF_HARDTOSHOOT</a> ) ) {</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>        <span class="keywordflow">switch</span>( <a class="code hl_function" href="classCreature.html#ab4c5777adaad4601b9ca17330371f5b7">get_size</a>() ) {</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>            <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592a07b6bf6678272622a1fb127d59cf0614">MS_TINY</a>:</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>            <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592a6a1920ba558cd6584b689f53519e9e96">MS_SMALL</a>:</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>                <span class="keywordflow">return</span> <a class="code hl_function" href="ranged_8cpp.html#a463802d3c2fe3f6d4ba8cc36a77912c7">occupied_tile_fraction</a>( <a class="code hl_enumvalue" href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592a07b6bf6678272622a1fb127d59cf0614">MS_TINY</a> );</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>            <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592aaef7580aead8b8a18bc50cb6c1f98b31">MS_MEDIUM</a>:</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>                <span class="keywordflow">return</span> <a class="code hl_function" href="ranged_8cpp.html#a463802d3c2fe3f6d4ba8cc36a77912c7">occupied_tile_fraction</a>( <a class="code hl_enumvalue" href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592a6a1920ba558cd6584b689f53519e9e96">MS_SMALL</a> );</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>            <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592a50d9f673ed0348953b2715fa33683791">MS_LARGE</a>:</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>                <span class="keywordflow">return</span> <a class="code hl_function" href="ranged_8cpp.html#a463802d3c2fe3f6d4ba8cc36a77912c7">occupied_tile_fraction</a>( <a class="code hl_enumvalue" href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592aaef7580aead8b8a18bc50cb6c1f98b31">MS_MEDIUM</a> );</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>            <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592a75a0e62060c8f624b2c71038a5a77ae9">MS_HUGE</a>:</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>                <span class="keywordflow">return</span> <a class="code hl_function" href="ranged_8cpp.html#a463802d3c2fe3f6d4ba8cc36a77912c7">occupied_tile_fraction</a>( <a class="code hl_enumvalue" href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592a50d9f673ed0348953b2715fa33683791">MS_LARGE</a> );</div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>            <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>        }</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>    }</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="ranged_8cpp.html#a463802d3c2fe3f6d4ba8cc36a77912c7">occupied_tile_fraction</a>( <a class="code hl_function" href="classCreature.html#ab4c5777adaad4601b9ca17330371f5b7">get_size</a>() );</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>}</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span> </div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a6b4c3a2a360b378de261413fbb7d84f0">  561</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="ranged_8cpp.html#a6b4c3a2a360b378de261413fbb7d84f0">range_with_even_chance_of_good_hit</a>( <span class="keywordtype">int</span> dispersion )</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>{</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>    <span class="keywordtype">int</span> even_chance_range = 0;</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>    <span class="keywordflow">while</span>( <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span><span class="keyword">&gt;</span>( even_chance_range ) &lt;</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>           <a class="code hl_variable" href="classCreature.html#a73b9cb6320e4447addaec375887e7861">Creature::dispersion_for_even_chance_of_good_hit</a>.<a class="code hl_variable" href="namespaceom__direction.html#af97f9dbddaa758278662da3478826c61">size</a>() &amp;&amp;</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>           dispersion &lt; <a class="code hl_variable" href="classCreature.html#a73b9cb6320e4447addaec375887e7861">Creature::dispersion_for_even_chance_of_good_hit</a>[ even_chance_range ] ) {</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>        even_chance_range++;</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>    }</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>    <span class="keywordflow">return</span> even_chance_range;</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>}</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span> </div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno"><a class="line" href="classplayer.html#a9c356da8331dbc6964aa054fa8030d45">  572</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="classplayer.html#a9c356da8331dbc6964aa054fa8030d45">player::gun_engagement_moves</a>( <span class="keyword">const</span> <a class="code hl_class" href="classitem.html">item</a> &amp;gun, <span class="keywordtype">int</span> target, <span class="keywordtype">int</span> start )<span class="keyword"> const</span></div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>    <span class="keywordtype">int</span> mv = 0;</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>    <span class="keywordtype">double</span> penalty = start;</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span> </div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>    <span class="keywordflow">while</span>( penalty &gt; target ) {</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>        <span class="keywordtype">double</span> adj = <a class="code hl_function" href="classCharacter.html#a851daac85a019452f34ba82a377773b0">aim_per_move</a>( gun, penalty );</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>        <span class="keywordflow">if</span>( adj &lt;= 0 ) {</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>        }</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>        penalty -= adj;</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>        mv++;</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>    }</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span> </div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>    <span class="keywordflow">return</span> mv;</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>}</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span> </div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno"><a class="line" href="namespaceranged.html#abf8b46e1f1dae2e7a3d4ff75b9495026">  589</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="namespaceranged.html#abf8b46e1f1dae2e7a3d4ff75b9495026">ranged::handle_gun_damage</a>( <a class="code hl_class" href="classCharacter.html">Character</a> &amp;shooter, <a class="code hl_class" href="classitem.html">item</a> &amp;it )</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>{</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>    <span class="comment">// Below item (maximum dirt possible) should be greater than or equal to dirt range in item_group.cpp. Also keep in mind that monster drops can have specific ranges and these should be below the max!</span></div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> dirt_max_dbl = 10000;</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>    <span class="keywordflow">if</span>( !it.<a class="code hl_function" href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">is_gun</a>() ) {</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>        <a class="code hl_define" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Tried to handle_gun_damage of a non-gun %s&quot;</span>, it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>    }</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span> </div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>    <span class="keywordtype">int</span> dirt = it.<a class="code hl_function" href="classitem.html#a0b12108a604ac9d940716bb8f1368cf5">get_var</a>( <span class="stringliteral">&quot;dirt&quot;</span>, 0 );</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>    <span class="keywordtype">int</span> dirtadder = 0;</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>    <span class="keywordtype">double</span> dirt_dbl = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( dirt );</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>    <span class="keywordflow">if</span>( it.<a class="code hl_variable" href="classitem.html#a12a6fa8aac1350f3ca4362a1bdccd9b0">faults</a>.count( <a class="code hl_variable" href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a> ) ) {</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>    }</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span> </div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>    <span class="keyword">const</span> <span class="keyword">auto</span> &amp;curammo_effects = it.<a class="code hl_function" href="classitem.html#a75fa277bb39c1d2922137986c67d48fb">ammo_effects</a>();</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structislot__gun.html">islot_gun</a> &amp;firing = *it.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_variable" href="structitype.html#a623ec8243b1e599086fa3a23c3179370">gun</a>;</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>    <span class="comment">// misfire chance based on dirt accumulation. Formula is designed to make chance of jam highly unlikely at low dirt levels, but levels increase geometrically as the dirt level reaches max (10,000). The number used is just a figure I found reasonable after plugging the number into excel and changing it until the probability made sense at high, medium, and low levels of dirt.</span></div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>    <span class="keywordflow">if</span>( !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#ab2dd3d8bd3db68ab02a94d2d26d2fc5a">flag_NEVER_JAMS</a> ) &amp;&amp;</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>        <a class="code hl_function" href="calendar_8cpp.html#a359120c15f92d54a49fec9de7bcb571f">x_in_y</a>( dirt_dbl * dirt_dbl * dirt_dbl,</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>                1000000000000.0 ) ) {</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>        shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>(</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>            <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s misfires with a muffled click!&quot;</span> ),</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>            <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s misfires with a muffled click!&quot;</span> ),</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>            it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>        <span class="comment">// at high dirt levels the chance to misfire gets to significant levels. 10,000 is max and 7800 is quite high so above that the player gets some relief in the form of exchanging time for some dirt reduction. Basically jiggling the parts loose to remove some dirt and get a few more shots out.</span></div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>        <span class="keywordflow">if</span>( dirt_dbl &gt;</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>            7800 ) {</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>            shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>(</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>                <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Perhaps taking the ammo out of your %s and reloading will help.&quot;</span> ),</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>                <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Perhaps taking the ammo out of &lt;npcname&gt;&#39;s %s and reloading will help.&quot;</span> ),</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>                it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>        }</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>    }</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span> </div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>    <span class="comment">// Here we check if we&#39;re underwater and whether we should misfire.</span></div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>    <span class="comment">// As a result this causes no damage to the firearm, note that some guns are waterproof</span></div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>    <span class="comment">// and so are immune to this effect, note also that WATERPROOF_GUN status does not</span></div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>    <span class="comment">// mean the gun will actually be accurate underwater.</span></div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>    <span class="keywordtype">int</span> effective_durability = firing.<a class="code hl_variable" href="structislot__gun.html#a40255e8d661dc99204ed70dbe6013a02">durability</a>;</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>    <span class="keywordflow">if</span>( shooter.<a class="code hl_function" href="classCreature.html#a5a2346f549de9c87e8f2afeec1e71366">is_underwater</a>() &amp;&amp; !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <span class="stringliteral">&quot;WATERPROOF_GUN&quot;</span> ) &amp;&amp;</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>        <a class="code hl_function" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( effective_durability ) ) {</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>        shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s misfires with a wet click!&quot;</span> ),</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>                                       <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s misfires with a wet click!&quot;</span> ),</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>                                       it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>        <span class="comment">// Here we check for a chance for the weapon to suffer a mechanical malfunction.</span></div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>        <span class="comment">// Note that some weapons never jam up &#39;NEVER_JAMS&#39; and thus are immune to this</span></div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>        <span class="comment">// effect as current guns have a durability between 5 and 9 this results in</span></div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>        <span class="comment">// a chance of mechanical failure between 1/(64*3) and 1/(1024*3) on any given shot.</span></div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>        <span class="comment">// the malfunction can&#39;t cause damage</span></div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_function" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( ( 2 &lt;&lt; effective_durability ) * 3 ) &amp;&amp; !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#ab2dd3d8bd3db68ab02a94d2d26d2fc5a">flag_NEVER_JAMS</a> ) ) {</div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>        shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s malfunctions!&quot;</span> ),</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>                                       <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s malfunctions!&quot;</span> ),</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>                                       it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>        <span class="comment">// Here we check for a chance for the weapon to suffer a misfire due to</span></div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>        <span class="comment">// using player-made &#39;RECYCLED&#39; bullets. Note that not all forms of</span></div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>        <span class="comment">// player-made ammunition have this effect.</span></div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#afa18fa10e4bc2e18f3911cebb559b7bd">ammo_effect_RECYCLED</a> ) &amp;&amp; <a class="code hl_function" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 256 ) ) {</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>        shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s misfires with a muffled click!&quot;</span> ),</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>                                       <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s misfires with a muffled click!&quot;</span> ),</div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>                                       it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>        <span class="comment">// Here we check for a chance for attached mods to get damaged if they are flagged as &#39;CONSUMABLE&#39;.</span></div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>        <span class="comment">// This is mostly for crappy handmade expedient stuff  or things that rarely receive damage during normal usage.</span></div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>        <span class="comment">// Default chance is 1/10000 unless set via json, damage is proportional to caliber(see below).</span></div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>        <span class="comment">// Can be toned down with &#39;consume_divisor.&#39;</span></div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span> </div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a916c022e69240915ee6678d0170882d3">flag_CONSUMABLE</a> ) &amp;&amp; !curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#a4823a8b924c5e1c83c8e1e1a316e1ae7">ammo_effect_LASER</a> ) &amp;&amp;</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>               !curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#aaf09bb55e60a45b1eb81e989d0758e93">ammo_effect_PLASMA</a> ) &amp;&amp; !curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#a02a98acfc0759dc42a3683ec82f936a9">ammo_effect_EMP</a> ) ) {</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>        <span class="keywordtype">int</span> uncork = ( ( 10 * it.<a class="code hl_function" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>()-&gt;<a class="code hl_variable" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>-&gt;loudness )</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>                       + ( it.<a class="code hl_function" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>()-&gt;<a class="code hl_variable" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>-&gt;recoil / 2 ) ) / 100;</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>        uncork = std::pow( uncork, 3 ) * 6.5;</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>        <span class="keywordflow">for</span>( <span class="keyword">auto</span> <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a> : it.<a class="code hl_function" href="classitem.html#acd78321ba4d5c09d39f1d58d20b68484">gunmods</a>() ) {</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>            <span class="keywordflow">if</span>( <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;has_flag( <a class="code hl_function" href="ranged_8cpp.html#a916c022e69240915ee6678d0170882d3">flag_CONSUMABLE</a> ) ) {</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>                <span class="keywordtype">int</span> dmgamt = uncork / <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;type-&gt;gunmod-&gt;consume_divisor;</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>                <span class="keywordtype">int</span> modconsume = <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;type-&gt;gunmod-&gt;consume_chance;</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>                <span class="keywordtype">int</span> initstate = it.<a class="code hl_function" href="classitem.html#ae8a58c6fe3c80cded11d6f3ccfa548a3">damage</a>();</div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>                <span class="comment">// fuzz damage if it&#39;s small</span></div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>                <span class="keywordflow">if</span>( dmgamt &lt; 1000 ) {</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>                    dmgamt = <a class="code hl_function" href="artifact_8cpp.html#a70800e95389f34dd34186fafaea2a840">rng</a>( dmgamt, dmgamt + 200 );</div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>                    <span class="comment">// ignore damage if inconsequential.</span></div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>                }</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>                <span class="keywordflow">if</span>( dmgamt &lt; 800 ) {</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>                    dmgamt = 0;</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>                }</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>                <span class="keywordflow">if</span>( <a class="code hl_function" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( modconsume ) ) {</div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>                    <span class="keywordflow">if</span>( <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;mod_damage( dmgamt ) ) {</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>                        shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your attached %s is destroyed by your shot!&quot;</span> ),</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>                                                       <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s attached %s is destroyed by their shot!&quot;</span> ),</div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>                                                       <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;tname() );</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>                        shooter.<a class="code hl_function" href="classCharacter.html#a35f89e2e6eb1144b623be5281f4f221b">i_rem</a>( <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a> );</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( it.<a class="code hl_function" href="classitem.html#ae8a58c6fe3c80cded11d6f3ccfa548a3">damage</a>() &gt; initstate ) {</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>                        shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your attached %s is damaged by your shot!&quot;</span> ),</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>                                                       <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s is damaged by their shot!&quot;</span> ),</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>                                                       <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;tname() );</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>                    }</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>                }</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>            }</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>        }</div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>    }</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>    <span class="keywordflow">if</span>( it.<a class="code hl_function" href="classitem.html#a45bcd33992b7d26eb4ae9f76a16b58fa">has_fault</a>( <a class="code hl_variable" href="ranged_8cpp.html#ad73ddd0cc91027278ca5627eaa4ef206">fault_gun_unlubricated</a> ) &amp;&amp;</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>        <a class="code hl_function" href="calendar_8cpp.html#a359120c15f92d54a49fec9de7bcb571f">x_in_y</a>( dirt_dbl, dirt_max_dbl ) ) {</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>        shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s emits a grimace-inducing screech!&quot;</span> ),</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>                                       <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s emits a grimace-inducing screech!&quot;</span> ),</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>                                       it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>        it.<a class="code hl_function" href="classitem.html#aca60af3c295738c2c1fddf0fd669f9a1">inc_damage</a>();</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>    }</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>    <span class="keywordflow">if</span>( ( ( !curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#ab97e95eba84f451228755a351c0476f7">ammo_effect_NON_FOULING</a> ) &amp;&amp; !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#aa125c6da24f14c1bec090943b0174e58">flag_NON_FOULING</a> ) ) ||</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>          ( it.<a class="code hl_function" href="classitem.html#a45bcd33992b7d26eb4ae9f76a16b58fa">has_fault</a>( <a class="code hl_variable" href="ranged_8cpp.html#ad73ddd0cc91027278ca5627eaa4ef206">fault_gun_unlubricated</a> ) ) ) &amp;&amp;</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>        !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#ad23a05e76b668009068f0e453c33692b">flag_PRIMITIVE_RANGED_WEAPON</a> ) ) {</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>        <span class="keywordflow">if</span>( curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#a680b9ce8c9824607142f83b2260dd3ef">ammo_effect_BLACKPOWDER</a> ) ||</div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>            it.<a class="code hl_function" href="classitem.html#a45bcd33992b7d26eb4ae9f76a16b58fa">has_fault</a>( <a class="code hl_variable" href="ranged_8cpp.html#ad73ddd0cc91027278ca5627eaa4ef206">fault_gun_unlubricated</a> ) ) {</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>            <span class="keywordflow">if</span>( ( ( it.<a class="code hl_function" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>()-&gt;<a class="code hl_variable" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>-&gt;recoil &lt; firing.<a class="code hl_variable" href="structislot__gun.html#a68eca15622f086d544820aabcb2a865a">min_cycle_recoil</a> ) ||</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>                  ( it.<a class="code hl_function" href="classitem.html#a45bcd33992b7d26eb4ae9f76a16b58fa">has_fault</a>( <a class="code hl_variable" href="ranged_8cpp.html#ad73ddd0cc91027278ca5627eaa4ef206">fault_gun_unlubricated</a> ) &amp;&amp; <a class="code hl_function" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 16 ) ) ) &amp;&amp;</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>                it.<a class="code hl_function" href="classitem.html#adaaa3ece39eb40637371659dad8550e3">faults_potential</a>().count( <a class="code hl_variable" href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a> ) ) {</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>                shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s fails to cycle!&quot;</span> ),</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>                                               <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s fails to cycle!&quot;</span> ),</div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>                                               it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>                it.<a class="code hl_variable" href="classitem.html#a12a6fa8aac1350f3ca4362a1bdccd9b0">faults</a>.insert( <a class="code hl_variable" href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a> );</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>                <span class="comment">// Don&#39;t return false in this case; this shot happens, follow-up ones won&#39;t.</span></div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>            }</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>        }</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>        <span class="comment">// These are the dirtying/fouling mechanics</span></div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>        <span class="keywordflow">if</span>( !curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#ab97e95eba84f451228755a351c0476f7">ammo_effect_NON_FOULING</a> ) &amp;&amp; !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#aa125c6da24f14c1bec090943b0174e58">flag_NON_FOULING</a> ) ) {</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>            <span class="keywordflow">if</span>( dirt &lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( dirt_max_dbl ) ) {</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>                dirtadder = curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#a680b9ce8c9824607142f83b2260dd3ef">ammo_effect_BLACKPOWDER</a> ) * ( 200 -</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>                            ( firing.<a class="code hl_variable" href="structislot__gun.html#a014b797e92e543ea47be93a1d6771a90">blackpowder_tolerance</a> *</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>                              2 ) );</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>                <span class="comment">// dirtadder is the dirt-increasing number for shots fired with gunpowder-based ammo. Usually dirt level increases by 1, unless it&#39;s blackpowder, in which case it increases by a higher number, but there is a reduction for blackpowder resistance of a weapon.</span></div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>                <span class="keywordflow">if</span>( dirtadder &lt; 0 ) {</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>                    dirtadder = 0;</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>                }</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>                <span class="comment">// in addition to increasing dirt level faster, regular gunpowder fouling is also capped at 7,150, not 10,000. So firing with regular gunpowder can never make the gun quite as bad as firing it with black gunpowder. At 7,150 the chance to jam is significantly lower (though still significant) than it is at 10,000, the absolute cap.</span></div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>                <span class="keywordflow">if</span>( curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#a680b9ce8c9824607142f83b2260dd3ef">ammo_effect_BLACKPOWDER</a> ) ||</div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>                    dirt &lt; 7150 ) {</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>                    it.<a class="code hl_function" href="classitem.html#a4938361b8fe897c4e85d66020ef91aff">set_var</a>( <span class="stringliteral">&quot;dirt&quot;</span>, std::min( <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( dirt_max_dbl ), dirt + dirtadder + 1 ) );</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>                }</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>            }</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>            dirt = it.<a class="code hl_function" href="classitem.html#a0b12108a604ac9d940716bb8f1368cf5">get_var</a>( <span class="stringliteral">&quot;dirt&quot;</span>, 0 );</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>            dirt_dbl = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( dirt );</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>            <span class="keywordflow">if</span>( dirt &gt; 0 &amp;&amp; !it.<a class="code hl_variable" href="classitem.html#a12a6fa8aac1350f3ca4362a1bdccd9b0">faults</a>.count( <a class="code hl_variable" href="ranged_8cpp.html#a6a67c1570499e9c4ab345a0c6f1ba026">fault_gun_blackpowder</a> ) ) {</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>                it.<a class="code hl_variable" href="classitem.html#a12a6fa8aac1350f3ca4362a1bdccd9b0">faults</a>.insert( <a class="code hl_variable" href="ranged_8cpp.html#a0ea533037e4a6a02394d39e2d62174bc">fault_gun_dirt</a> );</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>            }</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>            <span class="keywordflow">if</span>( dirt &gt; 0 &amp;&amp; curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#a680b9ce8c9824607142f83b2260dd3ef">ammo_effect_BLACKPOWDER</a> ) ) {</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>                it.<a class="code hl_variable" href="classitem.html#a12a6fa8aac1350f3ca4362a1bdccd9b0">faults</a>.erase( <a class="code hl_variable" href="ranged_8cpp.html#a0ea533037e4a6a02394d39e2d62174bc">fault_gun_dirt</a> );</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>                it.<a class="code hl_variable" href="classitem.html#a12a6fa8aac1350f3ca4362a1bdccd9b0">faults</a>.insert( <a class="code hl_variable" href="ranged_8cpp.html#a6a67c1570499e9c4ab345a0c6f1ba026">fault_gun_blackpowder</a> );</div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>            }</div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>            <span class="comment">// end fouling mechanics</span></div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>        }</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>    }</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>    <span class="comment">// chance to damage gun due to high levels of dirt. Very unlikely, especially at lower levels and impossible below 5,000. Lower than the chance of a jam at the same levels. 555555... is an arbitrary number that I came up with after playing with the formula in excel. It makes sense at low, medium, and high levels of dirt.</span></div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>    <span class="keywordflow">if</span>( dirt_dbl &gt; 5000 &amp;&amp;</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>        <a class="code hl_function" href="calendar_8cpp.html#a359120c15f92d54a49fec9de7bcb571f">x_in_y</a>( dirt_dbl * dirt_dbl * dirt_dbl,</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>                5555555555555 ) ) {</div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>        shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s is damaged by the high pressure!&quot;</span> ),</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>                                       <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s is damaged by the high pressure!&quot;</span> ),</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>                                       it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>        <span class="comment">// Don&#39;t increment until after the message</span></div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>        it.<a class="code hl_function" href="classitem.html#aca60af3c295738c2c1fddf0fd669f9a1">inc_damage</a>();</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>    }</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>}</div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span> </div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno"><a class="line" href="classnpc.html#ac7ecd979db776f376e3ccb34553e45d6">  756</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classnpc.html#ac7ecd979db776f376e3ccb34553e45d6">npc::pretend_fire</a>( <a class="code hl_class" href="classnpc.html">npc</a> *source, <span class="keywordtype">int</span> shots, <a class="code hl_class" href="classitem.html">item</a> &amp;gun )</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>{</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>    <span class="keywordtype">int</span> curshot = 0;</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;u.sees( *source ) &amp;&amp; <a class="code hl_function" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 50 ) ) {</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>        <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea5d3734a51686ceb1848704dd277dfc7f">m_info</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;%s shoots something.&quot;</span> ), source-&gt;<a class="code hl_function" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>() );</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>    }</div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>    <span class="keywordflow">while</span>( curshot != shots ) {</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>        <span class="keywordflow">if</span>( gun.<a class="code hl_function" href="classitem.html#ae00bce86206993cc672387f9a2c77f92">ammo_consume</a>( gun.<a class="code hl_function" href="classitem.html#a7dc5d9ccf5638ae80cebe1864050fa26">ammo_required</a>(), <a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() ) != gun.<a class="code hl_function" href="classitem.html#a7dc5d9ccf5638ae80cebe1864050fa26">ammo_required</a>() ) {</div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>            <a class="code hl_define" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Unexpected shortage of ammo whilst firing %s&quot;</span>, gun.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>().c_str() );</div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>        }</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span> </div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>        <a class="code hl_class" href="classitem.html">item</a> *<a class="code hl_variable" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a> = &amp;gun;</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>        <span class="keyword">const</span> <span class="keyword">auto</span> data = <a class="code hl_variable" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a>-&gt;<a class="code hl_function" href="classitem.html#a3694c5d9138956736af2444bd7b3972e">gun_noise</a>( shots &gt; 1 );</div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span> </div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>        <span class="keywordflow">if</span>( <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;u.sees( *source ) ) {</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>            <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096eaed9222dd268c0a08567f6c9081b3e687">m_warning</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You hear %s.&quot;</span> ), data.sound );</div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>        }</div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>        curshot++;</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>        <a class="code hl_variable" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a> -= 100;</div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>    }</div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>}</div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span> </div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a6bfc75cd10b0d4de99dc6dcb44abc85b">  779</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="ranged_8cpp.html#a6bfc75cd10b0d4de99dc6dcb44abc85b">can_use_bipod</a>( <span class="keyword">const</span> <a class="code hl_class" href="classmap.html">map</a> &amp;m, <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;pos )</div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>{</div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>    <span class="comment">// usage of any attached bipod is dependent upon terrain</span></div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>    <span class="keywordflow">if</span>( m.<a class="code hl_function" href="classmap.html#a516c0764134cc86b57297811520395f7">has_flag_ter_or_furn</a>( <span class="stringliteral">&quot;MOUNTABLE&quot;</span>, pos ) ) {</div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>    }</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span> </div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>    <span class="keywordflow">if</span>( <span class="keyword">const</span> <a class="code hl_class" href="classoptional__vpart__position.html">optional_vpart_position</a> vp = m.<a class="code hl_function" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( pos ) ) {</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>        <span class="keywordflow">return</span> vp-&gt;vehicle().has_part( pos, <span class="stringliteral">&quot;MOUNTABLE&quot;</span> );</div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>    }</div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span> </div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>}</div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span> </div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a75bb71c29339b16696e3a2eb384bbc3c">  793</a></span><a class="code hl_class" href="classdispersion__sources.html">dispersion_sources</a> <a class="code hl_function" href="ranged_8cpp.html#a75bb71c29339b16696e3a2eb384bbc3c">calculate_dispersion</a>( <span class="keyword">const</span> <a class="code hl_class" href="classmap.html">map</a> &amp;m, <span class="keyword">const</span> <a class="code hl_class" href="classplayer.html">player</a> &amp;p, <span class="keyword">const</span> <a class="code hl_class" href="classitem.html">item</a> &amp;gun,</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>        <span class="keywordtype">int</span> at_recoil, <span class="keywordtype">bool</span> burst )</div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>{</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>    <span class="keywordtype">bool</span> bipod = <a class="code hl_function" href="ranged_8cpp.html#a6bfc75cd10b0d4de99dc6dcb44abc85b">can_use_bipod</a>( m, p.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() );</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span> </div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>    <span class="keywordtype">int</span> gun_recoil = gun.<a class="code hl_function" href="classitem.html#a4dbbda81cd9bc9ed386b9c5bf71d5acd">gun_recoil</a>( bipod );</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>    <span class="keywordtype">int</span> eff_recoil = at_recoil + ( burst ? <a class="code hl_function" href="namespaceranged.html#a5332ed56c9f0b3702e72aecdcaa1e7be">ranged::burst_penalty</a>( p, gun, gun_recoil ) : 0 );</div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>    <a class="code hl_class" href="classdispersion__sources.html">dispersion_sources</a> dispersion( p.<a class="code hl_function" href="classplayer.html#a3deecf5e0ddfe40130d97c61c57e2fe2">get_weapon_dispersion</a>( gun ) );</div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>    dispersion.add_range( eff_recoil );</div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>    <span class="keywordflow">return</span> dispersion;</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>}</div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span> </div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno"><a class="line" href="classplayer.html#a44202fda7322e9ba557a37a7081e249c">  805</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="classplayer.html#a44202fda7322e9ba557a37a7081e249c">player::fire_gun</a>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;target, <span class="keywordtype">int</span> shots )</div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>{</div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="classplayer.html#a44202fda7322e9ba557a37a7081e249c">fire_gun</a>( target, shots, <a class="code hl_variable" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a> );</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>}</div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span> </div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno"><a class="line" href="classplayer.html#a09de46fc4e05450f99872c0e4fcc30e2">  810</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="classplayer.html#a44202fda7322e9ba557a37a7081e249c">player::fire_gun</a>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;target, <span class="keyword">const</span> <span class="keywordtype">int</span> max_shots, <a class="code hl_class" href="classitem.html">item</a> &amp;gun )</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>{</div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>    <span class="keywordflow">if</span>( !gun.<a class="code hl_function" href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">is_gun</a>() ) {</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>        <a class="code hl_define" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;%s tried to fire non-gun (%s).&quot;</span>, <a class="code hl_variable" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, gun.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>    }</div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>    <span class="keywordtype">bool</span> is_mech_weapon = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="classCharacter.html#a67b51491c2529df09755e07bc633cc55">is_mounted</a>() &amp;&amp;</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>        <a class="code hl_variable" href="classCharacter.html#ac3d46549b7cdaac1f98991167ad5f1b3">mounted_creature</a>-&gt;has_flag( <a class="code hl_enumvalue" href="mtype_8h.html#afa4c966d04d2ddb261a7cde725eca842a674d4fc8b69d5ad8a6a2154d471ba941">MF_RIDEABLE_MECH</a> ) ) {</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>        is_mech_weapon = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>    }</div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span> </div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>    <span class="keywordtype">int</span> shots = max_shots;</div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>    <span class="comment">// Number of shots to fire is limited by the amount of remaining ammo</span></div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>    <span class="keywordflow">if</span>( gun.<a class="code hl_function" href="classitem.html#a7dc5d9ccf5638ae80cebe1864050fa26">ammo_required</a>() ) {</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>        shots = std::min( shots, <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( gun.<a class="code hl_function" href="classitem.html#a26c025fd4909bd31c8e91ed87905507b">ammo_remaining</a>() / gun.<a class="code hl_function" href="classitem.html#a7dc5d9ccf5638ae80cebe1864050fa26">ammo_required</a>() ) );</div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>    }</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span> </div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>    <span class="comment">// cap our maximum burst size by the amount of UPS power left</span></div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>    <span class="keywordflow">if</span>( !gun.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a08cb2ed99917b1260118f74991ece915">flag_VEHICLE</a> ) &amp;&amp; gun.<a class="code hl_function" href="classitem.html#af6bd135500675d45eb9b79b196d9558e">get_gun_ups_drain</a>() &gt; 0 ) {</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>        shots = std::min( shots, <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( <a class="code hl_function" href="classvisitable.html#a517e20b6f6c13b8316d5cce8e310b871">charges_of</a>( <a class="code hl_variable" href="ranged_8cpp.html#a55a80a9bbab1925d5462d46d355c2b6e">itype_UPS</a> ) / gun.<a class="code hl_function" href="classitem.html#af6bd135500675d45eb9b79b196d9558e">get_gun_ups_drain</a>() ) );</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>    }</div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span> </div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>    <span class="keywordflow">if</span>( shots &lt;= 0 ) {</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>        <a class="code hl_define" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Attempted to fire zero or negative shots using %s&quot;</span>, gun.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>    }</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span> </div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>    <a class="code hl_class" href="classcata_1_1optional.html">cata::optional&lt;shape_factory&gt;</a> <a class="code hl_class" href="classshape.html">shape</a>;</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>    <span class="keywordflow">if</span>( gun.<a class="code hl_function" href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">ammo_current</a>() &amp;&amp; gun.<a class="code hl_function" href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">ammo_current</a>()-&gt;<a class="code hl_variable" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a> ) {</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>        <a class="code hl_class" href="classshape.html">shape</a> = gun.<a class="code hl_function" href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">ammo_current</a>()-&gt;<a class="code hl_variable" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>-&gt;shape;</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>    }</div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span> </div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>    <span class="comment">// Shaped attacks don&#39;t allow aiming, so they don&#39;t suffer from lack of aim either</span></div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>    <span class="keywordtype">int</span> character_recoil = <a class="code hl_class" href="classshape.html">shape</a> ? <a class="code hl_function" href="classCharacter.html#accd6b165a9454cad9972bc153061215a">recoil_vehicle</a>() : <a class="code hl_function" href="classCharacter.html#aec46a4b513360ef60f6143830bbb711d">recoil_total</a>();</div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>    <span class="comment">// Penalty is (intentionally) based off mode shots, not ammo-limited.</span></div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>    <a class="code hl_class" href="classdispersion__sources.html">dispersion_sources</a> dispersion = <a class="code hl_function" href="ranged_8cpp.html#a75bb71c29339b16696e3a2eb384bbc3c">calculate_dispersion</a>( <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;m, *<span class="keyword">this</span>, gun, character_recoil,</div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>                                    max_shots &gt; 1 );</div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span> </div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>    <span class="keywordtype">bool</span> aoe_attack = gun.<a class="code hl_function" href="classitem.html#a3d8542661f2e2a82e8cb3792584912f3">gun_skill</a>() == <a class="code hl_variable" href="ranged_8cpp.html#a0c6f7a1d7eeb2c38d69b568d85eb9f0d">skill_launcher</a> || <a class="code hl_class" href="classshape.html">shape</a>;</div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>    <a class="code hl_struct" href="structtripoint.html">tripoint</a> aim = target;</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>    <span class="keywordtype">int</span> curshot = 0;</div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>    <span class="keywordtype">int</span> hits = 0; <span class="comment">// total shots on target</span></div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>    <span class="keywordflow">while</span>( curshot != shots ) {</div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>        <span class="keywordflow">if</span>( gun.<a class="code hl_variable" href="classitem.html#a12a6fa8aac1350f3ca4362a1bdccd9b0">faults</a>.count( <a class="code hl_variable" href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a> ) &amp;&amp; curshot == 0 ) {</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>            <a class="code hl_variable" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a> -= 50;</div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>            gun.<a class="code hl_variable" href="classitem.html#a12a6fa8aac1350f3ca4362a1bdccd9b0">faults</a>.erase( <a class="code hl_variable" href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a> );</div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span>            <a class="code hl_function" href="classplayer.html#ae7009d849f19a4f5ebe877cbe463c459">add_msg_if_player</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You cycle your %s manually.&quot;</span> ), gun.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>        }</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span> </div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>        <span class="keywordflow">if</span>( !<a class="code hl_function" href="namespaceranged.html#abf8b46e1f1dae2e7a3d4ff75b9495026">ranged::handle_gun_damage</a>( *<span class="keyword">this</span>, gun ) ) {</div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>        }</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span> </div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>        <span class="comment">// If this is a vehicle mounted turret, which vehicle is it mounted on?</span></div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>        <span class="keyword">const</span> <a class="code hl_class" href="classvehicle.html">vehicle</a> *in_veh = <a class="code hl_function" href="classCreature.html#a6fb79df9315dc2bed6f34d9a2e37da90">has_effect</a>( <a class="code hl_variable" href="ranged_8cpp.html#a3be9304af3e12dfef2f28becb7b93011">effect_on_roof</a> ) ? <a class="code hl_function" href="vpart__position_8h.html#a67bd76da258293f1443f1356308381dc">veh_pointer_or_null</a>( <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;m.veh_at(</div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>                                    <a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() ) ) : <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>        <a class="code hl_struct" href="structprojectile.html">projectile</a> <a class="code hl_struct" href="structprojectile.html">projectile</a> = <a class="code hl_function" href="ranged_8cpp.html#ab0db3d2d826960249b5a1d47fa7881ff">make_gun_projectile</a>( gun );</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span> </div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>        <span class="comment">// Damage reduction from insufficient strength, if using a STR_DRAW weapon.</span></div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>        <a class="code hl_struct" href="structprojectile.html">projectile</a>.<a class="code hl_variable" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a>.<a class="code hl_function" href="structdamage__instance.html#a6cc673dba3d2de116c2579c3eda7ed23">mult_damage</a>( <a class="code hl_function" href="namespaceranged.html#a32d7ead84f4eb01b4050fdbbca0767ea">ranged::str_draw_damage_modifier</a>( gun, *<span class="keyword">this</span> ) );</div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span> </div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>        <span class="keywordflow">if</span>( <a class="code hl_function" href="classCharacter.html#af06dd97724f4f05df782e7a4b4f9cfe1">has_trait</a>( <a class="code hl_variable" href="ranged_8cpp.html#a7a08490346831114f00f3e44cbe454e3">trait_NORANGEDCRIT</a> ) ) {</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>            <a class="code hl_struct" href="structprojectile.html">projectile</a>.<a class="code hl_function" href="structprojectile.html#a05d90cbb1c83669dd7c23477c8f35963">add_effect</a>( <a class="code hl_variable" href="ranged_8cpp.html#a99d97c99b6e5d138e7daa56d509e13ed">ammo_effect_NO_CRIT</a> );</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>        }</div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>        <span class="keywordflow">if</span>( !<a class="code hl_class" href="classshape.html">shape</a> ) {</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>            <span class="keyword">auto</span> shot = <a class="code hl_function" href="ballistics_8cpp.html#aeded5f16540ef8f873a7d9eb5edca240">projectile_attack</a>( <a class="code hl_struct" href="structprojectile.html">projectile</a>, <a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>(), aim, dispersion, <span class="keyword">this</span>, in_veh );</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>            <span class="keywordflow">if</span>( shot.missed_by &lt;= .1 ) {</div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>                <span class="comment">// TODO: check head existence for headshot</span></div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>                <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;events().send&lt;<a class="code hl_enumvalue" href="event_8h.html#a430b444c74dd3fd1472a31714ec5f1cea365dbc32084e314b4788756b6fa66ecb">event_type::character_gets_headshot</a>&gt;( <a class="code hl_function" href="classCharacter.html#adb54bdcb284abb66b6be99c8ae225065">getID</a>() );</div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>            }</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span> </div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>            <span class="keywordflow">if</span>( shot.hit_critter ) {</div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>                hits++;</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>            }</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>            <span class="comment">// 30 degree cap, like for projectiles</span></div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>            <span class="keywordtype">double</span> angle_offset_arcmin = std::min( dispersion.<a class="code hl_function" href="classdispersion__sources.html#acaee96ee2b8a0c87b6fb5a9e2d4285d9">roll</a>(), 1800.0 ) * ( <a class="code hl_function" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 2 ) ? 1 : -1 );</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>            <span class="keywordtype">double</span> angle_offset = <a class="code hl_function" href="namespaceunits.html#a1bd284bde31c6b9124add6c8362c8a90">units::to_radians</a>( <a class="code hl_function" href="namespaceunits.html#a8841cc418c4abd052eab82f152a5af07">units::from_arcmin</a>( angle_offset_arcmin ) );</div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>            <span class="keywordtype">double</span> dx = aim.<a class="code hl_variable" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a> - <a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>().<a class="code hl_variable" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a>;</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>            <span class="keywordtype">double</span> dy = aim.<a class="code hl_variable" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a> - <a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>().<a class="code hl_variable" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a>;</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>            <span class="keywordtype">double</span> new_angle = <a class="code hl_function" href="line_8cpp.html#aaa43dcdfe5b511b116fafb32c5cff349">atan2</a>( dy, dx ) + angle_offset;</div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>            <span class="comment">// Always using trig here, rotations in maximum metric are weird</span></div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>            <span class="keywordtype">double</span> length = <a class="code hl_function" href="coordinates_8h.html#adf2fa43699f878fca49a987112d4aa03">trig_dist</a>( <a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>(), aim );</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>            <a class="code hl_struct" href="structrl__vec3d.html">rl_vec3d</a> vec_pos( <a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() );</div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span>            <a class="code hl_struct" href="structrl__vec3d.html">rl_vec3d</a> new_aim = vec_pos + <a class="code hl_struct" href="structrl__vec3d.html">rl_vec3d</a>( length, 0, 0 ).<a class="code hl_function" href="structrl__vec3d.html#ace319a14c1ba51cb637cdd28d8cddc8c">rotated</a>( new_angle );</div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>            <a class="code hl_function" href="namespaceranged.html#ade9b38890f46ab6cbe94e1004f0ea5f1">ranged::execute_shaped_attack</a>( *<a class="code hl_class" href="classshape.html">shape</a>-&gt;create( vec_pos, new_aim ), <a class="code hl_struct" href="structprojectile.html">projectile</a>, *<span class="keyword">this</span> );</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>        }</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>        curshot++;</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span> </div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>        <a class="code hl_function" href="ranged_8cpp.html#a9d14a0cc5b70610323cf40b51929fae5">make_gun_sound_effect</a>( *<span class="keyword">this</span>, shots &gt; 1, &amp;gun );</div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>        <a class="code hl_function" href="namespacesfx.html#ae07ec6b40b7da8acd1d5386ea3a8e41f">sfx::generate_gun_sound</a>( *<span class="keyword">this</span>, gun );</div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span> </div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>        <a class="code hl_function" href="ranged_8cpp.html#a8b90a63ce217d881ddad6a7456c4a98e">cycle_action</a>( gun, <a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() );</div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span> </div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>        <span class="keywordflow">if</span>( <a class="code hl_function" href="classCharacter.html#af06dd97724f4f05df782e7a4b4f9cfe1">has_trait</a>( <a class="code hl_variable" href="ranged_8cpp.html#a512959ad2b35ea057f2fed5445fc23c4">trait_PYROMANIA</a> ) &amp;&amp; !<a class="code hl_function" href="classCharacter.html#a51a6b8e64f0e18cd2d0bbfcff2edae57">has_morale</a>( <a class="code hl_variable" href="morale__types_8cpp.html#a7a7fa39cff1d7efe58e013c63b7f0ee6">MORALE_PYROMANIA_STARTFIRE</a> ) ) {</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>            <span class="keywordflow">if</span>( gun.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#add0bf5e67088357d1ff569fc62addb60">flag_PYROMANIAC_WEAPON</a> ) ) {</div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>                <a class="code hl_function" href="classplayer.html#ae7009d849f19a4f5ebe877cbe463c459">add_msg_if_player</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea2f644bab8f796b847285eab073040f10">m_good</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You feel a surge of euphoria as flames roar out of the %s!&quot;</span> ),</div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>                                   gun.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>                <a class="code hl_function" href="classCharacter.html#ab6b6b317ae10bfb8f358fe289d645c96">add_morale</a>( <a class="code hl_variable" href="morale__types_8cpp.html#a7a7fa39cff1d7efe58e013c63b7f0ee6">MORALE_PYROMANIA_STARTFIRE</a>, 15, 15, 8_hours, 6_hours );</div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>                <a class="code hl_function" href="classCharacter.html#ac55733961846b5c57183bd3b0fde9eae">rem_morale</a>( <a class="code hl_variable" href="morale__types_8cpp.html#ae932ffaaef9c3a4092fc8727141405bf">MORALE_PYROMANIA_NOFIRE</a> );</div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>            }</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>        }</div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span> </div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>        <span class="keywordflow">if</span>( gun.<a class="code hl_function" href="classitem.html#ae00bce86206993cc672387f9a2c77f92">ammo_consume</a>( gun.<a class="code hl_function" href="classitem.html#a7dc5d9ccf5638ae80cebe1864050fa26">ammo_required</a>(), <a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() ) != gun.<a class="code hl_function" href="classitem.html#a7dc5d9ccf5638ae80cebe1864050fa26">ammo_required</a>() ) {</div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>            <a class="code hl_define" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Unexpected shortage of ammo whilst firing %s&quot;</span>, gun.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>        }</div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span> </div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span>        <span class="keywordflow">if</span>( !gun.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a08cb2ed99917b1260118f74991ece915">flag_VEHICLE</a> ) ) {</div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>            <a class="code hl_function" href="classCharacter.html#a3d0ec2b4e80527bd2daad576c2bbb187">use_charges</a>( <a class="code hl_variable" href="ranged_8cpp.html#a55a80a9bbab1925d5462d46d355c2b6e">itype_UPS</a>, gun.<a class="code hl_function" href="classitem.html#af6bd135500675d45eb9b79b196d9558e">get_gun_ups_drain</a>() );</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span>        }</div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span> </div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>        <span class="keywordflow">if</span>( aoe_attack ) {</div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>            <span class="keywordflow">continue</span>; <span class="comment">// skip retargeting for launchers</span></div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>        }</div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>    }</div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span> </div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>    <span class="keywordflow">if</span>( gun.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a30c9d25adcf2167a8bff0fe6ca21fdaf">flag_RELOAD_AND_SHOOT</a> ) ) {</div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>        <span class="comment">// Reset aim for bows and other reload-and-shoot weapons.</span></div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>        <a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> = <a class="code hl_variable" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a>;</div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>        <span class="comment">// Now actually apply recoil for the future shots</span></div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span>        <span class="comment">// But only for one shot, because bursts kinda suck</span></div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span>        <span class="keywordtype">int</span> gun_recoil = gun.<a class="code hl_function" href="classitem.html#a4dbbda81cd9bc9ed386b9c5bf71d5acd">gun_recoil</a>( <a class="code hl_function" href="ranged_8cpp.html#a6bfc75cd10b0d4de99dc6dcb44abc85b">can_use_bipod</a>( <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;m, <a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() ) );</div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span> </div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>        <span class="comment">// If user is currently able to fire a mounted gun freely, penalize recoil based on size class.</span></div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>        <span class="keywordflow">if</span>( gun.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a9a327f2be95a30526c2d1ab6a31f72b2">flag_MOUNTED_GUN</a> ) &amp;&amp; !<a class="code hl_function" href="ranged_8cpp.html#a6bfc75cd10b0d4de99dc6dcb44abc85b">can_use_bipod</a>( <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;m, <a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() ) ) {</div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>            <span class="keywordflow">if</span>( <a class="code hl_function" href="classCharacter.html#aa5ca0f6c4fb1c08bb93ece1c9746c368">get_size</a>() == <a class="code hl_enumvalue" href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592a75a0e62060c8f624b2c71038a5a77ae9">MS_HUGE</a> ) {</div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span>                gun_recoil = gun_recoil * 2;</div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span>                gun_recoil = gun_recoil * 3;</div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span>            }</div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span>        }</div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span> </div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>        <a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> += gun_recoil;</div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>        <span class="keywordflow">if</span>( is_mech_weapon ) {</div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>            <span class="comment">// mechs can handle recoil far better. they are built around their main gun.</span></div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>            <a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> = <a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> / 2;</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>        }</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>        <a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> = std::min( <a class="code hl_variable" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a>, <a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> );</div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>    }</div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span> </div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>    <span class="comment">// Use different amounts of time depending on the type of gun and our skill</span></div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>    <a class="code hl_variable" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a> -= <a class="code hl_function" href="ranged_8cpp.html#a613a8b59e4b2f2aaf05091d354bb4aa3">time_to_attack</a>( *<span class="keyword">this</span>, *gun.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a> );</div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span> </div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>    <span class="comment">// Practice the base gun skill proportionally to number of hits, but always by one.</span></div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span>    <a class="code hl_function" href="classplayer.html#aa57c61de29a5e410c100aee07798b9b1">practice</a>( <a class="code hl_variable" href="ranged_8cpp.html#a3eadead4a9aa7fee079c0b1acce7965e">skill_gun</a>, ( hits + 1 ) * 5 );</div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span>    <span class="comment">// launchers train weapon skill for both hits and misses.</span></div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span>    <span class="keywordtype">int</span> practice_units = aoe_attack ? curshot : hits;</div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>    <a class="code hl_function" href="classplayer.html#aa57c61de29a5e410c100aee07798b9b1">practice</a>( gun.<a class="code hl_function" href="classitem.html#a3d8542661f2e2a82e8cb3792584912f3">gun_skill</a>(), ( practice_units + 1 ) * 5 );</div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span> </div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>    <span class="keywordflow">return</span> curshot;</div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span>}</div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span> </div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceranged.html">ranged</a></div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span>{</div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span> </div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno"><a class="line" href="namespaceranged.html#a581c5c797384eeec8c7e3ffe10a82d26">  967</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="namespaceranged.html#a581c5c797384eeec8c7e3ffe10a82d26">throw_cost</a>( <span class="keyword">const</span> <a class="code hl_class" href="classplayer.html">player</a> &amp;<a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, <span class="keyword">const</span> <a class="code hl_class" href="classitem.html">item</a> &amp;to_throw )</div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>{</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>    <span class="comment">// Very similar to player::attack_cost</span></div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>    <span class="comment">// TODO: Extract into a function?</span></div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span>    <span class="comment">// Differences:</span></div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>    <span class="comment">// Dex is more (2x) important for throwing speed</span></div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>    <span class="comment">// At 10 skill, the cost is down to 0.75%, not 0.66%</span></div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> base_move_cost = to_throw.<a class="code hl_function" href="classitem.html#ae75cd02ac10dda906018f27096a6efa9">attack_cost</a>() / 2;</div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> throw_skill = std::min( <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a>, <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_skill_level( <a class="code hl_variable" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a> ) );<span class="comment"></span></div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span><span class="comment">    ///\EFFECT_THROW increases throwing speed</span></div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span><span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">int</span> skill_cost = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( ( base_move_cost * ( 20 - throw_skill ) / 20 ) );<span class="comment"></span></div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span><span class="comment">    ///\EFFECT_DEX increases throwing speed</span></div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span><span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">int</span> dexbonus = <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_dex();</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> encumbrance_penalty = <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.encumb( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980ab4b216482dcc0e468819f023c3aeddd1">bp_torso</a> ) +</div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>                                    ( <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.encumb( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a2806629e65a2c2eb5d8049e29e77910e">bp_hand_l</a> ) + <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.encumb( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a54721306a0e05318b6d0440349c1a0fb">bp_hand_r</a> ) ) / 2;</div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> stamina_ratio = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>( <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_stamina() ) / <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_stamina_max();</div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> stamina_penalty = 1.0 + std::max( ( 0.25f - stamina_ratio ) * 4.0f, 0.0f );</div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span> </div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span>    <span class="keywordtype">int</span> <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> = base_move_cost;</div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span>    <span class="comment">// Stamina penalty only affects base/2 and encumbrance parts of the cost</span></div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>    <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> += encumbrance_penalty;</div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>    <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> *= stamina_penalty;</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>    <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> += skill_cost;</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>    <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> -= dexbonus;</div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>    <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> *= <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.mutation_value( <span class="stringliteral">&quot;attackcost_modifier&quot;</span> );</div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span> </div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span>    <span class="keywordflow">return</span> std::max( 25, <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> );</div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>}</div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span> </div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno"><a class="line" href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">  996</a></span><span class="keywordtype">float</span> <a class="code hl_function" href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">get_str_draw_penalty</a>( <span class="keyword">const</span> <a class="code hl_class" href="classitem.html">item</a> &amp;it, <span class="keyword">const</span> <a class="code hl_class" href="classCharacter.html">Character</a> &amp;p )</div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>{</div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>    <span class="comment">// We only care if weapon has STR_DRAW, and that the user is weaker than required strength.</span></div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span>    <span class="comment">// Also avoid dividing by zero, and skip if we&#39;d just get a result of 1 anyway.</span></div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>    <span class="keywordflow">if</span>( !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a3756f1dde5d862fe1b0f0240dfc13e6a">flag_STR_DRAW</a> ) || p.<a class="code hl_function" href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">get_str</a>() &gt;= it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() || it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() &lt;= 1 ) {</div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>        <span class="keywordflow">return</span> 1.0f;</div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span>    }</div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>    <span class="comment">// We also don&#39;t want to actually reduce values to zero, even if user is debuffed to zero strength.</span></div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>    <span class="keywordtype">float</span> archer_str = std::max( 1, p.<a class="code hl_function" href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">get_str</a>() );</div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>    <span class="keywordflow">return</span> ( archer_str / it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() );</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>}</div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span> </div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"><a class="line" href="namespaceranged.html#a32d7ead84f4eb01b4050fdbbca0767ea"> 1008</a></span><span class="keywordtype">float</span> <a class="code hl_function" href="namespaceranged.html#a32d7ead84f4eb01b4050fdbbca0767ea">str_draw_damage_modifier</a>( <span class="keyword">const</span> <a class="code hl_class" href="classitem.html">item</a> &amp;it, <span class="keyword">const</span> <a class="code hl_class" href="classCharacter.html">Character</a> &amp;p )</div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>{</div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>    <span class="keywordflow">if</span>( !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a3756f1dde5d862fe1b0f0240dfc13e6a">flag_STR_DRAW</a> ) || p.<a class="code hl_function" href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">get_str</a>() &gt;= it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() || it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() &lt;= 1 ) {</div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>        <span class="keywordflow">return</span> 1.0f;</div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>    }</div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">ranged::get_str_draw_penalty</a>( it, p ) &lt; 0.75f ) {</div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>        <span class="keywordflow">return</span> 0.5f;</div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">ranged::get_str_draw_penalty</a>( it, p ) &lt; 1.0f ) {</div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>        <span class="keywordflow">return</span> 0.75f;</div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>        <span class="keywordflow">return</span> 1.0f;</div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>    }</div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>}</div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span> </div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"><a class="line" href="namespaceranged.html#a613a2847b3c06998d6117f2630fc9ed5"> 1022</a></span><span class="keywordtype">float</span> <a class="code hl_function" href="namespaceranged.html#a613a2847b3c06998d6117f2630fc9ed5">str_draw_dispersion_modifier</a>( <span class="keyword">const</span> <a class="code hl_class" href="classitem.html">item</a> &amp;it, <span class="keyword">const</span> <a class="code hl_class" href="classCharacter.html">Character</a> &amp;p )</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>{</div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>    <span class="keywordflow">if</span>( !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a3756f1dde5d862fe1b0f0240dfc13e6a">flag_STR_DRAW</a> ) || p.<a class="code hl_function" href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">get_str</a>() &gt;= it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() || it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() &lt;= 1 ) {</div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>        <span class="keywordflow">return</span> 1.0f;</div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>    }</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">ranged::get_str_draw_penalty</a>( it, p ) &lt; 0.75f ) {</div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span>        <span class="keywordflow">return</span> 0.5f;</div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>        <span class="keywordflow">return</span> 1.0f;</div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>    }</div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>}</div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span> </div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"><a class="line" href="namespaceranged.html#aa7a46e309ff8892e692a92511635a4eb"> 1034</a></span><span class="keywordtype">float</span> <a class="code hl_function" href="namespaceranged.html#aa7a46e309ff8892e692a92511635a4eb">str_draw_range_modifier</a>( <span class="keyword">const</span> <a class="code hl_class" href="classitem.html">item</a> &amp;it, <span class="keyword">const</span> <a class="code hl_class" href="classCharacter.html">Character</a> &amp;p )</div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>{</div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>    <span class="keywordflow">if</span>( !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a3756f1dde5d862fe1b0f0240dfc13e6a">flag_STR_DRAW</a> ) || p.<a class="code hl_function" href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">get_str</a>() &gt;= it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() || it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() &lt;= 1 ) {</div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>        <span class="keywordflow">return</span> 1.0f;</div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>    }</div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">ranged::get_str_draw_penalty</a>( it, p ) &lt; 0.75f ) {</div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>        <span class="keywordflow">return</span> 0.5f;</div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">ranged::get_str_draw_penalty</a>( it, p ) &lt; 1.0f ) {</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>        <span class="keywordflow">return</span> 0.75f;</div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>        <span class="keywordflow">return</span> 1.0f;</div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>    }</div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>}</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span> </div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"><a class="line" href="namespaceranged.html#afd6b1338d47e5ecd34de75b921c11113"> 1048</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="namespaceranged.html#afd6b1338d47e5ecd34de75b921c11113">throw_dispersion_per_dodge</a>( <span class="keyword">const</span> <a class="code hl_class" href="classCharacter.html">Character</a> &amp;<a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, <span class="keywordtype">bool</span> add_encumbrance )</div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span>{</div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span>    <span class="comment">// +200 per dodge point at 0 dexterity</span></div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span>    <span class="comment">// +100 at 8, +80 at 12, +66.6 at 16, +57 at 20, +50 at 24</span></div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>    <span class="comment">// Each 10 encumbrance on either hand is like -1 dex (can bring penalty to +400 per dodge)</span></div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span>    <span class="comment">// Maybe TODO: Only use one hand</span></div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> encumbrance = add_encumbrance ? <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.encumb( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a2806629e65a2c2eb5d8049e29e77910e">bp_hand_l</a> ) + <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.encumb( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a54721306a0e05318b6d0440349c1a0fb">bp_hand_r</a> ) : 0;<span class="comment"></span></div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span><span class="comment">    ///\EFFECT_DEX increases throwing accuracy against targets with good dodge stat</span></div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span><span class="comment"></span>    <span class="keywordtype">float</span> effective_dex = 2 + <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_dex() / 4.0f - ( encumbrance ) / 40.0f;</div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span>    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( 100.0f / std::max( 1.0f, effective_dex ) );</div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span>}</div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span> </div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span><span class="comment">// Perfect situation gives us 1000 dispersion at lvl 0</span></div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span><span class="comment">// This goes down linearly to 200  dispersion at lvl 10</span></div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"><a class="line" href="namespaceranged.html#a54895869f69a00b4a74df15057a9a780"> 1062</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="namespaceranged.html#a54895869f69a00b4a74df15057a9a780">throwing_dispersion</a>( <span class="keyword">const</span> <a class="code hl_class" href="classCharacter.html">Character</a> &amp;<a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, <span class="keyword">const</span> <a class="code hl_class" href="classitem.html">item</a> &amp;to_throw, <a class="code hl_class" href="classCreature.html">Creature</a> *critter,</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>                         <span class="keywordtype">bool</span> is_blind_throw )</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>{</div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>    <a class="code hl_class" href="classunits_1_1quantity.html">units::mass</a> weight = to_throw.<a class="code hl_function" href="classitem.html#a3157f01f1da6fe89bdbc87db2605afb9">weight</a>();</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>    <a class="code hl_class" href="classunits_1_1quantity.html">units::volume</a> <a class="code hl_typedef" href="namespaceunits.html#a5d16607c866588620acb381e7dbbf0a6">volume</a> = to_throw.<a class="code hl_function" href="classitem.html#a51eafbdf8b331d88b741c0c527f98eb9">volume</a>();</div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>    <span class="keywordflow">if</span>( to_throw.<a class="code hl_function" href="classitem.html#a40963a016376016eb408bdb9dbb94388">count_by_charges</a>() &amp;&amp; to_throw.<a class="code hl_variable" href="classitem.html#a6bfb92ab5d41e0eb3a1da160fac71b0e">charges</a> &gt; 1 ) {</div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>        weight /= to_throw.<a class="code hl_variable" href="classitem.html#a6bfb92ab5d41e0eb3a1da160fac71b0e">charges</a>;</div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>        <a class="code hl_typedef" href="namespaceunits.html#a5d16607c866588620acb381e7dbbf0a6">volume</a> /= to_throw.<a class="code hl_variable" href="classitem.html#a6bfb92ab5d41e0eb3a1da160fac71b0e">charges</a>;</div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span>    }</div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span> </div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>    <span class="keywordtype">int</span> throw_difficulty = 1000;</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>    <span class="comment">// 1000 penalty for every liter after the first</span></div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>    <span class="comment">// TODO: Except javelin type items</span></div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>    throw_difficulty += std::max&lt;int&gt;( 0, <a class="code hl_function" href="namespaceunits.html#a144476d36f26d6e1916493c3636d54dc">units::to_milliliter</a>( <a class="code hl_typedef" href="namespaceunits.html#a5d16607c866588620acb381e7dbbf0a6">volume</a> - 1_liter ) );</div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span>    <span class="comment">// 1 penalty for gram above str*100 grams (at 0 skill)</span><span class="comment"></span></div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span><span class="comment">    ///\EFFECT_STR decreases throwing dispersion when throwing heavy objects</span></div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span><span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">int</span> weight_in_gram = <a class="code hl_function" href="namespaceunits.html#a8306911daadc1a4d7a7b46e9786f4a4c">units::to_gram</a>( weight );</div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>    throw_difficulty += std::max( 0, weight_in_gram - <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_str() * 100 );</div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span> </div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>    <span class="comment">// Dispersion from difficult throws goes from 100% at lvl 0 to 20% at lvl 10</span><span class="comment"></span></div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span><span class="comment">    ///\EFFECT_THROW increases throwing accuracy</span></div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span><span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">int</span> throw_skill = std::min( <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a>, <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_skill_level( <a class="code hl_variable" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a> ) );</div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>    <span class="keywordtype">int</span> dispersion = 10 * throw_difficulty / ( 6 * throw_skill + 20 );</div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>    <span class="comment">// If the target is a creature, it moves around and ruins aim</span></div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>    <span class="comment">// TODO: Inform projectile functions if the attacker actually aims for the critter or just the tile</span></div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>    <span class="keywordflow">if</span>( critter != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>        <span class="comment">// It&#39;s easier to dodge at close range (thrower needs to adjust more)</span></div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>        <span class="comment">// Dodge x10 at point blank, x5 at 1 dist, then flat</span></div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>        <span class="keywordtype">float</span> effective_dodge = critter-&gt;<a class="code hl_function" href="classCreature.html#aaa501dbe3d1e90d47da43fb9ea57b3be">get_dodge</a>() * std::max( 1, 10 - 5 * <a class="code hl_function" href="coordinates_8h.html#a47953b33a873caa0861b12222842a5ec">rl_dist</a>( <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.pos(),</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>                                critter-&gt;<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>() ) );</div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span>        dispersion += <a class="code hl_function" href="namespaceranged.html#afd6b1338d47e5ecd34de75b921c11113">throw_dispersion_per_dodge</a>( <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, <span class="keyword">true</span> ) * effective_dodge;</div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>    }</div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>    <span class="comment">// 1 perception per 1 eye encumbrance</span><span class="comment"></span></div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span><span class="comment">    ///\EFFECT_PER decreases throwing accuracy penalty from eye encumbrance</span></div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span><span class="comment"></span>    dispersion += std::max( 0, ( <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.encumb( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a2055386ee220ee2ca3e61d13df65e868">bp_eyes</a> ) - <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_per() ) * 10 );</div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span> </div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span>    <span class="comment">// If throwing blind, we&#39;re assuming they mechanically can&#39;t achieve the</span></div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>    <span class="comment">// accuracy of a normal throw.</span></div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>    <span class="keywordflow">if</span>( is_blind_throw ) {</div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>        dispersion *= 4;</div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>    }</div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span> </div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>    <span class="keywordflow">return</span> std::max( 0, dispersion );</div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span>}</div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span> </div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>} <span class="comment">// namespace ranged</span></div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span> </div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"><a class="line" href="classplayer.html#a347590f5f5ca932d3ffc5c5cc5cdc723"> 1109</a></span><a class="code hl_struct" href="structdealt__projectile__attack.html">dealt_projectile_attack</a> <a class="code hl_function" href="classplayer.html#a347590f5f5ca932d3ffc5c5cc5cdc723">player::throw_item</a>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;target, <span class="keyword">const</span> <a class="code hl_class" href="classitem.html">item</a> &amp;to_throw,</div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>        <span class="keyword">const</span> <a class="code hl_class" href="classcata_1_1optional.html">cata::optional&lt;tripoint&gt;</a> &amp;blind_throw_from_pos )</div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>{</div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>    <span class="comment">// Copy the item, we may alter it before throwing</span></div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>    <a class="code hl_class" href="classitem.html">item</a> thrown = to_throw;</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span> </div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> = <a class="code hl_function" href="namespaceranged.html#a581c5c797384eeec8c7e3ffe10a82d26">ranged::throw_cost</a>( *<span class="keyword">this</span>, to_throw );</div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span>    <a class="code hl_function" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -<a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> );</div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span> </div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> throwing_skill = <a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( <a class="code hl_variable" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a> );</div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>    <a class="code hl_class" href="classunits_1_1quantity.html">units::volume</a> <a class="code hl_variable" href="classplayer.html#a20589432777baec94c204b4f5efbfcfb">volume</a> = to_throw.<a class="code hl_function" href="classitem.html#a51eafbdf8b331d88b741c0c527f98eb9">volume</a>();</div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span>    <a class="code hl_class" href="classunits_1_1quantity.html">units::mass</a> weight = to_throw.<a class="code hl_function" href="classitem.html#a3157f01f1da6fe89bdbc87db2605afb9">weight</a>();</div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span> </div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span>    <span class="comment">// Previously calculated as 2_gram * std::max( 1, str_cur )</span></div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span>    <span class="comment">// using 16_gram normalizes it to 8 str. Same effort expenditure</span></div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>    <span class="comment">// for being able to throw farther.</span></div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> weight_cost = weight / ( 16_gram );</div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> encumbrance_cost = <a class="code hl_function" href="rng_8cpp.html#acd19ae79e3590a99c9eaf0389318b686">roll_remainder</a>( ( <a class="code hl_function" href="classCharacter.html#adc1fd84a88722a905e57fea8bfd5b6b0">encumb</a>( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a441080ba1d3930d38f635658d9b28e01">bp_arm_l</a> ) + <a class="code hl_function" href="classCharacter.html#adc1fd84a88722a905e57fea8bfd5b6b0">encumb</a>( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980ae5f21c7494ad730a0c6abf6957976cb3">bp_arm_r</a> ) ) * 2.0f );</div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> stamina_cost = ( weight_cost + encumbrance_cost - throwing_skill + 50 ) * -1;</div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span> </div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span>    <span class="keywordtype">bool</span> throw_assist = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span>    <span class="keywordtype">int</span> throw_assist_str = 0;</div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="classCharacter.html#a67b51491c2529df09755e07bc633cc55">is_mounted</a>() ) {</div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span>        <span class="keyword">auto</span> mons = <a class="code hl_variable" href="classCharacter.html#ac3d46549b7cdaac1f98991167ad5f1b3">mounted_creature</a>.get();</div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>        <span class="keywordflow">if</span>( mons-&gt;mech_str_addition() != 0 ) {</div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span>            throw_assist = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span>            throw_assist_str = mons-&gt;mech_str_addition();</div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span>            mons-&gt;use_mech_power( -3 );</div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>        }</div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span>    }</div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span>    <span class="keywordflow">if</span>( !throw_assist ) {</div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span>        <a class="code hl_function" href="classCharacter.html#ac29de3d2bc90dd1c8d921b539fb05cfb">mod_stamina</a>( stamina_cost );</div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span>    }</div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span> </div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span>    <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">skill_id</a> &amp;skill_used = <a class="code hl_variable" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a>;</div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span>    <span class="keywordtype">int</span> skill_level = std::min( <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a>, <a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( <a class="code hl_variable" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a> ) );</div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span>    <span class="comment">// if you are lying on the floor, you can&#39;t really throw that well</span></div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="classCreature.html#a6fb79df9315dc2bed6f34d9a2e37da90">has_effect</a>( <a class="code hl_variable" href="ranged_8cpp.html#a08481f62adb6937636ea44b855311037">effect_downed</a> ) ) {</div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>        skill_level = std::max( 0, skill_level - 5 );</div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>    }</div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span>    <span class="comment">// We&#39;ll be constructing a projectile</span></div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span>    <a class="code hl_struct" href="structprojectile.html">projectile</a> proj;</div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>    proj.<a class="code hl_variable" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a> = thrown.<a class="code hl_function" href="classitem.html#a13b2b008995a2f2f2daa63be578b27c8">base_damage_thrown</a>();</div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span>    proj.<a class="code hl_variable" href="structprojectile.html#aa2af53bce63feecb719ef1edba54689e">speed</a> = 10 + skill_level;</div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span>    <span class="keyword">auto</span> &amp;<a class="code hl_function" href="classplayer.html#ae1d6e52d9fb8fdf08eecb74890a28342">impact</a> = proj.<a class="code hl_variable" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a>;</div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span> </div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span>    <span class="keyword">static</span> <span class="keyword">const</span> std::set&lt;material_id&gt; ferric = { <a class="code hl_typedef" href="type__id_8h.html#a569ce0271cf4ab170e63bb05658be142">material_id</a>( <span class="stringliteral">&quot;iron&quot;</span> ), <a class="code hl_typedef" href="type__id_8h.html#a569ce0271cf4ab170e63bb05658be142">material_id</a>( <span class="stringliteral">&quot;steel&quot;</span> ) };</div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span> </div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span>    <span class="keywordtype">bool</span> do_railgun = <a class="code hl_function" href="classCharacter.html#af9c7419575e23d52745c94009929fafb">has_active_bionic</a>( <a class="code hl_variable" href="ranged_8cpp.html#a738f726f320c7f5b5edca445777a14fa">bio_railgun</a> ) &amp;&amp; thrown.<a class="code hl_function" href="classitem.html#a9e2c24734b538e61e186fb6777b62c25">made_of_any</a>( ferric ) &amp;&amp;</div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span>                      !throw_assist;</div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span> </div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span>    <span class="comment">// The damage dealt due to item&#39;s weight, player&#39;s strength, and skill level</span></div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span>    <span class="comment">// Up to str/2 or weight/100g (lower), so 10 str is 5 damage before multipliers</span></div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span>    <span class="comment">// Railgun doubles the effective strength</span><span class="comment"></span></div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span><span class="comment">    ///\EFFECT_STR increases throwing damage</span></div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span><span class="comment"></span>    <span class="keywordtype">double</span> stats_mod = do_railgun ? <a class="code hl_function" href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">get_str</a>() : ( <a class="code hl_function" href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">get_str</a>() / 2.0 );</div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span>    stats_mod = throw_assist ? throw_assist_str / 2.0 : stats_mod;</div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span>    <span class="comment">// modify strength impact based on skill level, clamped to [0.15 - 1]</span></div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span>    <span class="comment">// mod = mod * [ ( ( skill / max_skill ) * 0.85 ) + 0.15 ]</span></div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span>    stats_mod *= ( std::min( <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a>,</div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span>                             <a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( <a class="code hl_variable" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a> ) ) /</div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span>                   <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> ) ) * 0.85 + 0.15;</div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span>    <a class="code hl_function" href="classplayer.html#ae1d6e52d9fb8fdf08eecb74890a28342">impact</a>.add_damage( <a class="code hl_enumvalue" href="damage_8h.html#ae63a2cf8429f9edf77b547d34ffe4e7aa5f8b46c6c239266403858fa2ae90ef23">DT_BASH</a>, std::min( weight / 100.0_gram, stats_mod ) );</div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span> </div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span>    <span class="keywordflow">if</span>( thrown.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <span class="stringliteral">&quot;ACT_ON_RANGED_HIT&quot;</span> ) ) {</div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span>        proj.<a class="code hl_function" href="structprojectile.html#a05d90cbb1c83669dd7c23477c8f35963">add_effect</a>( <a class="code hl_variable" href="ranged_8cpp.html#a4832c47fe321946202cd17b211b27862">ammo_effect_ACT_ON_RANGED_HIT</a> );</div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span>        thrown.<a class="code hl_variable" href="classitem.html#a2993eb10a5ae589e6bb1be0a74cb65c1">active</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span>    }</div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span> </div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span>    <span class="comment">// Item will shatter upon landing, destroying the item, dealing damage, and making noise</span><span class="comment"></span></div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span><span class="comment">    /** @EFFECT_STR increases chance of shattering thrown glass items (NEGATIVE) */</span></div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> shatter = !thrown.<a class="code hl_variable" href="classitem.html#a2993eb10a5ae589e6bb1be0a74cb65c1">active</a> &amp;&amp; thrown.<a class="code hl_function" href="classitem.html#a4326944ae95f4d265c8ca1c76ed89a03">made_of</a>( <a class="code hl_typedef" href="type__id_8h.html#a569ce0271cf4ab170e63bb05658be142">material_id</a>( <span class="stringliteral">&quot;glass&quot;</span> ) ) &amp;&amp;</div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span>                         <a class="code hl_function" href="artifact_8cpp.html#a70800e95389f34dd34186fafaea2a840">rng</a>( 0, <a class="code hl_function" href="namespaceunits.html#a144476d36f26d6e1916493c3636d54dc">units::to_milliliter</a>( 2_liter - <a class="code hl_variable" href="classplayer.html#a20589432777baec94c204b4f5efbfcfb">volume</a> ) ) &lt; <a class="code hl_function" href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">get_str</a>() * 100;</div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span> </div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span>    <span class="comment">// Item will burst upon landing, destroying the item, and spilling its contents</span></div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> burst = thrown.<a class="code hl_function" href="classitem.html#aeb49bb1b64eba3731e606ffe83e95b4f">has_property</a>( <span class="stringliteral">&quot;burst_when_filled&quot;</span> ) &amp;&amp; thrown.<a class="code hl_function" href="classitem.html#a723753bab4cc789e3ec186846c9916a3">is_container</a>() &amp;&amp;</div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span>                       thrown.<a class="code hl_function" href="classitem.html#a19e6dd5afd4bada41c8d97792fd0815d">get_property_int64_t</a>( <span class="stringliteral">&quot;burst_when_filled&quot;</span> ) &lt;= <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span></div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span>                       ( thrown.<a class="code hl_function" href="classitem.html#aeb62f6d93e37bf01af71f795cc39f4f1">get_contained</a>().<a class="code hl_function" href="classitem.html#a51eafbdf8b331d88b741c0c527f98eb9">volume</a>().<a class="code hl_function" href="classunits_1_1quantity.html#a239e9b238064a23fab11ff2094537958">value</a>() ) / thrown.<a class="code hl_function" href="classitem.html#acbc651b09ebafad57974d0cfa04b8e5d">get_container_capacity</a>().<a class="code hl_function" href="classunits_1_1quantity.html#a239e9b238064a23fab11ff2094537958">value</a>() * 100;</div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span> </div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>    <span class="comment">// Add some flags to the projectile</span></div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span>    <span class="keywordflow">if</span>( weight &gt; 500_gram ) {</div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>        proj.<a class="code hl_function" href="structprojectile.html#a05d90cbb1c83669dd7c23477c8f35963">add_effect</a>( <a class="code hl_variable" href="ranged_8cpp.html#a56ca2e5cfeec3ed46b11661ab0d4a51d">ammo_effect_HEAVY_HIT</a> );</div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span>    }</div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span> </div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span>    proj.<a class="code hl_function" href="structprojectile.html#a05d90cbb1c83669dd7c23477c8f35963">add_effect</a>( <a class="code hl_variable" href="ranged_8cpp.html#aa3f58e0db88c98c686cbce467d25fd94">ammo_effect_NO_ITEM_DAMAGE</a> );</div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span> </div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span>    <span class="keywordflow">if</span>( thrown.<a class="code hl_variable" href="classitem.html#a2993eb10a5ae589e6bb1be0a74cb65c1">active</a> ) {</div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span>        <span class="comment">// Can&#39;t have Molotovs embed into monsters</span></div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>        <span class="comment">// Monsters don&#39;t have inventory processing</span></div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span>        proj.<a class="code hl_function" href="structprojectile.html#a05d90cbb1c83669dd7c23477c8f35963">add_effect</a>( <a class="code hl_variable" href="ranged_8cpp.html#a8f6e1a41d7fec5aac1acdc98363c8cc4">ammo_effect_NO_EMBED</a> );</div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span>    }</div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span> </div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span>    <span class="keywordflow">if</span>( do_railgun ) {</div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span>        proj.<a class="code hl_function" href="structprojectile.html#a05d90cbb1c83669dd7c23477c8f35963">add_effect</a>( <a class="code hl_variable" href="ranged_8cpp.html#a17d7acb18d1ef9119106898d678fac76">ammo_effect_LIGHTNING</a> );</div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span>    }</div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span> </div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classplayer.html#a20589432777baec94c204b4f5efbfcfb">volume</a> &gt; 500_ml ) {</div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span>        proj.<a class="code hl_function" href="structprojectile.html#a05d90cbb1c83669dd7c23477c8f35963">add_effect</a>( <a class="code hl_variable" href="ranged_8cpp.html#ad2f60bde7290b0993994d14fad34a3e9">ammo_effect_WIDE</a> );</div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span>    }</div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span> </div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span>    <span class="comment">// Deal extra cut damage if the item breaks</span></div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span>    <span class="keywordflow">if</span>( shatter ) {</div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>        <a class="code hl_function" href="classplayer.html#ae1d6e52d9fb8fdf08eecb74890a28342">impact</a>.add_damage( <a class="code hl_enumvalue" href="damage_8h.html#ae63a2cf8429f9edf77b547d34ffe4e7aa8ff698c0509e78ff65c7c7ec899b4f51">DT_CUT</a>, <a class="code hl_function" href="namespaceunits.html#a144476d36f26d6e1916493c3636d54dc">units::to_milliliter</a>( <a class="code hl_variable" href="classplayer.html#a20589432777baec94c204b4f5efbfcfb">volume</a> ) / 500.0f );</div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span>        proj.<a class="code hl_function" href="structprojectile.html#a05d90cbb1c83669dd7c23477c8f35963">add_effect</a>( <a class="code hl_variable" href="ranged_8cpp.html#a7037269f2b6a941bc0e3f2e659450f32">ammo_effect_SHATTER_SELF</a> );</div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span>    }</div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span> </div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span>    <span class="comment">// TODO: Add wet effect if other things care about that</span></div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span>    <span class="keywordflow">if</span>( burst ) {</div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span>        proj.<a class="code hl_function" href="structprojectile.html#a05d90cbb1c83669dd7c23477c8f35963">add_effect</a>( <a class="code hl_variable" href="ranged_8cpp.html#a336ae362f6bd28ffde9cd73ccf9be4ae">ammo_effect_BURST</a> );</div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span>    }</div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span> </div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span>    <span class="comment">// Some minor (skill/2) armor piercing for skillful throws</span></div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span>    <span class="comment">// Not as much as in melee, though</span></div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span>    <span class="keywordflow">for</span>( <a class="code hl_struct" href="structdamage__unit.html">damage_unit</a> &amp;du : <a class="code hl_function" href="classplayer.html#ae1d6e52d9fb8fdf08eecb74890a28342">impact</a>.damage_units ) {</div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span>        du.<a class="code hl_variable" href="structdamage__unit.html#ab4d1b13f7ebe2f16a43038e1441ec2b5">res_pen</a> += skill_level / 2.0f;</div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span>    }</div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span>    <span class="comment">// handling for tangling thrown items</span></div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span>    <span class="keywordflow">if</span>( thrown.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <span class="stringliteral">&quot;TANGLE&quot;</span> ) ) {</div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span>        proj.<a class="code hl_function" href="structprojectile.html#a05d90cbb1c83669dd7c23477c8f35963">add_effect</a>( <a class="code hl_variable" href="ranged_8cpp.html#aa629b07204a26cf4e57eabe425b3d5c4">ammo_effect_TANGLE</a> );</div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span>    }</div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span> </div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span>    <a class="code hl_class" href="classCreature.html">Creature</a> *critter = <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;critter_at( target, <span class="keyword">true</span> );</div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span>    <span class="keyword">const</span> <a class="code hl_class" href="classdispersion__sources.html">dispersion_sources</a> dispersion( <a class="code hl_function" href="namespaceranged.html#a54895869f69a00b4a74df15057a9a780">ranged::throwing_dispersion</a>( *<span class="keyword">this</span>, thrown, critter,</div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span>                                         blind_throw_from_pos.<a class="code hl_function" href="classcata_1_1optional.html#ad5b847e0e2f1db1387a10bac3751ccf4">has_value</a>() ) );</div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structitype.html">itype</a> *thrown_type = thrown.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>;</div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span> </div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span>    <span class="comment">// Put the item into the projectile</span></div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span>    proj.<a class="code hl_function" href="structprojectile.html#a2bbf20562006058aa939aa5339860ba7">set_drop</a>( <a class="code hl_function" href="namespaceavatar__action.html#a76ba74774376a08222b8cdcce08f7304">std::move</a>( thrown ) );</div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span>    <span class="keywordflow">if</span>( thrown_type-&gt;<a class="code hl_function" href="structitype.html#ab8196084d50fd9a33d6d93c290501b4f">has_flag</a>( <span class="stringliteral">&quot;CUSTOM_EXPLOSION&quot;</span> ) ) {</div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span>        proj.<a class="code hl_function" href="structprojectile.html#a3eb9cbe946d6bf2131eeae97d2d1230d">set_custom_explosion</a>( thrown_type-&gt;<a class="code hl_variable" href="structitype.html#a15ce9f3914d2afb7992e4683a0996791">explosion</a> );</div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span>    }</div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span> </div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span>    <span class="comment">// Throw from the player&#39;s position, unless we&#39;re blind throwing, in which case</span></div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span>    <span class="comment">// throw from the the blind throw position instead.</span></div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> throw_from = blind_throw_from_pos ? *blind_throw_from_pos : <a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>();</div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span> </div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span>    <span class="keywordtype">float</span> range = <a class="code hl_function" href="coordinates_8h.html#a47953b33a873caa0861b12222842a5ec">rl_dist</a>( throw_from, target );</div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span>    proj.<a class="code hl_variable" href="structprojectile.html#a312bc9a78fe7a5fdefb44e3755154db3">range</a> = range;</div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span>    <span class="keywordtype">int</span> skill_lvl = <a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( skill_used );</div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span>    <span class="comment">// Avoid awarding tons of xp for lucky throws against hard to hit targets</span></div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> range_factor = std::min&lt;float&gt;( range, skill_lvl + 3 );</div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span>    <span class="comment">// We&#39;re aiming to get a damaging hit, not just an accurate one - reward proper weapons</span></div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> damage_factor = 5.0f * std::sqrt( proj.<a class="code hl_variable" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a>.<a class="code hl_function" href="structdamage__instance.html#a96f6f6d008ed8744ce549cefcfec3951">total_damage</a>() / 5.0f );</div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span>    <span class="comment">// This should generally have values below ~20*sqrt(skill_lvl)</span></div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> final_xp_mult = range_factor * damage_factor;</div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span> </div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span>    <span class="keyword">auto</span> dealt_attack = <a class="code hl_function" href="ballistics_8cpp.html#aeded5f16540ef8f873a7d9eb5edca240">projectile_attack</a>( proj, throw_from, target, dispersion, <span class="keyword">this</span> );</div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span> </div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> missed_by = dealt_attack.missed_by;</div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span>    <span class="keywordflow">if</span>( missed_by &lt;= 0.1 &amp;&amp; dealt_attack.hit_critter != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span>        <a class="code hl_function" href="classplayer.html#aa57c61de29a5e410c100aee07798b9b1">practice</a>( skill_used, final_xp_mult, <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> );</div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span>        <span class="comment">// TODO: Check target for existence of head</span></div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span>        <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;events().send&lt;<a class="code hl_enumvalue" href="event_8h.html#a430b444c74dd3fd1472a31714ec5f1cea365dbc32084e314b4788756b6fa66ecb">event_type::character_gets_headshot</a>&gt;( <a class="code hl_function" href="classCharacter.html#adb54bdcb284abb66b6be99c8ae225065">getID</a>() );</div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( dealt_attack.hit_critter != <span class="keyword">nullptr</span> &amp;&amp; missed_by &gt; 0.0f ) {</div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span>        <a class="code hl_function" href="classplayer.html#aa57c61de29a5e410c100aee07798b9b1">practice</a>( skill_used, final_xp_mult / ( 1.0f + missed_by ), <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> );</div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span>        <span class="comment">// Pure grindy practice - cap gain at lvl 2</span></div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span>        <a class="code hl_function" href="classplayer.html#aa57c61de29a5e410c100aee07798b9b1">practice</a>( skill_used, 5, 2 );</div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span>    }</div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span>    <span class="comment">// Reset last target pos</span></div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"> 1269</span>    <a class="code hl_variable" href="classplayer.html#a9aac4afb832dc4762430b0b3545cbfea">last_target_pos</a> = <a class="code hl_variable" href="namespacecata.html#ad05314667ac5d05f984aeeef26b9a87f">cata::nullopt</a>;</div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span>    <a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> = <a class="code hl_variable" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a>;</div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span> </div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"> 1272</span>    <span class="keywordflow">return</span> dealt_attack;</div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span>}</div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span> </div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a7dcffd38110cb6a93c24f11258461023"> 1275</a></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="ranged_8cpp.html#a7dcffd38110cb6a93c24f11258461023">do_aim</a>( <a class="code hl_class" href="classplayer.html">player</a> &amp;p, <span class="keyword">const</span> <a class="code hl_class" href="classitem.html">item</a> &amp;relevant, <span class="keyword">const</span> <span class="keywordtype">double</span> min_recoil )</div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span>{</div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"> 1277</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> aim_amount = p.<a class="code hl_function" href="classCharacter.html#a851daac85a019452f34ba82a377773b0">aim_per_move</a>( relevant, p.<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> );</div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"> 1278</span>    <span class="keywordflow">if</span>( aim_amount &gt; 0 &amp;&amp; p.<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> &gt; min_recoil ) {</div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"> 1279</span>        <span class="comment">// Increase aim at the cost of moves</span></div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"> 1280</span>        p.<a class="code hl_function" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -1 );</div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"> 1281</span>        p.<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> = std::max( min_recoil, p.<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> - aim_amount );</div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"> 1282</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"> 1283</span>        <span class="comment">// If aim is already maxed, we&#39;re just waiting, so pass the turn.</span></div>
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"> 1284</span>        p.<a class="code hl_function" href="classCreature.html#af826bfbdc9d7f81a8b9e53775f43d080">set_moves</a>( 0 );</div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span>    }</div>
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"> 1286</span>}</div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span> </div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"><a class="line" href="structconfidence__rating.html"> 1288</a></span><span class="keyword">struct </span><a class="code hl_struct" href="structconfidence__rating.html">confidence_rating</a> {</div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"><a class="line" href="structconfidence__rating.html#a95391c9a8078562cb5f37dacf9ff0267"> 1289</a></span>    <span class="keywordtype">double</span> <a class="code hl_variable" href="structconfidence__rating.html#a95391c9a8078562cb5f37dacf9ff0267">aim_level</a>;</div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"><a class="line" href="structconfidence__rating.html#a3e948736e9d479abfa280833019cad36"> 1290</a></span>    <span class="keywordtype">char</span> <a class="code hl_variable" href="structconfidence__rating.html#a3e948736e9d479abfa280833019cad36">symbol</a>;</div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"><a class="line" href="structconfidence__rating.html#afe2900a64ed6d6d39f4f2322216abf36"> 1291</a></span>    std::string <a class="code hl_variable" href="structconfidence__rating.html#afe2900a64ed6d6d39f4f2322216abf36">color</a>;</div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"><a class="line" href="structconfidence__rating.html#a47c7756df867e77f46be130c7bb02e5c"> 1292</a></span>    std::string <a class="code hl_variable" href="structconfidence__rating.html#a47c7756df867e77f46be130c7bb02e5c">label</a>;</div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span>};</div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span> </div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ab1ce33f7e8ed6c701d44bf39e98de576"> 1295</a></span><span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code hl_function" href="ranged_8cpp.html#ab1ce33f7e8ed6c701d44bf39e98de576">print_steadiness</a>( <span class="keyword">const</span> <a class="code hl_class" href="classcatacurses_1_1window.html">catacurses::window</a> &amp;w, <span class="keywordtype">int</span> line_number, <span class="keywordtype">double</span> steadiness )</div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"> 1296</span>{</div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"> 1297</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> window_width = <a class="code hl_function" href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">getmaxx</a>( w ) - 2; <span class="comment">// Window width minus borders.</span></div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"> 1298</span> </div>
<div class="line"><a id="l01299" name="l01299"></a><span class="lineno"> 1299</span>    <span class="keywordflow">if</span>( get_option&lt;std::string&gt;( <span class="stringliteral">&quot;ACCURACY_DISPLAY&quot;</span> ) == <span class="stringliteral">&quot;numbers&quot;</span> ) {</div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"> 1300</span>        std::string steadiness_s = <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <span class="stringliteral">&quot;%s: %d%%&quot;</span>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Steadiness&quot;</span> ),</div>
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"> 1301</span>                                   <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( 100.0 * steadiness ) );</div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span>        <a class="code hl_function" href="namespacecatacurses.html#abde9c157650e464f0a27441d81c84644">mvwprintw</a>( w, <a class="code hl_struct" href="structpoint.html">point</a>( 1, line_number++ ), steadiness_s );</div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"> 1303</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"> 1304</span>        <span class="keyword">const</span> std::string &amp;steadiness_bar = <a class="code hl_function" href="output_8cpp.html#add34b080694a5b887cf3b201051bf1c0">get_labeled_bar</a>( steadiness, window_width,</div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"> 1305</span>                                            <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Steadiness&quot;</span> ), <span class="charliteral">&#39;*&#39;</span> );</div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span>        <a class="code hl_function" href="namespacecatacurses.html#abde9c157650e464f0a27441d81c84644">mvwprintw</a>( w, <a class="code hl_struct" href="structpoint.html">point</a>( 1, line_number++ ), steadiness_bar );</div>
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"> 1307</span>    }</div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span> </div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"> 1309</span>    <span class="keywordflow">return</span> line_number;</div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span>}</div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span> </div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a8c62adc6acdb9a2e731a64f65499bad8"> 1312</a></span><span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code hl_function" href="ranged_8cpp.html#a8c62adc6acdb9a2e731a64f65499bad8">confidence_estimate</a>( <span class="keywordtype">int</span> range, <span class="keywordtype">double</span> target_size,</div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span>                                   <span class="keyword">const</span> <a class="code hl_class" href="classdispersion__sources.html">dispersion_sources</a> &amp;dispersion )</div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span>{</div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span>    <span class="comment">// This is a rough estimate of accuracy based on a linear distribution across min and max</span></div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span>    <span class="comment">// dispersion.  It is highly inaccurate probability-wise.  The result gives the player</span></div>
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"> 1317</span>    <span class="comment">// correct relative measures of chance to hit, and corresponds with the actual distribution at</span></div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span>    <span class="comment">// min, max, and mean.</span></div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"> 1319</span>    <span class="keywordflow">if</span>( range == 0 ) {</div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"> 1320</span>        <span class="keywordflow">return</span> 2 * target_size;</div>
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"> 1321</span>    }</div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"> 1322</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> max_lateral_offset =</div>
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"> 1323</span>        <a class="code hl_function" href="line_8cpp.html#abe565ec8aa356531238f99029077c3a1">iso_tangent</a>( range, <a class="code hl_function" href="namespaceunits.html#a8841cc418c4abd052eab82f152a5af07">units::from_arcmin</a>( dispersion.<a class="code hl_function" href="classdispersion__sources.html#ac3dc7f13e78a217aeaba57740f3af17c">max</a>() ) );</div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span>    <span class="keywordflow">return</span> 1 / ( max_lateral_offset / target_size );</div>
<div class="line"><a id="l01325" name="l01325"></a><span class="lineno"> 1325</span>}</div>
<div class="line"><a id="l01326" name="l01326"></a><span class="lineno"> 1326</span> </div>
<div class="line"><a id="l01327" name="l01327"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a588329b70c53194be20a6c9b7798923d"> 1327</a></span><span class="keyword">static</span> std::vector&lt;aim_type&gt; <a class="code hl_function" href="ranged_8cpp.html#a588329b70c53194be20a6c9b7798923d">get_default_aim_type</a>()</div>
<div class="line"><a id="l01328" name="l01328"></a><span class="lineno"> 1328</span>{</div>
<div class="line"><a id="l01329" name="l01329"></a><span class="lineno"> 1329</span>    std::vector&lt;aim_type&gt; aim_types;</div>
<div class="line"><a id="l01330" name="l01330"></a><span class="lineno"> 1330</span>    aim_types.push_back( <a class="code hl_struct" href="structaim__type.html">aim_type</a> { <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">false</span>, 0 } ); <span class="comment">// dummy aim type for unaimed shots</span></div>
<div class="line"><a id="l01331" name="l01331"></a><span class="lineno"> 1331</span>    <span class="keywordflow">return</span> aim_types;</div>
<div class="line"><a id="l01332" name="l01332"></a><span class="lineno"> 1332</span>}</div>
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"> 1333</span> </div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a86a68d80cad5052d3e456a9fb8b1769d"> 1334</a></span><span class="keyword">using</span> <a class="code hl_typedef" href="ranged_8cpp.html#a86a68d80cad5052d3e456a9fb8b1769d">RatingVector</a> = std::vector&lt;std::tuple&lt;double, char, std::string&gt;&gt;;</div>
<div class="line"><a id="l01335" name="l01335"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ae485e14f2f0d97810da8125353dfa101"> 1335</a></span><span class="keyword">static</span> std::string <a class="code hl_function" href="ranged_8cpp.html#ae485e14f2f0d97810da8125353dfa101">get_colored_bar</a>( <span class="keyword">const</span> <span class="keywordtype">double</span> val, <span class="keyword">const</span> <span class="keywordtype">int</span> width, <span class="keyword">const</span> std::string &amp;<a class="code hl_struct" href="structlabel.html">label</a>,</div>
<div class="line"><a id="l01336" name="l01336"></a><span class="lineno"> 1336</span>                                    RatingVector::iterator begin, RatingVector::iterator end )</div>
<div class="line"><a id="l01337" name="l01337"></a><span class="lineno"> 1337</span>{</div>
<div class="line"><a id="l01338" name="l01338"></a><span class="lineno"> 1338</span>    std::string <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a>;</div>
<div class="line"><a id="l01339" name="l01339"></a><span class="lineno"> 1339</span> </div>
<div class="line"><a id="l01340" name="l01340"></a><span class="lineno"> 1340</span>    <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a>.reserve( width );</div>
<div class="line"><a id="l01341" name="l01341"></a><span class="lineno"> 1341</span>    <span class="keywordflow">if</span>( !<a class="code hl_struct" href="structlabel.html">label</a>.empty() ) {</div>
<div class="line"><a id="l01342" name="l01342"></a><span class="lineno"> 1342</span>        <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> += <a class="code hl_struct" href="structlabel.html">label</a>;</div>
<div class="line"><a id="l01343" name="l01343"></a><span class="lineno"> 1343</span>        <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> += <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line"><a id="l01344" name="l01344"></a><span class="lineno"> 1344</span>    }</div>
<div class="line"><a id="l01345" name="l01345"></a><span class="lineno"> 1345</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> bar_width = width - <a class="code hl_function" href="catacharset_8cpp.html#a7616a48a4b48437c60b6683439a8f3e2">utf8_width</a>( <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> ) - 2; <span class="comment">// - 2 for the brackets</span></div>
<div class="line"><a id="l01346" name="l01346"></a><span class="lineno"> 1346</span> </div>
<div class="line"><a id="l01347" name="l01347"></a><span class="lineno"> 1347</span>    <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> += <span class="charliteral">&#39;[&#39;</span>;</div>
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"> 1348</span>    <span class="keywordflow">if</span>( bar_width &gt; 0 ) {</div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span>        <span class="keywordtype">int</span> used_width = 0;</div>
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"> 1350</span>        <span class="keywordflow">for</span>( <span class="keyword">auto</span> it( begin ); it != end; ++it ) {</div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> factor = std::min( 1.0, std::max( 0.0, std::get&lt;0&gt;( *it ) * val ) );</div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span>            <span class="keyword">const</span> <span class="keywordtype">int</span> seg_width = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( factor * bar_width ) - used_width;</div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span> </div>
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"> 1354</span>            <span class="keywordflow">if</span>( seg_width &lt;= 0 ) {</div>
<div class="line"><a id="l01355" name="l01355"></a><span class="lineno"> 1355</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01356" name="l01356"></a><span class="lineno"> 1356</span>            }</div>
<div class="line"><a id="l01357" name="l01357"></a><span class="lineno"> 1357</span>            used_width += seg_width;</div>
<div class="line"><a id="l01358" name="l01358"></a><span class="lineno"> 1358</span>            <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> += <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <span class="stringliteral">&quot;&lt;color_%s&gt;&quot;</span>, std::get&lt;2&gt;( *it ) );</div>
<div class="line"><a id="l01359" name="l01359"></a><span class="lineno"> 1359</span>            <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a>.insert( <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a>.end(), seg_width, std::get&lt;1&gt;( *it ) );</div>
<div class="line"><a id="l01360" name="l01360"></a><span class="lineno"> 1360</span>            <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> += <span class="stringliteral">&quot;&lt;/color&gt;&quot;</span>;</div>
<div class="line"><a id="l01361" name="l01361"></a><span class="lineno"> 1361</span>        }</div>
<div class="line"><a id="l01362" name="l01362"></a><span class="lineno"> 1362</span>        <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a>.insert( <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a>.end(), bar_width - used_width, <span class="charliteral">&#39; &#39;</span> );</div>
<div class="line"><a id="l01363" name="l01363"></a><span class="lineno"> 1363</span>    }</div>
<div class="line"><a id="l01364" name="l01364"></a><span class="lineno"> 1364</span>    <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> += <span class="charliteral">&#39;]&#39;</span>;</div>
<div class="line"><a id="l01365" name="l01365"></a><span class="lineno"> 1365</span> </div>
<div class="line"><a id="l01366" name="l01366"></a><span class="lineno"> 1366</span>    <span class="keywordflow">return</span> <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a>;</div>
<div class="line"><a id="l01367" name="l01367"></a><span class="lineno"> 1367</span>}</div>
<div class="line"><a id="l01368" name="l01368"></a><span class="lineno"> 1368</span> </div>
<div class="line"><a id="l01369" name="l01369"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a0d9e38138df960f8f724b45c5e3c1204"> 1369</a></span><span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code hl_function" href="ranged_8cpp.html#a0d9e38138df960f8f724b45c5e3c1204">print_ranged_chance</a>( <span class="keyword">const</span> <a class="code hl_class" href="classplayer.html">player</a> &amp;, <span class="keyword">const</span> <a class="code hl_class" href="classcatacurses_1_1window.html">catacurses::window</a> &amp;w, <span class="keywordtype">int</span> line_number,</div>
<div class="line"><a id="l01370" name="l01370"></a><span class="lineno"> 1370</span>                                <a class="code hl_class" href="classinput__context.html">input_context</a> &amp;ctxt, <span class="keyword">const</span> <a class="code hl_class" href="classitem.html">item</a> &amp;,</div>
<div class="line"><a id="l01371" name="l01371"></a><span class="lineno"> 1371</span>                                <span class="keyword">const</span> std::vector&lt;aim_type&gt; &amp;aim_types,</div>
<div class="line"><a id="l01372" name="l01372"></a><span class="lineno"> 1372</span>                                <span class="keyword">const</span> std::function&lt;<a class="code hl_class" href="classdispersion__sources.html">dispersion_sources</a>( <span class="keyword">const</span> <a class="code hl_struct" href="structaim__type.html">aim_type</a> &amp; )&gt; &amp;dispersion_fun,</div>
<div class="line"><a id="l01373" name="l01373"></a><span class="lineno"> 1373</span>                                <span class="keyword">const</span> std::function&lt;<span class="keywordtype">int</span>( <span class="keyword">const</span> <a class="code hl_struct" href="structaim__type.html">aim_type</a> &amp; )&gt; &amp;cost_fun,</div>
<div class="line"><a id="l01374" name="l01374"></a><span class="lineno"> 1374</span>                                <span class="keyword">const</span> std::vector&lt;confidence_rating&gt; &amp;confidence_config,</div>
<div class="line"><a id="l01375" name="l01375"></a><span class="lineno"> 1375</span>                                <span class="keywordtype">double</span> range, <span class="keywordtype">double</span> target_size )</div>
<div class="line"><a id="l01376" name="l01376"></a><span class="lineno"> 1376</span>{</div>
<div class="line"><a id="l01377" name="l01377"></a><span class="lineno"> 1377</span>    <span class="keywordtype">int</span> window_width = <a class="code hl_function" href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">getmaxx</a>( w ) - 2; <span class="comment">// Window width minus borders.</span></div>
<div class="line"><a id="l01378" name="l01378"></a><span class="lineno"> 1378</span>    std::string display_type = get_option&lt;std::string&gt;( <span class="stringliteral">&quot;ACCURACY_DISPLAY&quot;</span> );</div>
<div class="line"><a id="l01379" name="l01379"></a><span class="lineno"> 1379</span>    std::string panel_type = <a class="code hl_function" href="classpanel__manager.html#a1196cd08699822653246ccafd856f72c">panel_manager::get_manager</a>().<a class="code hl_function" href="classpanel__manager.html#a3f6290efcd5bca21c3cf44762bca2a91">get_current_layout_id</a>();</div>
<div class="line"><a id="l01380" name="l01380"></a><span class="lineno"> 1380</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> bars_pad = 3; <span class="comment">// Padding for &quot;bars&quot; to fit moves_to_fire value.</span></div>
<div class="line"><a id="l01381" name="l01381"></a><span class="lineno"> 1381</span>    <span class="keywordflow">if</span>( ( panel_type == <span class="stringliteral">&quot;compact&quot;</span> || panel_type == <span class="stringliteral">&quot;labels-narrow&quot;</span> ) &amp;&amp; display_type != <span class="stringliteral">&quot;numbers&quot;</span> ) {</div>
<div class="line"><a id="l01382" name="l01382"></a><span class="lineno"> 1382</span>        window_width -= bars_pad;</div>
<div class="line"><a id="l01383" name="l01383"></a><span class="lineno"> 1383</span>    }</div>
<div class="line"><a id="l01384" name="l01384"></a><span class="lineno"> 1384</span> </div>
<div class="line"><a id="l01385" name="l01385"></a><span class="lineno"> 1385</span>    std::string label_m = <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Moves&quot;</span> );</div>
<div class="line"><a id="l01386" name="l01386"></a><span class="lineno"> 1386</span>    std::vector&lt;std::string&gt; t_aims( 4 ), t_confidence( 16 );</div>
<div class="line"><a id="l01387" name="l01387"></a><span class="lineno"> 1387</span>    <span class="keywordtype">int</span> aim_iter = 0, conf_iter = 0;</div>
<div class="line"><a id="l01388" name="l01388"></a><span class="lineno"> 1388</span> </div>
<div class="line"><a id="l01389" name="l01389"></a><span class="lineno"> 1389</span>    <a class="code hl_class" href="classnc__color.html">nc_color</a> col = <a class="code hl_define" href="color_8h.html#a5738d18ff9e165cca088a623cb1883ae">c_dark_gray</a>;</div>
<div class="line"><a id="l01390" name="l01390"></a><span class="lineno"> 1390</span> </div>
<div class="line"><a id="l01391" name="l01391"></a><span class="lineno"> 1391</span>    <span class="keywordflow">if</span>( display_type != <span class="stringliteral">&quot;numbers&quot;</span> ) {</div>
<div class="line"><a id="l01392" name="l01392"></a><span class="lineno"> 1392</span>        std::string <a class="code hl_variable" href="namespaceanonymous__namespace_02rotatable__symbols_8cpp_03.html#a0828f572b03c625d4b291dd36d0d0a4c">symbols</a>;</div>
<div class="line"><a id="l01393" name="l01393"></a><span class="lineno"> 1393</span>        <span class="keywordtype">int</span> column_number = 1;</div>
<div class="line"><a id="l01394" name="l01394"></a><span class="lineno"> 1394</span>        <span class="keywordflow">if</span>( !( panel_type == <span class="stringliteral">&quot;compact&quot;</span> || panel_type == <span class="stringliteral">&quot;labels-narrow&quot;</span> ) ) {</div>
<div class="line"><a id="l01395" name="l01395"></a><span class="lineno"> 1395</span>            std::string <a class="code hl_struct" href="structlabel.html">label</a> = <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Symbols:&quot;</span> );</div>
<div class="line"><a id="l01396" name="l01396"></a><span class="lineno"> 1396</span>            <a class="code hl_function" href="namespacecatacurses.html#abde9c157650e464f0a27441d81c84644">mvwprintw</a>( w, <a class="code hl_struct" href="structpoint.html">point</a>( column_number, line_number ), <a class="code hl_struct" href="structlabel.html">label</a> );</div>
<div class="line"><a id="l01397" name="l01397"></a><span class="lineno"> 1397</span>            column_number += <a class="code hl_function" href="catacharset_8cpp.html#a7616a48a4b48437c60b6683439a8f3e2">utf8_width</a>( <a class="code hl_struct" href="structlabel.html">label</a> ) + 1; <span class="comment">// 1 for whitespace after &#39;Symbols:&#39;</span></div>
<div class="line"><a id="l01398" name="l01398"></a><span class="lineno"> 1398</span>        }</div>
<div class="line"><a id="l01399" name="l01399"></a><span class="lineno"> 1399</span>        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_struct" href="structconfidence__rating.html">confidence_rating</a> &amp;cr : confidence_config ) {</div>
<div class="line"><a id="l01400" name="l01400"></a><span class="lineno"> 1400</span>            std::string <a class="code hl_struct" href="structlabel.html">label</a> = <a class="code hl_function" href="translations_8cpp.html#af0c79b5c75a7cf2df78663485b03ed9a">pgettext</a>( <span class="stringliteral">&quot;aim_confidence&quot;</span>, cr.label.c_str() );</div>
<div class="line"><a id="l01401" name="l01401"></a><span class="lineno"> 1401</span>            std::string <a class="code hl_variable" href="namespaceanonymous__namespace_02rotatable__symbols_8cpp_03.html#a0828f572b03c625d4b291dd36d0d0a4c">symbols</a> = <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <span class="stringliteral">&quot;&lt;color_%s&gt;%s&lt;/color&gt; = %s&quot;</span>, cr.color, cr.symbol,</div>
<div class="line"><a id="l01402" name="l01402"></a><span class="lineno"> 1402</span>                                                 <a class="code hl_struct" href="structlabel.html">label</a> );</div>
<div class="line"><a id="l01403" name="l01403"></a><span class="lineno"> 1403</span>            <span class="keywordtype">int</span> line_len = <a class="code hl_function" href="catacharset_8cpp.html#a7616a48a4b48437c60b6683439a8f3e2">utf8_width</a>( <a class="code hl_struct" href="structlabel.html">label</a> ) + 5; <span class="comment">// 5 for &#39;# = &#39; and whitespace at end</span></div>
<div class="line"><a id="l01404" name="l01404"></a><span class="lineno"> 1404</span>            <span class="keywordflow">if</span>( ( window_width + bars_pad - column_number ) &lt; line_len ) {</div>
<div class="line"><a id="l01405" name="l01405"></a><span class="lineno"> 1405</span>                column_number = 1;</div>
<div class="line"><a id="l01406" name="l01406"></a><span class="lineno"> 1406</span>                line_number++;</div>
<div class="line"><a id="l01407" name="l01407"></a><span class="lineno"> 1407</span>            }</div>
<div class="line"><a id="l01408" name="l01408"></a><span class="lineno"> 1408</span>            <a class="code hl_function" href="output_8cpp.html#a9fcad5b904c8019b15fe1ac8e665a1cb">print_colored_text</a>( w, <a class="code hl_struct" href="structpoint.html">point</a>( column_number, line_number ), col, col, <a class="code hl_variable" href="namespaceanonymous__namespace_02rotatable__symbols_8cpp_03.html#a0828f572b03c625d4b291dd36d0d0a4c">symbols</a> );</div>
<div class="line"><a id="l01409" name="l01409"></a><span class="lineno"> 1409</span>            column_number += line_len;</div>
<div class="line"><a id="l01410" name="l01410"></a><span class="lineno"> 1410</span>        }</div>
<div class="line"><a id="l01411" name="l01411"></a><span class="lineno"> 1411</span>        line_number++;</div>
<div class="line"><a id="l01412" name="l01412"></a><span class="lineno"> 1412</span>    }</div>
<div class="line"><a id="l01413" name="l01413"></a><span class="lineno"> 1413</span>    <span class="keywordflow">if</span>( ( panel_type == <span class="stringliteral">&quot;compact&quot;</span> || panel_type == <span class="stringliteral">&quot;labels-narrow&quot;</span> ) &amp;&amp; display_type == <span class="stringliteral">&quot;numbers&quot;</span> ) {</div>
<div class="line"><a id="l01414" name="l01414"></a><span class="lineno"> 1414</span>        std::string <a class="code hl_variable" href="namespaceanonymous__namespace_02rotatable__symbols_8cpp_03.html#a0828f572b03c625d4b291dd36d0d0a4c">symbols</a> = <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot; &lt;color_green&gt;Great&lt;/color&gt; - &lt;color_light_gray&gt;Normal&lt;/color&gt;&quot;</span></div>
<div class="line"><a id="l01415" name="l01415"></a><span class="lineno"> 1415</span>                                 <span class="stringliteral">&quot; - &lt;color_magenta&gt;Graze&lt;/color&gt; - &lt;color_light_blue&gt;Moves&lt;/color&gt;&quot;</span> );</div>
<div class="line"><a id="l01416" name="l01416"></a><span class="lineno"> 1416</span>        <a class="code hl_function" href="output_8cpp.html#ab9659cbe9ec23a2efd813f795cb7fb73">fold_and_print</a>( w, <a class="code hl_struct" href="structpoint.html">point</a>( 1, line_number++ ), window_width + bars_pad,</div>
<div class="line"><a id="l01417" name="l01417"></a><span class="lineno"> 1417</span>                        <a class="code hl_define" href="color_8h.html#a5738d18ff9e165cca088a623cb1883ae">c_dark_gray</a>, <a class="code hl_variable" href="namespaceanonymous__namespace_02rotatable__symbols_8cpp_03.html#a0828f572b03c625d4b291dd36d0d0a4c">symbols</a> );</div>
<div class="line"><a id="l01418" name="l01418"></a><span class="lineno"> 1418</span>        <span class="keywordtype">int</span> len = <a class="code hl_function" href="catacharset_8cpp.html#a7616a48a4b48437c60b6683439a8f3e2">utf8_width</a>( <a class="code hl_variable" href="namespaceanonymous__namespace_02rotatable__symbols_8cpp_03.html#a0828f572b03c625d4b291dd36d0d0a4c">symbols</a> ) - 96; <span class="comment">// 96 to subtract color codes</span></div>
<div class="line"><a id="l01419" name="l01419"></a><span class="lineno"> 1419</span>        <span class="keywordflow">if</span>( len &gt; window_width + bars_pad ) {</div>
<div class="line"><a id="l01420" name="l01420"></a><span class="lineno"> 1420</span>            line_number++;</div>
<div class="line"><a id="l01421" name="l01421"></a><span class="lineno"> 1421</span>        }</div>
<div class="line"><a id="l01422" name="l01422"></a><span class="lineno"> 1422</span>        <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; window_width; i++ ) {</div>
<div class="line"><a id="l01423" name="l01423"></a><span class="lineno"> 1423</span>            <a class="code hl_function" href="namespacecatacurses.html#abde9c157650e464f0a27441d81c84644">mvwprintw</a>( w, <a class="code hl_struct" href="structpoint.html">point</a>( i + 1, line_number ), <span class="stringliteral">&quot;-&quot;</span> );</div>
<div class="line"><a id="l01424" name="l01424"></a><span class="lineno"> 1424</span>        }</div>
<div class="line"><a id="l01425" name="l01425"></a><span class="lineno"> 1425</span>    }</div>
<div class="line"><a id="l01426" name="l01426"></a><span class="lineno"> 1426</span> </div>
<div class="line"><a id="l01427" name="l01427"></a><span class="lineno"> 1427</span>    <span class="keyword">const</span> <span class="keyword">auto</span> front_or = [&amp;]( <span class="keyword">const</span> std::string &amp; s, <span class="keyword">const</span> <span class="keywordtype">char</span> fallback ) {</div>
<div class="line"><a id="l01428" name="l01428"></a><span class="lineno"> 1428</span>        <span class="keyword">const</span> <span class="keyword">auto</span> keys = ctxt.<a class="code hl_function" href="classinput__context.html#af2b7d6cab67d5a2eeb1122f3041edf79">keys_bound_to</a>( s );</div>
<div class="line"><a id="l01429" name="l01429"></a><span class="lineno"> 1429</span>        <span class="keywordflow">return</span> keys.empty() ? fallback : keys.front();</div>
<div class="line"><a id="l01430" name="l01430"></a><span class="lineno"> 1430</span>    };</div>
<div class="line"><a id="l01431" name="l01431"></a><span class="lineno"> 1431</span> </div>
<div class="line"><a id="l01432" name="l01432"></a><span class="lineno"> 1432</span>    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_struct" href="structaim__type.html">aim_type</a> &amp;<a class="code hl_enumvalue" href="enums_8h.html#ac7c2392f800a8be2feb093ef5fe48d40af3725cafa78eb43cc647b405bb6ecfab">type</a> : aim_types ) {</div>
<div class="line"><a id="l01433" name="l01433"></a><span class="lineno"> 1433</span>        <a class="code hl_class" href="classdispersion__sources.html">dispersion_sources</a> current_dispersion = dispersion_fun( <a class="code hl_enumvalue" href="enums_8h.html#ac7c2392f800a8be2feb093ef5fe48d40af3725cafa78eb43cc647b405bb6ecfab">type</a> );</div>
<div class="line"><a id="l01434" name="l01434"></a><span class="lineno"> 1434</span>        std::string <a class="code hl_struct" href="structlabel.html">label</a> = <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Current&quot;</span> );</div>
<div class="line"><a id="l01435" name="l01435"></a><span class="lineno"> 1435</span>        std::string aim_l = <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Aim&quot;</span> );</div>
<div class="line"><a id="l01436" name="l01436"></a><span class="lineno"> 1436</span>        <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="enums_8h.html#ac7c2392f800a8be2feb093ef5fe48d40af3725cafa78eb43cc647b405bb6ecfab">type</a>.has_threshold ) {</div>
<div class="line"><a id="l01437" name="l01437"></a><span class="lineno"> 1437</span>            <a class="code hl_struct" href="structlabel.html">label</a> = <a class="code hl_enumvalue" href="enums_8h.html#ac7c2392f800a8be2feb093ef5fe48d40af3725cafa78eb43cc647b405bb6ecfab">type</a>.name;</div>
<div class="line"><a id="l01438" name="l01438"></a><span class="lineno"> 1438</span>        }</div>
<div class="line"><a id="l01439" name="l01439"></a><span class="lineno"> 1439</span> </div>
<div class="line"><a id="l01440" name="l01440"></a><span class="lineno"> 1440</span>        <span class="keywordtype">int</span> moves_to_fire = cost_fun( <a class="code hl_enumvalue" href="enums_8h.html#ac7c2392f800a8be2feb093ef5fe48d40af3725cafa78eb43cc647b405bb6ecfab">type</a> );</div>
<div class="line"><a id="l01441" name="l01441"></a><span class="lineno"> 1441</span> </div>
<div class="line"><a id="l01442" name="l01442"></a><span class="lineno"> 1442</span>        <span class="keyword">auto</span> hotkey = front_or( <a class="code hl_enumvalue" href="enums_8h.html#ac7c2392f800a8be2feb093ef5fe48d40af3725cafa78eb43cc647b405bb6ecfab">type</a>.action.empty() ? <span class="stringliteral">&quot;FIRE&quot;</span> : <a class="code hl_enumvalue" href="enums_8h.html#ac7c2392f800a8be2feb093ef5fe48d40af3725cafa78eb43cc647b405bb6ecfab">type</a>.action, <span class="charliteral">&#39; &#39;</span> );</div>
<div class="line"><a id="l01443" name="l01443"></a><span class="lineno"> 1443</span>        <span class="keywordflow">if</span>( ( panel_type == <span class="stringliteral">&quot;compact&quot;</span> || panel_type == <span class="stringliteral">&quot;labels-narrow&quot;</span> ) ) {</div>
<div class="line"><a id="l01444" name="l01444"></a><span class="lineno"> 1444</span>            <span class="keywordflow">if</span>( display_type == <span class="stringliteral">&quot;numbers&quot;</span> ) {</div>
<div class="line"><a id="l01445" name="l01445"></a><span class="lineno"> 1445</span>                t_aims[aim_iter] = <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <span class="stringliteral">&quot;&lt;color_dark_gray&gt;%s:&lt;/color&gt;&quot;</span>, <a class="code hl_struct" href="structlabel.html">label</a> );</div>
<div class="line"><a id="l01446" name="l01446"></a><span class="lineno"> 1446</span>                t_confidence[( aim_iter * 4 ) + 3] = <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <span class="stringliteral">&quot;&lt;color_light_blue&gt;%d&lt;/color&gt;&quot;</span>, moves_to_fire );</div>
<div class="line"><a id="l01447" name="l01447"></a><span class="lineno"> 1447</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01448" name="l01448"></a><span class="lineno"> 1448</span>                <a class="code hl_function" href="output_8cpp.html#a9fcad5b904c8019b15fe1ac8e665a1cb">print_colored_text</a>( w, <a class="code hl_struct" href="structpoint.html">point</a>( 1, line_number ), col, col, <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;%s %s:&quot;</span> ), <a class="code hl_struct" href="structlabel.html">label</a>,</div>
<div class="line"><a id="l01449" name="l01449"></a><span class="lineno"> 1449</span>                                    aim_l ) );</div>
<div class="line"><a id="l01450" name="l01450"></a><span class="lineno"> 1450</span>                <a class="code hl_function" href="output_8cpp.html#aa6093ccb0ebc7f7ee1f11edd5cc2711c">right_print</a>( w, line_number++, 1, <a class="code hl_define" href="color_8h.html#a7b00fb82de0be83f6fc5f7965ea86623">c_light_blue</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Moves&quot;</span> ) );</div>
<div class="line"><a id="l01451" name="l01451"></a><span class="lineno"> 1451</span>                <a class="code hl_function" href="output_8cpp.html#aa6093ccb0ebc7f7ee1f11edd5cc2711c">right_print</a>( w, line_number, 1, <a class="code hl_define" href="color_8h.html#a7b00fb82de0be83f6fc5f7965ea86623">c_light_blue</a>, <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <span class="stringliteral">&quot;%d&quot;</span>, moves_to_fire ) );</div>
<div class="line"><a id="l01452" name="l01452"></a><span class="lineno"> 1452</span>            }</div>
<div class="line"><a id="l01453" name="l01453"></a><span class="lineno"> 1453</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01454" name="l01454"></a><span class="lineno"> 1454</span>            <a class="code hl_function" href="output_8cpp.html#a9fcad5b904c8019b15fe1ac8e665a1cb">print_colored_text</a>( w, <a class="code hl_struct" href="structpoint.html">point</a>( 1, line_number++ ), col, col,</div>
<div class="line"><a id="l01455" name="l01455"></a><span class="lineno"> 1455</span>                                <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;color_white&gt;[%s]&lt;/color&gt; %s %s: Moves to fire: &quot;</span></div>
<div class="line"><a id="l01456" name="l01456"></a><span class="lineno"> 1456</span>                                                  <span class="stringliteral">&quot;&lt;color_light_blue&gt;%d&lt;/color&gt;&quot;</span> ),</div>
<div class="line"><a id="l01457" name="l01457"></a><span class="lineno"> 1457</span>                                               hotkey, <a class="code hl_struct" href="structlabel.html">label</a>, aim_l, moves_to_fire ) );</div>
<div class="line"><a id="l01458" name="l01458"></a><span class="lineno"> 1458</span>        }</div>
<div class="line"><a id="l01459" name="l01459"></a><span class="lineno"> 1459</span> </div>
<div class="line"><a id="l01460" name="l01460"></a><span class="lineno"> 1460</span>        <span class="keywordtype">double</span> confidence = <a class="code hl_function" href="ranged_8cpp.html#a8c62adc6acdb9a2e731a64f65499bad8">confidence_estimate</a>( range, target_size, current_dispersion );</div>
<div class="line"><a id="l01461" name="l01461"></a><span class="lineno"> 1461</span> </div>
<div class="line"><a id="l01462" name="l01462"></a><span class="lineno"> 1462</span>        <span class="keywordflow">if</span>( display_type == <span class="stringliteral">&quot;numbers&quot;</span> ) {</div>
<div class="line"><a id="l01463" name="l01463"></a><span class="lineno"> 1463</span>            <span class="keywordflow">if</span>( panel_type == <span class="stringliteral">&quot;compact&quot;</span> || panel_type == <span class="stringliteral">&quot;labels-narrow&quot;</span> ) {</div>
<div class="line"><a id="l01464" name="l01464"></a><span class="lineno"> 1464</span>                <span class="keywordtype">int</span> last_chance = 0;</div>
<div class="line"><a id="l01465" name="l01465"></a><span class="lineno"> 1465</span>                <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_struct" href="structconfidence__rating.html">confidence_rating</a> &amp;cr : confidence_config ) {</div>
<div class="line"><a id="l01466" name="l01466"></a><span class="lineno"> 1466</span>                    <span class="keywordtype">int</span> chance = std::min&lt;int&gt;( 100, 100.0 * ( cr.aim_level ) * confidence ) - last_chance;</div>
<div class="line"><a id="l01467" name="l01467"></a><span class="lineno"> 1467</span>                    last_chance += chance;</div>
<div class="line"><a id="l01468" name="l01468"></a><span class="lineno"> 1468</span>                    t_confidence[conf_iter] = <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <span class="stringliteral">&quot;&lt;color_%s&gt;%3d%%&lt;/color&gt;&quot;</span>, cr.color, chance );</div>
<div class="line"><a id="l01469" name="l01469"></a><span class="lineno"> 1469</span>                    conf_iter++;</div>
<div class="line"><a id="l01470" name="l01470"></a><span class="lineno"> 1470</span>                    <span class="keywordflow">if</span>( conf_iter == ( aim_iter * 4 ) + 3 ) {</div>
<div class="line"><a id="l01471" name="l01471"></a><span class="lineno"> 1471</span>                        conf_iter++;</div>
<div class="line"><a id="l01472" name="l01472"></a><span class="lineno"> 1472</span>                    }</div>
<div class="line"><a id="l01473" name="l01473"></a><span class="lineno"> 1473</span>                }</div>
<div class="line"><a id="l01474" name="l01474"></a><span class="lineno"> 1474</span>                aim_iter++;</div>
<div class="line"><a id="l01475" name="l01475"></a><span class="lineno"> 1475</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01476" name="l01476"></a><span class="lineno"> 1476</span>                <span class="keywordtype">int</span> last_chance = 0;</div>
<div class="line"><a id="l01477" name="l01477"></a><span class="lineno"> 1477</span>                std::string confidence_s = <a class="code hl_function" href="output_8h.html#abc4022ff920f936d2ee400cedc458733">enumerate_as_string</a>( confidence_config.begin(), confidence_config.end(),</div>
<div class="line"><a id="l01478" name="l01478"></a><span class="lineno"> 1478</span>                [&amp;]( <span class="keyword">const</span> <a class="code hl_struct" href="structconfidence__rating.html">confidence_rating</a> &amp; <a class="code hl_variable" href="namespacecalendar.html#a56436e146aa8bdd67857ec0886d89ffe">config</a> ) {</div>
<div class="line"><a id="l01479" name="l01479"></a><span class="lineno"> 1479</span>                    <span class="comment">// TODO: Consider not printing 0 chances, but only if you can print something (at least miss 100% or so)</span></div>
<div class="line"><a id="l01480" name="l01480"></a><span class="lineno"> 1480</span>                    int chance = std::min&lt;int&gt;( 100, 100.0 * ( config.aim_level * confidence ) ) - last_chance;</div>
<div class="line"><a id="l01481" name="l01481"></a><span class="lineno"> 1481</span>                    last_chance += chance;</div>
<div class="line"><a id="l01482" name="l01482"></a><span class="lineno"> 1482</span>                    return string_format( <span class="stringliteral">&quot;%s: &lt;color_%s&gt;%3d%%&lt;/color&gt;&quot;</span>, pgettext( <span class="stringliteral">&quot;aim_confidence&quot;</span>,</div>
<div class="line"><a id="l01483" name="l01483"></a><span class="lineno"> 1483</span>                                          config.label.c_str() ), config.color, chance );</div>
<div class="line"><a id="l01484" name="l01484"></a><span class="lineno"> 1484</span>                }, <a class="code hl_enumvalue" href="output_8h.html#a17a93de390fc2504e63ab6dc8cf4753aa334c4a4c42fdb79d7ebc3e73b517e6f8">enumeration_conjunction::none</a> );</div>
<div class="line"><a id="l01485" name="l01485"></a><span class="lineno"> 1485</span>                line_number += <a class="code hl_function" href="output_8cpp.html#a2f8515020638461e15374b3bf6555c75">fold_and_print_from</a>( w, <a class="code hl_struct" href="structpoint.html">point</a>( 1, line_number ), window_width, 0,</div>
<div class="line"><a id="l01486" name="l01486"></a><span class="lineno"> 1486</span>                                                    <a class="code hl_define" href="color_8h.html#a5738d18ff9e165cca088a623cb1883ae">c_dark_gray</a>, confidence_s );</div>
<div class="line"><a id="l01487" name="l01487"></a><span class="lineno"> 1487</span>            }</div>
<div class="line"><a id="l01488" name="l01488"></a><span class="lineno"> 1488</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01489" name="l01489"></a><span class="lineno"> 1489</span>            std::vector&lt;std::tuple&lt;double, char, std::string&gt;&gt; confidence_ratings;</div>
<div class="line"><a id="l01490" name="l01490"></a><span class="lineno"> 1490</span>            <a class="code hl_function" href="namespaceiexamine.html#ab9103bcb0e9cb4755b445e5395a0a62f">std::transform</a>( confidence_config.begin(), confidence_config.end(),</div>
<div class="line"><a id="l01491" name="l01491"></a><span class="lineno"> 1491</span>                            std::back_inserter( confidence_ratings ),</div>
<div class="line"><a id="l01492" name="l01492"></a><span class="lineno"> 1492</span>            [&amp;]( <span class="keyword">const</span> <a class="code hl_struct" href="structconfidence__rating.html">confidence_rating</a> &amp; <a class="code hl_variable" href="namespacecalendar.html#a56436e146aa8bdd67857ec0886d89ffe">config</a> ) {</div>
<div class="line"><a id="l01493" name="l01493"></a><span class="lineno"> 1493</span>                return std::make_tuple( config.aim_level, config.symbol, config.color );</div>
<div class="line"><a id="l01494" name="l01494"></a><span class="lineno"> 1494</span>            }</div>
<div class="line"><a id="l01495" name="l01495"></a><span class="lineno"> 1495</span>                          );</div>
<div class="line"><a id="l01496" name="l01496"></a><span class="lineno"> 1496</span>            <span class="keyword">const</span> std::string &amp;confidence_bar = <a class="code hl_function" href="ranged_8cpp.html#ae485e14f2f0d97810da8125353dfa101">get_colored_bar</a>( confidence, window_width, <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><a id="l01497" name="l01497"></a><span class="lineno"> 1497</span>                                                confidence_ratings.begin(),</div>
<div class="line"><a id="l01498" name="l01498"></a><span class="lineno"> 1498</span>                                                confidence_ratings.end() );</div>
<div class="line"><a id="l01499" name="l01499"></a><span class="lineno"> 1499</span> </div>
<div class="line"><a id="l01500" name="l01500"></a><span class="lineno"> 1500</span>            <a class="code hl_function" href="output_8cpp.html#a9fcad5b904c8019b15fe1ac8e665a1cb">print_colored_text</a>( w, <a class="code hl_struct" href="structpoint.html">point</a>( 1, line_number++ ), col, col, confidence_bar );</div>
<div class="line"><a id="l01501" name="l01501"></a><span class="lineno"> 1501</span>        }</div>
<div class="line"><a id="l01502" name="l01502"></a><span class="lineno"> 1502</span>    }</div>
<div class="line"><a id="l01503" name="l01503"></a><span class="lineno"> 1503</span> </div>
<div class="line"><a id="l01504" name="l01504"></a><span class="lineno"> 1504</span>    <span class="comment">// Draw tables for compact Numbers display</span></div>
<div class="line"><a id="l01505" name="l01505"></a><span class="lineno"> 1505</span>    <span class="keywordflow">if</span>( ( panel_type == <span class="stringliteral">&quot;compact&quot;</span> || panel_type == <span class="stringliteral">&quot;labels-narrow&quot;</span> )</div>
<div class="line"><a id="l01506" name="l01506"></a><span class="lineno"> 1506</span>        &amp;&amp; display_type == <span class="stringliteral">&quot;numbers&quot;</span> ) {</div>
<div class="line"><a id="l01507" name="l01507"></a><span class="lineno"> 1507</span>        <span class="keyword">const</span> std::string divider = <span class="stringliteral">&quot;|&quot;</span>;</div>
<div class="line"><a id="l01508" name="l01508"></a><span class="lineno"> 1508</span>        <span class="keywordtype">int</span> left_pad = 10, columns = 4;</div>
<div class="line"><a id="l01509" name="l01509"></a><span class="lineno"> 1509</span>        <a class="code hl_function" href="output_8cpp.html#add4e31deb8a6e0444b89c79343c34a9c">insert_table</a>( w, left_pad, ++line_number, columns, <a class="code hl_define" href="color_8h.html#a1b1e3c0bef566a83c3535e38a93ad733">c_light_gray</a>, divider, <span class="keyword">true</span>, t_confidence );</div>
<div class="line"><a id="l01510" name="l01510"></a><span class="lineno"> 1510</span>        <a class="code hl_function" href="output_8cpp.html#add4e31deb8a6e0444b89c79343c34a9c">insert_table</a>( w, 0, line_number, 1, <a class="code hl_define" href="color_8h.html#a1b1e3c0bef566a83c3535e38a93ad733">c_light_gray</a>, <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">false</span>, t_aims );</div>
<div class="line"><a id="l01511" name="l01511"></a><span class="lineno"> 1511</span>        line_number = line_number + 4; <span class="comment">// 4 to account for the tables</span></div>
<div class="line"><a id="l01512" name="l01512"></a><span class="lineno"> 1512</span>    }</div>
<div class="line"><a id="l01513" name="l01513"></a><span class="lineno"> 1513</span>    <span class="keywordflow">return</span> line_number;</div>
<div class="line"><a id="l01514" name="l01514"></a><span class="lineno"> 1514</span>}</div>
<div class="line"><a id="l01515" name="l01515"></a><span class="lineno"> 1515</span> </div>
<div class="line"><a id="l01516" name="l01516"></a><span class="lineno"> 1516</span><span class="comment">// Whether player character knows creature&#39;s position and can roughly track it with the aim cursor</span></div>
<div class="line"><a id="l01517" name="l01517"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a7c4d782d03c3f30e5b3332260ded8951"> 1517</a></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="ranged_8cpp.html#a7c4d782d03c3f30e5b3332260ded8951">pl_sees</a>( <span class="keyword">const</span> <a class="code hl_class" href="classCreature.html">Creature</a> &amp;cr )</div>
<div class="line"><a id="l01518" name="l01518"></a><span class="lineno"> 1518</span>{</div>
<div class="line"><a id="l01519" name="l01519"></a><span class="lineno"> 1519</span>    <a class="code hl_class" href="classCharacter.html">Character</a> &amp;u = <a class="code hl_function" href="character_8cpp.html#a2fcb25d686f4a35fca374c6f71280311">get_player_character</a>();</div>
<div class="line"><a id="l01520" name="l01520"></a><span class="lineno"> 1520</span>    <span class="keywordflow">return</span> u.<a class="code hl_function" href="classCharacter.html#aba9bd7517b334e6ed4149889ed32377a">sees</a>( cr ) || u.<a class="code hl_function" href="classCharacter.html#a9976ba9d9bccdaff264bd834628b97ec">sees_with_infrared</a>( cr ) || u.<a class="code hl_function" href="classCharacter.html#a9333ab3cffa25b588ec5aa932db8d73d">sees_with_specials</a>( cr );</div>
<div class="line"><a id="l01521" name="l01521"></a><span class="lineno"> 1521</span>}</div>
<div class="line"><a id="l01522" name="l01522"></a><span class="lineno"> 1522</span> </div>
<div class="line"><a id="l01523" name="l01523"></a><span class="lineno"> 1523</span><span class="comment">// Handle capping aim level when the player cannot see the target tile or there is nothing to aim at.</span></div>
<div class="line"><a id="l01524" name="l01524"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a4c4dcbdeaad877776816e6f5b2dd1739"> 1524</a></span><span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code hl_function" href="ranged_8cpp.html#a4c4dcbdeaad877776816e6f5b2dd1739">calculate_aim_cap</a>( <span class="keyword">const</span> <a class="code hl_class" href="classplayer.html">player</a> &amp;p, <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;target )</div>
<div class="line"><a id="l01525" name="l01525"></a><span class="lineno"> 1525</span>{</div>
<div class="line"><a id="l01526" name="l01526"></a><span class="lineno"> 1526</span>    <span class="keywordtype">double</span> min_recoil = 0.0;</div>
<div class="line"><a id="l01527" name="l01527"></a><span class="lineno"> 1527</span>    <span class="keyword">const</span> <a class="code hl_class" href="classCreature.html">Creature</a> *victim = <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;critter_at( target, <span class="keyword">true</span> );</div>
<div class="line"><a id="l01528" name="l01528"></a><span class="lineno"> 1528</span>    <span class="comment">// No p.sees_with_specials() here because special senses are not precise enough</span></div>
<div class="line"><a id="l01529" name="l01529"></a><span class="lineno"> 1529</span>    <span class="comment">// to give creature&#39;s exact size &amp; position, only which tile it occupies</span></div>
<div class="line"><a id="l01530" name="l01530"></a><span class="lineno"> 1530</span>    <span class="keywordflow">if</span>( victim == <span class="keyword">nullptr</span> || ( !p.<a class="code hl_function" href="classCharacter.html#aba9bd7517b334e6ed4149889ed32377a">sees</a>( *victim ) &amp;&amp; !p.<a class="code hl_function" href="classCharacter.html#a9976ba9d9bccdaff264bd834628b97ec">sees_with_infrared</a>( *victim ) ) ) {</div>
<div class="line"><a id="l01531" name="l01531"></a><span class="lineno"> 1531</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> range = <a class="code hl_function" href="coordinates_8h.html#a47953b33a873caa0861b12222842a5ec">rl_dist</a>( p.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>(), target );</div>
<div class="line"><a id="l01532" name="l01532"></a><span class="lineno"> 1532</span>        <span class="comment">// Get angle of triangle that spans the target square.</span></div>
<div class="line"><a id="l01533" name="l01533"></a><span class="lineno"> 1533</span>        <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code hl_typedef" href="namespaceunits.html#a2c7fe916bf04655f9fb4f2abdc5d28ed">angle</a> = <a class="code hl_function" href="line_8cpp.html#aaa43dcdfe5b511b116fafb32c5cff349">atan2</a>( 1, range );</div>
<div class="line"><a id="l01534" name="l01534"></a><span class="lineno"> 1534</span>        <span class="comment">// Convert from radians to arcmin.</span></div>
<div class="line"><a id="l01535" name="l01535"></a><span class="lineno"> 1535</span>        min_recoil = 60 * 180 * <a class="code hl_typedef" href="namespaceunits.html#a2c7fe916bf04655f9fb4f2abdc5d28ed">angle</a> / <a class="code hl_define" href="math__defines_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>;</div>
<div class="line"><a id="l01536" name="l01536"></a><span class="lineno"> 1536</span>    }</div>
<div class="line"><a id="l01537" name="l01537"></a><span class="lineno"> 1537</span>    <span class="keywordflow">return</span> min_recoil;</div>
<div class="line"><a id="l01538" name="l01538"></a><span class="lineno"> 1538</span>}</div>
<div class="line"><a id="l01539" name="l01539"></a><span class="lineno"> 1539</span> </div>
<div class="line"><a id="l01540" name="l01540"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#aebe27b2e9dd96af665d642596a9b8b43"> 1540</a></span><span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code hl_function" href="ranged_8cpp.html#aebe27b2e9dd96af665d642596a9b8b43">print_aim</a>( <span class="keyword">const</span> <a class="code hl_class" href="classplayer.html">player</a> &amp;p, <span class="keyword">const</span> <a class="code hl_class" href="classcatacurses_1_1window.html">catacurses::window</a> &amp;w, <span class="keywordtype">int</span> line_number,</div>
<div class="line"><a id="l01541" name="l01541"></a><span class="lineno"> 1541</span>                      <a class="code hl_class" href="classinput__context.html">input_context</a> &amp;ctxt, <span class="keyword">const</span> <a class="code hl_class" href="classitem.html">item</a> &amp;weapon,</div>
<div class="line"><a id="l01542" name="l01542"></a><span class="lineno"> 1542</span>                      <span class="keyword">const</span> <span class="keywordtype">double</span> target_size, <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;pos, <span class="keywordtype">double</span> predicted_recoil )</div>
<div class="line"><a id="l01543" name="l01543"></a><span class="lineno"> 1543</span>{</div>
<div class="line"><a id="l01544" name="l01544"></a><span class="lineno"> 1544</span>    <span class="comment">// This is absolute accuracy for the player.</span></div>
<div class="line"><a id="l01545" name="l01545"></a><span class="lineno"> 1545</span>    <span class="comment">// TODO: push the calculations duplicated from Creature::deal_projectile_attack() and</span></div>
<div class="line"><a id="l01546" name="l01546"></a><span class="lineno"> 1546</span>    <span class="comment">// Creature::projectile_attack() into shared methods.</span></div>
<div class="line"><a id="l01547" name="l01547"></a><span class="lineno"> 1547</span>    <span class="comment">// Dodge doesn&#39;t affect gun attacks</span></div>
<div class="line"><a id="l01548" name="l01548"></a><span class="lineno"> 1548</span> </div>
<div class="line"><a id="l01549" name="l01549"></a><span class="lineno"> 1549</span>    <a class="code hl_class" href="classdispersion__sources.html">dispersion_sources</a> dispersion = p.<a class="code hl_function" href="classplayer.html#a3deecf5e0ddfe40130d97c61c57e2fe2">get_weapon_dispersion</a>( weapon );</div>
<div class="line"><a id="l01550" name="l01550"></a><span class="lineno"> 1550</span>    dispersion.<a class="code hl_function" href="classdispersion__sources.html#af9119f90d39a52caf16086dca87b1cac">add_range</a>( p.<a class="code hl_function" href="classCharacter.html#accd6b165a9454cad9972bc153061215a">recoil_vehicle</a>() );</div>
<div class="line"><a id="l01551" name="l01551"></a><span class="lineno"> 1551</span> </div>
<div class="line"><a id="l01552" name="l01552"></a><span class="lineno"> 1552</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> min_recoil = <a class="code hl_function" href="ranged_8cpp.html#a4c4dcbdeaad877776816e6f5b2dd1739">calculate_aim_cap</a>( p, pos );</div>
<div class="line"><a id="l01553" name="l01553"></a><span class="lineno"> 1553</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> effective_recoil = p.<a class="code hl_function" href="classCharacter.html#a37855668c0e9260587d5561b044f5510">effective_dispersion</a>( p.<a class="code hl_variable" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a>.<a class="code hl_function" href="classitem.html#af0b7e5875297be57d675270f57ff775a">sight_dispersion</a>() );</div>
<div class="line"><a id="l01554" name="l01554"></a><span class="lineno"> 1554</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> min_dispersion = std::max( min_recoil, effective_recoil );</div>
<div class="line"><a id="l01555" name="l01555"></a><span class="lineno"> 1555</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> steadiness_range = <a class="code hl_variable" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a> - min_dispersion;</div>
<div class="line"><a id="l01556" name="l01556"></a><span class="lineno"> 1556</span>    <span class="comment">// This is a relative measure of how steady the player&#39;s aim is,</span></div>
<div class="line"><a id="l01557" name="l01557"></a><span class="lineno"> 1557</span>    <span class="comment">// 0 is the best the player can do.</span></div>
<div class="line"><a id="l01558" name="l01558"></a><span class="lineno"> 1558</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> steady_score = std::max( 0.0, predicted_recoil - min_dispersion );</div>
<div class="line"><a id="l01559" name="l01559"></a><span class="lineno"> 1559</span>    <span class="comment">// Fairly arbitrary cap on steadiness...</span></div>
<div class="line"><a id="l01560" name="l01560"></a><span class="lineno"> 1560</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> steadiness = 1.0 - ( steady_score / steadiness_range );</div>
<div class="line"><a id="l01561" name="l01561"></a><span class="lineno"> 1561</span> </div>
<div class="line"><a id="l01562" name="l01562"></a><span class="lineno"> 1562</span>    <span class="comment">// This could be extracted, to allow more/less verbose displays</span></div>
<div class="line"><a id="l01563" name="l01563"></a><span class="lineno"> 1563</span>    <span class="keyword">static</span> <span class="keyword">const</span> std::vector&lt;confidence_rating&gt; confidence_config = {{</div>
<div class="line"><a id="l01564" name="l01564"></a><span class="lineno"> 1564</span>            { <a class="code hl_variable" href="game__constants_8h.html#a32b6b0daa47aeb1caa71bc0585e24684">accuracy_critical</a>, <span class="charliteral">&#39;*&#39;</span>, <span class="stringliteral">&quot;green&quot;</span>, <a class="code hl_define" href="translations_8h.html#a9e39a96618079002323c6e554271d3e2">translate_marker_context</a>( <span class="stringliteral">&quot;aim_confidence&quot;</span>, <span class="stringliteral">&quot;Great&quot;</span> ) },</div>
<div class="line"><a id="l01565" name="l01565"></a><span class="lineno"> 1565</span>            { <a class="code hl_variable" href="game__constants_8h.html#ae5e219227693b7de2d1bb823567b01c7">accuracy_standard</a>, <span class="charliteral">&#39;+&#39;</span>, <span class="stringliteral">&quot;light_gray&quot;</span>, <a class="code hl_define" href="translations_8h.html#a9e39a96618079002323c6e554271d3e2">translate_marker_context</a>( <span class="stringliteral">&quot;aim_confidence&quot;</span>, <span class="stringliteral">&quot;Normal&quot;</span> ) },</div>
<div class="line"><a id="l01566" name="l01566"></a><span class="lineno"> 1566</span>            { <a class="code hl_variable" href="game__constants_8h.html#a45b6e116f09ae6af4ef31f1495cf48a1">accuracy_grazing</a>, <span class="charliteral">&#39;|&#39;</span>, <span class="stringliteral">&quot;magenta&quot;</span>, <a class="code hl_define" href="translations_8h.html#a9e39a96618079002323c6e554271d3e2">translate_marker_context</a>( <span class="stringliteral">&quot;aim_confidence&quot;</span>, <span class="stringliteral">&quot;Graze&quot;</span> ) }</div>
<div class="line"><a id="l01567" name="l01567"></a><span class="lineno"> 1567</span>        }</div>
<div class="line"><a id="l01568" name="l01568"></a><span class="lineno"> 1568</span>    };</div>
<div class="line"><a id="l01569" name="l01569"></a><span class="lineno"> 1569</span> </div>
<div class="line"><a id="l01570" name="l01570"></a><span class="lineno"> 1570</span>    <span class="keywordtype">int</span> shots = std::max( 1, weapon.<a class="code hl_function" href="classitem.html#a1a94ea108d695febf7f2bcf090f097fa">gun_current_mode</a>().<a class="code hl_variable" href="classgun__mode.html#a0b58020ecc1a637010d13f0ee7c40ef8">qty</a> );</div>
<div class="line"><a id="l01571" name="l01571"></a><span class="lineno"> 1571</span>    <span class="keyword">const</span> <span class="keyword">auto</span> dispersion_fun = [&amp;]( <span class="keyword">const</span> <a class="code hl_struct" href="structaim__type.html">aim_type</a> &amp; at ) {</div>
<div class="line"><a id="l01572" name="l01572"></a><span class="lineno"> 1572</span>        <span class="keywordtype">int</span> at_recoil = at.has_threshold ? at.threshold : <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( predicted_recoil );</div>
<div class="line"><a id="l01573" name="l01573"></a><span class="lineno"> 1573</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="ranged_8cpp.html#a75bb71c29339b16696e3a2eb384bbc3c">calculate_dispersion</a>( <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;m, p, weapon, at_recoil, shots &gt; 1 );</div>
<div class="line"><a id="l01574" name="l01574"></a><span class="lineno"> 1574</span>    };</div>
<div class="line"><a id="l01575" name="l01575"></a><span class="lineno"> 1575</span>    <span class="keyword">const</span> <span class="keyword">auto</span> cost_fun = [&amp;]( <span class="keyword">const</span> <a class="code hl_struct" href="structaim__type.html">aim_type</a> &amp; at ) {</div>
<div class="line"><a id="l01576" name="l01576"></a><span class="lineno"> 1576</span>        <span class="keywordtype">int</span> at_recoil = at.has_threshold ? at.threshold : <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( predicted_recoil );</div>
<div class="line"><a id="l01577" name="l01577"></a><span class="lineno"> 1577</span>        <span class="keywordflow">return</span> p.<a class="code hl_function" href="classplayer.html#a9c356da8331dbc6964aa054fa8030d45">gun_engagement_moves</a>( weapon, at_recoil, p.<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> ) + <a class="code hl_function" href="ranged_8cpp.html#a613a8b59e4b2f2aaf05091d354bb4aa3">time_to_attack</a>( p,</div>
<div class="line"><a id="l01578" name="l01578"></a><span class="lineno"> 1578</span>                *weapon.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a> );</div>
<div class="line"><a id="l01579" name="l01579"></a><span class="lineno"> 1579</span>    };</div>
<div class="line"><a id="l01580" name="l01580"></a><span class="lineno"> 1580</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> range = <a class="code hl_function" href="coordinates_8h.html#a47953b33a873caa0861b12222842a5ec">rl_dist</a>( p.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>(), pos );</div>
<div class="line"><a id="l01581" name="l01581"></a><span class="lineno"> 1581</span>    line_number = <a class="code hl_function" href="ranged_8cpp.html#ab1ce33f7e8ed6c701d44bf39e98de576">print_steadiness</a>( w, line_number, steadiness );</div>
<div class="line"><a id="l01582" name="l01582"></a><span class="lineno"> 1582</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="ranged_8cpp.html#a0d9e38138df960f8f724b45c5e3c1204">print_ranged_chance</a>( p, w, line_number, ctxt, weapon, p.<a class="code hl_function" href="classCharacter.html#a7a8f9ffd035435c9f2777e007059e68d">get_aim_types</a>( weapon ),</div>
<div class="line"><a id="l01583" name="l01583"></a><span class="lineno"> 1583</span>                                dispersion_fun, cost_fun,</div>
<div class="line"><a id="l01584" name="l01584"></a><span class="lineno"> 1584</span>                                confidence_config,</div>
<div class="line"><a id="l01585" name="l01585"></a><span class="lineno"> 1585</span>                                range, target_size );</div>
<div class="line"><a id="l01586" name="l01586"></a><span class="lineno"> 1586</span>}</div>
<div class="line"><a id="l01587" name="l01587"></a><span class="lineno"> 1587</span> </div>
<div class="line"><a id="l01588" name="l01588"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a2e072a7b4bbd9c0deff64e0a8f1ffb85"> 1588</a></span><span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code hl_function" href="ranged_8cpp.html#a2e072a7b4bbd9c0deff64e0a8f1ffb85">draw_throw_aim</a>( <span class="keyword">const</span> <a class="code hl_class" href="classplayer.html">player</a> &amp;p, <span class="keyword">const</span> <a class="code hl_class" href="classcatacurses_1_1window.html">catacurses::window</a> &amp;w, <span class="keywordtype">int</span> line_number,</div>
<div class="line"><a id="l01589" name="l01589"></a><span class="lineno"> 1589</span>                           <a class="code hl_class" href="classinput__context.html">input_context</a> &amp;ctxt,</div>
<div class="line"><a id="l01590" name="l01590"></a><span class="lineno"> 1590</span>                           <span class="keyword">const</span> <a class="code hl_class" href="classitem.html">item</a> &amp;weapon, <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;target_pos, <span class="keywordtype">bool</span> is_blind_throw )</div>
<div class="line"><a id="l01591" name="l01591"></a><span class="lineno"> 1591</span>{</div>
<div class="line"><a id="l01592" name="l01592"></a><span class="lineno"> 1592</span>    <a class="code hl_class" href="classCreature.html">Creature</a> *target = <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;critter_at( target_pos, <span class="keyword">true</span> );</div>
<div class="line"><a id="l01593" name="l01593"></a><span class="lineno"> 1593</span>    <span class="keywordflow">if</span>( target != <span class="keyword">nullptr</span> &amp;&amp; !p.<a class="code hl_function" href="classCharacter.html#aba9bd7517b334e6ed4149889ed32377a">sees</a>( *target ) ) {</div>
<div class="line"><a id="l01594" name="l01594"></a><span class="lineno"> 1594</span>        target = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l01595" name="l01595"></a><span class="lineno"> 1595</span>    }</div>
<div class="line"><a id="l01596" name="l01596"></a><span class="lineno"> 1596</span> </div>
<div class="line"><a id="l01597" name="l01597"></a><span class="lineno"> 1597</span>    <span class="keyword">const</span> <a class="code hl_class" href="classdispersion__sources.html">dispersion_sources</a> dispersion(</div>
<div class="line"><a id="l01598" name="l01598"></a><span class="lineno"> 1598</span>        <a class="code hl_function" href="namespaceranged.html#a54895869f69a00b4a74df15057a9a780">ranged::throwing_dispersion</a>( p, weapon, target, is_blind_throw ) );</div>
<div class="line"><a id="l01599" name="l01599"></a><span class="lineno"> 1599</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> range = <a class="code hl_function" href="coordinates_8h.html#a47953b33a873caa0861b12222842a5ec">rl_dist</a>( p.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>(), target_pos );</div>
<div class="line"><a id="l01600" name="l01600"></a><span class="lineno"> 1600</span> </div>
<div class="line"><a id="l01601" name="l01601"></a><span class="lineno"> 1601</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> target_size = target != <span class="keyword">nullptr</span> ? target-&gt;<a class="code hl_function" href="classCreature.html#a1c8ea56d06ff96a720201c46a40969aa">ranged_target_size</a>() : 1.0f;</div>
<div class="line"><a id="l01602" name="l01602"></a><span class="lineno"> 1602</span> </div>
<div class="line"><a id="l01603" name="l01603"></a><span class="lineno"> 1603</span>    <span class="keyword">static</span> <span class="keyword">const</span> std::vector&lt;confidence_rating&gt; confidence_config_critter = {{</div>
<div class="line"><a id="l01604" name="l01604"></a><span class="lineno"> 1604</span>            { <a class="code hl_variable" href="game__constants_8h.html#a32b6b0daa47aeb1caa71bc0585e24684">accuracy_critical</a>, <span class="charliteral">&#39;*&#39;</span>, <span class="stringliteral">&quot;green&quot;</span>, <a class="code hl_define" href="translations_8h.html#a9e39a96618079002323c6e554271d3e2">translate_marker_context</a>( <span class="stringliteral">&quot;aim_confidence&quot;</span>, <span class="stringliteral">&quot;Great&quot;</span> ) },</div>
<div class="line"><a id="l01605" name="l01605"></a><span class="lineno"> 1605</span>            { <a class="code hl_variable" href="game__constants_8h.html#ae5e219227693b7de2d1bb823567b01c7">accuracy_standard</a>, <span class="charliteral">&#39;+&#39;</span>, <span class="stringliteral">&quot;light_gray&quot;</span>, <a class="code hl_define" href="translations_8h.html#a9e39a96618079002323c6e554271d3e2">translate_marker_context</a>( <span class="stringliteral">&quot;aim_confidence&quot;</span>, <span class="stringliteral">&quot;Normal&quot;</span> ) },</div>
<div class="line"><a id="l01606" name="l01606"></a><span class="lineno"> 1606</span>            { <a class="code hl_variable" href="game__constants_8h.html#a45b6e116f09ae6af4ef31f1495cf48a1">accuracy_grazing</a>, <span class="charliteral">&#39;|&#39;</span>, <span class="stringliteral">&quot;magenta&quot;</span>, <a class="code hl_define" href="translations_8h.html#a9e39a96618079002323c6e554271d3e2">translate_marker_context</a>( <span class="stringliteral">&quot;aim_confidence&quot;</span>, <span class="stringliteral">&quot;Graze&quot;</span> ) }</div>
<div class="line"><a id="l01607" name="l01607"></a><span class="lineno"> 1607</span>        }</div>
<div class="line"><a id="l01608" name="l01608"></a><span class="lineno"> 1608</span>    };</div>
<div class="line"><a id="l01609" name="l01609"></a><span class="lineno"> 1609</span>    <span class="keyword">static</span> <span class="keyword">const</span> std::vector&lt;confidence_rating&gt; confidence_config_object = {{</div>
<div class="line"><a id="l01610" name="l01610"></a><span class="lineno"> 1610</span>            { <a class="code hl_variable" href="game__constants_8h.html#a45b6e116f09ae6af4ef31f1495cf48a1">accuracy_grazing</a>, <span class="charliteral">&#39;*&#39;</span>, <span class="stringliteral">&quot;white&quot;</span>, <a class="code hl_define" href="translations_8h.html#a9e39a96618079002323c6e554271d3e2">translate_marker_context</a>( <span class="stringliteral">&quot;aim_confidence&quot;</span>, <span class="stringliteral">&quot;Hit&quot;</span> ) }</div>
<div class="line"><a id="l01611" name="l01611"></a><span class="lineno"> 1611</span>        }</div>
<div class="line"><a id="l01612" name="l01612"></a><span class="lineno"> 1612</span>    };</div>
<div class="line"><a id="l01613" name="l01613"></a><span class="lineno"> 1613</span>    <span class="keyword">const</span> <span class="keyword">auto</span> &amp;confidence_config = target != <span class="keyword">nullptr</span> ?</div>
<div class="line"><a id="l01614" name="l01614"></a><span class="lineno"> 1614</span>                                    confidence_config_critter : confidence_config_object;</div>
<div class="line"><a id="l01615" name="l01615"></a><span class="lineno"> 1615</span> </div>
<div class="line"><a id="l01616" name="l01616"></a><span class="lineno"> 1616</span>    <span class="keyword">const</span> <span class="keyword">auto</span> dispersion_fun = [&amp;]( <span class="keyword">const</span> <a class="code hl_struct" href="structaim__type.html">aim_type</a> &amp; ) {</div>
<div class="line"><a id="l01617" name="l01617"></a><span class="lineno"> 1617</span>        <span class="keywordflow">return</span> dispersion;</div>
<div class="line"><a id="l01618" name="l01618"></a><span class="lineno"> 1618</span>    };</div>
<div class="line"><a id="l01619" name="l01619"></a><span class="lineno"> 1619</span>    <span class="keyword">const</span> <span class="keyword">auto</span> cost_fun = [&amp;]( <span class="keyword">const</span> <a class="code hl_struct" href="structaim__type.html">aim_type</a> &amp; ) {</div>
<div class="line"><a id="l01620" name="l01620"></a><span class="lineno"> 1620</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="namespaceranged.html#a581c5c797384eeec8c7e3ffe10a82d26">ranged::throw_cost</a>( p, weapon );</div>
<div class="line"><a id="l01621" name="l01621"></a><span class="lineno"> 1621</span>    };</div>
<div class="line"><a id="l01622" name="l01622"></a><span class="lineno"> 1622</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="ranged_8cpp.html#a0d9e38138df960f8f724b45c5e3c1204">print_ranged_chance</a>( p, w, line_number, ctxt,  weapon, <a class="code hl_function" href="ranged_8cpp.html#a588329b70c53194be20a6c9b7798923d">get_default_aim_type</a>(),</div>
<div class="line"><a id="l01623" name="l01623"></a><span class="lineno"> 1623</span>                                dispersion_fun, cost_fun,</div>
<div class="line"><a id="l01624" name="l01624"></a><span class="lineno"> 1624</span>                                confidence_config,</div>
<div class="line"><a id="l01625" name="l01625"></a><span class="lineno"> 1625</span>                                range, target_size );</div>
<div class="line"><a id="l01626" name="l01626"></a><span class="lineno"> 1626</span>}</div>
<div class="line"><a id="l01627" name="l01627"></a><span class="lineno"> 1627</span> </div>
<div class="line"><a id="l01628" name="l01628"></a><span class="lineno"><a class="line" href="classCharacter.html#a7a8f9ffd035435c9f2777e007059e68d"> 1628</a></span>std::vector&lt;aim_type&gt; <a class="code hl_function" href="classCharacter.html#a7a8f9ffd035435c9f2777e007059e68d">Character::get_aim_types</a>( <span class="keyword">const</span> <a class="code hl_class" href="classitem.html">item</a> &amp;gun )<span class="keyword"> const</span></div>
<div class="line"><a id="l01629" name="l01629"></a><span class="lineno"> 1629</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01630" name="l01630"></a><span class="lineno"> 1630</span>    std::vector&lt;aim_type&gt; aim_types = <a class="code hl_function" href="ranged_8cpp.html#a588329b70c53194be20a6c9b7798923d">get_default_aim_type</a>();</div>
<div class="line"><a id="l01631" name="l01631"></a><span class="lineno"> 1631</span>    <span class="keywordflow">if</span>( !gun.<a class="code hl_function" href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">is_gun</a>() ) {</div>
<div class="line"><a id="l01632" name="l01632"></a><span class="lineno"> 1632</span>        <span class="keywordflow">return</span> aim_types;</div>
<div class="line"><a id="l01633" name="l01633"></a><span class="lineno"> 1633</span>    }</div>
<div class="line"><a id="l01634" name="l01634"></a><span class="lineno"> 1634</span>    <span class="keywordtype">int</span> sight_dispersion = <a class="code hl_function" href="classCharacter.html#a37855668c0e9260587d5561b044f5510">effective_dispersion</a>( gun.<a class="code hl_function" href="classitem.html#af0b7e5875297be57d675270f57ff775a">sight_dispersion</a>() );</div>
<div class="line"><a id="l01635" name="l01635"></a><span class="lineno"> 1635</span>    <span class="comment">// Aiming thresholds are dependent on weapon sight dispersion, attempting to place thresholds</span></div>
<div class="line"><a id="l01636" name="l01636"></a><span class="lineno"> 1636</span>    <span class="comment">// at 10%, 5% and 0% of the difference between MAX_RECOIL and sight dispersion.</span></div>
<div class="line"><a id="l01637" name="l01637"></a><span class="lineno"> 1637</span>    std::vector&lt;int&gt; thresholds = {</div>
<div class="line"><a id="l01638" name="l01638"></a><span class="lineno"> 1638</span>        <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( ( ( <a class="code hl_variable" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a> - sight_dispersion ) / 10.0 ) + sight_dispersion ),</div>
<div class="line"><a id="l01639" name="l01639"></a><span class="lineno"> 1639</span>        <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( ( ( <a class="code hl_variable" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a> - sight_dispersion ) / 20.0 ) + sight_dispersion ),</div>
<div class="line"><a id="l01640" name="l01640"></a><span class="lineno"> 1640</span>        <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( sight_dispersion )</div>
<div class="line"><a id="l01641" name="l01641"></a><span class="lineno"> 1641</span>    };</div>
<div class="line"><a id="l01642" name="l01642"></a><span class="lineno"> 1642</span>    <span class="comment">// Remove duplicate thresholds.</span></div>
<div class="line"><a id="l01643" name="l01643"></a><span class="lineno"> 1643</span>    std::vector&lt;int&gt;::iterator thresholds_it = std::adjacent_find( thresholds.begin(),</div>
<div class="line"><a id="l01644" name="l01644"></a><span class="lineno"> 1644</span>            thresholds.end() );</div>
<div class="line"><a id="l01645" name="l01645"></a><span class="lineno"> 1645</span>    <span class="keywordflow">while</span>( thresholds_it != thresholds.end() ) {</div>
<div class="line"><a id="l01646" name="l01646"></a><span class="lineno"> 1646</span>        thresholds.erase( thresholds_it );</div>
<div class="line"><a id="l01647" name="l01647"></a><span class="lineno"> 1647</span>        thresholds_it = std::adjacent_find( thresholds.begin(), thresholds.end() );</div>
<div class="line"><a id="l01648" name="l01648"></a><span class="lineno"> 1648</span>    }</div>
<div class="line"><a id="l01649" name="l01649"></a><span class="lineno"> 1649</span>    thresholds_it = thresholds.begin();</div>
<div class="line"><a id="l01650" name="l01650"></a><span class="lineno"> 1650</span>    aim_types.push_back( <a class="code hl_struct" href="structaim__type.html">aim_type</a> { <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Regular&quot;</span> ), <span class="stringliteral">&quot;AIMED_SHOT&quot;</span>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;[%c] to aim and fire.&quot;</span> ),</div>
<div class="line"><a id="l01651" name="l01651"></a><span class="lineno"> 1651</span>                                    <span class="keyword">true</span>, *thresholds_it } );</div>
<div class="line"><a id="l01652" name="l01652"></a><span class="lineno"> 1652</span>    thresholds_it++;</div>
<div class="line"><a id="l01653" name="l01653"></a><span class="lineno"> 1653</span>    <span class="keywordflow">if</span>( thresholds_it != thresholds.end() ) {</div>
<div class="line"><a id="l01654" name="l01654"></a><span class="lineno"> 1654</span>        aim_types.push_back( <a class="code hl_struct" href="structaim__type.html">aim_type</a> { <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Careful&quot;</span> ), <span class="stringliteral">&quot;CAREFUL_SHOT&quot;</span>,</div>
<div class="line"><a id="l01655" name="l01655"></a><span class="lineno"> 1655</span>                                        <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;[%c] to take careful aim and fire.&quot;</span> ), <span class="keyword">true</span>,</div>
<div class="line"><a id="l01656" name="l01656"></a><span class="lineno"> 1656</span>                                        *thresholds_it } );</div>
<div class="line"><a id="l01657" name="l01657"></a><span class="lineno"> 1657</span>        thresholds_it++;</div>
<div class="line"><a id="l01658" name="l01658"></a><span class="lineno"> 1658</span>    }</div>
<div class="line"><a id="l01659" name="l01659"></a><span class="lineno"> 1659</span>    <span class="keywordflow">if</span>( thresholds_it != thresholds.end() ) {</div>
<div class="line"><a id="l01660" name="l01660"></a><span class="lineno"> 1660</span>        aim_types.push_back( <a class="code hl_struct" href="structaim__type.html">aim_type</a> { <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Precise&quot;</span> ), <span class="stringliteral">&quot;PRECISE_SHOT&quot;</span>,</div>
<div class="line"><a id="l01661" name="l01661"></a><span class="lineno"> 1661</span>                                        <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;[%c] to take precise aim and fire.&quot;</span> ), <span class="keyword">true</span>,</div>
<div class="line"><a id="l01662" name="l01662"></a><span class="lineno"> 1662</span>                                        *thresholds_it } );</div>
<div class="line"><a id="l01663" name="l01663"></a><span class="lineno"> 1663</span>    }</div>
<div class="line"><a id="l01664" name="l01664"></a><span class="lineno"> 1664</span>    <span class="keywordflow">return</span> aim_types;</div>
<div class="line"><a id="l01665" name="l01665"></a><span class="lineno"> 1665</span>}</div>
<div class="line"><a id="l01666" name="l01666"></a><span class="lineno"> 1666</span> </div>
<div class="line"><a id="l01667" name="l01667"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ab0db3d2d826960249b5a1d47fa7881ff"> 1667</a></span><span class="keyword">static</span> <a class="code hl_struct" href="structprojectile.html">projectile</a> <a class="code hl_function" href="ranged_8cpp.html#ab0db3d2d826960249b5a1d47fa7881ff">make_gun_projectile</a>( <span class="keyword">const</span> <a class="code hl_class" href="classitem.html">item</a> &amp;gun )</div>
<div class="line"><a id="l01668" name="l01668"></a><span class="lineno"> 1668</span>{</div>
<div class="line"><a id="l01669" name="l01669"></a><span class="lineno"> 1669</span>    <a class="code hl_struct" href="structprojectile.html">projectile</a> proj;</div>
<div class="line"><a id="l01670" name="l01670"></a><span class="lineno"> 1670</span>    proj.<a class="code hl_variable" href="structprojectile.html#aa2af53bce63feecb719ef1edba54689e">speed</a>  = 1000;</div>
<div class="line"><a id="l01671" name="l01671"></a><span class="lineno"> 1671</span>    proj.<a class="code hl_variable" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a> = gun.<a class="code hl_function" href="classitem.html#ada111938a57ec6c7b47fcca30ec9d36c">gun_damage</a>();</div>
<div class="line"><a id="l01672" name="l01672"></a><span class="lineno"> 1672</span>    proj.<a class="code hl_variable" href="structprojectile.html#a312bc9a78fe7a5fdefb44e3755154db3">range</a> = gun.<a class="code hl_function" href="classitem.html#af443024fa9e01c97953b3fcf81c9cfb1">gun_range</a>();</div>
<div class="line"><a id="l01673" name="l01673"></a><span class="lineno"> 1673</span>    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">ammo_effect_str_id</a> &amp;ae_id : gun.<a class="code hl_function" href="classitem.html#a75fa277bb39c1d2922137986c67d48fb">ammo_effects</a>() ) {</div>
<div class="line"><a id="l01674" name="l01674"></a><span class="lineno"> 1674</span>        proj.<a class="code hl_function" href="structprojectile.html#a05d90cbb1c83669dd7c23477c8f35963">add_effect</a>( ae_id );</div>
<div class="line"><a id="l01675" name="l01675"></a><span class="lineno"> 1675</span>    }</div>
<div class="line"><a id="l01676" name="l01676"></a><span class="lineno"> 1676</span> </div>
<div class="line"><a id="l01677" name="l01677"></a><span class="lineno"> 1677</span>    <span class="keyword">auto</span> &amp;fx = proj;</div>
<div class="line"><a id="l01678" name="l01678"></a><span class="lineno"> 1678</span> </div>
<div class="line"><a id="l01679" name="l01679"></a><span class="lineno"> 1679</span>    <span class="keywordflow">if</span>( ( gun.<a class="code hl_function" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>() &amp;&amp; gun.<a class="code hl_function" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>()-&gt;<a class="code hl_variable" href="structitype.html#a3d7692cff108d3b8c59ca0847d25a45c">phase</a> == <a class="code hl_enumvalue" href="enums_8h.html#ade8f325e8cc8463cef8f944f3209d0e5aa87f9501ff2b390be1ea7d261b0d7cce">LIQUID</a> ) ||</div>
<div class="line"><a id="l01680" name="l01680"></a><span class="lineno"> 1680</span>        fx.has_effect( <a class="code hl_variable" href="ranged_8cpp.html#adf294508632caed42c2bd4c1bf7a40d0">ammo_effect_SHOT</a> ) || fx.has_effect( <a class="code hl_variable" href="ranged_8cpp.html#a2e2f893aee74eb40d2c1609963133838">ammo_effect_BOUNCE</a> ) ) {</div>
<div class="line"><a id="l01681" name="l01681"></a><span class="lineno"> 1681</span>        fx.<a class="code hl_function" href="structprojectile.html#a05d90cbb1c83669dd7c23477c8f35963">add_effect</a>( <a class="code hl_variable" href="ranged_8cpp.html#ad2f60bde7290b0993994d14fad34a3e9">ammo_effect_WIDE</a> );</div>
<div class="line"><a id="l01682" name="l01682"></a><span class="lineno"> 1682</span>    }</div>
<div class="line"><a id="l01683" name="l01683"></a><span class="lineno"> 1683</span> </div>
<div class="line"><a id="l01684" name="l01684"></a><span class="lineno"> 1684</span>    <span class="keywordflow">if</span>( gun.<a class="code hl_function" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>() ) {</div>
<div class="line"><a id="l01685" name="l01685"></a><span class="lineno"> 1685</span>        assert( gun.<a class="code hl_function" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>()-&gt;<a class="code hl_variable" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a> );</div>
<div class="line"><a id="l01686" name="l01686"></a><span class="lineno"> 1686</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structislot__ammo.html">islot_ammo</a> &amp;ammo = *gun.<a class="code hl_function" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>()-&gt;<a class="code hl_variable" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>;</div>
<div class="line"><a id="l01687" name="l01687"></a><span class="lineno"> 1687</span>        <span class="comment">// Some projectiles have a chance of being recoverable</span></div>
<div class="line"><a id="l01688" name="l01688"></a><span class="lineno"> 1688</span>        <span class="keywordtype">bool</span> recover = !<a class="code hl_function" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( ammo.<a class="code hl_variable" href="structislot__ammo.html#a4e55e746a4e82e094d70ed42f1cf1ac1">dont_recover_one_in</a> );</div>
<div class="line"><a id="l01689" name="l01689"></a><span class="lineno"> 1689</span> </div>
<div class="line"><a id="l01690" name="l01690"></a><span class="lineno"> 1690</span>        <span class="keywordflow">if</span>( recover &amp;&amp; !fx.has_effect( <a class="code hl_variable" href="ranged_8cpp.html#ab5bc741878d9b8001686d7776457d9f9">ammo_effect_IGNITE</a> ) &amp;&amp; !fx.has_effect( <a class="code hl_variable" href="ranged_8cpp.html#aac5abe3e4bd613b31a66a3a04df87a87">ammo_effect_EXPLOSIVE</a> ) ) {</div>
<div class="line"><a id="l01691" name="l01691"></a><span class="lineno"> 1691</span>            <a class="code hl_class" href="classitem.html">item</a> drop( gun.<a class="code hl_function" href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">ammo_current</a>(), <a class="code hl_variable" href="namespacecalendar.html#ae15fcbf1c971589eb49c1a657fb6a580">calendar::turn</a>, 1 );</div>
<div class="line"><a id="l01692" name="l01692"></a><span class="lineno"> 1692</span>            drop.<a class="code hl_variable" href="classitem.html#a2993eb10a5ae589e6bb1be0a74cb65c1">active</a> = fx.has_effect( <a class="code hl_variable" href="ranged_8cpp.html#a4832c47fe321946202cd17b211b27862">ammo_effect_ACT_ON_RANGED_HIT</a> );</div>
<div class="line"><a id="l01693" name="l01693"></a><span class="lineno"> 1693</span>            proj.<a class="code hl_function" href="structprojectile.html#a2bbf20562006058aa939aa5339860ba7">set_drop</a>( drop );</div>
<div class="line"><a id="l01694" name="l01694"></a><span class="lineno"> 1694</span>        }</div>
<div class="line"><a id="l01695" name="l01695"></a><span class="lineno"> 1695</span> </div>
<div class="line"><a id="l01696" name="l01696"></a><span class="lineno"> 1696</span>        <span class="keywordflow">if</span>( ammo.<a class="code hl_variable" href="structislot__ammo.html#acd114e30cfafd26d8644a2b43d29ceb9">drop</a> ) {</div>
<div class="line"><a id="l01697" name="l01697"></a><span class="lineno"> 1697</span>            <a class="code hl_class" href="classitem.html">item</a> drop( ammo.<a class="code hl_variable" href="structislot__ammo.html#acd114e30cfafd26d8644a2b43d29ceb9">drop</a> );</div>
<div class="line"><a id="l01698" name="l01698"></a><span class="lineno"> 1698</span>            <span class="keywordflow">if</span>( ammo.<a class="code hl_variable" href="structislot__ammo.html#ad7649b801b4ed0d8bec314b40f18f1db">drop_active</a> ) {</div>
<div class="line"><a id="l01699" name="l01699"></a><span class="lineno"> 1699</span>                drop.<a class="code hl_function" href="classitem.html#a7f1ae4e309841707eea0852dd4cd95a3">activate</a>();</div>
<div class="line"><a id="l01700" name="l01700"></a><span class="lineno"> 1700</span>            }</div>
<div class="line"><a id="l01701" name="l01701"></a><span class="lineno"> 1701</span>            proj.<a class="code hl_function" href="structprojectile.html#a2bbf20562006058aa939aa5339860ba7">set_drop</a>( drop );</div>
<div class="line"><a id="l01702" name="l01702"></a><span class="lineno"> 1702</span>        }</div>
<div class="line"><a id="l01703" name="l01703"></a><span class="lineno"> 1703</span> </div>
<div class="line"><a id="l01704" name="l01704"></a><span class="lineno"> 1704</span>        <span class="keywordflow">if</span>( fx.has_effect( <a class="code hl_variable" href="ranged_8cpp.html#ab656471d666816a9cd8ae082f81ac021">ammo_effect_CUSTOM_EXPLOSION</a> ) ) {</div>
<div class="line"><a id="l01705" name="l01705"></a><span class="lineno"> 1705</span>            proj.<a class="code hl_function" href="structprojectile.html#a3eb9cbe946d6bf2131eeae97d2d1230d">set_custom_explosion</a>( gun.<a class="code hl_function" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>()-&gt;<a class="code hl_variable" href="structitype.html#a15ce9f3914d2afb7992e4683a0996791">explosion</a> );</div>
<div class="line"><a id="l01706" name="l01706"></a><span class="lineno"> 1706</span>        }</div>
<div class="line"><a id="l01707" name="l01707"></a><span class="lineno"> 1707</span>    }</div>
<div class="line"><a id="l01708" name="l01708"></a><span class="lineno"> 1708</span> </div>
<div class="line"><a id="l01709" name="l01709"></a><span class="lineno"> 1709</span>    <span class="keywordflow">return</span> proj;</div>
<div class="line"><a id="l01710" name="l01710"></a><span class="lineno"> 1710</span>}</div>
<div class="line"><a id="l01711" name="l01711"></a><span class="lineno"> 1711</span> </div>
<div class="line"><a id="l01712" name="l01712"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a613a8b59e4b2f2aaf05091d354bb4aa3"> 1712</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="ranged_8cpp.html#a613a8b59e4b2f2aaf05091d354bb4aa3">time_to_attack</a>( <span class="keyword">const</span> <a class="code hl_class" href="classCharacter.html">Character</a> &amp;p, <span class="keyword">const</span> <a class="code hl_struct" href="structitype.html">itype</a> &amp;firing )</div>
<div class="line"><a id="l01713" name="l01713"></a><span class="lineno"> 1713</span>{</div>
<div class="line"><a id="l01714" name="l01714"></a><span class="lineno"> 1714</span>    <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">skill_id</a> &amp;skill_used = firing.<a class="code hl_variable" href="structitype.html#a623ec8243b1e599086fa3a23c3179370">gun</a>-&gt;skill_used;</div>
<div class="line"><a id="l01715" name="l01715"></a><span class="lineno"> 1715</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtime__info__t.html">time_info_t</a> &amp;info = skill_used-&gt;<a class="code hl_function" href="classSkill.html#a879f0e8d0da73f0cdebd825134cd32d6">time_to_attack</a>();</div>
<div class="line"><a id="l01716" name="l01716"></a><span class="lineno"> 1716</span>    <span class="keywordflow">return</span> std::max( info.<a class="code hl_variable" href="structtime__info__t.html#a562e779c37f25968ccd5f5298a8c308c">min_time</a>,</div>
<div class="line"><a id="l01717" name="l01717"></a><span class="lineno"> 1717</span>                     info.<a class="code hl_variable" href="structtime__info__t.html#ab3676d37128ef1625abe58686c8c2bfb">base_time</a> - info.<a class="code hl_variable" href="structtime__info__t.html#a1cb4c0bb33cbe25f4e889533d8ae1721">time_reduction_per_level</a> * p.<a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( skill_used ) );</div>
<div class="line"><a id="l01718" name="l01718"></a><span class="lineno"> 1718</span>}</div>
<div class="line"><a id="l01719" name="l01719"></a><span class="lineno"> 1719</span> </div>
<div class="line"><a id="l01720" name="l01720"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a8b90a63ce217d881ddad6a7456c4a98e"> 1720</a></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="ranged_8cpp.html#a8b90a63ce217d881ddad6a7456c4a98e">cycle_action</a>( <a class="code hl_class" href="classitem.html">item</a> &amp;weap, <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;pos )</div>
<div class="line"><a id="l01721" name="l01721"></a><span class="lineno"> 1721</span>{</div>
<div class="line"><a id="l01722" name="l01722"></a><span class="lineno"> 1722</span>    <a class="code hl_class" href="classmap.html">map</a> &amp;here = <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>();</div>
<div class="line"><a id="l01723" name="l01723"></a><span class="lineno"> 1723</span>    <span class="comment">// eject casings and linkages in random direction avoiding walls using player position as fallback</span></div>
<div class="line"><a id="l01724" name="l01724"></a><span class="lineno"> 1724</span>    std::vector&lt;tripoint&gt; tiles = <a class="code hl_function" href="coordinates_8h.html#a13a12943d34d5f17e6c3b4e730659fc6">closest_points_first</a>( pos, 1 );</div>
<div class="line"><a id="l01725" name="l01725"></a><span class="lineno"> 1725</span>    tiles.erase( tiles.begin() );</div>
<div class="line"><a id="l01726" name="l01726"></a><span class="lineno"> 1726</span>    tiles.erase( std::remove_if( tiles.begin(), tiles.end(), [&amp;pos, &amp;here]( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp; e ) {</div>
<div class="line"><a id="l01727" name="l01727"></a><span class="lineno"> 1727</span>        return !here.passable( e ) || here.obstructed_by_vehicle_rotation( pos, e );</div>
<div class="line"><a id="l01728" name="l01728"></a><span class="lineno"> 1728</span>    } ), tiles.end() );</div>
<div class="line"><a id="l01729" name="l01729"></a><span class="lineno"> 1729</span>    <a class="code hl_struct" href="structtripoint.html">tripoint</a> eject = tiles.empty() ? pos : <a class="code hl_function" href="rng_8h.html#a12244355ee77108f1b08618e9962e4d1">random_entry</a>( tiles );</div>
<div class="line"><a id="l01730" name="l01730"></a><span class="lineno"> 1730</span> </div>
<div class="line"><a id="l01731" name="l01731"></a><span class="lineno"> 1731</span>    <span class="comment">// for turrets try and drop casings or linkages directly to any CARGO part on the same tile</span></div>
<div class="line"><a id="l01732" name="l01732"></a><span class="lineno"> 1732</span>    <span class="keyword">const</span> <a class="code hl_class" href="classoptional__vpart__position.html">optional_vpart_position</a> vp = here.<a class="code hl_function" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( pos );</div>
<div class="line"><a id="l01733" name="l01733"></a><span class="lineno"> 1733</span>    std::vector&lt;vehicle_part *&gt; cargo;</div>
<div class="line"><a id="l01734" name="l01734"></a><span class="lineno"> 1734</span>    <span class="keywordflow">if</span>( vp &amp;&amp; weap.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <span class="stringliteral">&quot;VEHICLE&quot;</span> ) ) {</div>
<div class="line"><a id="l01735" name="l01735"></a><span class="lineno"> 1735</span>        cargo = vp-&gt;vehicle().get_parts_at( pos, <span class="stringliteral">&quot;CARGO&quot;</span>, <a class="code hl_enumvalue" href="vehicle_8h.html#ad9a221cee9ae7a69d6f09d4de701f02ca100b8cad7cf2a56f6df78f171f97a1ec">part_status_flag::any</a> );</div>
<div class="line"><a id="l01736" name="l01736"></a><span class="lineno"> 1736</span>    }</div>
<div class="line"><a id="l01737" name="l01737"></a><span class="lineno"> 1737</span> </div>
<div class="line"><a id="l01738" name="l01738"></a><span class="lineno"> 1738</span>    <span class="keywordflow">if</span>( weap.<a class="code hl_function" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>() &amp;&amp; weap.<a class="code hl_function" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>()-&gt;<a class="code hl_variable" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>-&gt;casing ) {</div>
<div class="line"><a id="l01739" name="l01739"></a><span class="lineno"> 1739</span>        <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">itype_id</a> casing = *weap.<a class="code hl_function" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>()-&gt;<a class="code hl_variable" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>-&gt;casing;</div>
<div class="line"><a id="l01740" name="l01740"></a><span class="lineno"> 1740</span>        <span class="keywordflow">if</span>( weap.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <span class="stringliteral">&quot;RELOAD_EJECT&quot;</span> ) || weap.<a class="code hl_function" href="classitem.html#a26ffce6c038cc9d398103dcd296275bd">gunmod_find</a>( <a class="code hl_variable" href="ranged_8cpp.html#a0ccb4d60ab6785e534c7eaa8ad7d07c6">itype_brass_catcher</a> ) ) {</div>
<div class="line"><a id="l01741" name="l01741"></a><span class="lineno"> 1741</span>            weap.<a class="code hl_function" href="classitem.html#a3841e9e250af73e45b14d5bb3cc7a043">put_in</a>( <a class="code hl_class" href="classitem.html">item</a>( casing ).set_flag( <span class="stringliteral">&quot;CASING&quot;</span> ) );</div>
<div class="line"><a id="l01742" name="l01742"></a><span class="lineno"> 1742</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01743" name="l01743"></a><span class="lineno"> 1743</span>            <span class="keywordflow">if</span>( cargo.empty() ) {</div>
<div class="line"><a id="l01744" name="l01744"></a><span class="lineno"> 1744</span>                here.<a class="code hl_function" href="classmap.html#a5579e13088b4ccd9c5a75458919d528a">add_item_or_charges</a>( eject, <a class="code hl_class" href="classitem.html">item</a>( casing ) );</div>
<div class="line"><a id="l01745" name="l01745"></a><span class="lineno"> 1745</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01746" name="l01746"></a><span class="lineno"> 1746</span>                vp-&gt;vehicle().add_item( *cargo.front(), <a class="code hl_class" href="classitem.html">item</a>( casing ) );</div>
<div class="line"><a id="l01747" name="l01747"></a><span class="lineno"> 1747</span>            }</div>
<div class="line"><a id="l01748" name="l01748"></a><span class="lineno"> 1748</span> </div>
<div class="line"><a id="l01749" name="l01749"></a><span class="lineno"> 1749</span>            <a class="code hl_function" href="namespacesfx.html#a8fa2bb887ac81392fb686cc4079b5d5a">sfx::play_variant_sound</a>( <span class="stringliteral">&quot;fire_gun&quot;</span>, <span class="stringliteral">&quot;brass_eject&quot;</span>, <a class="code hl_function" href="namespacesfx.html#a1f138eaa92db132e81ce591751c512cc">sfx::get_heard_volume</a>( eject ),</div>
<div class="line"><a id="l01750" name="l01750"></a><span class="lineno"> 1750</span>                                     <a class="code hl_function" href="namespacesfx.html#aa186eb63210729f73d7c76dcda527ff5">sfx::get_heard_angle</a>( eject ) );</div>
<div class="line"><a id="l01751" name="l01751"></a><span class="lineno"> 1751</span>        }</div>
<div class="line"><a id="l01752" name="l01752"></a><span class="lineno"> 1752</span>    }</div>
<div class="line"><a id="l01753" name="l01753"></a><span class="lineno"> 1753</span> </div>
<div class="line"><a id="l01754" name="l01754"></a><span class="lineno"> 1754</span>    <span class="comment">// some magazines also eject disintegrating linkages</span></div>
<div class="line"><a id="l01755" name="l01755"></a><span class="lineno"> 1755</span>    <span class="keyword">const</span> <span class="keyword">auto</span> mag = weap.<a class="code hl_function" href="classitem.html#ab22fc9a4e0f9c6f5569b93e00deccfac">magazine_current</a>();</div>
<div class="line"><a id="l01756" name="l01756"></a><span class="lineno"> 1756</span>    <span class="keywordflow">if</span>( mag &amp;&amp; mag-&gt;type-&gt;magazine-&gt;linkage ) {</div>
<div class="line"><a id="l01757" name="l01757"></a><span class="lineno"> 1757</span>        <a class="code hl_class" href="classitem.html">item</a> linkage( *mag-&gt;type-&gt;magazine-&gt;linkage, <a class="code hl_variable" href="namespacecalendar.html#ae15fcbf1c971589eb49c1a657fb6a580">calendar::turn</a>, 1 );</div>
<div class="line"><a id="l01758" name="l01758"></a><span class="lineno"> 1758</span>        <span class="keywordflow">if</span>( weap.<a class="code hl_function" href="classitem.html#a26ffce6c038cc9d398103dcd296275bd">gunmod_find</a>( <a class="code hl_variable" href="ranged_8cpp.html#a0ccb4d60ab6785e534c7eaa8ad7d07c6">itype_brass_catcher</a> ) ) {</div>
<div class="line"><a id="l01759" name="l01759"></a><span class="lineno"> 1759</span>            linkage.<a class="code hl_function" href="classitem.html#aaf0e79cb1bc190daa4804cfd62f279c4">set_flag</a>( <span class="stringliteral">&quot;CASING&quot;</span> );</div>
<div class="line"><a id="l01760" name="l01760"></a><span class="lineno"> 1760</span>            weap.<a class="code hl_function" href="classitem.html#a3841e9e250af73e45b14d5bb3cc7a043">put_in</a>( linkage );</div>
<div class="line"><a id="l01761" name="l01761"></a><span class="lineno"> 1761</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( cargo.empty() ) {</div>
<div class="line"><a id="l01762" name="l01762"></a><span class="lineno"> 1762</span>            here.<a class="code hl_function" href="classmap.html#a5579e13088b4ccd9c5a75458919d528a">add_item_or_charges</a>( eject, linkage );</div>
<div class="line"><a id="l01763" name="l01763"></a><span class="lineno"> 1763</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01764" name="l01764"></a><span class="lineno"> 1764</span>            vp-&gt;vehicle().add_item( *cargo.front(), linkage );</div>
<div class="line"><a id="l01765" name="l01765"></a><span class="lineno"> 1765</span>        }</div>
<div class="line"><a id="l01766" name="l01766"></a><span class="lineno"> 1766</span>    }</div>
<div class="line"><a id="l01767" name="l01767"></a><span class="lineno"> 1767</span>}</div>
<div class="line"><a id="l01768" name="l01768"></a><span class="lineno"> 1768</span> </div>
<div class="line"><a id="l01769" name="l01769"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a9d14a0cc5b70610323cf40b51929fae5"> 1769</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="ranged_8cpp.html#a9d14a0cc5b70610323cf40b51929fae5">make_gun_sound_effect</a>( <span class="keyword">const</span> <a class="code hl_class" href="classplayer.html">player</a> &amp;p, <span class="keywordtype">bool</span> burst, <a class="code hl_class" href="classitem.html">item</a> *weapon )</div>
<div class="line"><a id="l01770" name="l01770"></a><span class="lineno"> 1770</span>{</div>
<div class="line"><a id="l01771" name="l01771"></a><span class="lineno"> 1771</span>    <span class="keyword">const</span> <span class="keyword">auto</span> data = weapon-&gt;<a class="code hl_function" href="classitem.html#a3694c5d9138956736af2444bd7b3972e">gun_noise</a>( burst );</div>
<div class="line"><a id="l01772" name="l01772"></a><span class="lineno"> 1772</span>    <span class="keywordflow">if</span>( data.volume &gt; 0 ) {</div>
<div class="line"><a id="l01773" name="l01773"></a><span class="lineno"> 1773</span>        <a class="code hl_function" href="namespacesounds.html#a6bb79ae1c9c3dcd8c8e0b28c66b0398d">sounds::sound</a>( p.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>(), data.volume, <a class="code hl_enumvalue" href="namespacesounds.html#af6b3d144906d9ccfda6824fb87e46aa3ac222ae0d4e9c59bd254b72521b9e74ed">sounds::sound_t::combat</a>,</div>
<div class="line"><a id="l01774" name="l01774"></a><span class="lineno"> 1774</span>                       data.sound.empty() ? <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Bang!&quot;</span> ) : data.sound );</div>
<div class="line"><a id="l01775" name="l01775"></a><span class="lineno"> 1775</span>    }</div>
<div class="line"><a id="l01776" name="l01776"></a><span class="lineno"> 1776</span>}</div>
<div class="line"><a id="l01777" name="l01777"></a><span class="lineno"> 1777</span> </div>
<div class="line"><a id="l01778" name="l01778"></a><span class="lineno"><a class="line" href="classitem.html#a3694c5d9138956736af2444bd7b3972e"> 1778</a></span><a class="code hl_struct" href="structitem_1_1sound__data.html">item::sound_data</a> <a class="code hl_function" href="classitem.html#a3694c5d9138956736af2444bd7b3972e">item::gun_noise</a>( <span class="keyword">const</span> <span class="keywordtype">bool</span> burst )<span class="keyword"> const</span></div>
<div class="line"><a id="l01779" name="l01779"></a><span class="lineno"> 1779</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01780" name="l01780"></a><span class="lineno"> 1780</span>    <span class="keywordflow">if</span>( !<a class="code hl_function" href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">is_gun</a>() ) {</div>
<div class="line"><a id="l01781" name="l01781"></a><span class="lineno"> 1781</span>        <span class="keywordflow">return</span> { 0, <span class="stringliteral">&quot;&quot;</span> };</div>
<div class="line"><a id="l01782" name="l01782"></a><span class="lineno"> 1782</span>    }</div>
<div class="line"><a id="l01783" name="l01783"></a><span class="lineno"> 1783</span> </div>
<div class="line"><a id="l01784" name="l01784"></a><span class="lineno"> 1784</span>    <span class="keywordtype">int</span> <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> = <a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_variable" href="structitype.html#a623ec8243b1e599086fa3a23c3179370">gun</a>-&gt;loudness;</div>
<div class="line"><a id="l01785" name="l01785"></a><span class="lineno"> 1785</span>    <span class="keywordflow">for</span>( <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a> : <a class="code hl_function" href="classitem.html#acd78321ba4d5c09d39f1d58d20b68484">gunmods</a>() ) {</div>
<div class="line"><a id="l01786" name="l01786"></a><span class="lineno"> 1786</span>        <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> += <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;type-&gt;gunmod-&gt;loudness;</div>
<div class="line"><a id="l01787" name="l01787"></a><span class="lineno"> 1787</span>    }</div>
<div class="line"><a id="l01788" name="l01788"></a><span class="lineno"> 1788</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>() ) {</div>
<div class="line"><a id="l01789" name="l01789"></a><span class="lineno"> 1789</span>        <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> += <a class="code hl_function" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>()-&gt;<a class="code hl_variable" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>-&gt;loudness;</div>
<div class="line"><a id="l01790" name="l01790"></a><span class="lineno"> 1790</span>    }</div>
<div class="line"><a id="l01791" name="l01791"></a><span class="lineno"> 1791</span> </div>
<div class="line"><a id="l01792" name="l01792"></a><span class="lineno"> 1792</span>    <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> = std::max( <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, 0 );</div>
<div class="line"><a id="l01793" name="l01793"></a><span class="lineno"> 1793</span> </div>
<div class="line"><a id="l01794" name="l01794"></a><span class="lineno"> 1794</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">ammo_current</a>() == <a class="code hl_variable" href="ranged_8cpp.html#a72d322a82b6cac799c940f935cbee213">itype_40x46mm</a> || <a class="code hl_function" href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">ammo_current</a>() == <a class="code hl_variable" href="ranged_8cpp.html#a7cebe4dcc0fe98d9a37fe19beb640e1f">itype_40x53mm</a> ) {</div>
<div class="line"><a id="l01795" name="l01795"></a><span class="lineno"> 1795</span>        <span class="comment">// Grenade launchers</span></div>
<div class="line"><a id="l01796" name="l01796"></a><span class="lineno"> 1796</span>        <span class="keywordflow">return</span> { 8, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Thunk!&quot;</span> ) };</div>
<div class="line"><a id="l01797" name="l01797"></a><span class="lineno"> 1797</span> </div>
<div class="line"><a id="l01798" name="l01798"></a><span class="lineno"> 1798</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_function" href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">ammo_current</a>() == <a class="code hl_variable" href="ranged_8cpp.html#a21b633b2e3ce24798652a8392b2be96e">itype_12mm</a> || <a class="code hl_function" href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">ammo_current</a>() == <a class="code hl_variable" href="ranged_8cpp.html#a8cd1e1b3b0c3c6b1ba13f05f3831279c">itype_metal_rail</a> ) {</div>
<div class="line"><a id="l01799" name="l01799"></a><span class="lineno"> 1799</span>        <span class="comment">// Railguns</span></div>
<div class="line"><a id="l01800" name="l01800"></a><span class="lineno"> 1800</span>        <span class="keywordflow">return</span> { 24, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;tz-CRACKck!&quot;</span> ) };</div>
<div class="line"><a id="l01801" name="l01801"></a><span class="lineno"> 1801</span> </div>
<div class="line"><a id="l01802" name="l01802"></a><span class="lineno"> 1802</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_function" href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">ammo_current</a>() == <a class="code hl_variable" href="ranged_8cpp.html#a31e6d6147ad05dd584d1f1e71ac5dce7">itype_flammable</a> || <a class="code hl_function" href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">ammo_current</a>() == <a class="code hl_variable" href="ranged_8cpp.html#ae3075e5ce833b51beabbbf41bec72156">itype_66mm</a> ||</div>
<div class="line"><a id="l01803" name="l01803"></a><span class="lineno"> 1803</span>               <a class="code hl_function" href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">ammo_current</a>() == <a class="code hl_variable" href="ranged_8cpp.html#a804a5958c8dea5a130b8a5c7fe686ac6">itype_84x246mm</a> || <a class="code hl_function" href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">ammo_current</a>() == <a class="code hl_variable" href="ranged_8cpp.html#a45b1f02f143134444fdec57043934598">itype_m235</a> ) {</div>
<div class="line"><a id="l01804" name="l01804"></a><span class="lineno"> 1804</span>        <span class="comment">// Rocket launchers and flamethrowers</span></div>
<div class="line"><a id="l01805" name="l01805"></a><span class="lineno"> 1805</span>        <span class="keywordflow">return</span> { 4, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Fwoosh!&quot;</span> ) };</div>
<div class="line"><a id="l01806" name="l01806"></a><span class="lineno"> 1806</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_function" href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">ammo_current</a>() == <a class="code hl_variable" href="ranged_8cpp.html#af6105e558342bb67286a7f70682f652f">itype_arrow</a> ) {</div>
<div class="line"><a id="l01807" name="l01807"></a><span class="lineno"> 1807</span>        <span class="keywordflow">return</span> { <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;whizz!&quot;</span> ) };</div>
<div class="line"><a id="l01808" name="l01808"></a><span class="lineno"> 1808</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_function" href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">ammo_current</a>() == <a class="code hl_variable" href="ranged_8cpp.html#a8003de0be6343d0b891adb019a7b51ea">itype_bolt</a> ) {</div>
<div class="line"><a id="l01809" name="l01809"></a><span class="lineno"> 1809</span>        <span class="keywordflow">return</span> { <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;thonk!&quot;</span> ) };</div>
<div class="line"><a id="l01810" name="l01810"></a><span class="lineno"> 1810</span>    }</div>
<div class="line"><a id="l01811" name="l01811"></a><span class="lineno"> 1811</span> </div>
<div class="line"><a id="l01812" name="l01812"></a><span class="lineno"> 1812</span>    <span class="keyword">auto</span> fx = <a class="code hl_function" href="classitem.html#a75fa277bb39c1d2922137986c67d48fb">ammo_effects</a>();</div>
<div class="line"><a id="l01813" name="l01813"></a><span class="lineno"> 1813</span> </div>
<div class="line"><a id="l01814" name="l01814"></a><span class="lineno"> 1814</span>    <span class="keywordflow">if</span>( fx.count( <a class="code hl_variable" href="ranged_8cpp.html#a4823a8b924c5e1c83c8e1e1a316e1ae7">ammo_effect_LASER</a> ) || fx.count( <a class="code hl_variable" href="ranged_8cpp.html#aaf09bb55e60a45b1eb81e989d0758e93">ammo_effect_PLASMA</a> ) ) {</div>
<div class="line"><a id="l01815" name="l01815"></a><span class="lineno"> 1815</span>        <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> &lt; 20 ) {</div>
<div class="line"><a id="l01816" name="l01816"></a><span class="lineno"> 1816</span>            <span class="keywordflow">return</span> { <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Fzzt!&quot;</span> ) };</div>
<div class="line"><a id="l01817" name="l01817"></a><span class="lineno"> 1817</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> &lt; 40 ) {</div>
<div class="line"><a id="l01818" name="l01818"></a><span class="lineno"> 1818</span>            <span class="keywordflow">return</span> { <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Pew!&quot;</span> ) };</div>
<div class="line"><a id="l01819" name="l01819"></a><span class="lineno"> 1819</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> &lt; 60 ) {</div>
<div class="line"><a id="l01820" name="l01820"></a><span class="lineno"> 1820</span>            <span class="keywordflow">return</span> { <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Tsewww!&quot;</span> ) };</div>
<div class="line"><a id="l01821" name="l01821"></a><span class="lineno"> 1821</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01822" name="l01822"></a><span class="lineno"> 1822</span>            <span class="keywordflow">return</span> { <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Kra-kow!&quot;</span> ) };</div>
<div class="line"><a id="l01823" name="l01823"></a><span class="lineno"> 1823</span>        }</div>
<div class="line"><a id="l01824" name="l01824"></a><span class="lineno"> 1824</span> </div>
<div class="line"><a id="l01825" name="l01825"></a><span class="lineno"> 1825</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fx.count( <a class="code hl_variable" href="ranged_8cpp.html#a17d7acb18d1ef9119106898d678fac76">ammo_effect_LIGHTNING</a> ) ) {</div>
<div class="line"><a id="l01826" name="l01826"></a><span class="lineno"> 1826</span>        <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> &lt; 20 ) {</div>
<div class="line"><a id="l01827" name="l01827"></a><span class="lineno"> 1827</span>            <span class="keywordflow">return</span> { <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Bzzt!&quot;</span> ) };</div>
<div class="line"><a id="l01828" name="l01828"></a><span class="lineno"> 1828</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> &lt; 40 ) {</div>
<div class="line"><a id="l01829" name="l01829"></a><span class="lineno"> 1829</span>            <span class="keywordflow">return</span> { <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Bzap!&quot;</span> ) };</div>
<div class="line"><a id="l01830" name="l01830"></a><span class="lineno"> 1830</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> &lt; 60 ) {</div>
<div class="line"><a id="l01831" name="l01831"></a><span class="lineno"> 1831</span>            <span class="keywordflow">return</span> { <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Bzaapp!&quot;</span> ) };</div>
<div class="line"><a id="l01832" name="l01832"></a><span class="lineno"> 1832</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01833" name="l01833"></a><span class="lineno"> 1833</span>            <span class="keywordflow">return</span> { <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Kra-koom!&quot;</span> ) };</div>
<div class="line"><a id="l01834" name="l01834"></a><span class="lineno"> 1834</span>        }</div>
<div class="line"><a id="l01835" name="l01835"></a><span class="lineno"> 1835</span> </div>
<div class="line"><a id="l01836" name="l01836"></a><span class="lineno"> 1836</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fx.count( <a class="code hl_variable" href="ranged_8cpp.html#a08fa47ab74c2457fe092efe94c352dd7">ammo_effect_WHIP</a> ) ) {</div>
<div class="line"><a id="l01837" name="l01837"></a><span class="lineno"> 1837</span>        <span class="keywordflow">return</span> { <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Crack!&quot;</span> ) };</div>
<div class="line"><a id="l01838" name="l01838"></a><span class="lineno"> 1838</span> </div>
<div class="line"><a id="l01839" name="l01839"></a><span class="lineno"> 1839</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> &gt; 0 ) {</div>
<div class="line"><a id="l01840" name="l01840"></a><span class="lineno"> 1840</span>        <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> &lt; 10 ) {</div>
<div class="line"><a id="l01841" name="l01841"></a><span class="lineno"> 1841</span>            <span class="keywordflow">return</span> { <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, burst ? <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Brrrip!&quot;</span> ) : <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;plink!&quot;</span> ) };</div>
<div class="line"><a id="l01842" name="l01842"></a><span class="lineno"> 1842</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> &lt; 150 ) {</div>
<div class="line"><a id="l01843" name="l01843"></a><span class="lineno"> 1843</span>            <span class="keywordflow">return</span> { <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, burst ? <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Brrrap!&quot;</span> ) : <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;bang!&quot;</span> ) };</div>
<div class="line"><a id="l01844" name="l01844"></a><span class="lineno"> 1844</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> &lt; 175 ) {</div>
<div class="line"><a id="l01845" name="l01845"></a><span class="lineno"> 1845</span>            <span class="keywordflow">return</span> { <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, burst ? <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;P-p-p-pow!&quot;</span> ) : <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;blam!&quot;</span> ) };</div>
<div class="line"><a id="l01846" name="l01846"></a><span class="lineno"> 1846</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01847" name="l01847"></a><span class="lineno"> 1847</span>            <span class="keywordflow">return</span> { <a class="code hl_enumvalue" href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, burst ? <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Kaboom!&quot;</span> ) : <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;kerblam!&quot;</span> ) };</div>
<div class="line"><a id="l01848" name="l01848"></a><span class="lineno"> 1848</span>        }</div>
<div class="line"><a id="l01849" name="l01849"></a><span class="lineno"> 1849</span>    }</div>
<div class="line"><a id="l01850" name="l01850"></a><span class="lineno"> 1850</span> </div>
<div class="line"><a id="l01851" name="l01851"></a><span class="lineno"> 1851</span>    <span class="keywordflow">return</span> { 0, <span class="stringliteral">&quot;&quot;</span> }; <span class="comment">// silent weapons</span></div>
<div class="line"><a id="l01852" name="l01852"></a><span class="lineno"> 1852</span>}</div>
<div class="line"><a id="l01853" name="l01853"></a><span class="lineno"> 1853</span> </div>
<div class="line"><a id="l01854" name="l01854"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a170041722ca59caad52f34270eb5f183"> 1854</a></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="ranged_8cpp.html#a170041722ca59caad52f34270eb5f183">is_driving</a>( <span class="keyword">const</span> <a class="code hl_class" href="classplayer.html">player</a> &amp;p )</div>
<div class="line"><a id="l01855" name="l01855"></a><span class="lineno"> 1855</span>{</div>
<div class="line"><a id="l01856" name="l01856"></a><span class="lineno"> 1856</span>    <span class="keyword">const</span> <a class="code hl_class" href="classoptional__vpart__position.html">optional_vpart_position</a> vp = <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;m.veh_at( p.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() );</div>
<div class="line"><a id="l01857" name="l01857"></a><span class="lineno"> 1857</span>    <span class="keywordflow">return</span> vp &amp;&amp; vp-&gt;vehicle().is_moving() &amp;&amp; vp-&gt;vehicle().player_in_control( p );</div>
<div class="line"><a id="l01858" name="l01858"></a><span class="lineno"> 1858</span>}</div>
<div class="line"><a id="l01859" name="l01859"></a><span class="lineno"> 1859</span> </div>
<div class="line"><a id="l01860" name="l01860"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a217238d7885e55ae74878bbb1f99cddd"> 1860</a></span><span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code hl_function" href="ranged_8cpp.html#a217238d7885e55ae74878bbb1f99cddd">dispersion_from_skill</a>( <span class="keywordtype">double</span> skill, <span class="keywordtype">double</span> weapon_dispersion )</div>
<div class="line"><a id="l01861" name="l01861"></a><span class="lineno"> 1861</span>{</div>
<div class="line"><a id="l01862" name="l01862"></a><span class="lineno"> 1862</span>    <span class="keywordflow">if</span>( skill &gt;= <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> ) {</div>
<div class="line"><a id="l01863" name="l01863"></a><span class="lineno"> 1863</span>        <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a id="l01864" name="l01864"></a><span class="lineno"> 1864</span>    }</div>
<div class="line"><a id="l01865" name="l01865"></a><span class="lineno"> 1865</span>    <span class="keywordtype">double</span> skill_shortfall = double( <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> ) - skill;</div>
<div class="line"><a id="l01866" name="l01866"></a><span class="lineno"> 1866</span>    <span class="keywordtype">double</span> dispersion_penalty = 3 * skill_shortfall;</div>
<div class="line"><a id="l01867" name="l01867"></a><span class="lineno"> 1867</span>    <span class="keywordtype">double</span> skill_threshold = 5;</div>
<div class="line"><a id="l01868" name="l01868"></a><span class="lineno"> 1868</span>    <span class="keywordflow">if</span>( skill &gt;= skill_threshold ) {</div>
<div class="line"><a id="l01869" name="l01869"></a><span class="lineno"> 1869</span>        <span class="keywordtype">double</span> post_threshold_skill_shortfall = double( <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> ) - skill;</div>
<div class="line"><a id="l01870" name="l01870"></a><span class="lineno"> 1870</span>        <span class="comment">// Lack of mastery multiplies the dispersion of the weapon.</span></div>
<div class="line"><a id="l01871" name="l01871"></a><span class="lineno"> 1871</span>        <span class="keywordflow">return</span> dispersion_penalty + ( weapon_dispersion * post_threshold_skill_shortfall * 1.25 ) /</div>
<div class="line"><a id="l01872" name="l01872"></a><span class="lineno"> 1872</span>               ( <span class="keywordtype">double</span>( <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> ) - skill_threshold );</div>
<div class="line"><a id="l01873" name="l01873"></a><span class="lineno"> 1873</span>    }</div>
<div class="line"><a id="l01874" name="l01874"></a><span class="lineno"> 1874</span>    <span class="comment">// Unskilled shooters suffer greater penalties, still scaling with weapon penalties.</span></div>
<div class="line"><a id="l01875" name="l01875"></a><span class="lineno"> 1875</span>    <span class="keywordtype">double</span> pre_threshold_skill_shortfall = skill_threshold - skill;</div>
<div class="line"><a id="l01876" name="l01876"></a><span class="lineno"> 1876</span>    dispersion_penalty += weapon_dispersion *</div>
<div class="line"><a id="l01877" name="l01877"></a><span class="lineno"> 1877</span>                          ( 1.25 + pre_threshold_skill_shortfall * 3.75 / skill_threshold );</div>
<div class="line"><a id="l01878" name="l01878"></a><span class="lineno"> 1878</span> </div>
<div class="line"><a id="l01879" name="l01879"></a><span class="lineno"> 1879</span>    <span class="keywordflow">return</span> dispersion_penalty;</div>
<div class="line"><a id="l01880" name="l01880"></a><span class="lineno"> 1880</span>}</div>
<div class="line"><a id="l01881" name="l01881"></a><span class="lineno"> 1881</span> </div>
<div class="line"><a id="l01882" name="l01882"></a><span class="lineno"> 1882</span><span class="comment">// utility functions for projectile_attack</span></div>
<div class="line"><a id="l01883" name="l01883"></a><span class="lineno"><a class="line" href="classplayer.html#a3deecf5e0ddfe40130d97c61c57e2fe2"> 1883</a></span><a class="code hl_class" href="classdispersion__sources.html">dispersion_sources</a> <a class="code hl_function" href="classplayer.html#a3deecf5e0ddfe40130d97c61c57e2fe2">player::get_weapon_dispersion</a>( <span class="keyword">const</span> <a class="code hl_class" href="classitem.html">item</a> &amp;<a class="code hl_function" href="classint__id.html#a315169d32cce4267b7c8dceff4b0d1d7">obj</a> )<span class="keyword"> const</span></div>
<div class="line"><a id="l01884" name="l01884"></a><span class="lineno"> 1884</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01885" name="l01885"></a><span class="lineno"> 1885</span>    <span class="keywordtype">int</span> weapon_dispersion = obj.<a class="code hl_function" href="classitem.html#adfd6f9946d4895a6ef2190e07c2486a3">gun_dispersion</a>();</div>
<div class="line"><a id="l01886" name="l01886"></a><span class="lineno"> 1886</span>    <a class="code hl_class" href="classdispersion__sources.html">dispersion_sources</a> dispersion( weapon_dispersion );</div>
<div class="line"><a id="l01887" name="l01887"></a><span class="lineno"> 1887</span>    dispersion.<a class="code hl_function" href="classdispersion__sources.html#af9119f90d39a52caf16086dca87b1cac">add_range</a>( <a class="code hl_function" href="classCharacter.html#aaef1f2b773b9e659b6b69f813ea4dafb">ranged_dex_mod</a>() );</div>
<div class="line"><a id="l01888" name="l01888"></a><span class="lineno"> 1888</span> </div>
<div class="line"><a id="l01889" name="l01889"></a><span class="lineno"> 1889</span>    dispersion.<a class="code hl_function" href="classdispersion__sources.html#af9119f90d39a52caf16086dca87b1cac">add_range</a>( ( <a class="code hl_function" href="classCharacter.html#adc1fd84a88722a905e57fea8bfd5b6b0">encumb</a>( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a441080ba1d3930d38f635658d9b28e01">bp_arm_l</a> ) + <a class="code hl_function" href="classCharacter.html#adc1fd84a88722a905e57fea8bfd5b6b0">encumb</a>( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980ae5f21c7494ad730a0c6abf6957976cb3">bp_arm_r</a> ) ) / 5.0 );</div>
<div class="line"><a id="l01890" name="l01890"></a><span class="lineno"> 1890</span> </div>
<div class="line"><a id="l01891" name="l01891"></a><span class="lineno"> 1891</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="ranged_8cpp.html#a170041722ca59caad52f34270eb5f183">is_driving</a>( *<span class="keyword">this</span> ) ) {</div>
<div class="line"><a id="l01892" name="l01892"></a><span class="lineno"> 1892</span>        <span class="comment">// get volume of gun (or for auxiliary gunmods the parent gun)</span></div>
<div class="line"><a id="l01893" name="l01893"></a><span class="lineno"> 1893</span>        <span class="keyword">const</span> <a class="code hl_class" href="classitem.html">item</a> *parent = <a class="code hl_function" href="classvisitable.html#af49d5ef7b3f2f0a8664c23097a56373f">has_item</a>( obj ) ? <a class="code hl_function" href="classvisitable.html#a073dab39ca059a87742a05300402ab01">find_parent</a>( obj ) : <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l01894" name="l01894"></a><span class="lineno"> 1894</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> vol = ( parent ? parent-&gt;<a class="code hl_function" href="classitem.html#a51eafbdf8b331d88b741c0c527f98eb9">volume</a>() : obj.<a class="code hl_function" href="classitem.html#a51eafbdf8b331d88b741c0c527f98eb9">volume</a>() ) / 250_ml;</div>
<div class="line"><a id="l01895" name="l01895"></a><span class="lineno"> 1895</span><span class="comment"></span> </div>
<div class="line"><a id="l01896" name="l01896"></a><span class="lineno"> 1896</span><span class="comment">        /** @EFFECT_DRIVING reduces the inaccuracy penalty when using guns whilst driving */</span></div>
<div class="line"><a id="l01897" name="l01897"></a><span class="lineno"> 1897</span>        dispersion.<a class="code hl_function" href="classdispersion__sources.html#af9119f90d39a52caf16086dca87b1cac">add_range</a>( std::max( vol - <a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( <a class="code hl_variable" href="ranged_8cpp.html#afee8dcfd12a225c469ee6171063d7594">skill_driving</a> ), 1 ) * 20 );</div>
<div class="line"><a id="l01898" name="l01898"></a><span class="lineno"> 1898</span>    }</div>
<div class="line"><a id="l01899" name="l01899"></a><span class="lineno"> 1899</span><span class="comment"></span> </div>
<div class="line"><a id="l01900" name="l01900"></a><span class="lineno"> 1900</span><span class="comment">    /** @EFFECT_GUN improves usage of accurate weapons and sights */</span></div>
<div class="line"><a id="l01901" name="l01901"></a><span class="lineno"> 1901</span>    <span class="keywordtype">double</span> avgSkill = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( <a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( <a class="code hl_variable" href="ranged_8cpp.html#a3eadead4a9aa7fee079c0b1acce7965e">skill_gun</a> ) +</div>
<div class="line"><a id="l01902" name="l01902"></a><span class="lineno"> 1902</span>                                           <a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( obj.<a class="code hl_function" href="classitem.html#a3d8542661f2e2a82e8cb3792584912f3">gun_skill</a>() ) ) / 2.0;</div>
<div class="line"><a id="l01903" name="l01903"></a><span class="lineno"> 1903</span>    avgSkill = std::min( avgSkill, <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> ) );</div>
<div class="line"><a id="l01904" name="l01904"></a><span class="lineno"> 1904</span> </div>
<div class="line"><a id="l01905" name="l01905"></a><span class="lineno"> 1905</span>    dispersion.<a class="code hl_function" href="classdispersion__sources.html#af9119f90d39a52caf16086dca87b1cac">add_range</a>( <a class="code hl_function" href="ranged_8cpp.html#a217238d7885e55ae74878bbb1f99cddd">dispersion_from_skill</a>( avgSkill, weapon_dispersion ) );</div>
<div class="line"><a id="l01906" name="l01906"></a><span class="lineno"> 1906</span> </div>
<div class="line"><a id="l01907" name="l01907"></a><span class="lineno"> 1907</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="classCharacter.html#a5751b689e5a4ecd43b6de5c3e2d31541">has_bionic</a>( <a class="code hl_variable" href="ranged_8cpp.html#a0919705e5cea2aa623cbda27d0cae0b6">bio_targeting</a> ) ) {</div>
<div class="line"><a id="l01908" name="l01908"></a><span class="lineno"> 1908</span>        dispersion.<a class="code hl_function" href="classdispersion__sources.html#a3b8451b0f7c962f1b9f1c19e48d0cf65">add_multiplier</a>( 0.75 );</div>
<div class="line"><a id="l01909" name="l01909"></a><span class="lineno"> 1909</span>    }</div>
<div class="line"><a id="l01910" name="l01910"></a><span class="lineno"> 1910</span> </div>
<div class="line"><a id="l01911" name="l01911"></a><span class="lineno"> 1911</span>    <span class="comment">// If using a bow you lack the strength for, increase based on how much weaker shooter is.</span></div>
<div class="line"><a id="l01912" name="l01912"></a><span class="lineno"> 1912</span>    dispersion.<a class="code hl_function" href="classdispersion__sources.html#a3b8451b0f7c962f1b9f1c19e48d0cf65">add_multiplier</a>( 1 / <a class="code hl_function" href="namespaceranged.html#a613a2847b3c06998d6117f2630fc9ed5">ranged::str_draw_dispersion_modifier</a>( obj, *<span class="keyword">this</span> ) );</div>
<div class="line"><a id="l01913" name="l01913"></a><span class="lineno"> 1913</span> </div>
<div class="line"><a id="l01914" name="l01914"></a><span class="lineno"> 1914</span>    <span class="comment">// Range is effectively four times longer when shooting unflagged/flagged guns underwater/out of water.</span></div>
<div class="line"><a id="l01915" name="l01915"></a><span class="lineno"> 1915</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="classCreature.html#a5a2346f549de9c87e8f2afeec1e71366">is_underwater</a>() != obj.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#ab6ca472fa792b69b4a6afa8ca9e63a58">flag_UNDERWATER_GUN</a> ) ) {</div>
<div class="line"><a id="l01916" name="l01916"></a><span class="lineno"> 1916</span>        <span class="comment">// Adding dispersion for additional debuff</span></div>
<div class="line"><a id="l01917" name="l01917"></a><span class="lineno"> 1917</span>        dispersion.<a class="code hl_function" href="classdispersion__sources.html#af9119f90d39a52caf16086dca87b1cac">add_range</a>( 150 );</div>
<div class="line"><a id="l01918" name="l01918"></a><span class="lineno"> 1918</span>        dispersion.<a class="code hl_function" href="classdispersion__sources.html#a3b8451b0f7c962f1b9f1c19e48d0cf65">add_multiplier</a>( 4 );</div>
<div class="line"><a id="l01919" name="l01919"></a><span class="lineno"> 1919</span>    }</div>
<div class="line"><a id="l01920" name="l01920"></a><span class="lineno"> 1920</span> </div>
<div class="line"><a id="l01921" name="l01921"></a><span class="lineno"> 1921</span>    <span class="comment">// If user is currently able to fire a mounted gun freely, penalize dispersion based on size class.</span></div>
<div class="line"><a id="l01922" name="l01922"></a><span class="lineno"> 1922</span>    <span class="keywordflow">if</span>( obj.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a9a327f2be95a30526c2d1ab6a31f72b2">flag_MOUNTED_GUN</a> ) &amp;&amp; !<a class="code hl_function" href="ranged_8cpp.html#a6bfc75cd10b0d4de99dc6dcb44abc85b">can_use_bipod</a>( <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;m, <a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() ) ) {</div>
<div class="line"><a id="l01923" name="l01923"></a><span class="lineno"> 1923</span>        <span class="keywordflow">if</span>( <a class="code hl_function" href="classCharacter.html#aa5ca0f6c4fb1c08bb93ece1c9746c368">get_size</a>() == <a class="code hl_enumvalue" href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592a75a0e62060c8f624b2c71038a5a77ae9">MS_HUGE</a> ) {</div>
<div class="line"><a id="l01924" name="l01924"></a><span class="lineno"> 1924</span>            dispersion.<a class="code hl_function" href="classdispersion__sources.html#a3b8451b0f7c962f1b9f1c19e48d0cf65">add_multiplier</a>( 2 );</div>
<div class="line"><a id="l01925" name="l01925"></a><span class="lineno"> 1925</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01926" name="l01926"></a><span class="lineno"> 1926</span>            dispersion.<a class="code hl_function" href="classdispersion__sources.html#a3b8451b0f7c962f1b9f1c19e48d0cf65">add_multiplier</a>( 3 );</div>
<div class="line"><a id="l01927" name="l01927"></a><span class="lineno"> 1927</span>        }</div>
<div class="line"><a id="l01928" name="l01928"></a><span class="lineno"> 1928</span>    }</div>
<div class="line"><a id="l01929" name="l01929"></a><span class="lineno"> 1929</span> </div>
<div class="line"><a id="l01930" name="l01930"></a><span class="lineno"> 1930</span>    <span class="keywordflow">return</span> dispersion;</div>
<div class="line"><a id="l01931" name="l01931"></a><span class="lineno"> 1931</span>}</div>
<div class="line"><a id="l01932" name="l01932"></a><span class="lineno"> 1932</span> </div>
<div class="line"><a id="l01933" name="l01933"></a><span class="lineno"><a class="line" href="classplayer.html#ad7cc78075e6defac1a555615a4a0451a"> 1933</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="classplayer.html#ad7cc78075e6defac1a555615a4a0451a">player::gun_value</a>( <span class="keyword">const</span> <a class="code hl_class" href="classitem.html">item</a> &amp;weap, <span class="keywordtype">int</span> ammo )<span class="keyword"> const</span></div>
<div class="line"><a id="l01934" name="l01934"></a><span class="lineno"> 1934</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01935" name="l01935"></a><span class="lineno"> 1935</span>    <span class="comment">// TODO: Mods</span></div>
<div class="line"><a id="l01936" name="l01936"></a><span class="lineno"> 1936</span>    <span class="comment">// TODO: Allow using a specified type of ammo rather than default or current</span></div>
<div class="line"><a id="l01937" name="l01937"></a><span class="lineno"> 1937</span>    <span class="keywordflow">if</span>( !weap.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_variable" href="structitype.html#a623ec8243b1e599086fa3a23c3179370">gun</a> ) {</div>
<div class="line"><a id="l01938" name="l01938"></a><span class="lineno"> 1938</span>        <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a id="l01939" name="l01939"></a><span class="lineno"> 1939</span>    }</div>
<div class="line"><a id="l01940" name="l01940"></a><span class="lineno"> 1940</span> </div>
<div class="line"><a id="l01941" name="l01941"></a><span class="lineno"> 1941</span>    <span class="keywordflow">if</span>( ammo &lt;= 0 ) {</div>
<div class="line"><a id="l01942" name="l01942"></a><span class="lineno"> 1942</span>        <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a id="l01943" name="l01943"></a><span class="lineno"> 1943</span>    }</div>
<div class="line"><a id="l01944" name="l01944"></a><span class="lineno"> 1944</span> </div>
<div class="line"><a id="l01945" name="l01945"></a><span class="lineno"> 1945</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structislot__gun.html">islot_gun</a> &amp;gun = *weap.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_variable" href="structitype.html#a623ec8243b1e599086fa3a23c3179370">gun</a>;</div>
<div class="line"><a id="l01946" name="l01946"></a><span class="lineno"> 1946</span>    <a class="code hl_class" href="classstring__id.html">itype_id</a> ammo_type;</div>
<div class="line"><a id="l01947" name="l01947"></a><span class="lineno"> 1947</span>    <span class="keywordflow">if</span>( !weap.<a class="code hl_function" href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">ammo_current</a>().<a class="code hl_function" href="classstring__id.html#a3ca78345025397b3d3ac22729ba1684b">is_null</a>() ) {</div>
<div class="line"><a id="l01948" name="l01948"></a><span class="lineno"> 1948</span>        ammo_type = weap.<a class="code hl_function" href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">ammo_current</a>();</div>
<div class="line"><a id="l01949" name="l01949"></a><span class="lineno"> 1949</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( weap.<a class="code hl_function" href="classitem.html#ab22fc9a4e0f9c6f5569b93e00deccfac">magazine_current</a>() ) {</div>
<div class="line"><a id="l01950" name="l01950"></a><span class="lineno"> 1950</span>        ammo_type = weap.<a class="code hl_function" href="classitem.html#a5cc833f71e0454446fd0f877d24f6585">common_ammo_default</a>();</div>
<div class="line"><a id="l01951" name="l01951"></a><span class="lineno"> 1951</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01952" name="l01952"></a><span class="lineno"> 1952</span>        ammo_type = weap.<a class="code hl_function" href="classitem.html#ab07d96e30c441a84435972df842f4c77">ammo_default</a>();</div>
<div class="line"><a id="l01953" name="l01953"></a><span class="lineno"> 1953</span>    }</div>
<div class="line"><a id="l01954" name="l01954"></a><span class="lineno"> 1954</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structitype.html">itype</a> *def_ammo_i = ammo_type.<a class="code hl_function" href="classstring__id.html#a3ca78345025397b3d3ac22729ba1684b">is_null</a>() ? nullptr : &amp;*ammo_type;</div>
<div class="line"><a id="l01955" name="l01955"></a><span class="lineno"> 1955</span> </div>
<div class="line"><a id="l01956" name="l01956"></a><span class="lineno"> 1956</span>    <a class="code hl_struct" href="structdamage__instance.html">damage_instance</a> gun_damage = weap.<a class="code hl_function" href="classitem.html#ada111938a57ec6c7b47fcca30ec9d36c">gun_damage</a>();</div>
<div class="line"><a id="l01957" name="l01957"></a><span class="lineno"> 1957</span>    <a class="code hl_class" href="classitem.html">item</a> tmp = weap;</div>
<div class="line"><a id="l01958" name="l01958"></a><span class="lineno"> 1958</span>    tmp.<a class="code hl_function" href="classitem.html#a6a3f16444c412bce4b75a7d600d6a3fe">ammo_set</a>( ammo_type );</div>
<div class="line"><a id="l01959" name="l01959"></a><span class="lineno"> 1959</span>    <span class="keywordtype">int</span> total_dispersion = <a class="code hl_function" href="classplayer.html#a3deecf5e0ddfe40130d97c61c57e2fe2">get_weapon_dispersion</a>( tmp ).<a class="code hl_function" href="classdispersion__sources.html#ac3dc7f13e78a217aeaba57740f3af17c">max</a>() +</div>
<div class="line"><a id="l01960" name="l01960"></a><span class="lineno"> 1960</span>                           <a class="code hl_function" href="classCharacter.html#a37855668c0e9260587d5561b044f5510">effective_dispersion</a>( tmp.<a class="code hl_function" href="classitem.html#af0b7e5875297be57d675270f57ff775a">sight_dispersion</a>() );</div>
<div class="line"><a id="l01961" name="l01961"></a><span class="lineno"> 1961</span> </div>
<div class="line"><a id="l01962" name="l01962"></a><span class="lineno"> 1962</span>    <span class="keywordflow">if</span>( def_ammo_i != <span class="keyword">nullptr</span> &amp;&amp; def_ammo_i-&gt;<a class="code hl_variable" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a> ) {</div>
<div class="line"><a id="l01963" name="l01963"></a><span class="lineno"> 1963</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structislot__ammo.html">islot_ammo</a> &amp;def_ammo = *def_ammo_i-&gt;<a class="code hl_variable" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>;</div>
<div class="line"><a id="l01964" name="l01964"></a><span class="lineno"> 1964</span>        gun_damage.<a class="code hl_function" href="structdamage__instance.html#ae17bfa13ed37fd55281fa769a152e941">add</a>( def_ammo.<a class="code hl_variable" href="structcommon__ranged__data.html#a94254f1acb94261bb47c4b7aaa3b0c89">damage</a> );</div>
<div class="line"><a id="l01965" name="l01965"></a><span class="lineno"> 1965</span>        total_dispersion += def_ammo.<a class="code hl_variable" href="structcommon__ranged__data.html#a497cd4533098e79f14f8a97fcec6ca1a">dispersion</a>;</div>
<div class="line"><a id="l01966" name="l01966"></a><span class="lineno"> 1966</span>    }</div>
<div class="line"><a id="l01967" name="l01967"></a><span class="lineno"> 1967</span> </div>
<div class="line"><a id="l01968" name="l01968"></a><span class="lineno"> 1968</span>    <span class="keywordtype">float</span> damage_factor = gun_damage.<a class="code hl_function" href="structdamage__instance.html#a96f6f6d008ed8744ce549cefcfec3951">total_damage</a>();</div>
<div class="line"><a id="l01969" name="l01969"></a><span class="lineno"> 1969</span>    <span class="keywordflow">if</span>( damage_factor &gt; 0 ) {</div>
<div class="line"><a id="l01970" name="l01970"></a><span class="lineno"> 1970</span>        <span class="comment">// TODO: Multiple damage types</span></div>
<div class="line"><a id="l01971" name="l01971"></a><span class="lineno"> 1971</span>        damage_factor += 0.5f * gun_damage.<a class="code hl_variable" href="structdamage__instance.html#a2cc3ee4ff8f77ab6cd74168b1999246a">damage_units</a>.front().res_pen;</div>
<div class="line"><a id="l01972" name="l01972"></a><span class="lineno"> 1972</span>    }</div>
<div class="line"><a id="l01973" name="l01973"></a><span class="lineno"> 1973</span> </div>
<div class="line"><a id="l01974" name="l01974"></a><span class="lineno"> 1974</span>    <span class="keywordtype">int</span> <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> = <a class="code hl_function" href="ranged_8cpp.html#a613a8b59e4b2f2aaf05091d354bb4aa3">time_to_attack</a>( *<span class="keyword">this</span>, *weap.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a> );</div>
<div class="line"><a id="l01975" name="l01975"></a><span class="lineno"> 1975</span>    <span class="keywordflow">if</span>( gun.<a class="code hl_variable" href="structislot__gun.html#a5a7e4998071d2cd8f7ecd9504003968b">clip</a> != 0 &amp;&amp; gun.<a class="code hl_variable" href="structislot__gun.html#a5a7e4998071d2cd8f7ecd9504003968b">clip</a> &lt; 10 ) {</div>
<div class="line"><a id="l01976" name="l01976"></a><span class="lineno"> 1976</span>        <span class="comment">// TODO: RELOAD_ONE should get a penalty here</span></div>
<div class="line"><a id="l01977" name="l01977"></a><span class="lineno"> 1977</span>        <span class="keywordtype">int</span> reload_cost = gun.<a class="code hl_variable" href="structislot__gun.html#acedd47c3f7557f9b7b839af476c5989e">reload_time</a> + <a class="code hl_function" href="classCharacter.html#adc1fd84a88722a905e57fea8bfd5b6b0">encumb</a>( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a2806629e65a2c2eb5d8049e29e77910e">bp_hand_l</a> ) + <a class="code hl_function" href="classCharacter.html#adc1fd84a88722a905e57fea8bfd5b6b0">encumb</a>( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a54721306a0e05318b6d0440349c1a0fb">bp_hand_r</a> );</div>
<div class="line"><a id="l01978" name="l01978"></a><span class="lineno"> 1978</span>        reload_cost /= gun.<a class="code hl_variable" href="structislot__gun.html#a5a7e4998071d2cd8f7ecd9504003968b">clip</a>;</div>
<div class="line"><a id="l01979" name="l01979"></a><span class="lineno"> 1979</span>        <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> += reload_cost;</div>
<div class="line"><a id="l01980" name="l01980"></a><span class="lineno"> 1980</span>    }</div>
<div class="line"><a id="l01981" name="l01981"></a><span class="lineno"> 1981</span> </div>
<div class="line"><a id="l01982" name="l01982"></a><span class="lineno"> 1982</span>    <span class="comment">// &quot;Medium range&quot; below means 9 tiles, &quot;short range&quot; means 4</span></div>
<div class="line"><a id="l01983" name="l01983"></a><span class="lineno"> 1983</span>    <span class="comment">// Those are guarantees (assuming maximum time spent aiming)</span></div>
<div class="line"><a id="l01984" name="l01984"></a><span class="lineno"> 1984</span>    <span class="keyword">static</span> <span class="keyword">const</span> std::vector&lt;std::pair&lt;float, float&gt;&gt; dispersion_thresholds = {{</div>
<div class="line"><a id="l01985" name="l01985"></a><span class="lineno"> 1985</span>            <span class="comment">// Headshots all the time</span></div>
<div class="line"><a id="l01986" name="l01986"></a><span class="lineno"> 1986</span>            { 0.0f, 5.0f },</div>
<div class="line"><a id="l01987" name="l01987"></a><span class="lineno"> 1987</span>            <span class="comment">// Critical at medium range</span></div>
<div class="line"><a id="l01988" name="l01988"></a><span class="lineno"> 1988</span>            { 100.0f, 4.5f },</div>
<div class="line"><a id="l01989" name="l01989"></a><span class="lineno"> 1989</span>            <span class="comment">// Critical at short range or good hit at medium</span></div>
<div class="line"><a id="l01990" name="l01990"></a><span class="lineno"> 1990</span>            { 200.0f, 3.5f },</div>
<div class="line"><a id="l01991" name="l01991"></a><span class="lineno"> 1991</span>            <span class="comment">// OK hits at medium</span></div>
<div class="line"><a id="l01992" name="l01992"></a><span class="lineno"> 1992</span>            { 300.0f, 3.0f },</div>
<div class="line"><a id="l01993" name="l01993"></a><span class="lineno"> 1993</span>            <span class="comment">// Point blank headshots</span></div>
<div class="line"><a id="l01994" name="l01994"></a><span class="lineno"> 1994</span>            { 450.0f, 2.5f },</div>
<div class="line"><a id="l01995" name="l01995"></a><span class="lineno"> 1995</span>            <span class="comment">// OK hits at short</span></div>
<div class="line"><a id="l01996" name="l01996"></a><span class="lineno"> 1996</span>            { 700.0f, 1.5f },</div>
<div class="line"><a id="l01997" name="l01997"></a><span class="lineno"> 1997</span>            <span class="comment">// Glances at medium, criticals at point blank</span></div>
<div class="line"><a id="l01998" name="l01998"></a><span class="lineno"> 1998</span>            { 1000.0f, 1.0f },</div>
<div class="line"><a id="l01999" name="l01999"></a><span class="lineno"> 1999</span>            <span class="comment">// Nothing guaranteed, pure gamble</span></div>
<div class="line"><a id="l02000" name="l02000"></a><span class="lineno"> 2000</span>            { 2000.0f, 0.1f },</div>
<div class="line"><a id="l02001" name="l02001"></a><span class="lineno"> 2001</span>        }</div>
<div class="line"><a id="l02002" name="l02002"></a><span class="lineno"> 2002</span>    };</div>
<div class="line"><a id="l02003" name="l02003"></a><span class="lineno"> 2003</span> </div>
<div class="line"><a id="l02004" name="l02004"></a><span class="lineno"> 2004</span>    <span class="keyword">static</span> <span class="keyword">const</span> std::vector&lt;std::pair&lt;float, float&gt;&gt; move_cost_thresholds = {{</div>
<div class="line"><a id="l02005" name="l02005"></a><span class="lineno"> 2005</span>            { 10.0f, 4.0f },</div>
<div class="line"><a id="l02006" name="l02006"></a><span class="lineno"> 2006</span>            { 25.0f, 3.0f },</div>
<div class="line"><a id="l02007" name="l02007"></a><span class="lineno"> 2007</span>            { 100.0f, 1.0f },</div>
<div class="line"><a id="l02008" name="l02008"></a><span class="lineno"> 2008</span>            { 500.0f, 5.0f },</div>
<div class="line"><a id="l02009" name="l02009"></a><span class="lineno"> 2009</span>        }</div>
<div class="line"><a id="l02010" name="l02010"></a><span class="lineno"> 2010</span>    };</div>
<div class="line"><a id="l02011" name="l02011"></a><span class="lineno"> 2011</span> </div>
<div class="line"><a id="l02012" name="l02012"></a><span class="lineno"> 2012</span>    <span class="keywordtype">float</span> move_cost_factor = <a class="code hl_function" href="cata__utility_8cpp.html#ac49c7bae3c3ac926a5501ffb127c1e97">multi_lerp</a>( move_cost_thresholds, <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> );</div>
<div class="line"><a id="l02013" name="l02013"></a><span class="lineno"> 2013</span> </div>
<div class="line"><a id="l02014" name="l02014"></a><span class="lineno"> 2014</span>    <span class="comment">// Penalty for dodging in melee makes the gun unusable in melee</span></div>
<div class="line"><a id="l02015" name="l02015"></a><span class="lineno"> 2015</span>    <span class="comment">// Until NPCs get proper kiting, at least</span></div>
<div class="line"><a id="l02016" name="l02016"></a><span class="lineno"> 2016</span>    <span class="keywordtype">int</span> melee_penalty = <a class="code hl_variable" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a>.<a class="code hl_function" href="classitem.html#a51eafbdf8b331d88b741c0c527f98eb9">volume</a>() / 250_ml - <a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( <a class="code hl_variable" href="ranged_8cpp.html#a1d5482b7403ee4ac3e70e88ecfee2141">skill_dodge</a> );</div>
<div class="line"><a id="l02017" name="l02017"></a><span class="lineno"> 2017</span>    <span class="keywordflow">if</span>( melee_penalty &lt;= 0 ) {</div>
<div class="line"><a id="l02018" name="l02018"></a><span class="lineno"> 2018</span>        <span class="comment">// Dispersion matters less if you can just use the gun in melee</span></div>
<div class="line"><a id="l02019" name="l02019"></a><span class="lineno"> 2019</span>        total_dispersion = std::min&lt;int&gt;( total_dispersion / move_cost_factor, total_dispersion );</div>
<div class="line"><a id="l02020" name="l02020"></a><span class="lineno"> 2020</span>    }</div>
<div class="line"><a id="l02021" name="l02021"></a><span class="lineno"> 2021</span> </div>
<div class="line"><a id="l02022" name="l02022"></a><span class="lineno"> 2022</span>    <span class="keywordtype">float</span> dispersion_factor = <a class="code hl_function" href="cata__utility_8cpp.html#ac49c7bae3c3ac926a5501ffb127c1e97">multi_lerp</a>( dispersion_thresholds, total_dispersion );</div>
<div class="line"><a id="l02023" name="l02023"></a><span class="lineno"> 2023</span> </div>
<div class="line"><a id="l02024" name="l02024"></a><span class="lineno"> 2024</span>    <span class="keywordtype">float</span> damage_and_accuracy = damage_factor * dispersion_factor;</div>
<div class="line"><a id="l02025" name="l02025"></a><span class="lineno"> 2025</span> </div>
<div class="line"><a id="l02026" name="l02026"></a><span class="lineno"> 2026</span>    <span class="comment">// TODO: Some better approximation of the ability to keep on shooting</span></div>
<div class="line"><a id="l02027" name="l02027"></a><span class="lineno"> 2027</span>    <span class="keyword">static</span> <span class="keyword">const</span> std::vector&lt;std::pair&lt;float, float&gt;&gt; capacity_thresholds = {{</div>
<div class="line"><a id="l02028" name="l02028"></a><span class="lineno"> 2028</span>            { 1.0f, 0.5f },</div>
<div class="line"><a id="l02029" name="l02029"></a><span class="lineno"> 2029</span>            { 5.0f, 1.0f },</div>
<div class="line"><a id="l02030" name="l02030"></a><span class="lineno"> 2030</span>            { 10.0f, 1.5f },</div>
<div class="line"><a id="l02031" name="l02031"></a><span class="lineno"> 2031</span>            { 20.0f, 2.0f },</div>
<div class="line"><a id="l02032" name="l02032"></a><span class="lineno"> 2032</span>            { 50.0f, 3.0f },</div>
<div class="line"><a id="l02033" name="l02033"></a><span class="lineno"> 2033</span>        }</div>
<div class="line"><a id="l02034" name="l02034"></a><span class="lineno"> 2034</span>    };</div>
<div class="line"><a id="l02035" name="l02035"></a><span class="lineno"> 2035</span> </div>
<div class="line"><a id="l02036" name="l02036"></a><span class="lineno"> 2036</span>    <span class="comment">// How much until reload</span></div>
<div class="line"><a id="l02037" name="l02037"></a><span class="lineno"> 2037</span>    <span class="keywordtype">float</span> capacity = gun.<a class="code hl_variable" href="structislot__gun.html#a5a7e4998071d2cd8f7ecd9504003968b">clip</a> &gt; 0 ? std::min&lt;float&gt;( gun.<a class="code hl_variable" href="structislot__gun.html#a5a7e4998071d2cd8f7ecd9504003968b">clip</a>, ammo ) : ammo;</div>
<div class="line"><a id="l02038" name="l02038"></a><span class="lineno"> 2038</span>    <span class="comment">// How much until dry and a new weapon is needed</span></div>
<div class="line"><a id="l02039" name="l02039"></a><span class="lineno"> 2039</span>    capacity += std::min&lt;float&gt;( 1.0, ammo / 20.0 );</div>
<div class="line"><a id="l02040" name="l02040"></a><span class="lineno"> 2040</span>    <span class="keywordtype">double</span> capacity_factor = <a class="code hl_function" href="cata__utility_8cpp.html#ac49c7bae3c3ac926a5501ffb127c1e97">multi_lerp</a>( capacity_thresholds, capacity );</div>
<div class="line"><a id="l02041" name="l02041"></a><span class="lineno"> 2041</span> </div>
<div class="line"><a id="l02042" name="l02042"></a><span class="lineno"> 2042</span>    <span class="keywordtype">double</span> <a class="code hl_function" href="classplayer.html#ad7cc78075e6defac1a555615a4a0451a">gun_value</a> = damage_and_accuracy * capacity_factor;</div>
<div class="line"><a id="l02043" name="l02043"></a><span class="lineno"> 2043</span> </div>
<div class="line"><a id="l02044" name="l02044"></a><span class="lineno"> 2044</span>    <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea9855e523119c93601d8f67718994df05">m_debug</a>, <span class="stringliteral">&quot;%s as gun: %.1f total, %.1f dispersion, %.1f damage, %.1f capacity&quot;</span>,</div>
<div class="line"><a id="l02045" name="l02045"></a><span class="lineno"> 2045</span>             weap.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_function" href="structitype.html#abc2596bacfc718fba56ab8076bab5d6b">get_id</a>().<a class="code hl_function" href="classstring__id.html#aa7dabc565f0c067e1a237ea224b18f93">str</a>(), <a class="code hl_function" href="classplayer.html#ad7cc78075e6defac1a555615a4a0451a">gun_value</a>, dispersion_factor, damage_factor,</div>
<div class="line"><a id="l02046" name="l02046"></a><span class="lineno"> 2046</span>             capacity_factor );</div>
<div class="line"><a id="l02047" name="l02047"></a><span class="lineno"> 2047</span>    <span class="keywordflow">return</span> std::max( 0.0, <a class="code hl_function" href="classplayer.html#ad7cc78075e6defac1a555615a4a0451a">gun_value</a> );</div>
<div class="line"><a id="l02048" name="l02048"></a><span class="lineno"> 2048</span>}</div>
<div class="line"><a id="l02049" name="l02049"></a><span class="lineno"> 2049</span> </div>
<div class="line"><a id="l02050" name="l02050"></a><span class="lineno"><a class="line" href="classCharacter.html#accd6b165a9454cad9972bc153061215a"> 2050</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="classCharacter.html#accd6b165a9454cad9972bc153061215a">Character::recoil_vehicle</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l02051" name="l02051"></a><span class="lineno"> 2051</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02052" name="l02052"></a><span class="lineno"> 2052</span>    <span class="comment">// TODO: vary penalty dependent upon vehicle part on which player is boarded</span></div>
<div class="line"><a id="l02053" name="l02053"></a><span class="lineno"> 2053</span> </div>
<div class="line"><a id="l02054" name="l02054"></a><span class="lineno"> 2054</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classCharacter.html#a61bc9422c35b63128532af268e52cb71">in_vehicle</a> ) {</div>
<div class="line"><a id="l02055" name="l02055"></a><span class="lineno"> 2055</span>        <span class="keywordflow">if</span>( <span class="keyword">const</span> <a class="code hl_class" href="classoptional__vpart__position.html">optional_vpart_position</a> vp = <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;m.veh_at( <a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() ) ) {</div>
<div class="line"><a id="l02056" name="l02056"></a><span class="lineno"> 2056</span>            <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( std::abs( vp-&gt;vehicle().velocity ) ) * 3 / 100;</div>
<div class="line"><a id="l02057" name="l02057"></a><span class="lineno"> 2057</span>        }</div>
<div class="line"><a id="l02058" name="l02058"></a><span class="lineno"> 2058</span>    }</div>
<div class="line"><a id="l02059" name="l02059"></a><span class="lineno"> 2059</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l02060" name="l02060"></a><span class="lineno"> 2060</span>}</div>
<div class="line"><a id="l02061" name="l02061"></a><span class="lineno"> 2061</span> </div>
<div class="line"><a id="l02062" name="l02062"></a><span class="lineno"><a class="line" href="classCharacter.html#aec46a4b513360ef60f6143830bbb711d"> 2062</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="classCharacter.html#aec46a4b513360ef60f6143830bbb711d">Character::recoil_total</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l02063" name="l02063"></a><span class="lineno"> 2063</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02064" name="l02064"></a><span class="lineno"> 2064</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> + <a class="code hl_function" href="classCharacter.html#accd6b165a9454cad9972bc153061215a">recoil_vehicle</a>();</div>
<div class="line"><a id="l02065" name="l02065"></a><span class="lineno"> 2065</span>}</div>
<div class="line"><a id="l02066" name="l02066"></a><span class="lineno"> 2066</span> </div>
<div class="line"><a id="l02067" name="l02067"></a><span class="lineno"> 2067</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceranged.html">ranged</a></div>
<div class="line"><a id="l02068" name="l02068"></a><span class="lineno"> 2068</span>{</div>
<div class="line"><a id="l02069" name="l02069"></a><span class="lineno"> 2069</span> </div>
<div class="line"><a id="l02070" name="l02070"></a><span class="lineno"><a class="line" href="namespaceranged.html#a3fc846128cfc30100d71fbb6e2d482c5"> 2070</a></span>std::vector&lt;Creature *&gt; <a class="code hl_function" href="namespaceranged.html#a3fc846128cfc30100d71fbb6e2d482c5">targetable_creatures</a>( <span class="keyword">const</span> <a class="code hl_class" href="classCharacter.html">Character</a> &amp;<a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, <span class="keyword">const</span> <span class="keywordtype">int</span> range )</div>
<div class="line"><a id="l02071" name="l02071"></a><span class="lineno"> 2071</span>{</div>
<div class="line"><a id="l02072" name="l02072"></a><span class="lineno"> 2072</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="namespaceranged.html#a3fc846128cfc30100d71fbb6e2d482c5">targetable_creatures</a>( <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, range, <a class="code hl_class" href="classturret__data.html">turret_data</a>() );</div>
<div class="line"><a id="l02073" name="l02073"></a><span class="lineno"> 2073</span>}</div>
<div class="line"><a id="l02074" name="l02074"></a><span class="lineno"> 2074</span> </div>
<div class="line"><a id="l02075" name="l02075"></a><span class="lineno"><a class="line" href="namespaceranged.html#a41e7f0a8b2c552d2f8ec4c8a4930c7af"> 2075</a></span>std::vector&lt;Creature *&gt; <a class="code hl_function" href="namespaceranged.html#a3fc846128cfc30100d71fbb6e2d482c5">targetable_creatures</a>( <span class="keyword">const</span> <a class="code hl_class" href="classCharacter.html">Character</a> &amp;<a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, <span class="keyword">const</span> <span class="keywordtype">int</span> range,</div>
<div class="line"><a id="l02076" name="l02076"></a><span class="lineno"> 2076</span>        <span class="keyword">const</span> <a class="code hl_class" href="classturret__data.html">turret_data</a> &amp;turret )</div>
<div class="line"><a id="l02077" name="l02077"></a><span class="lineno"> 2077</span>{</div>
<div class="line"><a id="l02078" name="l02078"></a><span class="lineno"> 2078</span>    <span class="keyword">const</span> <a class="code hl_class" href="classvehicle.html">vehicle</a> *veh_from_turret = turret ? turret.<a class="code hl_function" href="classturret__data.html#aca7944937ce0285293b927c0c893d65a">get_veh</a>() : <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l02079" name="l02079"></a><span class="lineno"> 2079</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;get_creatures_if( [&amp;<a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, range, veh_from_turret]( <span class="keyword">const</span> <a class="code hl_class" href="classCreature.html">Creature</a> &amp; critter ) -&gt; <span class="keywordtype">bool</span> {</div>
<div class="line"><a id="l02080" name="l02080"></a><span class="lineno"> 2080</span>        <span class="keywordflow">if</span>( std::round( <a class="code hl_function" href="line_8cpp.html#a2d906c9af0b0586f48bc34cff0838817">rl_dist_exact</a>( <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.pos(), critter.<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>() ) ) &gt; range )</div>
<div class="line"><a id="l02081" name="l02081"></a><span class="lineno"> 2081</span>        {</div>
<div class="line"><a id="l02082" name="l02082"></a><span class="lineno"> 2082</span>            return false;</div>
<div class="line"><a id="l02083" name="l02083"></a><span class="lineno"> 2083</span>        }</div>
<div class="line"><a id="l02084" name="l02084"></a><span class="lineno"> 2084</span> </div>
<div class="line"><a id="l02085" name="l02085"></a><span class="lineno"> 2085</span>        <span class="keywordflow">if</span>( !<a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.sees( critter ) &amp;&amp; !<a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.sees_with_infrared( critter ) )</div>
<div class="line"><a id="l02086" name="l02086"></a><span class="lineno"> 2086</span>        {</div>
<div class="line"><a id="l02087" name="l02087"></a><span class="lineno"> 2087</span>            return false;</div>
<div class="line"><a id="l02088" name="l02088"></a><span class="lineno"> 2088</span>        }</div>
<div class="line"><a id="l02089" name="l02089"></a><span class="lineno"> 2089</span> </div>
<div class="line"><a id="l02090" name="l02090"></a><span class="lineno"> 2090</span>        <span class="comment">// TODO: get rid of fake npcs (pos() check)</span></div>
<div class="line"><a id="l02091" name="l02091"></a><span class="lineno"> 2091</span>        <span class="keywordflow">if</span>( &amp;<a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a> == &amp;critter || <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.pos() == critter.<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>() || <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.attitude_to( critter ) == Creature::Attitude::A_FRIENDLY )</div>
<div class="line"><a id="l02092" name="l02092"></a><span class="lineno"> 2092</span>        {</div>
<div class="line"><a id="l02093" name="l02093"></a><span class="lineno"> 2093</span>            return false;</div>
<div class="line"><a id="l02094" name="l02094"></a><span class="lineno"> 2094</span>        }</div>
<div class="line"><a id="l02095" name="l02095"></a><span class="lineno"> 2095</span> </div>
<div class="line"><a id="l02096" name="l02096"></a><span class="lineno"> 2096</span>        <a class="code hl_class" href="classmap.html">map</a> &amp;here = <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>();</div>
<div class="line"><a id="l02097" name="l02097"></a><span class="lineno"> 2097</span> </div>
<div class="line"><a id="l02098" name="l02098"></a><span class="lineno"> 2098</span>        <span class="comment">// TODO: It should use projectile passability checks when finding path, not vision checks.</span></div>
<div class="line"><a id="l02099" name="l02099"></a><span class="lineno"> 2099</span>        std::vector&lt;tripoint&gt; path = here.<a class="code hl_function" href="classmap.html#a0f73359be972a030063b4e84f770275e">find_clear_path</a>( <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.pos(), critter.<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>() );</div>
<div class="line"><a id="l02100" name="l02100"></a><span class="lineno"> 2100</span>        <a class="code hl_struct" href="structtripoint.html">tripoint</a> prev_point = <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.pos();</div>
<div class="line"><a id="l02101" name="l02101"></a><span class="lineno"> 2101</span>        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;<a class="code hl_struct" href="structpoint.html">point</a> : path )</div>
<div class="line"><a id="l02102" name="l02102"></a><span class="lineno"> 2102</span>        {</div>
<div class="line"><a id="l02103" name="l02103"></a><span class="lineno"> 2103</span>            if( here.obstructed_by_vehicle_rotation( prev_point, point ) ) {</div>
<div class="line"><a id="l02104" name="l02104"></a><span class="lineno"> 2104</span>                <span class="comment">//Blocked by a rotated vehicle&#39;s walls</span></div>
<div class="line"><a id="l02105" name="l02105"></a><span class="lineno"> 2105</span>                return false;</div>
<div class="line"><a id="l02106" name="l02106"></a><span class="lineno"> 2106</span>            }</div>
<div class="line"><a id="l02107" name="l02107"></a><span class="lineno"> 2107</span> </div>
<div class="line"><a id="l02108" name="l02108"></a><span class="lineno"> 2108</span>            prev_point = <a class="code hl_struct" href="structpoint.html">point</a>;</div>
<div class="line"><a id="l02109" name="l02109"></a><span class="lineno"> 2109</span> </div>
<div class="line"><a id="l02110" name="l02110"></a><span class="lineno"> 2110</span>            <span class="keywordflow">if</span>( here.passable( <a class="code hl_struct" href="structpoint.html">point</a> ) ) {</div>
<div class="line"><a id="l02111" name="l02111"></a><span class="lineno"> 2111</span>                <span class="comment">// If it&#39;s passable, it doesn&#39;t block bullets</span></div>
<div class="line"><a id="l02112" name="l02112"></a><span class="lineno"> 2112</span>                continue;</div>
<div class="line"><a id="l02113" name="l02113"></a><span class="lineno"> 2113</span>            }</div>
<div class="line"><a id="l02114" name="l02114"></a><span class="lineno"> 2114</span> </div>
<div class="line"><a id="l02115" name="l02115"></a><span class="lineno"> 2115</span>            <span class="keyword">const</span> <a class="code hl_class" href="classvehicle.html">vehicle</a> *veh_at_point = <a class="code hl_function" href="vpart__position_8h.html#a67bd76da258293f1443f1356308381dc">veh_pointer_or_null</a>( here.veh_at( <a class="code hl_struct" href="structpoint.html">point</a> ) );</div>
<div class="line"><a id="l02116" name="l02116"></a><span class="lineno"> 2116</span>            <span class="keywordflow">if</span>( veh_at_point &amp;&amp; veh_at_point != veh_from_turret ) {</div>
<div class="line"><a id="l02117" name="l02117"></a><span class="lineno"> 2117</span>                <span class="comment">// Vehicles don&#39;t have impassable-but-shootable-through parts</span></div>
<div class="line"><a id="l02118" name="l02118"></a><span class="lineno"> 2118</span>                return false;</div>
<div class="line"><a id="l02119" name="l02119"></a><span class="lineno"> 2119</span>            }</div>
<div class="line"><a id="l02120" name="l02120"></a><span class="lineno"> 2120</span>            <span class="keywordflow">if</span>( !here.has_flag_ter( <a class="code hl_enumvalue" href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258ac945c31a7a3d56b4f17384b30f73133f">TFLAG_TRANSPARENT</a>, <a class="code hl_struct" href="structpoint.html">point</a> ) ) {</div>
<div class="line"><a id="l02121" name="l02121"></a><span class="lineno"> 2121</span>                <span class="comment">// If it&#39;s transparent, it&#39;s either glass (fine) or reinforced glass (not fine)</span></div>
<div class="line"><a id="l02122" name="l02122"></a><span class="lineno"> 2122</span>                <span class="comment">// Hack it with the more common case for now</span></div>
<div class="line"><a id="l02123" name="l02123"></a><span class="lineno"> 2123</span>                <span class="comment">// TODO: Handle armored glass</span></div>
<div class="line"><a id="l02124" name="l02124"></a><span class="lineno"> 2124</span>                return false;</div>
<div class="line"><a id="l02125" name="l02125"></a><span class="lineno"> 2125</span>            }</div>
<div class="line"><a id="l02126" name="l02126"></a><span class="lineno"> 2126</span>        }</div>
<div class="line"><a id="l02127" name="l02127"></a><span class="lineno"> 2127</span> </div>
<div class="line"><a id="l02128" name="l02128"></a><span class="lineno"> 2128</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02129" name="l02129"></a><span class="lineno"> 2129</span>    } );</div>
<div class="line"><a id="l02130" name="l02130"></a><span class="lineno"> 2130</span>}</div>
<div class="line"><a id="l02131" name="l02131"></a><span class="lineno"> 2131</span> </div>
<div class="line"><a id="l02132" name="l02132"></a><span class="lineno"><a class="line" href="namespaceranged.html#a5332ed56c9f0b3702e72aecdcaa1e7be"> 2132</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="namespaceranged.html#a5332ed56c9f0b3702e72aecdcaa1e7be">burst_penalty</a>( <span class="keyword">const</span> <a class="code hl_class" href="classCharacter.html">Character</a> &amp;p, <span class="keyword">const</span> <a class="code hl_class" href="classitem.html">item</a> &amp;gun, <span class="keywordtype">int</span> gun_recoil )</div>
<div class="line"><a id="l02133" name="l02133"></a><span class="lineno"> 2133</span>{<span class="comment"></span></div>
<div class="line"><a id="l02134" name="l02134"></a><span class="lineno"> 2134</span><span class="comment">    ///\EFFECT_DEX reduces burst penalty by flat amount</span></div>
<div class="line"><a id="l02135" name="l02135"></a><span class="lineno"> 2135</span><span class="comment"></span>    <span class="keywordtype">int</span> dex_effect = p.<a class="code hl_function" href="classCharacter.html#a34a927d0f161ac92ab0d462397828bd5">get_dex</a>() * 10;<span class="comment"></span></div>
<div class="line"><a id="l02136" name="l02136"></a><span class="lineno"> 2136</span><span class="comment">    ///\EFFECT_STR reduces burst fire penalty</span></div>
<div class="line"><a id="l02137" name="l02137"></a><span class="lineno"> 2137</span><span class="comment"></span>    <span class="keywordtype">float</span> str_effect = p.<a class="code hl_function" href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">get_str</a>() * 0.5f;</div>
<div class="line"><a id="l02138" name="l02138"></a><span class="lineno"> 2138</span><span class="comment"></span> </div>
<div class="line"><a id="l02139" name="l02139"></a><span class="lineno"> 2139</span><span class="comment">    /** @EFFECT_PISTOL reduces burst fire penalty */</span><span class="comment"></span></div>
<div class="line"><a id="l02140" name="l02140"></a><span class="lineno"> 2140</span><span class="comment">    /** @EFFECT_SMG reduces burst fire penalty */</span><span class="comment"></span></div>
<div class="line"><a id="l02141" name="l02141"></a><span class="lineno"> 2141</span><span class="comment">    /** @EFFECT_RIFLE reduces burst fire penalty */</span><span class="comment"></span></div>
<div class="line"><a id="l02142" name="l02142"></a><span class="lineno"> 2142</span><span class="comment">    /** @EFFECT_SHOTGUN reduces burst fire penalty */</span></div>
<div class="line"><a id="l02143" name="l02143"></a><span class="lineno"> 2143</span>    <span class="keywordtype">int</span> skill_lvl = std::min( p.<a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( gun.<a class="code hl_function" href="classitem.html#a3d8542661f2e2a82e8cb3792584912f3">gun_skill</a>() ), <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> );</div>
<div class="line"><a id="l02144" name="l02144"></a><span class="lineno"> 2144</span> </div>
<div class="line"><a id="l02145" name="l02145"></a><span class="lineno"> 2145</span>    <span class="keywordflow">return</span> std::max&lt;int&gt;( 0, 3 * ( gun_recoil - dex_effect ) / std::max( 1.0f,</div>
<div class="line"><a id="l02146" name="l02146"></a><span class="lineno"> 2146</span>                          str_effect + skill_lvl ) );</div>
<div class="line"><a id="l02147" name="l02147"></a><span class="lineno"> 2147</span>}</div>
<div class="line"><a id="l02148" name="l02148"></a><span class="lineno"> 2148</span> </div>
<div class="line"><a id="l02149" name="l02149"></a><span class="lineno"> 2149</span>} <span class="comment">// namespace ranged</span></div>
<div class="line"><a id="l02150" name="l02150"></a><span class="lineno"> 2150</span> </div>
<div class="line"><a id="l02151" name="l02151"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a11be420f4d6ffd6128dd23d01be6c310"> 2151</a></span><a class="code hl_typedef" href="namespacetarget__handler.html#aea843144f5e69546ddea88eeda177640">target_handler::trajectory</a> <a class="code hl_function" href="classtarget__ui.html#a11be420f4d6ffd6128dd23d01be6c310">target_ui::run</a>()</div>
<div class="line"><a id="l02152" name="l02152"></a><span class="lineno"> 2152</span>{</div>
<div class="line"><a id="l02153" name="l02153"></a><span class="lineno"> 2153</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd">TargetMode::Spell</a> &amp;&amp; !<a class="code hl_variable" href="classtarget__ui.html#ac9b01fafb341eaec6c8f85582fd7f32f">no_mana</a> &amp;&amp; !<a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code hl_function" href="classspell.html#ab2631d5fc9da8a5ec04f7c3757e6c9f5">can_cast</a>( *<a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a> ) ) {</div>
<div class="line"><a id="l02154" name="l02154"></a><span class="lineno"> 2154</span>        <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_function" href="classplayer.html#ae7009d849f19a4f5ebe877cbe463c459">add_msg_if_player</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You don&#39;t have enough %s to cast this spell&quot;</span> ),</div>
<div class="line"><a id="l02155" name="l02155"></a><span class="lineno"> 2155</span>                                <a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code hl_function" href="classspell.html#aeb55e6084337fb199e3cab09260ad916">energy_string</a>() );</div>
<div class="line"><a id="l02156" name="l02156"></a><span class="lineno"> 2156</span>    }</div>
<div class="line"><a id="l02157" name="l02157"></a><span class="lineno"> 2157</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> || <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70">TargetMode::TurretManual</a> || <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a880c1273b27d27cfc82004c3a4b205c9">TargetMode::Shape</a> ) {</div>
<div class="line"><a id="l02158" name="l02158"></a><span class="lineno"> 2158</span>        <a class="code hl_function" href="classtarget__ui.html#a92256c0cb72fe5b2520a5808a5fcb79a">ensure_ranged_gun_mode</a>();</div>
<div class="line"><a id="l02159" name="l02159"></a><span class="lineno"> 2159</span>        <a class="code hl_function" href="classtarget__ui.html#a77429c16aec83b5c81d3a1c259259cd5">update_ammo_range_from_gun_mode</a>();</div>
<div class="line"><a id="l02160" name="l02160"></a><span class="lineno"> 2160</span>        <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> ) {</div>
<div class="line"><a id="l02161" name="l02161"></a><span class="lineno"> 2161</span>            <a class="code hl_variable" href="classtarget__ui.html#a2e6f4c9c827b91ce215a1a7b32a4affb">sight_dispersion</a> = <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_function" href="classCharacter.html#a37855668c0e9260587d5561b044f5510">effective_dispersion</a>( <a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code hl_function" href="classitem.html#af0b7e5875297be57d675270f57ff775a">sight_dispersion</a>() );</div>
<div class="line"><a id="l02162" name="l02162"></a><span class="lineno"> 2162</span>        }</div>
<div class="line"><a id="l02163" name="l02163"></a><span class="lineno"> 2163</span>    }</div>
<div class="line"><a id="l02164" name="l02164"></a><span class="lineno"> 2164</span> </div>
<div class="line"><a id="l02165" name="l02165"></a><span class="lineno"> 2165</span>    <a class="code hl_class" href="classmap.html">map</a> &amp;here = <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>();</div>
<div class="line"><a id="l02166" name="l02166"></a><span class="lineno"> 2166</span>    <span class="comment">// Load settings</span></div>
<div class="line"><a id="l02167" name="l02167"></a><span class="lineno"> 2167</span>    <a class="code hl_variable" href="classtarget__ui.html#a45f98789c877903961a56a54b17d9e96">allow_zlevel_shift</a> = here.<a class="code hl_function" href="classmap.html#abff2fded83a8e96e5e20084c3cb59579">has_zlevels</a>() &amp;&amp; get_option&lt;bool&gt;( <span class="stringliteral">&quot;FOV_3D&quot;</span> );</div>
<div class="line"><a id="l02168" name="l02168"></a><span class="lineno"> 2168</span>    <a class="code hl_variable" href="classtarget__ui.html#a270f72c5bfef55a533d3cd9b3cf57ea0">snap_to_target</a> = get_option&lt;bool&gt;( <span class="stringliteral">&quot;SNAP_TO_TARGET&quot;</span> );</div>
<div class="line"><a id="l02169" name="l02169"></a><span class="lineno"> 2169</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">TargetMode::Turrets</a> ) {</div>
<div class="line"><a id="l02170" name="l02170"></a><span class="lineno"> 2170</span>        <span class="comment">// Due to how cluttered the display would become, disable it by default</span></div>
<div class="line"><a id="l02171" name="l02171"></a><span class="lineno"> 2171</span>        <span class="comment">// unless aiming a single turret.</span></div>
<div class="line"><a id="l02172" name="l02172"></a><span class="lineno"> 2172</span>        <a class="code hl_variable" href="classtarget__ui.html#a63ac73585a9794e93d181362f7473b50">draw_turret_lines</a> = <a class="code hl_variable" href="classtarget__ui.html#ae7a7446b4088911709b2eb6a1d3973e5">vturrets</a>-&gt;size() == 1;</div>
<div class="line"><a id="l02173" name="l02173"></a><span class="lineno"> 2173</span>    }</div>
<div class="line"><a id="l02174" name="l02174"></a><span class="lineno"> 2174</span> </div>
<div class="line"><a id="l02175" name="l02175"></a><span class="lineno"> 2175</span>    <a class="code hl_class" href="classavatar.html">avatar</a> &amp;player_character = *<a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>;</div>
<div class="line"><a id="l02176" name="l02176"></a><span class="lineno"> 2176</span>    <a class="code hl_class" href="classon__out__of__scope.html">on_out_of_scope</a> cleanup( [&amp;here, &amp;player_character]() {</div>
<div class="line"><a id="l02177" name="l02177"></a><span class="lineno"> 2177</span>        here.<a class="code hl_function" href="classmap.html#af839ef9ba53f51b09259e0af06881fe6">invalidate_map_cache</a>( player_character.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>().<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> + player_character.<a class="code hl_variable" href="classplayer.html#a625b6dd5247589902251e845d07a2154">view_offset</a>.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a id="l02178" name="l02178"></a><span class="lineno"> 2178</span>    } );</div>
<div class="line"><a id="l02179" name="l02179"></a><span class="lineno"> 2179</span>    <a class="code hl_class" href="classrestore__on__out__of__scope.html">restore_on_out_of_scope&lt;tripoint&gt;</a> view_offset_prev( player_character.<a class="code hl_variable" href="classplayer.html#a625b6dd5247589902251e845d07a2154">view_offset</a> );</div>
<div class="line"><a id="l02180" name="l02180"></a><span class="lineno"> 2180</span> </div>
<div class="line"><a id="l02181" name="l02181"></a><span class="lineno"> 2181</span>    <a class="code hl_typedef" href="memory__fast_8h.html#ada897699f31fc8b37c5af09d95d45840">shared_ptr_fast&lt;game::draw_callback_t&gt;</a> target_ui_cb = make_shared_fast&lt;game::draw_callback_t&gt;(</div>
<div class="line"><a id="l02182" name="l02182"></a><span class="lineno"> 2182</span>    [&amp;]() {</div>
<div class="line"><a id="l02183" name="l02183"></a><span class="lineno"> 2183</span>        <a class="code hl_function" href="classtarget__ui.html#a15d523ae27fc66cbff7adac5e9fa91dd">draw_terrain_overlay</a>();</div>
<div class="line"><a id="l02184" name="l02184"></a><span class="lineno"> 2184</span>    } );</div>
<div class="line"><a id="l02185" name="l02185"></a><span class="lineno"> 2185</span>    <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;add_draw_callback( target_ui_cb );</div>
<div class="line"><a id="l02186" name="l02186"></a><span class="lineno"> 2186</span> </div>
<div class="line"><a id="l02187" name="l02187"></a><span class="lineno"> 2187</span>    <a class="code hl_class" href="classui__adaptor.html">ui_adaptor</a> <a class="code hl_namespace" href="namespaceui.html">ui</a>;</div>
<div class="line"><a id="l02188" name="l02188"></a><span class="lineno"> 2188</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.on_screen_resize( [&amp;]( <a class="code hl_class" href="classui__adaptor.html">ui_adaptor</a> &amp; <a class="code hl_namespace" href="namespaceui.html">ui</a> ) {</div>
<div class="line"><a id="l02189" name="l02189"></a><span class="lineno"> 2189</span>        <a class="code hl_function" href="classtarget__ui.html#af3857720f2059a0a2f23896bc7e808c7">init_window_and_input</a>();</div>
<div class="line"><a id="l02190" name="l02190"></a><span class="lineno"> 2190</span>        <a class="code hl_namespace" href="namespaceui.html">ui</a>.position_from_window( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> );</div>
<div class="line"><a id="l02191" name="l02191"></a><span class="lineno"> 2191</span>    } );</div>
<div class="line"><a id="l02192" name="l02192"></a><span class="lineno"> 2192</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.mark_resize();</div>
<div class="line"><a id="l02193" name="l02193"></a><span class="lineno"> 2193</span> </div>
<div class="line"><a id="l02194" name="l02194"></a><span class="lineno"> 2194</span>    <a class="code hl_namespace" href="namespaceui.html">ui</a>.on_redraw( [&amp;]( <span class="keyword">const</span> <a class="code hl_class" href="classui__adaptor.html">ui_adaptor</a> &amp; ) {</div>
<div class="line"><a id="l02195" name="l02195"></a><span class="lineno"> 2195</span>        <a class="code hl_function" href="classtarget__ui.html#a93a478e95d201324548329f39a087208">draw_ui_window</a>();</div>
<div class="line"><a id="l02196" name="l02196"></a><span class="lineno"> 2196</span>    } );</div>
<div class="line"><a id="l02197" name="l02197"></a><span class="lineno"> 2197</span> </div>
<div class="line"><a id="l02198" name="l02198"></a><span class="lineno"> 2198</span>    <span class="comment">// Handle multi-turn aiming</span></div>
<div class="line"><a id="l02199" name="l02199"></a><span class="lineno"> 2199</span>    std::string <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>;</div>
<div class="line"><a id="l02200" name="l02200"></a><span class="lineno"> 2200</span>    <span class="keywordtype">bool</span> attack_was_confirmed = <span class="keyword">false</span>;</div>
<div class="line"><a id="l02201" name="l02201"></a><span class="lineno"> 2201</span>    <span class="keywordtype">bool</span> reentered = <span class="keyword">false</span>;</div>
<div class="line"><a id="l02202" name="l02202"></a><span class="lineno"> 2202</span>    <span class="keywordtype">bool</span> resume_critter = <span class="keyword">false</span>;</div>
<div class="line"><a id="l02203" name="l02203"></a><span class="lineno"> 2203</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> &amp;&amp; !<a class="code hl_variable" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code hl_variable" href="classaim__activity__actor.html#a59cdab2e147fa7c2d2d46b9440083e05">first_turn</a> ) {</div>
<div class="line"><a id="l02204" name="l02204"></a><span class="lineno"> 2204</span>        <span class="comment">// We were in this UI during previous turn...</span></div>
<div class="line"><a id="l02205" name="l02205"></a><span class="lineno"> 2205</span>        reentered = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02206" name="l02206"></a><span class="lineno"> 2206</span>        std::string act_data = <a class="code hl_variable" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code hl_variable" href="classaim__activity__actor.html#ae287f1e168ac9ea8cfc16f0f55d323ef">action</a>;</div>
<div class="line"><a id="l02207" name="l02207"></a><span class="lineno"> 2207</span>        <span class="keywordflow">if</span>( act_data == <span class="stringliteral">&quot;AIM&quot;</span> ) {</div>
<div class="line"><a id="l02208" name="l02208"></a><span class="lineno"> 2208</span>            <span class="comment">// ...and ran out of moves while aiming.</span></div>
<div class="line"><a id="l02209" name="l02209"></a><span class="lineno"> 2209</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02210" name="l02210"></a><span class="lineno"> 2210</span>            <span class="comment">// ...and selected &#39;aim and shoot&#39;, but ran out of moves.</span></div>
<div class="line"><a id="l02211" name="l02211"></a><span class="lineno"> 2211</span>            <span class="comment">// So, skip retrieving input and go straight to the action.</span></div>
<div class="line"><a id="l02212" name="l02212"></a><span class="lineno"> 2212</span>            <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = act_data;</div>
<div class="line"><a id="l02213" name="l02213"></a><span class="lineno"> 2213</span>            attack_was_confirmed = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02214" name="l02214"></a><span class="lineno"> 2214</span>        }</div>
<div class="line"><a id="l02215" name="l02215"></a><span class="lineno"> 2215</span>        <span class="comment">// Load state to keep the ui consistent across turns</span></div>
<div class="line"><a id="l02216" name="l02216"></a><span class="lineno"> 2216</span>        <a class="code hl_variable" href="classtarget__ui.html#a270f72c5bfef55a533d3cd9b3cf57ea0">snap_to_target</a> = <a class="code hl_variable" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code hl_variable" href="classaim__activity__actor.html#a289353e8cf59d999c2e3db1db5d89f12">snap_to_target</a>;</div>
<div class="line"><a id="l02217" name="l02217"></a><span class="lineno"> 2217</span>        <a class="code hl_variable" href="classtarget__ui.html#a122323ec4c1e72c291e76643ccfd3fde">shifting_view</a> = <a class="code hl_variable" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code hl_variable" href="classaim__activity__actor.html#ab7b696d1eb458e907dbccf99a5dd54aa">shifting_view</a>;</div>
<div class="line"><a id="l02218" name="l02218"></a><span class="lineno"> 2218</span>        resume_critter = <a class="code hl_variable" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code hl_variable" href="classaim__activity__actor.html#a8f9b4001d182a0fc1ab4fdd8bd5b1507">aiming_at_critter</a>;</div>
<div class="line"><a id="l02219" name="l02219"></a><span class="lineno"> 2219</span>    }</div>
<div class="line"><a id="l02220" name="l02220"></a><span class="lineno"> 2220</span> </div>
<div class="line"><a id="l02221" name="l02221"></a><span class="lineno"> 2221</span>    <span class="comment">// Initialize cursor position</span></div>
<div class="line"><a id="l02222" name="l02222"></a><span class="lineno"> 2222</span>    <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> = <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>();</div>
<div class="line"><a id="l02223" name="l02223"></a><span class="lineno"> 2223</span>    <a class="code hl_function" href="classtarget__ui.html#af17fecf6fc24afc0a1af11ee1447b39a">update_target_list</a>();</div>
<div class="line"><a id="l02224" name="l02224"></a><span class="lineno"> 2224</span> </div>
<div class="line"><a id="l02225" name="l02225"></a><span class="lineno"> 2225</span>    <a class="code hl_struct" href="structtripoint.html">tripoint</a> initial_dst = <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>;</div>
<div class="line"><a id="l02226" name="l02226"></a><span class="lineno"> 2226</span>    <span class="keywordflow">if</span>( reentered ) {</div>
<div class="line"><a id="l02227" name="l02227"></a><span class="lineno"> 2227</span>        <span class="keywordflow">if</span>( !<a class="code hl_function" href="classtarget__ui.html#a5c885fc69abc2190e1850b7f23601ac2">try_reacquire_target</a>( resume_critter, initial_dst ) ) {</div>
<div class="line"><a id="l02228" name="l02228"></a><span class="lineno"> 2228</span>            <span class="comment">// Target lost</span></div>
<div class="line"><a id="l02229" name="l02229"></a><span class="lineno"> 2229</span>            <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>.clear();</div>
<div class="line"><a id="l02230" name="l02230"></a><span class="lineno"> 2230</span>            attack_was_confirmed = <span class="keyword">false</span>;</div>
<div class="line"><a id="l02231" name="l02231"></a><span class="lineno"> 2231</span>        }</div>
<div class="line"><a id="l02232" name="l02232"></a><span class="lineno"> 2232</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02233" name="l02233"></a><span class="lineno"> 2233</span>        initial_dst = <a class="code hl_function" href="classtarget__ui.html#a1591b490e9f8d48547b108ae481f982e">choose_initial_target</a>();</div>
<div class="line"><a id="l02234" name="l02234"></a><span class="lineno"> 2234</span>    }</div>
<div class="line"><a id="l02235" name="l02235"></a><span class="lineno"> 2235</span>    <a class="code hl_function" href="classtarget__ui.html#a3ead422f4a78394c13bc3f4c6c953f42">set_cursor_pos</a>( initial_dst );</div>
<div class="line"><a id="l02236" name="l02236"></a><span class="lineno"> 2236</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> != initial_dst ) {</div>
<div class="line"><a id="l02237" name="l02237"></a><span class="lineno"> 2237</span>        <span class="comment">// Our target moved out of range</span></div>
<div class="line"><a id="l02238" name="l02238"></a><span class="lineno"> 2238</span>        <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>.clear();</div>
<div class="line"><a id="l02239" name="l02239"></a><span class="lineno"> 2239</span>        attack_was_confirmed = <span class="keyword">false</span>;</div>
<div class="line"><a id="l02240" name="l02240"></a><span class="lineno"> 2240</span>    }</div>
<div class="line"><a id="l02241" name="l02241"></a><span class="lineno"> 2241</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> ) {</div>
<div class="line"><a id="l02242" name="l02242"></a><span class="lineno"> 2242</span>        <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code hl_variable" href="classaim__activity__actor.html#a5e4630c6a7a1630c7d93714d221ed78e">aif_duration</a> &gt; <a class="code hl_variable" href="ranged_8cpp.html#ae134db696195500e4ff1835e6f784aca">AIF_DURATION_LIMIT</a> ) {</div>
<div class="line"><a id="l02243" name="l02243"></a><span class="lineno"> 2243</span>            <span class="comment">// Break long (potentially infinite) aim-and-fire loop.</span></div>
<div class="line"><a id="l02244" name="l02244"></a><span class="lineno"> 2244</span>            <span class="comment">// May happen if e.g. avatar tries to get &#39;precise&#39; shot while being</span></div>
<div class="line"><a id="l02245" name="l02245"></a><span class="lineno"> 2245</span>            <span class="comment">// attacked by multiple zombies, which triggers dodges and corresponding aim loss.</span></div>
<div class="line"><a id="l02246" name="l02246"></a><span class="lineno"> 2246</span>            <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>.clear();</div>
<div class="line"><a id="l02247" name="l02247"></a><span class="lineno"> 2247</span>            attack_was_confirmed = <span class="keyword">false</span>;</div>
<div class="line"><a id="l02248" name="l02248"></a><span class="lineno"> 2248</span>        }</div>
<div class="line"><a id="l02249" name="l02249"></a><span class="lineno"> 2249</span>        <span class="keywordflow">if</span>( !<a class="code hl_variable" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code hl_variable" href="classaim__activity__actor.html#a59cdab2e147fa7c2d2d46b9440083e05">first_turn</a> &amp;&amp; !<a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>.empty() &amp;&amp; !<a class="code hl_function" href="classtarget__ui.html#ad2ca7887fd647df92c825e8ee153ff84">prompt_friendlies_in_lof</a>() ) {</div>
<div class="line"><a id="l02250" name="l02250"></a><span class="lineno"> 2250</span>            <span class="comment">// A friendly creature moved into line of fire during aim-and-shoot,</span></div>
<div class="line"><a id="l02251" name="l02251"></a><span class="lineno"> 2251</span>            <span class="comment">// and player decided to stop aiming</span></div>
<div class="line"><a id="l02252" name="l02252"></a><span class="lineno"> 2252</span>            <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>.clear();</div>
<div class="line"><a id="l02253" name="l02253"></a><span class="lineno"> 2253</span>            attack_was_confirmed = <span class="keyword">false</span>;</div>
<div class="line"><a id="l02254" name="l02254"></a><span class="lineno"> 2254</span>        }</div>
<div class="line"><a id="l02255" name="l02255"></a><span class="lineno"> 2255</span>        <a class="code hl_variable" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code hl_variable" href="classaim__activity__actor.html#a9835661ff059c7c690bf26075417b9b9">acceptable_losses</a>.clear();</div>
<div class="line"><a id="l02256" name="l02256"></a><span class="lineno"> 2256</span>        <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>.empty() ) {</div>
<div class="line"><a id="l02257" name="l02257"></a><span class="lineno"> 2257</span>            <a class="code hl_variable" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code hl_variable" href="classaim__activity__actor.html#a5e4630c6a7a1630c7d93714d221ed78e">aif_duration</a> = 0;</div>
<div class="line"><a id="l02258" name="l02258"></a><span class="lineno"> 2258</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02259" name="l02259"></a><span class="lineno"> 2259</span>            <a class="code hl_variable" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code hl_variable" href="classaim__activity__actor.html#a5e4630c6a7a1630c7d93714d221ed78e">aif_duration</a> += 1;</div>
<div class="line"><a id="l02260" name="l02260"></a><span class="lineno"> 2260</span>        }</div>
<div class="line"><a id="l02261" name="l02261"></a><span class="lineno"> 2261</span>    }</div>
<div class="line"><a id="l02262" name="l02262"></a><span class="lineno"> 2262</span> </div>
<div class="line"><a id="l02263" name="l02263"></a><span class="lineno"> 2263</span>    <span class="comment">// Event loop!</span></div>
<div class="line"><a id="l02264" name="l02264"></a><span class="lineno"> 2264</span>    <a class="code hl_enumeration" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6">ExitCode</a> loop_exit_code;</div>
<div class="line"><a id="l02265" name="l02265"></a><span class="lineno"> 2265</span>    std::string timed_out_action;</div>
<div class="line"><a id="l02266" name="l02266"></a><span class="lineno"> 2266</span>    <span class="keywordtype">bool</span> skip_redraw = <span class="keyword">false</span>;</div>
<div class="line"><a id="l02267" name="l02267"></a><span class="lineno"> 2267</span>    <span class="keywordflow">for</span>( ;; <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>.clear() ) {</div>
<div class="line"><a id="l02268" name="l02268"></a><span class="lineno"> 2268</span>        <span class="keywordflow">if</span>( !skip_redraw ) {</div>
<div class="line"><a id="l02269" name="l02269"></a><span class="lineno"> 2269</span>            <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;invalidate_main_ui_adaptor();</div>
<div class="line"><a id="l02270" name="l02270"></a><span class="lineno"> 2270</span>            <a class="code hl_function" href="namespaceui__manager.html#ae38f3a918052ef286ee60daac47f52d4">ui_manager::redraw</a>();</div>
<div class="line"><a id="l02271" name="l02271"></a><span class="lineno"> 2271</span>        }</div>
<div class="line"><a id="l02272" name="l02272"></a><span class="lineno"> 2272</span>        skip_redraw = <span class="keyword">false</span>;</div>
<div class="line"><a id="l02273" name="l02273"></a><span class="lineno"> 2273</span> </div>
<div class="line"><a id="l02274" name="l02274"></a><span class="lineno"> 2274</span>        <span class="comment">// Wait for user input (or use value retrieved from activity)</span></div>
<div class="line"><a id="l02275" name="l02275"></a><span class="lineno"> 2275</span>        <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>.empty() ) {</div>
<div class="line"><a id="l02276" name="l02276"></a><span class="lineno"> 2276</span>            <span class="keywordtype">int</span> timeout = get_option&lt;int&gt;( <span class="stringliteral">&quot;EDGE_SCROLL&quot;</span> );</div>
<div class="line"><a id="l02277" name="l02277"></a><span class="lineno"> 2277</span>            <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#a43aa2fcd42cabfd04056def8986bc927">handle_input</a>( timeout );</div>
<div class="line"><a id="l02278" name="l02278"></a><span class="lineno"> 2278</span>        }</div>
<div class="line"><a id="l02279" name="l02279"></a><span class="lineno"> 2279</span> </div>
<div class="line"><a id="l02280" name="l02280"></a><span class="lineno"> 2280</span>        <span class="comment">// If an aiming mode is selected, use &quot;*_SHOT&quot; instead of &quot;FIRE&quot;</span></div>
<div class="line"><a id="l02281" name="l02281"></a><span class="lineno"> 2281</span>        <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> &amp;&amp; <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;FIRE&quot;</span> &amp;&amp; <a class="code hl_variable" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">aim_mode</a>-&gt;has_threshold ) {</div>
<div class="line"><a id="l02282" name="l02282"></a><span class="lineno"> 2282</span>            <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code hl_variable" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">aim_mode</a>-&gt;action;</div>
<div class="line"><a id="l02283" name="l02283"></a><span class="lineno"> 2283</span>        }</div>
<div class="line"><a id="l02284" name="l02284"></a><span class="lineno"> 2284</span> </div>
<div class="line"><a id="l02285" name="l02285"></a><span class="lineno"> 2285</span>        <span class="comment">// Handle received input</span></div>
<div class="line"><a id="l02286" name="l02286"></a><span class="lineno"> 2286</span>        <span class="keywordflow">if</span>( <a class="code hl_function" href="classtarget__ui.html#ab290e475e7cd308b447788ec369053b0">handle_cursor_movement</a>( <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>, skip_redraw ) ) {</div>
<div class="line"><a id="l02287" name="l02287"></a><span class="lineno"> 2287</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l02288" name="l02288"></a><span class="lineno"> 2288</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;TOGGLE_SNAP_TO_TARGET&quot;</span> ) {</div>
<div class="line"><a id="l02289" name="l02289"></a><span class="lineno"> 2289</span>            <a class="code hl_function" href="classtarget__ui.html#a779bc721417ab8ee4a6b103d8a1030f5">toggle_snap_to_target</a>();</div>
<div class="line"><a id="l02290" name="l02290"></a><span class="lineno"> 2290</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;TOGGLE_TURRET_LINES&quot;</span> ) {</div>
<div class="line"><a id="l02291" name="l02291"></a><span class="lineno"> 2291</span>            <a class="code hl_variable" href="classtarget__ui.html#a63ac73585a9794e93d181362f7473b50">draw_turret_lines</a> = !<a class="code hl_variable" href="classtarget__ui.html#a63ac73585a9794e93d181362f7473b50">draw_turret_lines</a>;</div>
<div class="line"><a id="l02292" name="l02292"></a><span class="lineno"> 2292</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;TOGGLE_MOVE_CURSOR_VIEW&quot;</span> ) {</div>
<div class="line"><a id="l02293" name="l02293"></a><span class="lineno"> 2293</span>            <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a270f72c5bfef55a533d3cd9b3cf57ea0">snap_to_target</a> ) {</div>
<div class="line"><a id="l02294" name="l02294"></a><span class="lineno"> 2294</span>                <a class="code hl_function" href="classtarget__ui.html#a779bc721417ab8ee4a6b103d8a1030f5">toggle_snap_to_target</a>();</div>
<div class="line"><a id="l02295" name="l02295"></a><span class="lineno"> 2295</span>            }</div>
<div class="line"><a id="l02296" name="l02296"></a><span class="lineno"> 2296</span>            <a class="code hl_variable" href="classtarget__ui.html#a122323ec4c1e72c291e76643ccfd3fde">shifting_view</a> = !<a class="code hl_variable" href="classtarget__ui.html#a122323ec4c1e72c291e76643ccfd3fde">shifting_view</a>;</div>
<div class="line"><a id="l02297" name="l02297"></a><span class="lineno"> 2297</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;zoom_in&quot;</span> ) {</div>
<div class="line"><a id="l02298" name="l02298"></a><span class="lineno"> 2298</span>            <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;zoom_in();</div>
<div class="line"><a id="l02299" name="l02299"></a><span class="lineno"> 2299</span>            <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;mark_main_ui_adaptor_resize();</div>
<div class="line"><a id="l02300" name="l02300"></a><span class="lineno"> 2300</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;zoom_out&quot;</span> ) {</div>
<div class="line"><a id="l02301" name="l02301"></a><span class="lineno"> 2301</span>            <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;zoom_out();</div>
<div class="line"><a id="l02302" name="l02302"></a><span class="lineno"> 2302</span>            <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;mark_main_ui_adaptor_resize();</div>
<div class="line"><a id="l02303" name="l02303"></a><span class="lineno"> 2303</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;QUIT&quot;</span> ) {</div>
<div class="line"><a id="l02304" name="l02304"></a><span class="lineno"> 2304</span>            loop_exit_code = <a class="code hl_enumvalue" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6a727b63583e01fa2b3952dab580c84dc2">ExitCode::Abort</a>;</div>
<div class="line"><a id="l02305" name="l02305"></a><span class="lineno"> 2305</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02306" name="l02306"></a><span class="lineno"> 2306</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;SWITCH_MODE&quot;</span> ) {</div>
<div class="line"><a id="l02307" name="l02307"></a><span class="lineno"> 2307</span>            <a class="code hl_function" href="classtarget__ui.html#a691e0bd6f4c5f82b309fd0e026f77825">action_switch_mode</a>();</div>
<div class="line"><a id="l02308" name="l02308"></a><span class="lineno"> 2308</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;SWITCH_AMMO&quot;</span> ) {</div>
<div class="line"><a id="l02309" name="l02309"></a><span class="lineno"> 2309</span>            <span class="keywordflow">if</span>( !<a class="code hl_function" href="classtarget__ui.html#acbdcdc8f41dd8bcbf887b12d96c9948d">action_switch_ammo</a>() ) {</div>
<div class="line"><a id="l02310" name="l02310"></a><span class="lineno"> 2310</span>                loop_exit_code = <a class="code hl_enumvalue" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6a4d1c8263ba1036754f8db14a98f9f006">ExitCode::Reload</a>;</div>
<div class="line"><a id="l02311" name="l02311"></a><span class="lineno"> 2311</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02312" name="l02312"></a><span class="lineno"> 2312</span>            }</div>
<div class="line"><a id="l02313" name="l02313"></a><span class="lineno"> 2313</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;FIRE&quot;</span> ) {</div>
<div class="line"><a id="l02314" name="l02314"></a><span class="lineno"> 2314</span>            <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> != <a class="code hl_enumvalue" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a0c6ad70beb3a7e76c3fc7adab7c46acc">Status::Good</a> ) {</div>
<div class="line"><a id="l02315" name="l02315"></a><span class="lineno"> 2315</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l02316" name="l02316"></a><span class="lineno"> 2316</span>            }</div>
<div class="line"><a id="l02317" name="l02317"></a><span class="lineno"> 2317</span>            <span class="keywordtype">bool</span> can_skip_confirm = ( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd">TargetMode::Spell</a> &amp;&amp; <a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code hl_function" href="classspell.html#a62a42d1597639881eafc04506095695d">damage</a>() &lt;= 0 );</div>
<div class="line"><a id="l02318" name="l02318"></a><span class="lineno"> 2318</span>            <span class="keywordflow">if</span>( !can_skip_confirm &amp;&amp; !<a class="code hl_function" href="classtarget__ui.html#a97d244cde8cae12d0266daf6fc083014">confirm_non_enemy_target</a>() ) {</div>
<div class="line"><a id="l02319" name="l02319"></a><span class="lineno"> 2319</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l02320" name="l02320"></a><span class="lineno"> 2320</span>            }</div>
<div class="line"><a id="l02321" name="l02321"></a><span class="lineno"> 2321</span>            <a class="code hl_function" href="classtarget__ui.html#aa53ba52da62f64baa29130908cf8637b">set_last_target</a>();</div>
<div class="line"><a id="l02322" name="l02322"></a><span class="lineno"> 2322</span>            loop_exit_code = <a class="code hl_enumvalue" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6abd2b7e5f85a6ea65065c4ebc6d7c95bb">ExitCode::Fire</a>;</div>
<div class="line"><a id="l02323" name="l02323"></a><span class="lineno"> 2323</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02324" name="l02324"></a><span class="lineno"> 2324</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;AIM&quot;</span> ) {</div>
<div class="line"><a id="l02325" name="l02325"></a><span class="lineno"> 2325</span>            <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> != <a class="code hl_enumvalue" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a0c6ad70beb3a7e76c3fc7adab7c46acc">Status::Good</a> ) {</div>
<div class="line"><a id="l02326" name="l02326"></a><span class="lineno"> 2326</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l02327" name="l02327"></a><span class="lineno"> 2327</span>            }</div>
<div class="line"><a id="l02328" name="l02328"></a><span class="lineno"> 2328</span> </div>
<div class="line"><a id="l02329" name="l02329"></a><span class="lineno"> 2329</span>            <span class="comment">// No confirm_non_enemy_target here because we have not initiated the firing.</span></div>
<div class="line"><a id="l02330" name="l02330"></a><span class="lineno"> 2330</span>            <span class="comment">// Aiming can be stopped / aborted at any time.</span></div>
<div class="line"><a id="l02331" name="l02331"></a><span class="lineno"> 2331</span> </div>
<div class="line"><a id="l02332" name="l02332"></a><span class="lineno"> 2332</span>            <span class="keywordflow">if</span>( !<a class="code hl_function" href="classtarget__ui.html#a6c0468c35f79fb501be1a3a50b4081d4">action_aim</a>() ) {</div>
<div class="line"><a id="l02333" name="l02333"></a><span class="lineno"> 2333</span>                timed_out_action = <span class="stringliteral">&quot;AIM&quot;</span>;</div>
<div class="line"><a id="l02334" name="l02334"></a><span class="lineno"> 2334</span>                loop_exit_code = <a class="code hl_enumvalue" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6ac85a251cc457840f1e032f1b733e9398">ExitCode::Timeout</a>;</div>
<div class="line"><a id="l02335" name="l02335"></a><span class="lineno"> 2335</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02336" name="l02336"></a><span class="lineno"> 2336</span>            }</div>
<div class="line"><a id="l02337" name="l02337"></a><span class="lineno"> 2337</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;AIMED_SHOT&quot;</span> || <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;CAREFUL_SHOT&quot;</span> || <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;PRECISE_SHOT&quot;</span> ) {</div>
<div class="line"><a id="l02338" name="l02338"></a><span class="lineno"> 2338</span>            <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> != <a class="code hl_enumvalue" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a0c6ad70beb3a7e76c3fc7adab7c46acc">Status::Good</a> ) {</div>
<div class="line"><a id="l02339" name="l02339"></a><span class="lineno"> 2339</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l02340" name="l02340"></a><span class="lineno"> 2340</span>            }</div>
<div class="line"><a id="l02341" name="l02341"></a><span class="lineno"> 2341</span> </div>
<div class="line"><a id="l02342" name="l02342"></a><span class="lineno"> 2342</span>            <span class="comment">// This action basically means &quot;Fire&quot; as well; the actual firing may be delayed</span></div>
<div class="line"><a id="l02343" name="l02343"></a><span class="lineno"> 2343</span>            <span class="comment">// through aiming, but there is usually no means to abort it. Therefore we query now</span></div>
<div class="line"><a id="l02344" name="l02344"></a><span class="lineno"> 2344</span>            <span class="keywordflow">if</span>( !attack_was_confirmed &amp;&amp; !<a class="code hl_function" href="classtarget__ui.html#a97d244cde8cae12d0266daf6fc083014">confirm_non_enemy_target</a>() ) {</div>
<div class="line"><a id="l02345" name="l02345"></a><span class="lineno"> 2345</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l02346" name="l02346"></a><span class="lineno"> 2346</span>            }</div>
<div class="line"><a id="l02347" name="l02347"></a><span class="lineno"> 2347</span> </div>
<div class="line"><a id="l02348" name="l02348"></a><span class="lineno"> 2348</span>            <span class="keywordflow">if</span>( <a class="code hl_function" href="classtarget__ui.html#a21275763803a2ce0d00e02dc0076a36c">action_aim_and_shoot</a>( <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> ) ) {</div>
<div class="line"><a id="l02349" name="l02349"></a><span class="lineno"> 2349</span>                loop_exit_code = <a class="code hl_enumvalue" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6abd2b7e5f85a6ea65065c4ebc6d7c95bb">ExitCode::Fire</a>;</div>
<div class="line"><a id="l02350" name="l02350"></a><span class="lineno"> 2350</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02351" name="l02351"></a><span class="lineno"> 2351</span>                timed_out_action = <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>;</div>
<div class="line"><a id="l02352" name="l02352"></a><span class="lineno"> 2352</span>                loop_exit_code = <a class="code hl_enumvalue" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6ac85a251cc457840f1e032f1b733e9398">ExitCode::Timeout</a>;</div>
<div class="line"><a id="l02353" name="l02353"></a><span class="lineno"> 2353</span>            }</div>
<div class="line"><a id="l02354" name="l02354"></a><span class="lineno"> 2354</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02355" name="l02355"></a><span class="lineno"> 2355</span>        }</div>
<div class="line"><a id="l02356" name="l02356"></a><span class="lineno"> 2356</span>    } <span class="comment">// for(;;)</span></div>
<div class="line"><a id="l02357" name="l02357"></a><span class="lineno"> 2357</span> </div>
<div class="line"><a id="l02358" name="l02358"></a><span class="lineno"> 2358</span>    <span class="keywordflow">switch</span>( loop_exit_code ) {</div>
<div class="line"><a id="l02359" name="l02359"></a><span class="lineno"> 2359</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6a727b63583e01fa2b3952dab580c84dc2">ExitCode::Abort</a>: {</div>
<div class="line"><a id="l02360" name="l02360"></a><span class="lineno"> 2360</span>            <a class="code hl_variable" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">traj</a>.clear();</div>
<div class="line"><a id="l02361" name="l02361"></a><span class="lineno"> 2361</span>            <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> || <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a880c1273b27d27cfc82004c3a4b205c9">TargetMode::Shape</a> ) {</div>
<div class="line"><a id="l02362" name="l02362"></a><span class="lineno"> 2362</span>                <a class="code hl_variable" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code hl_variable" href="classaim__activity__actor.html#a064e415f122aefc25c29b9d3eee4fa4e">aborted</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02363" name="l02363"></a><span class="lineno"> 2363</span>            }</div>
<div class="line"><a id="l02364" name="l02364"></a><span class="lineno"> 2364</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02365" name="l02365"></a><span class="lineno"> 2365</span>        }</div>
<div class="line"><a id="l02366" name="l02366"></a><span class="lineno"> 2366</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6abd2b7e5f85a6ea65065c4ebc6d7c95bb">ExitCode::Fire</a>: {</div>
<div class="line"><a id="l02367" name="l02367"></a><span class="lineno"> 2367</span>            <span class="keywordtype">bool</span> harmful = !( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd">TargetMode::Spell</a> &amp;&amp; <a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code hl_function" href="classspell.html#a62a42d1597639881eafc04506095695d">damage</a>() &lt;= 0 );</div>
<div class="line"><a id="l02368" name="l02368"></a><span class="lineno"> 2368</span>            <a class="code hl_function" href="classtarget__ui.html#a9d84b28ee34fdefd76ae987c95a29600">on_target_accepted</a>( harmful );</div>
<div class="line"><a id="l02369" name="l02369"></a><span class="lineno"> 2369</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02370" name="l02370"></a><span class="lineno"> 2370</span>        }</div>
<div class="line"><a id="l02371" name="l02371"></a><span class="lineno"> 2371</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6ac85a251cc457840f1e032f1b733e9398">ExitCode::Timeout</a>: {</div>
<div class="line"><a id="l02372" name="l02372"></a><span class="lineno"> 2372</span>            <span class="comment">// We&#39;ve ran out of moves, save UI state</span></div>
<div class="line"><a id="l02373" name="l02373"></a><span class="lineno"> 2373</span>            <a class="code hl_variable" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code hl_variable" href="classaim__activity__actor.html#a9835661ff059c7c690bf26075417b9b9">acceptable_losses</a> = <a class="code hl_function" href="classtarget__ui.html#ac352f6aae1cb28945f8115b76fea2eb6">list_friendlies_in_lof</a>();</div>
<div class="line"><a id="l02374" name="l02374"></a><span class="lineno"> 2374</span>            <a class="code hl_variable" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">traj</a>.clear();</div>
<div class="line"><a id="l02375" name="l02375"></a><span class="lineno"> 2375</span>            <a class="code hl_variable" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code hl_variable" href="classaim__activity__actor.html#ae287f1e168ac9ea8cfc16f0f55d323ef">action</a> = timed_out_action;</div>
<div class="line"><a id="l02376" name="l02376"></a><span class="lineno"> 2376</span>            <a class="code hl_variable" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code hl_variable" href="classaim__activity__actor.html#a289353e8cf59d999c2e3db1db5d89f12">snap_to_target</a> = <a class="code hl_variable" href="classtarget__ui.html#a270f72c5bfef55a533d3cd9b3cf57ea0">snap_to_target</a>;</div>
<div class="line"><a id="l02377" name="l02377"></a><span class="lineno"> 2377</span>            <a class="code hl_variable" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code hl_variable" href="classaim__activity__actor.html#ab7b696d1eb458e907dbccf99a5dd54aa">shifting_view</a> = <a class="code hl_variable" href="classtarget__ui.html#a122323ec4c1e72c291e76643ccfd3fde">shifting_view</a>;</div>
<div class="line"><a id="l02378" name="l02378"></a><span class="lineno"> 2378</span>            <a class="code hl_variable" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code hl_variable" href="classaim__activity__actor.html#a8f9b4001d182a0fc1ab4fdd8bd5b1507">aiming_at_critter</a> = !!<a class="code hl_variable" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a>;</div>
<div class="line"><a id="l02379" name="l02379"></a><span class="lineno"> 2379</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02380" name="l02380"></a><span class="lineno"> 2380</span>        }</div>
<div class="line"><a id="l02381" name="l02381"></a><span class="lineno"> 2381</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6a4d1c8263ba1036754f8db14a98f9f006">ExitCode::Reload</a>: {</div>
<div class="line"><a id="l02382" name="l02382"></a><span class="lineno"> 2382</span>            <a class="code hl_variable" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">traj</a>.clear();</div>
<div class="line"><a id="l02383" name="l02383"></a><span class="lineno"> 2383</span>            <a class="code hl_variable" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code hl_variable" href="classaim__activity__actor.html#a064e415f122aefc25c29b9d3eee4fa4e">aborted</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02384" name="l02384"></a><span class="lineno"> 2384</span>            <a class="code hl_variable" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code hl_variable" href="classaim__activity__actor.html#a5a65a1ad1452654bdf0ce924ba8dcf53">reload_requested</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02385" name="l02385"></a><span class="lineno"> 2385</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02386" name="l02386"></a><span class="lineno"> 2386</span>        }</div>
<div class="line"><a id="l02387" name="l02387"></a><span class="lineno"> 2387</span>    }</div>
<div class="line"><a id="l02388" name="l02388"></a><span class="lineno"> 2388</span> </div>
<div class="line"><a id="l02389" name="l02389"></a><span class="lineno"> 2389</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">traj</a>;</div>
<div class="line"><a id="l02390" name="l02390"></a><span class="lineno"> 2390</span>}</div>
<div class="line"><a id="l02391" name="l02391"></a><span class="lineno"> 2391</span> </div>
<div class="line"><a id="l02392" name="l02392"></a><span class="lineno"><a class="line" href="classtarget__ui.html#af3857720f2059a0a2f23896bc7e808c7"> 2392</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#af3857720f2059a0a2f23896bc7e808c7">target_ui::init_window_and_input</a>()</div>
<div class="line"><a id="l02393" name="l02393"></a><span class="lineno"> 2393</span>{</div>
<div class="line"><a id="l02394" name="l02394"></a><span class="lineno"> 2394</span>    std::string display_type = get_option&lt;std::string&gt;( <span class="stringliteral">&quot;ACCURACY_DISPLAY&quot;</span> );</div>
<div class="line"><a id="l02395" name="l02395"></a><span class="lineno"> 2395</span>    std::string panel_type = <a class="code hl_function" href="classpanel__manager.html#a1196cd08699822653246ccafd856f72c">panel_manager::get_manager</a>().<a class="code hl_function" href="classpanel__manager.html#a3f6290efcd5bca21c3cf44762bca2a91">get_current_layout_id</a>();</div>
<div class="line"><a id="l02396" name="l02396"></a><span class="lineno"> 2396</span>    <a class="code hl_variable" href="classtarget__ui.html#a4b525b1e2a39f4748409b97e8984947b">narrow</a> = ( panel_type == <span class="stringliteral">&quot;compact&quot;</span> || panel_type == <span class="stringliteral">&quot;labels-narrow&quot;</span> );</div>
<div class="line"><a id="l02397" name="l02397"></a><span class="lineno"> 2397</span> </div>
<div class="line"><a id="l02398" name="l02398"></a><span class="lineno"> 2398</span>    <span class="keywordtype">int</span> top = 0;</div>
<div class="line"><a id="l02399" name="l02399"></a><span class="lineno"> 2399</span>    <span class="keywordtype">int</span> width;</div>
<div class="line"><a id="l02400" name="l02400"></a><span class="lineno"> 2400</span>    <span class="keywordtype">int</span> height;</div>
<div class="line"><a id="l02401" name="l02401"></a><span class="lineno"> 2401</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a4b525b1e2a39f4748409b97e8984947b">narrow</a> ) {</div>
<div class="line"><a id="l02402" name="l02402"></a><span class="lineno"> 2402</span>        <span class="comment">// Narrow layout removes the list of controls. This allows us</span></div>
<div class="line"><a id="l02403" name="l02403"></a><span class="lineno"> 2403</span>        <span class="comment">// to have small window size and not suffer from it.</span></div>
<div class="line"><a id="l02404" name="l02404"></a><span class="lineno"> 2404</span>        width = 34;</div>
<div class="line"><a id="l02405" name="l02405"></a><span class="lineno"> 2405</span>        height = 24;</div>
<div class="line"><a id="l02406" name="l02406"></a><span class="lineno"> 2406</span>        <a class="code hl_variable" href="classtarget__ui.html#a34b69263e28fa4472b51104ec1d2e6f0">compact</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02407" name="l02407"></a><span class="lineno"> 2407</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02408" name="l02408"></a><span class="lineno"> 2408</span>        width = 55;</div>
<div class="line"><a id="l02409" name="l02409"></a><span class="lineno"> 2409</span>        <a class="code hl_variable" href="classtarget__ui.html#a34b69263e28fa4472b51104ec1d2e6f0">compact</a> = <a class="code hl_variable" href="output_8cpp.html#a567a63be8cb70cc3eb47bf8affced8e5">TERMY</a> &lt; 41;</div>
<div class="line"><a id="l02410" name="l02410"></a><span class="lineno"> 2410</span>        <a class="code hl_variable" href="classtarget__ui.html#a1e6534092ef1b213639575c914030eb1">tiny</a> = <a class="code hl_variable" href="output_8cpp.html#a567a63be8cb70cc3eb47bf8affced8e5">TERMY</a> &lt; 28;</div>
<div class="line"><a id="l02411" name="l02411"></a><span class="lineno"> 2411</span>        <span class="keywordtype">bool</span> use_whole_sidebar = <a class="code hl_variable" href="output_8cpp.html#a567a63be8cb70cc3eb47bf8affced8e5">TERMY</a> &lt; 32;</div>
<div class="line"><a id="l02412" name="l02412"></a><span class="lineno"> 2412</span>        <span class="keywordflow">if</span>( use_whole_sidebar ) {</div>
<div class="line"><a id="l02413" name="l02413"></a><span class="lineno"> 2413</span>            <span class="comment">// If we&#39;re extremely short on space, use the whole sidebar.</span></div>
<div class="line"><a id="l02414" name="l02414"></a><span class="lineno"> 2414</span>            height = <a class="code hl_variable" href="output_8cpp.html#a567a63be8cb70cc3eb47bf8affced8e5">TERMY</a>;</div>
<div class="line"><a id="l02415" name="l02415"></a><span class="lineno"> 2415</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a34b69263e28fa4472b51104ec1d2e6f0">compact</a> ) {</div>
<div class="line"><a id="l02416" name="l02416"></a><span class="lineno"> 2416</span>            <span class="comment">// Cover up more low-value ui elements if we&#39;re tight on space.</span></div>
<div class="line"><a id="l02417" name="l02417"></a><span class="lineno"> 2417</span>            height = 28;</div>
<div class="line"><a id="l02418" name="l02418"></a><span class="lineno"> 2418</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02419" name="l02419"></a><span class="lineno"> 2419</span>            <span class="comment">// Go all out</span></div>
<div class="line"><a id="l02420" name="l02420"></a><span class="lineno"> 2420</span>            height = 32;</div>
<div class="line"><a id="l02421" name="l02421"></a><span class="lineno"> 2421</span>        }</div>
<div class="line"><a id="l02422" name="l02422"></a><span class="lineno"> 2422</span>    }</div>
<div class="line"><a id="l02423" name="l02423"></a><span class="lineno"> 2423</span> </div>
<div class="line"><a id="l02424" name="l02424"></a><span class="lineno"> 2424</span>    <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> = <a class="code hl_function" href="namespacecatacurses.html#a576fd20080b8f49e27acf97af45b374b">catacurses::newwin</a>( height, width, <a class="code hl_struct" href="structpoint.html">point</a>( <a class="code hl_variable" href="output_8cpp.html#a000abea6447dfafd5f9b787aa6753609">TERMX</a> - width, top ) );</div>
<div class="line"><a id="l02425" name="l02425"></a><span class="lineno"> 2425</span> </div>
<div class="line"><a id="l02426" name="l02426"></a><span class="lineno"> 2426</span>    <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a> = <a class="code hl_class" href="classinput__context.html">input_context</a>( <span class="stringliteral">&quot;TARGET&quot;</span> );</div>
<div class="line"><a id="l02427" name="l02427"></a><span class="lineno"> 2427</span>    <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#aec8e809c4ee9afcde858709e07b5f64b">set_iso</a>( <span class="keyword">true</span> );</div>
<div class="line"><a id="l02428" name="l02428"></a><span class="lineno"> 2428</span>    <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#a26d796fbe876b21a2d8b85eb5d59195f">register_directions</a>();</div>
<div class="line"><a id="l02429" name="l02429"></a><span class="lineno"> 2429</span>    <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;COORDINATE&quot;</span> );</div>
<div class="line"><a id="l02430" name="l02430"></a><span class="lineno"> 2430</span>    <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;SELECT&quot;</span> );</div>
<div class="line"><a id="l02431" name="l02431"></a><span class="lineno"> 2431</span>    <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;FIRE&quot;</span> );</div>
<div class="line"><a id="l02432" name="l02432"></a><span class="lineno"> 2432</span>    <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;NEXT_TARGET&quot;</span> );</div>
<div class="line"><a id="l02433" name="l02433"></a><span class="lineno"> 2433</span>    <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;PREV_TARGET&quot;</span> );</div>
<div class="line"><a id="l02434" name="l02434"></a><span class="lineno"> 2434</span>    <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;CENTER&quot;</span> );</div>
<div class="line"><a id="l02435" name="l02435"></a><span class="lineno"> 2435</span>    <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;TOGGLE_SNAP_TO_TARGET&quot;</span> );</div>
<div class="line"><a id="l02436" name="l02436"></a><span class="lineno"> 2436</span>    <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;HELP_KEYBINDINGS&quot;</span> );</div>
<div class="line"><a id="l02437" name="l02437"></a><span class="lineno"> 2437</span>    <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;QUIT&quot;</span> );</div>
<div class="line"><a id="l02438" name="l02438"></a><span class="lineno"> 2438</span>    <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;MOUSE_MOVE&quot;</span> );</div>
<div class="line"><a id="l02439" name="l02439"></a><span class="lineno"> 2439</span>    <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;zoom_out&quot;</span> );</div>
<div class="line"><a id="l02440" name="l02440"></a><span class="lineno"> 2440</span>    <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;zoom_in&quot;</span> );</div>
<div class="line"><a id="l02441" name="l02441"></a><span class="lineno"> 2441</span>    <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;TOGGLE_MOVE_CURSOR_VIEW&quot;</span> );</div>
<div class="line"><a id="l02442" name="l02442"></a><span class="lineno"> 2442</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a45f98789c877903961a56a54b17d9e96">allow_zlevel_shift</a> ) {</div>
<div class="line"><a id="l02443" name="l02443"></a><span class="lineno"> 2443</span>        <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;LEVEL_UP&quot;</span> );</div>
<div class="line"><a id="l02444" name="l02444"></a><span class="lineno"> 2444</span>        <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;LEVEL_DOWN&quot;</span> );</div>
<div class="line"><a id="l02445" name="l02445"></a><span class="lineno"> 2445</span>    }</div>
<div class="line"><a id="l02446" name="l02446"></a><span class="lineno"> 2446</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> || <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70">TargetMode::TurretManual</a> ) {</div>
<div class="line"><a id="l02447" name="l02447"></a><span class="lineno"> 2447</span>        <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;SWITCH_MODE&quot;</span> );</div>
<div class="line"><a id="l02448" name="l02448"></a><span class="lineno"> 2448</span>        <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70">TargetMode::TurretManual</a> || <a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a30c9d25adcf2167a8bff0fe6ca21fdaf">flag_RELOAD_AND_SHOOT</a> ) ) {</div>
<div class="line"><a id="l02449" name="l02449"></a><span class="lineno"> 2449</span>            <span class="comment">// Turrets may support multiple ammo types.</span></div>
<div class="line"><a id="l02450" name="l02450"></a><span class="lineno"> 2450</span>            <span class="comment">// RELOAD_AND_SHOOT weapons use whatever ammo is favorite.</span></div>
<div class="line"><a id="l02451" name="l02451"></a><span class="lineno"> 2451</span>            <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;SWITCH_AMMO&quot;</span> );</div>
<div class="line"><a id="l02452" name="l02452"></a><span class="lineno"> 2452</span>        }</div>
<div class="line"><a id="l02453" name="l02453"></a><span class="lineno"> 2453</span>    }</div>
<div class="line"><a id="l02454" name="l02454"></a><span class="lineno"> 2454</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> ) {</div>
<div class="line"><a id="l02455" name="l02455"></a><span class="lineno"> 2455</span>        <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;AIM&quot;</span> );</div>
<div class="line"><a id="l02456" name="l02456"></a><span class="lineno"> 2456</span> </div>
<div class="line"><a id="l02457" name="l02457"></a><span class="lineno"> 2457</span>        <a class="code hl_variable" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a> = <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_function" href="classCharacter.html#a7a8f9ffd035435c9f2777e007059e68d">get_aim_types</a>( *<a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a> );</div>
<div class="line"><a id="l02458" name="l02458"></a><span class="lineno"> 2458</span>        <span class="keywordflow">for</span>( <a class="code hl_struct" href="structaim__type.html">aim_type</a> &amp;<a class="code hl_enumvalue" href="enums_8h.html#ac7c2392f800a8be2feb093ef5fe48d40af3725cafa78eb43cc647b405bb6ecfab">type</a> : <a class="code hl_variable" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a> ) {</div>
<div class="line"><a id="l02459" name="l02459"></a><span class="lineno"> 2459</span>            <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="enums_8h.html#ac7c2392f800a8be2feb093ef5fe48d40af3725cafa78eb43cc647b405bb6ecfab">type</a>.has_threshold ) {</div>
<div class="line"><a id="l02460" name="l02460"></a><span class="lineno"> 2460</span>                <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <a class="code hl_enumvalue" href="enums_8h.html#ac7c2392f800a8be2feb093ef5fe48d40af3725cafa78eb43cc647b405bb6ecfab">type</a>.action );</div>
<div class="line"><a id="l02461" name="l02461"></a><span class="lineno"> 2461</span>            }</div>
<div class="line"><a id="l02462" name="l02462"></a><span class="lineno"> 2462</span>        }</div>
<div class="line"><a id="l02463" name="l02463"></a><span class="lineno"> 2463</span>        <a class="code hl_variable" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">aim_mode</a> = <a class="code hl_variable" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a>.begin();</div>
<div class="line"><a id="l02464" name="l02464"></a><span class="lineno"> 2464</span>        <span class="keywordflow">for</span>( <span class="keyword">auto</span> it = <a class="code hl_variable" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a>.begin(); it != <a class="code hl_variable" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a>.end(); ++it ) {</div>
<div class="line"><a id="l02465" name="l02465"></a><span class="lineno"> 2465</span>            <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classavatar.html#a98553758b9d158c58dd11c77d97ff55e">preferred_aiming_mode</a> == it-&gt;action ) {</div>
<div class="line"><a id="l02466" name="l02466"></a><span class="lineno"> 2466</span>                <a class="code hl_variable" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">aim_mode</a> = it; <span class="comment">// default to persisted mode if possible</span></div>
<div class="line"><a id="l02467" name="l02467"></a><span class="lineno"> 2467</span>            }</div>
<div class="line"><a id="l02468" name="l02468"></a><span class="lineno"> 2468</span>        }</div>
<div class="line"><a id="l02469" name="l02469"></a><span class="lineno"> 2469</span>    }</div>
<div class="line"><a id="l02470" name="l02470"></a><span class="lineno"> 2470</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">TargetMode::Turrets</a> ) {</div>
<div class="line"><a id="l02471" name="l02471"></a><span class="lineno"> 2471</span>        <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;TOGGLE_TURRET_LINES&quot;</span> );</div>
<div class="line"><a id="l02472" name="l02472"></a><span class="lineno"> 2472</span>    }</div>
<div class="line"><a id="l02473" name="l02473"></a><span class="lineno"> 2473</span>}</div>
<div class="line"><a id="l02474" name="l02474"></a><span class="lineno"> 2474</span> </div>
<div class="line"><a id="l02475" name="l02475"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ab290e475e7cd308b447788ec369053b0"> 2475</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classtarget__ui.html#ab290e475e7cd308b447788ec369053b0">target_ui::handle_cursor_movement</a>( <span class="keyword">const</span> std::string &amp;<a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>, <span class="keywordtype">bool</span> &amp;skip_redraw )</div>
<div class="line"><a id="l02476" name="l02476"></a><span class="lineno"> 2476</span>{</div>
<div class="line"><a id="l02477" name="l02477"></a><span class="lineno"> 2477</span>    <a class="code hl_class" href="classcata_1_1optional.html">cata::optional&lt;tripoint&gt;</a> mouse_pos;</div>
<div class="line"><a id="l02478" name="l02478"></a><span class="lineno"> 2478</span>    <span class="keyword">const</span> <span class="keyword">auto</span> shift_view_or_cursor = [<span class="keyword">this</span>]( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp; delta ) {</div>
<div class="line"><a id="l02479" name="l02479"></a><span class="lineno"> 2479</span>        <span class="keywordflow">if</span>( this-&gt;<a class="code hl_variable" href="classtarget__ui.html#a122323ec4c1e72c291e76643ccfd3fde">shifting_view</a> ) {</div>
<div class="line"><a id="l02480" name="l02480"></a><span class="lineno"> 2480</span>            this-&gt;<a class="code hl_function" href="classtarget__ui.html#abcb5ba4fec5983a480a4f765da7abe23">set_view_offset</a>( this-&gt;<a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classplayer.html#a625b6dd5247589902251e845d07a2154">view_offset</a> + delta );</div>
<div class="line"><a id="l02481" name="l02481"></a><span class="lineno"> 2481</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02482" name="l02482"></a><span class="lineno"> 2482</span>            this-&gt;<a class="code hl_function" href="classtarget__ui.html#a3ead422f4a78394c13bc3f4c6c953f42">set_cursor_pos</a>( <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> + delta );</div>
<div class="line"><a id="l02483" name="l02483"></a><span class="lineno"> 2483</span>        }</div>
<div class="line"><a id="l02484" name="l02484"></a><span class="lineno"> 2484</span>    };</div>
<div class="line"><a id="l02485" name="l02485"></a><span class="lineno"> 2485</span> </div>
<div class="line"><a id="l02486" name="l02486"></a><span class="lineno"> 2486</span>    <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;MOUSE_MOVE&quot;</span> || <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;TIMEOUT&quot;</span> ) {</div>
<div class="line"><a id="l02487" name="l02487"></a><span class="lineno"> 2487</span>        <span class="comment">// Shift pos and/or view via edge scrolling</span></div>
<div class="line"><a id="l02488" name="l02488"></a><span class="lineno"> 2488</span>        <a class="code hl_struct" href="structtripoint.html">tripoint</a> edge_scroll = <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;mouse_edge_scrolling_terrain( <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a> );</div>
<div class="line"><a id="l02489" name="l02489"></a><span class="lineno"> 2489</span>        <span class="keywordflow">if</span>( edge_scroll == <a class="code hl_variable" href="point_8h.html#a4b1a6bcaa42d2c06ecc3afc63305bfdf">tripoint_zero</a> ) {</div>
<div class="line"><a id="l02490" name="l02490"></a><span class="lineno"> 2490</span>            skip_redraw = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02491" name="l02491"></a><span class="lineno"> 2491</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02492" name="l02492"></a><span class="lineno"> 2492</span>            <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;MOUSE_MOVE&quot;</span> ) {</div>
<div class="line"><a id="l02493" name="l02493"></a><span class="lineno"> 2493</span>                edge_scroll *= 2;</div>
<div class="line"><a id="l02494" name="l02494"></a><span class="lineno"> 2494</span>            }</div>
<div class="line"><a id="l02495" name="l02495"></a><span class="lineno"> 2495</span>            <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a270f72c5bfef55a533d3cd9b3cf57ea0">snap_to_target</a> ) {</div>
<div class="line"><a id="l02496" name="l02496"></a><span class="lineno"> 2496</span>                <a class="code hl_function" href="classtarget__ui.html#a3ead422f4a78394c13bc3f4c6c953f42">set_cursor_pos</a>( <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> + edge_scroll );</div>
<div class="line"><a id="l02497" name="l02497"></a><span class="lineno"> 2497</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02498" name="l02498"></a><span class="lineno"> 2498</span>                <a class="code hl_function" href="classtarget__ui.html#abcb5ba4fec5983a480a4f765da7abe23">set_view_offset</a>( <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classplayer.html#a625b6dd5247589902251e845d07a2154">view_offset</a> + edge_scroll );</div>
<div class="line"><a id="l02499" name="l02499"></a><span class="lineno"> 2499</span>            }</div>
<div class="line"><a id="l02500" name="l02500"></a><span class="lineno"> 2500</span>        }</div>
<div class="line"><a id="l02501" name="l02501"></a><span class="lineno"> 2501</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <span class="keyword">const</span> <a class="code hl_class" href="classcata_1_1optional.html">cata::optional&lt;tripoint&gt;</a> delta = <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#a3c252676d2f1f2d49a0ec9c7fc7aae2b">get_direction</a>( <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> ) ) {</div>
<div class="line"><a id="l02502" name="l02502"></a><span class="lineno"> 2502</span>        <span class="comment">// Shift view/cursor with directional keys</span></div>
<div class="line"><a id="l02503" name="l02503"></a><span class="lineno"> 2503</span>        shift_view_or_cursor( *delta );</div>
<div class="line"><a id="l02504" name="l02504"></a><span class="lineno"> 2504</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;SELECT&quot;</span> &amp;&amp; ( mouse_pos = <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#a0937bc6e559b46c12c78aa65bea21942">get_coordinates</a>( <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;w_terrain ) ) ) {</div>
<div class="line"><a id="l02505" name="l02505"></a><span class="lineno"> 2505</span>        <span class="comment">// Set pos by clicking with mouse</span></div>
<div class="line"><a id="l02506" name="l02506"></a><span class="lineno"> 2506</span>        mouse_pos-&gt;z = <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>().<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> + <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classplayer.html#a625b6dd5247589902251e845d07a2154">view_offset</a>.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>;</div>
<div class="line"><a id="l02507" name="l02507"></a><span class="lineno"> 2507</span>        <a class="code hl_function" href="classtarget__ui.html#a3ead422f4a78394c13bc3f4c6c953f42">set_cursor_pos</a>( *mouse_pos );</div>
<div class="line"><a id="l02508" name="l02508"></a><span class="lineno"> 2508</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;LEVEL_UP&quot;</span> || <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;LEVEL_DOWN&quot;</span> ) {</div>
<div class="line"><a id="l02509" name="l02509"></a><span class="lineno"> 2509</span>        <span class="comment">// Shift view/cursor up/down one z level</span></div>
<div class="line"><a id="l02510" name="l02510"></a><span class="lineno"> 2510</span>        <a class="code hl_struct" href="structtripoint.html">tripoint</a> delta = <a class="code hl_struct" href="structtripoint.html">tripoint</a>(</div>
<div class="line"><a id="l02511" name="l02511"></a><span class="lineno"> 2511</span>                             0,</div>
<div class="line"><a id="l02512" name="l02512"></a><span class="lineno"> 2512</span>                             0,</div>
<div class="line"><a id="l02513" name="l02513"></a><span class="lineno"> 2513</span>                             <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;LEVEL_UP&quot;</span> ? 1 : -1</div>
<div class="line"><a id="l02514" name="l02514"></a><span class="lineno"> 2514</span>                         );</div>
<div class="line"><a id="l02515" name="l02515"></a><span class="lineno"> 2515</span>        shift_view_or_cursor( delta );</div>
<div class="line"><a id="l02516" name="l02516"></a><span class="lineno"> 2516</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;NEXT_TARGET&quot;</span> ) {</div>
<div class="line"><a id="l02517" name="l02517"></a><span class="lineno"> 2517</span>        <a class="code hl_function" href="classtarget__ui.html#af007dd5fcc266ee10d673299ca90c29c">cycle_targets</a>( 1 );</div>
<div class="line"><a id="l02518" name="l02518"></a><span class="lineno"> 2518</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;PREV_TARGET&quot;</span> ) {</div>
<div class="line"><a id="l02519" name="l02519"></a><span class="lineno"> 2519</span>        <a class="code hl_function" href="classtarget__ui.html#af007dd5fcc266ee10d673299ca90c29c">cycle_targets</a>( -1 );</div>
<div class="line"><a id="l02520" name="l02520"></a><span class="lineno"> 2520</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;CENTER&quot;</span> ) {</div>
<div class="line"><a id="l02521" name="l02521"></a><span class="lineno"> 2521</span>        <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a122323ec4c1e72c291e76643ccfd3fde">shifting_view</a> ) {</div>
<div class="line"><a id="l02522" name="l02522"></a><span class="lineno"> 2522</span>            <a class="code hl_function" href="classtarget__ui.html#abcb5ba4fec5983a480a4f765da7abe23">set_view_offset</a>( <a class="code hl_variable" href="point_8h.html#a4b1a6bcaa42d2c06ecc3afc63305bfdf">tripoint_zero</a> );</div>
<div class="line"><a id="l02523" name="l02523"></a><span class="lineno"> 2523</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02524" name="l02524"></a><span class="lineno"> 2524</span>            <a class="code hl_function" href="classtarget__ui.html#a3ead422f4a78394c13bc3f4c6c953f42">set_cursor_pos</a>( <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> );</div>
<div class="line"><a id="l02525" name="l02525"></a><span class="lineno"> 2525</span>        }</div>
<div class="line"><a id="l02526" name="l02526"></a><span class="lineno"> 2526</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02527" name="l02527"></a><span class="lineno"> 2527</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02528" name="l02528"></a><span class="lineno"> 2528</span>    }</div>
<div class="line"><a id="l02529" name="l02529"></a><span class="lineno"> 2529</span> </div>
<div class="line"><a id="l02530" name="l02530"></a><span class="lineno"> 2530</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02531" name="l02531"></a><span class="lineno"> 2531</span>}</div>
<div class="line"><a id="l02532" name="l02532"></a><span class="lineno"> 2532</span> </div>
<div class="line"><a id="l02533" name="l02533"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a3ead422f4a78394c13bc3f4c6c953f42"> 2533</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classtarget__ui.html#a3ead422f4a78394c13bc3f4c6c953f42">target_ui::set_cursor_pos</a>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;new_pos )</div>
<div class="line"><a id="l02534" name="l02534"></a><span class="lineno"> 2534</span>{</div>
<div class="line"><a id="l02535" name="l02535"></a><span class="lineno"> 2535</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> == new_pos ) {</div>
<div class="line"><a id="l02536" name="l02536"></a><span class="lineno"> 2536</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02537" name="l02537"></a><span class="lineno"> 2537</span>    }</div>
<div class="line"><a id="l02538" name="l02538"></a><span class="lineno"> 2538</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202aaa5b08f858f7353c5d012d6706525773">Status::OutOfAmmo</a> &amp;&amp; new_pos != <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> ) {</div>
<div class="line"><a id="l02539" name="l02539"></a><span class="lineno"> 2539</span>        <span class="comment">// range == 0, no sense in moving cursor</span></div>
<div class="line"><a id="l02540" name="l02540"></a><span class="lineno"> 2540</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02541" name="l02541"></a><span class="lineno"> 2541</span>    }</div>
<div class="line"><a id="l02542" name="l02542"></a><span class="lineno"> 2542</span> </div>
<div class="line"><a id="l02543" name="l02543"></a><span class="lineno"> 2543</span>    <span class="comment">// Make sure new position is valid or find a closest valid position</span></div>
<div class="line"><a id="l02544" name="l02544"></a><span class="lineno"> 2544</span>    std::vector&lt;tripoint&gt; new_traj;</div>
<div class="line"><a id="l02545" name="l02545"></a><span class="lineno"> 2545</span>    <a class="code hl_struct" href="structtripoint.html">tripoint</a> valid_pos = new_pos;</div>
<div class="line"><a id="l02546" name="l02546"></a><span class="lineno"> 2546</span>    <a class="code hl_class" href="classmap.html">map</a> &amp;here = <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>();</div>
<div class="line"><a id="l02547" name="l02547"></a><span class="lineno"> 2547</span>    <span class="keywordflow">if</span>( new_pos != <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> ) {</div>
<div class="line"><a id="l02548" name="l02548"></a><span class="lineno"> 2548</span>        <span class="comment">// On Z axis, make sure we do not exceed map boundaries</span></div>
<div class="line"><a id="l02549" name="l02549"></a><span class="lineno"> 2549</span>        valid_pos.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> = <a class="code hl_function" href="cata__utility_8h.html#ad22b4a043b6eb4c2c06f87f83b720b15">clamp</a>( valid_pos.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>, -<a class="code hl_variable" href="game__constants_8h.html#aad0eacfa516a8f7e005674027d7640fe">OVERMAP_DEPTH</a>, <a class="code hl_variable" href="game__constants_8h.html#a3984a9476d1edc78e4e7b886a08d4d4b">OVERMAP_HEIGHT</a> );</div>
<div class="line"><a id="l02550" name="l02550"></a><span class="lineno"> 2550</span>        <span class="comment">// Or current view range</span></div>
<div class="line"><a id="l02551" name="l02551"></a><span class="lineno"> 2551</span>        valid_pos.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> = <a class="code hl_function" href="cata__utility_8h.html#ad22b4a043b6eb4c2c06f87f83b720b15">clamp</a>( valid_pos.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> - <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>, -<a class="code hl_variable" href="cached__options_8cpp.html#a0cb65464a3fa34c1ed5474f5d2d853a7">fov_3d_z_range</a>, <a class="code hl_variable" href="cached__options_8cpp.html#a0cb65464a3fa34c1ed5474f5d2d853a7">fov_3d_z_range</a> ) + <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>;</div>
<div class="line"><a id="l02552" name="l02552"></a><span class="lineno"> 2552</span> </div>
<div class="line"><a id="l02553" name="l02553"></a><span class="lineno"> 2553</span>        new_traj = here.<a class="code hl_function" href="classmap.html#a0f73359be972a030063b4e84f770275e">find_clear_path</a>( <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, valid_pos );</div>
<div class="line"><a id="l02554" name="l02554"></a><span class="lineno"> 2554</span>        <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> == 1 ) {</div>
<div class="line"><a id="l02555" name="l02555"></a><span class="lineno"> 2555</span>            <span class="comment">// We should always be able to hit adjacent squares</span></div>
<div class="line"><a id="l02556" name="l02556"></a><span class="lineno"> 2556</span>            <span class="keywordflow">if</span>( <a class="code hl_function" href="coordinates_8h.html#a5ca1722555a6d5ab9ab7ae8e35c35eaa">square_dist</a>( <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, valid_pos ) &gt; 1 ) {</div>
<div class="line"><a id="l02557" name="l02557"></a><span class="lineno"> 2557</span>                valid_pos = new_traj[0];</div>
<div class="line"><a id="l02558" name="l02558"></a><span class="lineno"> 2558</span>            }</div>
<div class="line"><a id="l02559" name="l02559"></a><span class="lineno"> 2559</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_variable" href="cached__options_8cpp.html#a40b9d88f6d95e646490329d0071ec931">trigdist</a> ) {</div>
<div class="line"><a id="l02560" name="l02560"></a><span class="lineno"> 2560</span>            <span class="keywordflow">if</span>( <a class="code hl_function" href="classtarget__ui.html#ab236848678058afb7605e6d82a5c8fa9">dist_fn</a>( valid_pos ) &gt; <a class="code hl_variable" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> ) {</div>
<div class="line"><a id="l02561" name="l02561"></a><span class="lineno"> 2561</span>                <span class="comment">// Find the farthest point that is still in range</span></div>
<div class="line"><a id="l02562" name="l02562"></a><span class="lineno"> 2562</span>                <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> i = new_traj.size(); i &gt; 0; i-- ) {</div>
<div class="line"><a id="l02563" name="l02563"></a><span class="lineno"> 2563</span>                    <span class="keywordflow">if</span>( <a class="code hl_function" href="classtarget__ui.html#ab236848678058afb7605e6d82a5c8fa9">dist_fn</a>( new_traj[i - 1] ) &lt;= <a class="code hl_variable" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> ) {</div>
<div class="line"><a id="l02564" name="l02564"></a><span class="lineno"> 2564</span>                        valid_pos = new_traj[i - 1];</div>
<div class="line"><a id="l02565" name="l02565"></a><span class="lineno"> 2565</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02566" name="l02566"></a><span class="lineno"> 2566</span>                    }</div>
<div class="line"><a id="l02567" name="l02567"></a><span class="lineno"> 2567</span>                }</div>
<div class="line"><a id="l02568" name="l02568"></a><span class="lineno"> 2568</span>                <span class="comment">// Sanity check</span></div>
<div class="line"><a id="l02569" name="l02569"></a><span class="lineno"> 2569</span>                <span class="keywordflow">if</span>( <a class="code hl_function" href="classtarget__ui.html#ab236848678058afb7605e6d82a5c8fa9">dist_fn</a>( valid_pos ) &gt; <a class="code hl_variable" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> ) {</div>
<div class="line"><a id="l02570" name="l02570"></a><span class="lineno"> 2570</span>                    <a class="code hl_define" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Calculated trajectory exceeds allowed range!&quot;</span> );</div>
<div class="line"><a id="l02571" name="l02571"></a><span class="lineno"> 2571</span>                    valid_pos = <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>;</div>
<div class="line"><a id="l02572" name="l02572"></a><span class="lineno"> 2572</span>                }</div>
<div class="line"><a id="l02573" name="l02573"></a><span class="lineno"> 2573</span>            }</div>
<div class="line"><a id="l02574" name="l02574"></a><span class="lineno"> 2574</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02575" name="l02575"></a><span class="lineno"> 2575</span>            <a class="code hl_struct" href="structtripoint.html">tripoint</a> delta = valid_pos - <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>;</div>
<div class="line"><a id="l02576" name="l02576"></a><span class="lineno"> 2576</span>            valid_pos = <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> + <a class="code hl_struct" href="structtripoint.html">tripoint</a>(</div>
<div class="line"><a id="l02577" name="l02577"></a><span class="lineno"> 2577</span>                            <a class="code hl_function" href="cata__utility_8h.html#ad22b4a043b6eb4c2c06f87f83b720b15">clamp</a>( delta.<a class="code hl_variable" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a>, -<a class="code hl_variable" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a>, <a class="code hl_variable" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> ),</div>
<div class="line"><a id="l02578" name="l02578"></a><span class="lineno"> 2578</span>                            <a class="code hl_function" href="cata__utility_8h.html#ad22b4a043b6eb4c2c06f87f83b720b15">clamp</a>( delta.<a class="code hl_variable" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a>, -<a class="code hl_variable" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a>, <a class="code hl_variable" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> ),</div>
<div class="line"><a id="l02579" name="l02579"></a><span class="lineno"> 2579</span>                            <a class="code hl_function" href="cata__utility_8h.html#ad22b4a043b6eb4c2c06f87f83b720b15">clamp</a>( delta.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>, -<a class="code hl_variable" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a>, <a class="code hl_variable" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> )</div>
<div class="line"><a id="l02580" name="l02580"></a><span class="lineno"> 2580</span>                        );</div>
<div class="line"><a id="l02581" name="l02581"></a><span class="lineno"> 2581</span>        }</div>
<div class="line"><a id="l02582" name="l02582"></a><span class="lineno"> 2582</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02583" name="l02583"></a><span class="lineno"> 2583</span>        new_traj.push_back( <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> );</div>
<div class="line"><a id="l02584" name="l02584"></a><span class="lineno"> 2584</span>    }</div>
<div class="line"><a id="l02585" name="l02585"></a><span class="lineno"> 2585</span> </div>
<div class="line"><a id="l02586" name="l02586"></a><span class="lineno"> 2586</span>    <span class="keywordflow">if</span>( valid_pos == <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> ) {</div>
<div class="line"><a id="l02587" name="l02587"></a><span class="lineno"> 2587</span>        <span class="comment">// We don&#39;t need to move the cursor after all</span></div>
<div class="line"><a id="l02588" name="l02588"></a><span class="lineno"> 2588</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02589" name="l02589"></a><span class="lineno"> 2589</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( new_pos == valid_pos ) {</div>
<div class="line"><a id="l02590" name="l02590"></a><span class="lineno"> 2590</span>        <span class="comment">// We can reuse new_traj</span></div>
<div class="line"><a id="l02591" name="l02591"></a><span class="lineno"> 2591</span>        <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> = valid_pos;</div>
<div class="line"><a id="l02592" name="l02592"></a><span class="lineno"> 2592</span>        <a class="code hl_variable" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">traj</a> = new_traj;</div>
<div class="line"><a id="l02593" name="l02593"></a><span class="lineno"> 2593</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02594" name="l02594"></a><span class="lineno"> 2594</span>        <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> = valid_pos;</div>
<div class="line"><a id="l02595" name="l02595"></a><span class="lineno"> 2595</span>        <a class="code hl_variable" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">traj</a> = here.<a class="code hl_function" href="classmap.html#a0f73359be972a030063b4e84f770275e">find_clear_path</a>( <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> );</div>
<div class="line"><a id="l02596" name="l02596"></a><span class="lineno"> 2596</span>    }</div>
<div class="line"><a id="l02597" name="l02597"></a><span class="lineno"> 2597</span> </div>
<div class="line"><a id="l02598" name="l02598"></a><span class="lineno"> 2598</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a270f72c5bfef55a533d3cd9b3cf57ea0">snap_to_target</a> ) {</div>
<div class="line"><a id="l02599" name="l02599"></a><span class="lineno"> 2599</span>        <a class="code hl_function" href="classtarget__ui.html#abcb5ba4fec5983a480a4f765da7abe23">set_view_offset</a>( <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> - <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> );</div>
<div class="line"><a id="l02600" name="l02600"></a><span class="lineno"> 2600</span>    }</div>
<div class="line"><a id="l02601" name="l02601"></a><span class="lineno"> 2601</span> </div>
<div class="line"><a id="l02602" name="l02602"></a><span class="lineno"> 2602</span>    <span class="comment">// Make player&#39;s sprite flip to face the current target</span></div>
<div class="line"><a id="l02603" name="l02603"></a><span class="lineno"> 2603</span>    <a class="code hl_struct" href="structpoint.html">point</a> d( <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a>.<a class="code hl_function" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>() - <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>.<a class="code hl_function" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>() );</div>
<div class="line"><a id="l02604" name="l02604"></a><span class="lineno"> 2604</span>    <span class="keywordflow">if</span>( !<a class="code hl_variable" href="cached__options_8cpp.html#a406fb460d3cd96ac0e1cc3ccdef6340a">tile_iso</a> ) {</div>
<div class="line"><a id="l02605" name="l02605"></a><span class="lineno"> 2605</span> </div>
<div class="line"><a id="l02606" name="l02606"></a><span class="lineno"> 2606</span>        <span class="keywordflow">if</span>( d.<a class="code hl_variable" href="structpoint.html#ad679b07fb69d55f5ad454d0f1f2891d5">x</a> &gt; 0 ) {</div>
<div class="line"><a id="l02607" name="l02607"></a><span class="lineno"> 2607</span>            <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classCreature.html#a21b8fbeb525a28615eec6a6c22beff44">facing</a> = <a class="code hl_enumvalue" href="creature_8h.html#ad75f2d1f6565bcf922f3f2ddab4c6b11a86dc1254b0f072b9cb90b4cf14cb2917">FacingDirection::FD_RIGHT</a>;</div>
<div class="line"><a id="l02608" name="l02608"></a><span class="lineno"> 2608</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( d.<a class="code hl_variable" href="structpoint.html#ad679b07fb69d55f5ad454d0f1f2891d5">x</a> &lt; 0 ) {</div>
<div class="line"><a id="l02609" name="l02609"></a><span class="lineno"> 2609</span>            <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classCreature.html#a21b8fbeb525a28615eec6a6c22beff44">facing</a> = <a class="code hl_enumvalue" href="creature_8h.html#ad75f2d1f6565bcf922f3f2ddab4c6b11a68b715cd56911c8b0ce1b82f76547b6b">FacingDirection::FD_LEFT</a>;</div>
<div class="line"><a id="l02610" name="l02610"></a><span class="lineno"> 2610</span>        }</div>
<div class="line"><a id="l02611" name="l02611"></a><span class="lineno"> 2611</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02612" name="l02612"></a><span class="lineno"> 2612</span>        <span class="keywordflow">if</span>( d.<a class="code hl_variable" href="structpoint.html#ad679b07fb69d55f5ad454d0f1f2891d5">x</a> &gt;= 0 &amp;&amp; d.<a class="code hl_variable" href="structpoint.html#a9a82ca9504acabb1e30569f89c805471">y</a> &gt;= 0 ) {</div>
<div class="line"><a id="l02613" name="l02613"></a><span class="lineno"> 2613</span>            <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classCreature.html#a21b8fbeb525a28615eec6a6c22beff44">facing</a> = <a class="code hl_enumvalue" href="creature_8h.html#ad75f2d1f6565bcf922f3f2ddab4c6b11a86dc1254b0f072b9cb90b4cf14cb2917">FacingDirection::FD_RIGHT</a>;</div>
<div class="line"><a id="l02614" name="l02614"></a><span class="lineno"> 2614</span>        }</div>
<div class="line"><a id="l02615" name="l02615"></a><span class="lineno"> 2615</span>        <span class="keywordflow">if</span>( d.<a class="code hl_variable" href="structpoint.html#a9a82ca9504acabb1e30569f89c805471">y</a> &lt;= 0 &amp;&amp; d.<a class="code hl_variable" href="structpoint.html#ad679b07fb69d55f5ad454d0f1f2891d5">x</a> &lt;= 0 ) {</div>
<div class="line"><a id="l02616" name="l02616"></a><span class="lineno"> 2616</span>            <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classCreature.html#a21b8fbeb525a28615eec6a6c22beff44">facing</a> = <a class="code hl_enumvalue" href="creature_8h.html#ad75f2d1f6565bcf922f3f2ddab4c6b11a68b715cd56911c8b0ce1b82f76547b6b">FacingDirection::FD_LEFT</a>;</div>
<div class="line"><a id="l02617" name="l02617"></a><span class="lineno"> 2617</span>        }</div>
<div class="line"><a id="l02618" name="l02618"></a><span class="lineno"> 2618</span>    }</div>
<div class="line"><a id="l02619" name="l02619"></a><span class="lineno"> 2619</span> </div>
<div class="line"><a id="l02620" name="l02620"></a><span class="lineno"> 2620</span>    <span class="comment">// Cache creature under cursor</span></div>
<div class="line"><a id="l02621" name="l02621"></a><span class="lineno"> 2621</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> != <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> ) {</div>
<div class="line"><a id="l02622" name="l02622"></a><span class="lineno"> 2622</span>        <a class="code hl_class" href="classCreature.html">Creature</a> *cr = <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;critter_at( <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a>, <span class="keyword">true</span> );</div>
<div class="line"><a id="l02623" name="l02623"></a><span class="lineno"> 2623</span>        <span class="keywordflow">if</span>( cr &amp;&amp; <a class="code hl_function" href="ranged_8cpp.html#a7c4d782d03c3f30e5b3332260ded8951">pl_sees</a>( *cr ) ) {</div>
<div class="line"><a id="l02624" name="l02624"></a><span class="lineno"> 2624</span>            <a class="code hl_variable" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> = cr;</div>
<div class="line"><a id="l02625" name="l02625"></a><span class="lineno"> 2625</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02626" name="l02626"></a><span class="lineno"> 2626</span>            <a class="code hl_variable" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l02627" name="l02627"></a><span class="lineno"> 2627</span>        }</div>
<div class="line"><a id="l02628" name="l02628"></a><span class="lineno"> 2628</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02629" name="l02629"></a><span class="lineno"> 2629</span>        <a class="code hl_variable" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l02630" name="l02630"></a><span class="lineno"> 2630</span>    }</div>
<div class="line"><a id="l02631" name="l02631"></a><span class="lineno"> 2631</span> </div>
<div class="line"><a id="l02632" name="l02632"></a><span class="lineno"> 2632</span>    <span class="comment">// Update mode-specific stuff</span></div>
<div class="line"><a id="l02633" name="l02633"></a><span class="lineno"> 2633</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> ) {</div>
<div class="line"><a id="l02634" name="l02634"></a><span class="lineno"> 2634</span>        <a class="code hl_function" href="classtarget__ui.html#a1403890979533cd6ea29897e3ee81ab5">recalc_aim_turning_penalty</a>();</div>
<div class="line"><a id="l02635" name="l02635"></a><span class="lineno"> 2635</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd">TargetMode::Spell</a> ) {</div>
<div class="line"><a id="l02636" name="l02636"></a><span class="lineno"> 2636</span>        <span class="keyword">const</span> std::string fx = <a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code hl_function" href="classspell.html#aa34fc8ebf8b820ac055f4b4dd9d78c35">effect</a>();</div>
<div class="line"><a id="l02637" name="l02637"></a><span class="lineno"> 2637</span>        <span class="keywordflow">if</span>( fx == <span class="stringliteral">&quot;target_attack&quot;</span> || fx == <span class="stringliteral">&quot;projectile_attack&quot;</span> || fx == <span class="stringliteral">&quot;ter_transform&quot;</span> ) {</div>
<div class="line"><a id="l02638" name="l02638"></a><span class="lineno"> 2638</span>            <a class="code hl_variable" href="classtarget__ui.html#ab855722580bd112ef0590b5a9b4f3556">spell_aoe</a> = <a class="code hl_function" href="namespacespell__effect.html#aeba26a51ccbe0af305962188ede8c6cd">spell_effect::spell_effect_blast</a>( *<a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>, <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a>, <a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code hl_function" href="classspell.html#a004decbbde4de635b4e652acff65eb8e">aoe</a>(), <span class="keyword">true</span> );</div>
<div class="line"><a id="l02639" name="l02639"></a><span class="lineno"> 2639</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fx == <span class="stringliteral">&quot;cone_attack&quot;</span> ) {</div>
<div class="line"><a id="l02640" name="l02640"></a><span class="lineno"> 2640</span>            <a class="code hl_variable" href="classtarget__ui.html#ab855722580bd112ef0590b5a9b4f3556">spell_aoe</a> = <a class="code hl_function" href="namespacespell__effect.html#a0e09e84c2b7a257a455b3e9fc3593b4b">spell_effect::spell_effect_cone</a>( *<a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>, <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a>, <a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code hl_function" href="classspell.html#a004decbbde4de635b4e652acff65eb8e">aoe</a>(), <span class="keyword">true</span> );</div>
<div class="line"><a id="l02641" name="l02641"></a><span class="lineno"> 2641</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fx == <span class="stringliteral">&quot;line_attack&quot;</span> ) {</div>
<div class="line"><a id="l02642" name="l02642"></a><span class="lineno"> 2642</span>            <a class="code hl_variable" href="classtarget__ui.html#ab855722580bd112ef0590b5a9b4f3556">spell_aoe</a> = <a class="code hl_function" href="namespacespell__effect.html#aa36a2d7d3cb5678aa8b0eb00c0ba7c0d">spell_effect::spell_effect_line</a>( *<a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>, <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a>, <a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code hl_function" href="classspell.html#a004decbbde4de635b4e652acff65eb8e">aoe</a>(), <span class="keyword">true</span> );</div>
<div class="line"><a id="l02643" name="l02643"></a><span class="lineno"> 2643</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02644" name="l02644"></a><span class="lineno"> 2644</span>            <a class="code hl_variable" href="classtarget__ui.html#ab855722580bd112ef0590b5a9b4f3556">spell_aoe</a>.clear();</div>
<div class="line"><a id="l02645" name="l02645"></a><span class="lineno"> 2645</span>        }</div>
<div class="line"><a id="l02646" name="l02646"></a><span class="lineno"> 2646</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">TargetMode::Turrets</a> ) {</div>
<div class="line"><a id="l02647" name="l02647"></a><span class="lineno"> 2647</span>        <a class="code hl_function" href="classtarget__ui.html#aa955ab0c7cfbd2c8c5d439f5aed608ef">update_turrets_in_range</a>();</div>
<div class="line"><a id="l02648" name="l02648"></a><span class="lineno"> 2648</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a880c1273b27d27cfc82004c3a4b205c9">TargetMode::Shape</a> ) {</div>
<div class="line"><a id="l02649" name="l02649"></a><span class="lineno"> 2649</span>        std::shared_ptr&lt;shape&gt; sh = <a class="code hl_variable" href="classtarget__ui.html#a2f93a66a18420fd252e275a9c6f536d4">shape_gen</a>-&gt;create( <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> );</div>
<div class="line"><a id="l02650" name="l02650"></a><span class="lineno"> 2650</span>        <a class="code hl_struct" href="structprojectile.html">projectile</a> proj = <a class="code hl_function" href="ranged_8cpp.html#ab0db3d2d826960249b5a1d47fa7881ff">make_gun_projectile</a>( *<a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a> );</div>
<div class="line"><a id="l02651" name="l02651"></a><span class="lineno"> 2651</span>        <span class="comment">// Same as in map::shoot (should probably be a function!)</span></div>
<div class="line"><a id="l02652" name="l02652"></a><span class="lineno"> 2652</span>        <span class="keywordtype">int</span> expected_bash_force = std::accumulate( proj.<a class="code hl_variable" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a>.<a class="code hl_function" href="structdamage__instance.html#a9fecfb3aaaa2d93dc882893cf9a71e2e">begin</a>(), proj.<a class="code hl_variable" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a>.<a class="code hl_function" href="structdamage__instance.html#a17fd21018ff56a2bd330302c1ec1bc77">end</a>(), 0.0,</div>
<div class="line"><a id="l02653" name="l02653"></a><span class="lineno"> 2653</span>        []( <span class="keywordtype">double</span> acc, <span class="keyword">const</span> <a class="code hl_struct" href="structdamage__unit.html">damage_unit</a> &amp; du ) {</div>
<div class="line"><a id="l02654" name="l02654"></a><span class="lineno"> 2654</span>            return acc + du.amount + du.res_pen;</div>
<div class="line"><a id="l02655" name="l02655"></a><span class="lineno"> 2655</span>        } );</div>
<div class="line"><a id="l02656" name="l02656"></a><span class="lineno"> 2656</span>        <a class="code hl_variable" href="classtarget__ui.html#a6f2c970f904d7b8c06e403dbc4560f4d">shape_coverage</a> = <a class="code hl_function" href="namespaceranged.html#a7b4da33d1d9391123845f299f1f156dc">ranged::expected_coverage</a>( *sh, here, expected_bash_force );</div>
<div class="line"><a id="l02657" name="l02657"></a><span class="lineno"> 2657</span>    }</div>
<div class="line"><a id="l02658" name="l02658"></a><span class="lineno"> 2658</span> </div>
<div class="line"><a id="l02659" name="l02659"></a><span class="lineno"> 2659</span>    <span class="comment">// Update UI controls &amp; colors</span></div>
<div class="line"><a id="l02660" name="l02660"></a><span class="lineno"> 2660</span>    <a class="code hl_function" href="classtarget__ui.html#ad1e40f0212d403109c8969d7308e493f">update_status</a>();</div>
<div class="line"><a id="l02661" name="l02661"></a><span class="lineno"> 2661</span> </div>
<div class="line"><a id="l02662" name="l02662"></a><span class="lineno"> 2662</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02663" name="l02663"></a><span class="lineno"> 2663</span>}</div>
<div class="line"><a id="l02664" name="l02664"></a><span class="lineno"> 2664</span> </div>
<div class="line"><a id="l02665" name="l02665"></a><span class="lineno"><a class="line" href="classtarget__ui.html#aaf459ec49ad96c44eddeb94d0c22fb36"> 2665</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#aaf459ec49ad96c44eddeb94d0c22fb36">target_ui::on_range_ammo_changed</a>()</div>
<div class="line"><a id="l02666" name="l02666"></a><span class="lineno"> 2666</span>{</div>
<div class="line"><a id="l02667" name="l02667"></a><span class="lineno"> 2667</span>    <a class="code hl_function" href="classtarget__ui.html#ad1e40f0212d403109c8969d7308e493f">update_status</a>();</div>
<div class="line"><a id="l02668" name="l02668"></a><span class="lineno"> 2668</span>    <a class="code hl_function" href="classtarget__ui.html#af17fecf6fc24afc0a1af11ee1447b39a">update_target_list</a>();</div>
<div class="line"><a id="l02669" name="l02669"></a><span class="lineno"> 2669</span>}</div>
<div class="line"><a id="l02670" name="l02670"></a><span class="lineno"> 2670</span> </div>
<div class="line"><a id="l02671" name="l02671"></a><span class="lineno"><a class="line" href="classtarget__ui.html#af17fecf6fc24afc0a1af11ee1447b39a"> 2671</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#af17fecf6fc24afc0a1af11ee1447b39a">target_ui::update_target_list</a>()</div>
<div class="line"><a id="l02672" name="l02672"></a><span class="lineno"> 2672</span>{</div>
<div class="line"><a id="l02673" name="l02673"></a><span class="lineno"> 2673</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> == 0 ) {</div>
<div class="line"><a id="l02674" name="l02674"></a><span class="lineno"> 2674</span>        <a class="code hl_variable" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.clear();</div>
<div class="line"><a id="l02675" name="l02675"></a><span class="lineno"> 2675</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02676" name="l02676"></a><span class="lineno"> 2676</span>    }</div>
<div class="line"><a id="l02677" name="l02677"></a><span class="lineno"> 2677</span> </div>
<div class="line"><a id="l02678" name="l02678"></a><span class="lineno"> 2678</span>    <span class="comment">// Get targets in range and sort them by distance (targets[0] is the closest)</span></div>
<div class="line"><a id="l02679" name="l02679"></a><span class="lineno"> 2679</span> </div>
<div class="line"><a id="l02680" name="l02680"></a><span class="lineno"> 2680</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70">TargetMode::TurretManual</a> ) {</div>
<div class="line"><a id="l02681" name="l02681"></a><span class="lineno"> 2681</span>        <a class="code hl_variable" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a> = <a class="code hl_function" href="namespaceranged.html#a3fc846128cfc30100d71fbb6e2d482c5">ranged::targetable_creatures</a>( *<a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>, <a class="code hl_variable" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a>, *<a class="code hl_variable" href="classtarget__ui.html#ae9e40adc2b44c3cd4cdbcc62dd8a1e30">turret</a> );</div>
<div class="line"><a id="l02682" name="l02682"></a><span class="lineno"> 2682</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02683" name="l02683"></a><span class="lineno"> 2683</span>        <a class="code hl_variable" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a> = <a class="code hl_function" href="namespaceranged.html#a3fc846128cfc30100d71fbb6e2d482c5">ranged::targetable_creatures</a>( *<a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>, <a class="code hl_variable" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> );</div>
<div class="line"><a id="l02684" name="l02684"></a><span class="lineno"> 2684</span>    }</div>
<div class="line"><a id="l02685" name="l02685"></a><span class="lineno"> 2685</span> </div>
<div class="line"><a id="l02686" name="l02686"></a><span class="lineno"> 2686</span>    std::sort( <a class="code hl_variable" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.begin(), <a class="code hl_variable" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.end(), [&amp;]( <span class="keyword">const</span> <a class="code hl_class" href="classCreature.html">Creature</a> * lhs, <span class="keyword">const</span> <a class="code hl_class" href="classCreature.html">Creature</a> * rhs ) {</div>
<div class="line"><a id="l02687" name="l02687"></a><span class="lineno"> 2687</span>        return rl_dist_exact( lhs-&gt;pos(), you-&gt;pos() ) &lt; rl_dist_exact( rhs-&gt;pos(), you-&gt;pos() );</div>
<div class="line"><a id="l02688" name="l02688"></a><span class="lineno"> 2688</span>    } );</div>
<div class="line"><a id="l02689" name="l02689"></a><span class="lineno"> 2689</span>}</div>
<div class="line"><a id="l02690" name="l02690"></a><span class="lineno"> 2690</span> </div>
<div class="line"><a id="l02691" name="l02691"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a1591b490e9f8d48547b108ae481f982e"> 2691</a></span><a class="code hl_struct" href="structtripoint.html">tripoint</a> <a class="code hl_function" href="classtarget__ui.html#a1591b490e9f8d48547b108ae481f982e">target_ui::choose_initial_target</a>()</div>
<div class="line"><a id="l02692" name="l02692"></a><span class="lineno"> 2692</span>{</div>
<div class="line"><a id="l02693" name="l02693"></a><span class="lineno"> 2693</span>    <span class="comment">// Try previously targeted creature</span></div>
<div class="line"><a id="l02694" name="l02694"></a><span class="lineno"> 2694</span>    <a class="code hl_typedef" href="memory__fast_8h.html#ada897699f31fc8b37c5af09d95d45840">shared_ptr_fast&lt;Creature&gt;</a> cr = <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classplayer.html#ab679d40f5584e38a6af33bcd7e3c102d">last_target</a>.lock();</div>
<div class="line"><a id="l02695" name="l02695"></a><span class="lineno"> 2695</span>    <span class="keywordflow">if</span>( cr &amp;&amp; <a class="code hl_function" href="ranged_8cpp.html#a7c4d782d03c3f30e5b3332260ded8951">pl_sees</a>( *cr ) &amp;&amp; <a class="code hl_function" href="classtarget__ui.html#ab236848678058afb7605e6d82a5c8fa9">dist_fn</a>( cr-&gt;pos() ) &lt;= <a class="code hl_variable" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> ) {</div>
<div class="line"><a id="l02696" name="l02696"></a><span class="lineno"> 2696</span>        <span class="keywordflow">return</span> cr-&gt;pos();</div>
<div class="line"><a id="l02697" name="l02697"></a><span class="lineno"> 2697</span>    }</div>
<div class="line"><a id="l02698" name="l02698"></a><span class="lineno"> 2698</span> </div>
<div class="line"><a id="l02699" name="l02699"></a><span class="lineno"> 2699</span>    <span class="comment">// Try closest creature</span></div>
<div class="line"><a id="l02700" name="l02700"></a><span class="lineno"> 2700</span>    <span class="keywordflow">if</span>( !<a class="code hl_variable" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.empty() ) {</div>
<div class="line"><a id="l02701" name="l02701"></a><span class="lineno"> 2701</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>[0]-&gt;pos();</div>
<div class="line"><a id="l02702" name="l02702"></a><span class="lineno"> 2702</span>    }</div>
<div class="line"><a id="l02703" name="l02703"></a><span class="lineno"> 2703</span> </div>
<div class="line"><a id="l02704" name="l02704"></a><span class="lineno"> 2704</span>    <span class="comment">// Try closest practice target</span></div>
<div class="line"><a id="l02705" name="l02705"></a><span class="lineno"> 2705</span>    <a class="code hl_class" href="classmap.html">map</a> &amp;here = <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>();</div>
<div class="line"><a id="l02706" name="l02706"></a><span class="lineno"> 2706</span>    <span class="keyword">const</span> std::vector&lt;tripoint&gt; nearby = <a class="code hl_function" href="coordinates_8h.html#a13a12943d34d5f17e6c3b4e730659fc6">closest_points_first</a>( <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, <a class="code hl_variable" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> );</div>
<div class="line"><a id="l02707" name="l02707"></a><span class="lineno"> 2707</span>    <span class="keyword">const</span> <span class="keyword">auto</span> target_spot = std::find_if( nearby.begin(), nearby.end(),</div>
<div class="line"><a id="l02708" name="l02708"></a><span class="lineno"> 2708</span>    [<span class="keyword">this</span>, &amp;here]( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp; pt ) {</div>
<div class="line"><a id="l02709" name="l02709"></a><span class="lineno"> 2709</span>        return here.tr_at( pt ).id == tr_practice_target &amp;&amp; this-&gt;you-&gt;sees( pt );</div>
<div class="line"><a id="l02710" name="l02710"></a><span class="lineno"> 2710</span>    } );</div>
<div class="line"><a id="l02711" name="l02711"></a><span class="lineno"> 2711</span>    <span class="keywordflow">if</span>( target_spot != nearby.end() ) {</div>
<div class="line"><a id="l02712" name="l02712"></a><span class="lineno"> 2712</span>        <span class="keywordflow">return</span> *target_spot;</div>
<div class="line"><a id="l02713" name="l02713"></a><span class="lineno"> 2713</span>    }</div>
<div class="line"><a id="l02714" name="l02714"></a><span class="lineno"> 2714</span> </div>
<div class="line"><a id="l02715" name="l02715"></a><span class="lineno"> 2715</span>    <span class="comment">// We&#39;ve got nothing.</span></div>
<div class="line"><a id="l02716" name="l02716"></a><span class="lineno"> 2716</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>;</div>
<div class="line"><a id="l02717" name="l02717"></a><span class="lineno"> 2717</span>}</div>
<div class="line"><a id="l02718" name="l02718"></a><span class="lineno"> 2718</span> </div>
<div class="line"><a id="l02719" name="l02719"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a5c885fc69abc2190e1850b7f23601ac2"> 2719</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classtarget__ui.html#a5c885fc69abc2190e1850b7f23601ac2">target_ui::try_reacquire_target</a>( <span class="keywordtype">bool</span> critter, <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;new_dst )</div>
<div class="line"><a id="l02720" name="l02720"></a><span class="lineno"> 2720</span>{</div>
<div class="line"><a id="l02721" name="l02721"></a><span class="lineno"> 2721</span>    <span class="keywordflow">if</span>( critter ) {</div>
<div class="line"><a id="l02722" name="l02722"></a><span class="lineno"> 2722</span>        <span class="comment">// Try to re-acquire the creature</span></div>
<div class="line"><a id="l02723" name="l02723"></a><span class="lineno"> 2723</span>        <a class="code hl_typedef" href="memory__fast_8h.html#ada897699f31fc8b37c5af09d95d45840">shared_ptr_fast&lt;Creature&gt;</a> cr = <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classplayer.html#ab679d40f5584e38a6af33bcd7e3c102d">last_target</a>.lock();</div>
<div class="line"><a id="l02724" name="l02724"></a><span class="lineno"> 2724</span>        <span class="keywordflow">if</span>( cr &amp;&amp; <a class="code hl_function" href="ranged_8cpp.html#a7c4d782d03c3f30e5b3332260ded8951">pl_sees</a>( *cr ) &amp;&amp; <a class="code hl_function" href="classtarget__ui.html#ab236848678058afb7605e6d82a5c8fa9">dist_fn</a>( cr-&gt;pos() ) &lt;= <a class="code hl_variable" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> ) {</div>
<div class="line"><a id="l02725" name="l02725"></a><span class="lineno"> 2725</span>            new_dst = cr-&gt;pos();</div>
<div class="line"><a id="l02726" name="l02726"></a><span class="lineno"> 2726</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02727" name="l02727"></a><span class="lineno"> 2727</span>        }</div>
<div class="line"><a id="l02728" name="l02728"></a><span class="lineno"> 2728</span>    }</div>
<div class="line"><a id="l02729" name="l02729"></a><span class="lineno"> 2729</span> </div>
<div class="line"><a id="l02730" name="l02730"></a><span class="lineno"> 2730</span>    <span class="keywordflow">if</span>( !<a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classplayer.html#a9aac4afb832dc4762430b0b3545cbfea">last_target_pos</a>.has_value() ) {</div>
<div class="line"><a id="l02731" name="l02731"></a><span class="lineno"> 2731</span>        <span class="comment">// This shouldn&#39;t happen</span></div>
<div class="line"><a id="l02732" name="l02732"></a><span class="lineno"> 2732</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02733" name="l02733"></a><span class="lineno"> 2733</span>    }</div>
<div class="line"><a id="l02734" name="l02734"></a><span class="lineno"> 2734</span> </div>
<div class="line"><a id="l02735" name="l02735"></a><span class="lineno"> 2735</span>    <span class="comment">// Try to re-acquire target tile or tile where the target creature used to be</span></div>
<div class="line"><a id="l02736" name="l02736"></a><span class="lineno"> 2736</span>    <a class="code hl_struct" href="structtripoint.html">tripoint</a> local_lt = <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>().<a class="code hl_function" href="classmap.html#a426c21f7244ff80a61685a89e9146fec">getlocal</a>( *<a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classplayer.html#a9aac4afb832dc4762430b0b3545cbfea">last_target_pos</a> );</div>
<div class="line"><a id="l02737" name="l02737"></a><span class="lineno"> 2737</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="classtarget__ui.html#ab236848678058afb7605e6d82a5c8fa9">dist_fn</a>( local_lt ) &lt;= <a class="code hl_variable" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> ) {</div>
<div class="line"><a id="l02738" name="l02738"></a><span class="lineno"> 2738</span>        new_dst = local_lt;</div>
<div class="line"><a id="l02739" name="l02739"></a><span class="lineno"> 2739</span>        <span class="comment">// Abort aiming if a creature moved in</span></div>
<div class="line"><a id="l02740" name="l02740"></a><span class="lineno"> 2740</span>        <span class="keywordflow">return</span> !critter &amp;&amp; !<a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;critter_at( local_lt, <span class="keyword">true</span> );</div>
<div class="line"><a id="l02741" name="l02741"></a><span class="lineno"> 2741</span>    }</div>
<div class="line"><a id="l02742" name="l02742"></a><span class="lineno"> 2742</span> </div>
<div class="line"><a id="l02743" name="l02743"></a><span class="lineno"> 2743</span>    <span class="comment">// We moved out of range</span></div>
<div class="line"><a id="l02744" name="l02744"></a><span class="lineno"> 2744</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02745" name="l02745"></a><span class="lineno"> 2745</span>}</div>
<div class="line"><a id="l02746" name="l02746"></a><span class="lineno"> 2746</span> </div>
<div class="line"><a id="l02747" name="l02747"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ad1e40f0212d403109c8969d7308e493f"> 2747</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#ad1e40f0212d403109c8969d7308e493f">target_ui::update_status</a>()</div>
<div class="line"><a id="l02748" name="l02748"></a><span class="lineno"> 2748</span>{</div>
<div class="line"><a id="l02749" name="l02749"></a><span class="lineno"> 2749</span>    std::vector&lt;std::string&gt; msgbuf;</div>
<div class="line"><a id="l02750" name="l02750"></a><span class="lineno"> 2750</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">TargetMode::Turrets</a> &amp;&amp; <a class="code hl_variable" href="classtarget__ui.html#ae8d4216fdc3f48ee8f6dd5f22c33d9d9">turrets_in_range</a>.empty() ) {</div>
<div class="line"><a id="l02751" name="l02751"></a><span class="lineno"> 2751</span>        <span class="comment">// None of the turrets are in range</span></div>
<div class="line"><a id="l02752" name="l02752"></a><span class="lineno"> 2752</span>        <a class="code hl_variable" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> = <a class="code hl_enumvalue" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a365b2699d38b61ef4b4c8a1066c8468f">Status::OutOfRange</a>;</div>
<div class="line"><a id="l02753" name="l02753"></a><span class="lineno"> 2753</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> &amp;&amp;</div>
<div class="line"><a id="l02754" name="l02754"></a><span class="lineno"> 2754</span>               ( !<a class="code hl_function" href="namespaceranged.html#aed4420a1fd77e160a72de2a528e56da5">ranged::gunmode_checks_common</a>( *<a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>, <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>(), msgbuf, <a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code hl_function" href="classitem.html#a1a94ea108d695febf7f2bcf090f097fa">gun_current_mode</a>() ) ||</div>
<div class="line"><a id="l02755" name="l02755"></a><span class="lineno"> 2755</span>                 !<a class="code hl_function" href="namespaceranged.html#a743f9e35b20c136e56ca9e9480fb27bc">ranged::gunmode_checks_weapon</a>( *<a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>, <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>(), msgbuf, <a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code hl_function" href="classitem.html#a1a94ea108d695febf7f2bcf090f097fa">gun_current_mode</a>() ) ) ) {</div>
<div class="line"><a id="l02756" name="l02756"></a><span class="lineno"> 2756</span>        <span class="comment">// Selected gun mode is empty</span></div>
<div class="line"><a id="l02757" name="l02757"></a><span class="lineno"> 2757</span>        <span class="comment">// TODO: it might be some other error, but that&#39;s highly unlikely to happen, so a catch-all &#39;Out of ammo&#39; is fine</span></div>
<div class="line"><a id="l02758" name="l02758"></a><span class="lineno"> 2758</span>        <a class="code hl_variable" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> = <a class="code hl_enumvalue" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202aaa5b08f858f7353c5d012d6706525773">Status::OutOfAmmo</a>;</div>
<div class="line"><a id="l02759" name="l02759"></a><span class="lineno"> 2759</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70">TargetMode::TurretManual</a> &amp;&amp; ( <a class="code hl_variable" href="classtarget__ui.html#ae9e40adc2b44c3cd4cdbcc62dd8a1e30">turret</a>-&gt;<a class="code hl_function" href="classturret__data.html#a585d18f2c33116bc1e9028210fccadbc">query</a>() != <a class="code hl_enumvalue" href="classturret__data.html#aa11f464b221b987d03a8859293e07ab6ab2fdab230a2c39f3595a947861863cb7">turret_data::status::ready</a> ||</div>
<div class="line"><a id="l02760" name="l02760"></a><span class="lineno"> 2760</span>               !<a class="code hl_function" href="namespaceranged.html#aed4420a1fd77e160a72de2a528e56da5">ranged::gunmode_checks_common</a>( *<a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>, <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>(), msgbuf, <a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code hl_function" href="classitem.html#a1a94ea108d695febf7f2bcf090f097fa">gun_current_mode</a>() ) ) ) {</div>
<div class="line"><a id="l02761" name="l02761"></a><span class="lineno"> 2761</span>        <a class="code hl_variable" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> = <a class="code hl_enumvalue" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202aaa5b08f858f7353c5d012d6706525773">Status::OutOfAmmo</a>;</div>
<div class="line"><a id="l02762" name="l02762"></a><span class="lineno"> 2762</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( ( <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> == <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> ) &amp;&amp; !( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd">TargetMode::Spell</a> &amp;&amp;</div>
<div class="line"><a id="l02763" name="l02763"></a><span class="lineno"> 2763</span>                                    <a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code hl_function" href="classspell.html#adc1aee8fd855fce28ebb1dcc39e37a12">is_valid_target</a>( <a class="code hl_enumvalue" href="magic_8h.html#ae9e507f7e02f759a1668864b8a46ae26aa5892df376122d8cc2f5f705351e4a44">valid_target::target_self</a> ) ) ) {</div>
<div class="line"><a id="l02764" name="l02764"></a><span class="lineno"> 2764</span>        <span class="comment">// TODO: consider allowing targeting yourself with turrets</span></div>
<div class="line"><a id="l02765" name="l02765"></a><span class="lineno"> 2765</span>        <a class="code hl_variable" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> = <a class="code hl_enumvalue" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a45c9ef8264639e178f18806be2b9a408">Status::BadTarget</a>;</div>
<div class="line"><a id="l02766" name="l02766"></a><span class="lineno"> 2766</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_function" href="classtarget__ui.html#ab236848678058afb7605e6d82a5c8fa9">dist_fn</a>( <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> ) &gt; <a class="code hl_variable" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> ) {</div>
<div class="line"><a id="l02767" name="l02767"></a><span class="lineno"> 2767</span>        <span class="comment">// We&#39;re out of range. This can happen if we switch from long-ranged</span></div>
<div class="line"><a id="l02768" name="l02768"></a><span class="lineno"> 2768</span>        <span class="comment">// gun mode to short-ranged. We can, of course, move the cursor into range automatically,</span></div>
<div class="line"><a id="l02769" name="l02769"></a><span class="lineno"> 2769</span>        <span class="comment">// but that would be rude. Instead, wait for directional keys/etc. and *then* move the cursor.</span></div>
<div class="line"><a id="l02770" name="l02770"></a><span class="lineno"> 2770</span>        <a class="code hl_variable" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> = <a class="code hl_enumvalue" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a365b2699d38b61ef4b4c8a1066c8468f">Status::OutOfRange</a>;</div>
<div class="line"><a id="l02771" name="l02771"></a><span class="lineno"> 2771</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02772" name="l02772"></a><span class="lineno"> 2772</span>        <a class="code hl_variable" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> = <a class="code hl_enumvalue" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a0c6ad70beb3a7e76c3fc7adab7c46acc">Status::Good</a>;</div>
<div class="line"><a id="l02773" name="l02773"></a><span class="lineno"> 2773</span>    }</div>
<div class="line"><a id="l02774" name="l02774"></a><span class="lineno"> 2774</span>}</div>
<div class="line"><a id="l02775" name="l02775"></a><span class="lineno"> 2775</span> </div>
<div class="line"><a id="l02776" name="l02776"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ab236848678058afb7605e6d82a5c8fa9"> 2776</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="classtarget__ui.html#ab236848678058afb7605e6d82a5c8fa9">target_ui::dist_fn</a>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;p )</div>
<div class="line"><a id="l02777" name="l02777"></a><span class="lineno"> 2777</span>{</div>
<div class="line"><a id="l02778" name="l02778"></a><span class="lineno"> 2778</span>    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( std::round( <a class="code hl_function" href="line_8cpp.html#a2d906c9af0b0586f48bc34cff0838817">rl_dist_exact</a>( <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, p ) ) );</div>
<div class="line"><a id="l02779" name="l02779"></a><span class="lineno"> 2779</span>}</div>
<div class="line"><a id="l02780" name="l02780"></a><span class="lineno"> 2780</span> </div>
<div class="line"><a id="l02781" name="l02781"></a><span class="lineno"><a class="line" href="classtarget__ui.html#aa53ba52da62f64baa29130908cf8637b"> 2781</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#aa53ba52da62f64baa29130908cf8637b">target_ui::set_last_target</a>()</div>
<div class="line"><a id="l02782" name="l02782"></a><span class="lineno"> 2782</span>{</div>
<div class="line"><a id="l02783" name="l02783"></a><span class="lineno"> 2783</span>    <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classplayer.html#a9aac4afb832dc4762430b0b3545cbfea">last_target_pos</a> = <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>().<a class="code hl_function" href="classmap.html#a501f3a1d449ac022f1b36b99da653e94">getabs</a>( <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> );</div>
<div class="line"><a id="l02784" name="l02784"></a><span class="lineno"> 2784</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> ) {</div>
<div class="line"><a id="l02785" name="l02785"></a><span class="lineno"> 2785</span>        <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classplayer.html#ab679d40f5584e38a6af33bcd7e3c102d">last_target</a> = <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;shared_from( *<a class="code hl_variable" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> );</div>
<div class="line"><a id="l02786" name="l02786"></a><span class="lineno"> 2786</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02787" name="l02787"></a><span class="lineno"> 2787</span>        <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classplayer.html#ab679d40f5584e38a6af33bcd7e3c102d">last_target</a>.reset();</div>
<div class="line"><a id="l02788" name="l02788"></a><span class="lineno"> 2788</span>    }</div>
<div class="line"><a id="l02789" name="l02789"></a><span class="lineno"> 2789</span>}</div>
<div class="line"><a id="l02790" name="l02790"></a><span class="lineno"> 2790</span> </div>
<div class="line"><a id="l02791" name="l02791"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a97d244cde8cae12d0266daf6fc083014"> 2791</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classtarget__ui.html#a97d244cde8cae12d0266daf6fc083014">target_ui::confirm_non_enemy_target</a>()</div>
<div class="line"><a id="l02792" name="l02792"></a><span class="lineno"> 2792</span>{</div>
<div class="line"><a id="l02793" name="l02793"></a><span class="lineno"> 2793</span>    <a class="code hl_class" href="classnpc.html">npc</a> *<span class="keyword">const</span> who = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classnpc.html">npc</a> *<span class="keyword">&gt;</span>( <a class="code hl_variable" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> );</div>
<div class="line"><a id="l02794" name="l02794"></a><span class="lineno"> 2794</span>    <span class="keywordflow">if</span>( who &amp;&amp; !who-&gt;<a class="code hl_function" href="classnpc.html#adc0b90f197e58b09eb6eb92132d432f0">guaranteed_hostile</a>() ) {</div>
<div class="line"><a id="l02795" name="l02795"></a><span class="lineno"> 2795</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="output_8cpp.html#ab62599a77867b8f416669b92f60f4900">query_yn</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Really attack %s?&quot;</span> ), who-&gt;<a class="code hl_variable" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>.c_str() );</div>
<div class="line"><a id="l02796" name="l02796"></a><span class="lineno"> 2796</span>    }</div>
<div class="line"><a id="l02797" name="l02797"></a><span class="lineno"> 2797</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02798" name="l02798"></a><span class="lineno"> 2798</span>}</div>
<div class="line"><a id="l02799" name="l02799"></a><span class="lineno"> 2799</span> </div>
<div class="line"><a id="l02800" name="l02800"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ad2ca7887fd647df92c825e8ee153ff84"> 2800</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classtarget__ui.html#ad2ca7887fd647df92c825e8ee153ff84">target_ui::prompt_friendlies_in_lof</a>()</div>
<div class="line"><a id="l02801" name="l02801"></a><span class="lineno"> 2801</span>{</div>
<div class="line"><a id="l02802" name="l02802"></a><span class="lineno"> 2802</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> != <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> ) {</div>
<div class="line"><a id="l02803" name="l02803"></a><span class="lineno"> 2803</span>        <a class="code hl_define" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Not implemented&quot;</span> );</div>
<div class="line"><a id="l02804" name="l02804"></a><span class="lineno"> 2804</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02805" name="l02805"></a><span class="lineno"> 2805</span>    }</div>
<div class="line"><a id="l02806" name="l02806"></a><span class="lineno"> 2806</span> </div>
<div class="line"><a id="l02807" name="l02807"></a><span class="lineno"> 2807</span>    std::vector&lt;weak_ptr_fast&lt;Creature&gt;&gt; in_lof = <a class="code hl_function" href="classtarget__ui.html#ac352f6aae1cb28945f8115b76fea2eb6">list_friendlies_in_lof</a>();</div>
<div class="line"><a id="l02808" name="l02808"></a><span class="lineno"> 2808</span>    std::vector&lt;Creature *&gt; new_in_lof;</div>
<div class="line"><a id="l02809" name="l02809"></a><span class="lineno"> 2809</span>    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_typedef" href="memory__fast_8h.html#ab8afe5baa726add2054cce385cad8855">weak_ptr_fast&lt;Creature&gt;</a> &amp;cr_ptr : in_lof ) {</div>
<div class="line"><a id="l02810" name="l02810"></a><span class="lineno"> 2810</span>        <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;</div>
<div class="line"><a id="l02811" name="l02811"></a><span class="lineno"> 2811</span>        <a class="code hl_typedef" href="memory__fast_8h.html#ada897699f31fc8b37c5af09d95d45840">shared_ptr_fast&lt;Creature&gt;</a> ptr_lock = cr_ptr.lock();</div>
<div class="line"><a id="l02812" name="l02812"></a><span class="lineno"> 2812</span>        <a class="code hl_class" href="classCreature.html">Creature</a> *cr = ptr_lock.get();</div>
<div class="line"><a id="l02813" name="l02813"></a><span class="lineno"> 2813</span>        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_typedef" href="memory__fast_8h.html#ab8afe5baa726add2054cce385cad8855">weak_ptr_fast&lt;Creature&gt;</a> &amp;cr2_ptr : <a class="code hl_variable" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code hl_variable" href="classaim__activity__actor.html#a9835661ff059c7c690bf26075417b9b9">acceptable_losses</a> ) {</div>
<div class="line"><a id="l02814" name="l02814"></a><span class="lineno"> 2814</span>            <a class="code hl_typedef" href="memory__fast_8h.html#ada897699f31fc8b37c5af09d95d45840">shared_ptr_fast&lt;Creature&gt;</a> ptr2_lock = cr2_ptr.lock();</div>
<div class="line"><a id="l02815" name="l02815"></a><span class="lineno"> 2815</span>            <a class="code hl_class" href="classCreature.html">Creature</a> *cr2 = ptr2_lock.get();</div>
<div class="line"><a id="l02816" name="l02816"></a><span class="lineno"> 2816</span>            <span class="keywordflow">if</span>( cr == cr2 ) {</div>
<div class="line"><a id="l02817" name="l02817"></a><span class="lineno"> 2817</span>                found = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02818" name="l02818"></a><span class="lineno"> 2818</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02819" name="l02819"></a><span class="lineno"> 2819</span>            }</div>
<div class="line"><a id="l02820" name="l02820"></a><span class="lineno"> 2820</span>        }</div>
<div class="line"><a id="l02821" name="l02821"></a><span class="lineno"> 2821</span>        <span class="keywordflow">if</span>( !found ) {</div>
<div class="line"><a id="l02822" name="l02822"></a><span class="lineno"> 2822</span>            new_in_lof.push_back( cr );</div>
<div class="line"><a id="l02823" name="l02823"></a><span class="lineno"> 2823</span>        }</div>
<div class="line"><a id="l02824" name="l02824"></a><span class="lineno"> 2824</span>    }</div>
<div class="line"><a id="l02825" name="l02825"></a><span class="lineno"> 2825</span> </div>
<div class="line"><a id="l02826" name="l02826"></a><span class="lineno"> 2826</span>    <span class="keywordflow">if</span>( new_in_lof.empty() ) {</div>
<div class="line"><a id="l02827" name="l02827"></a><span class="lineno"> 2827</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02828" name="l02828"></a><span class="lineno"> 2828</span>    }</div>
<div class="line"><a id="l02829" name="l02829"></a><span class="lineno"> 2829</span> </div>
<div class="line"><a id="l02830" name="l02830"></a><span class="lineno"> 2830</span>    std::string msg = <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;There are friendly creatures in line of fire:\n&quot;</span> );</div>
<div class="line"><a id="l02831" name="l02831"></a><span class="lineno"> 2831</span>    <span class="keywordflow">for</span>( <a class="code hl_class" href="classCreature.html">Creature</a> *cr : new_in_lof ) {</div>
<div class="line"><a id="l02832" name="l02832"></a><span class="lineno"> 2832</span>        msg += <span class="stringliteral">&quot;  &quot;</span> + cr-&gt;disp_name() + <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a id="l02833" name="l02833"></a><span class="lineno"> 2833</span>    }</div>
<div class="line"><a id="l02834" name="l02834"></a><span class="lineno"> 2834</span>    msg += <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Proceed with the attack?&quot;</span> );</div>
<div class="line"><a id="l02835" name="l02835"></a><span class="lineno"> 2835</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="output_8cpp.html#ab62599a77867b8f416669b92f60f4900">query_yn</a>( msg );</div>
<div class="line"><a id="l02836" name="l02836"></a><span class="lineno"> 2836</span>}</div>
<div class="line"><a id="l02837" name="l02837"></a><span class="lineno"> 2837</span> </div>
<div class="line"><a id="l02838" name="l02838"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ac352f6aae1cb28945f8115b76fea2eb6"> 2838</a></span>std::vector&lt;weak_ptr_fast&lt;Creature&gt;&gt; <a class="code hl_function" href="classtarget__ui.html#ac352f6aae1cb28945f8115b76fea2eb6">target_ui::list_friendlies_in_lof</a>()</div>
<div class="line"><a id="l02839" name="l02839"></a><span class="lineno"> 2839</span>{</div>
<div class="line"><a id="l02840" name="l02840"></a><span class="lineno"> 2840</span>    std::vector&lt;weak_ptr_fast&lt;Creature&gt;&gt; <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>;</div>
<div class="line"><a id="l02841" name="l02841"></a><span class="lineno"> 2841</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">TargetMode::Turrets</a> || <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd">TargetMode::Spell</a> ) {</div>
<div class="line"><a id="l02842" name="l02842"></a><span class="lineno"> 2842</span>        <a class="code hl_define" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Not implemented&quot;</span> );</div>
<div class="line"><a id="l02843" name="l02843"></a><span class="lineno"> 2843</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>;</div>
<div class="line"><a id="l02844" name="l02844"></a><span class="lineno"> 2844</span>    }</div>
<div class="line"><a id="l02845" name="l02845"></a><span class="lineno"> 2845</span>    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;p : <a class="code hl_variable" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">traj</a> ) {</div>
<div class="line"><a id="l02846" name="l02846"></a><span class="lineno"> 2846</span>        <span class="keywordflow">if</span>( p != <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> &amp;&amp; p != <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> ) {</div>
<div class="line"><a id="l02847" name="l02847"></a><span class="lineno"> 2847</span>            <a class="code hl_class" href="classCreature.html">Creature</a> *cr = <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;critter_at( p, <span class="keyword">true</span> );</div>
<div class="line"><a id="l02848" name="l02848"></a><span class="lineno"> 2848</span>            <span class="keywordflow">if</span>( cr &amp;&amp; <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_function" href="classCharacter.html#aba9bd7517b334e6ed4149889ed32377a">sees</a>( *cr ) ) {</div>
<div class="line"><a id="l02849" name="l02849"></a><span class="lineno"> 2849</span>                <a class="code hl_enumeration" href="classCreature.html#a8a475630b3289c468bd06cf114008217">Creature::Attitude</a> <a class="code hl_variable" href="magic_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a> = cr-&gt;<a class="code hl_function" href="classCreature.html#a5698402eb4d7bbb013213f11f5768c92">attitude_to</a>( *this-&gt;<a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a> );</div>
<div class="line"><a id="l02850" name="l02850"></a><span class="lineno"> 2850</span>                <span class="keywordflow">if</span>(</div>
<div class="line"><a id="l02851" name="l02851"></a><span class="lineno"> 2851</span>                    ( cr-&gt;<a class="code hl_function" href="classCreature.html#aed84fe52e1335d48d53f482f8a278c87">is_npc</a>() &amp;&amp; <a class="code hl_variable" href="magic_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a> != <a class="code hl_enumvalue" href="classCreature.html#a8a475630b3289c468bd06cf114008217a8972817fc4b645a5fee948a7ab4d3cc2">Creature::A_HOSTILE</a> ) ||</div>
<div class="line"><a id="l02852" name="l02852"></a><span class="lineno"> 2852</span>                    ( !cr-&gt;<a class="code hl_function" href="classCreature.html#aed84fe52e1335d48d53f482f8a278c87">is_npc</a>() &amp;&amp; <a class="code hl_variable" href="magic_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a> == <a class="code hl_enumvalue" href="classCreature.html#a8a475630b3289c468bd06cf114008217ac45ee12dee5d3dc56de7fe86e4484bea">Creature::A_FRIENDLY</a> )</div>
<div class="line"><a id="l02853" name="l02853"></a><span class="lineno"> 2853</span>                ) {</div>
<div class="line"><a id="l02854" name="l02854"></a><span class="lineno"> 2854</span>                    <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.push_back( <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;shared_from( *cr ) );</div>
<div class="line"><a id="l02855" name="l02855"></a><span class="lineno"> 2855</span>                }</div>
<div class="line"><a id="l02856" name="l02856"></a><span class="lineno"> 2856</span>            }</div>
<div class="line"><a id="l02857" name="l02857"></a><span class="lineno"> 2857</span>        }</div>
<div class="line"><a id="l02858" name="l02858"></a><span class="lineno"> 2858</span>    }</div>
<div class="line"><a id="l02859" name="l02859"></a><span class="lineno"> 2859</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>;</div>
<div class="line"><a id="l02860" name="l02860"></a><span class="lineno"> 2860</span>}</div>
<div class="line"><a id="l02861" name="l02861"></a><span class="lineno"> 2861</span> </div>
<div class="line"><a id="l02862" name="l02862"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a779bc721417ab8ee4a6b103d8a1030f5"> 2862</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a779bc721417ab8ee4a6b103d8a1030f5">target_ui::toggle_snap_to_target</a>()</div>
<div class="line"><a id="l02863" name="l02863"></a><span class="lineno"> 2863</span>{</div>
<div class="line"><a id="l02864" name="l02864"></a><span class="lineno"> 2864</span>    <a class="code hl_variable" href="classtarget__ui.html#a122323ec4c1e72c291e76643ccfd3fde">shifting_view</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l02865" name="l02865"></a><span class="lineno"> 2865</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a270f72c5bfef55a533d3cd9b3cf57ea0">snap_to_target</a> ) {</div>
<div class="line"><a id="l02866" name="l02866"></a><span class="lineno"> 2866</span>        <span class="comment">// Keep current view offset</span></div>
<div class="line"><a id="l02867" name="l02867"></a><span class="lineno"> 2867</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02868" name="l02868"></a><span class="lineno"> 2868</span>        <a class="code hl_function" href="classtarget__ui.html#abcb5ba4fec5983a480a4f765da7abe23">set_view_offset</a>( <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> - <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> );</div>
<div class="line"><a id="l02869" name="l02869"></a><span class="lineno"> 2869</span>    }</div>
<div class="line"><a id="l02870" name="l02870"></a><span class="lineno"> 2870</span>    <a class="code hl_variable" href="classtarget__ui.html#a270f72c5bfef55a533d3cd9b3cf57ea0">snap_to_target</a> = !<a class="code hl_variable" href="classtarget__ui.html#a270f72c5bfef55a533d3cd9b3cf57ea0">snap_to_target</a>;</div>
<div class="line"><a id="l02871" name="l02871"></a><span class="lineno"> 2871</span>}</div>
<div class="line"><a id="l02872" name="l02872"></a><span class="lineno"> 2872</span> </div>
<div class="line"><a id="l02873" name="l02873"></a><span class="lineno"><a class="line" href="classtarget__ui.html#af007dd5fcc266ee10d673299ca90c29c"> 2873</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#af007dd5fcc266ee10d673299ca90c29c">target_ui::cycle_targets</a>( <span class="keywordtype">int</span> <a class="code hl_enumeration" href="line_8h.html#a3621d2006812bd84f3ed6999b38f90a3">direction</a> )</div>
<div class="line"><a id="l02874" name="l02874"></a><span class="lineno"> 2874</span>{</div>
<div class="line"><a id="l02875" name="l02875"></a><span class="lineno"> 2875</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.empty() ) {</div>
<div class="line"><a id="l02876" name="l02876"></a><span class="lineno"> 2876</span>        <span class="comment">// Nothing to cycle</span></div>
<div class="line"><a id="l02877" name="l02877"></a><span class="lineno"> 2877</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02878" name="l02878"></a><span class="lineno"> 2878</span>    }</div>
<div class="line"><a id="l02879" name="l02879"></a><span class="lineno"> 2879</span> </div>
<div class="line"><a id="l02880" name="l02880"></a><span class="lineno"> 2880</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> ) {</div>
<div class="line"><a id="l02881" name="l02881"></a><span class="lineno"> 2881</span>        <span class="keyword">auto</span> t = <a class="code hl_function" href="namespacedetail.html#ad06b74f7502b63cbab323bba1ca3f72b">std::find</a>( <a class="code hl_variable" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.begin(), <a class="code hl_variable" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.end(), <a class="code hl_variable" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> );</div>
<div class="line"><a id="l02882" name="l02882"></a><span class="lineno"> 2882</span>        <span class="keywordtype">size_t</span> new_target = 0;</div>
<div class="line"><a id="l02883" name="l02883"></a><span class="lineno"> 2883</span>        <span class="keywordflow">if</span>( t != <a class="code hl_variable" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.end() ) {</div>
<div class="line"><a id="l02884" name="l02884"></a><span class="lineno"> 2884</span>            <span class="keywordtype">size_t</span> idx = std::distance( <a class="code hl_variable" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.begin(), t );</div>
<div class="line"><a id="l02885" name="l02885"></a><span class="lineno"> 2885</span>            new_target = ( idx + <a class="code hl_variable" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.size() + <a class="code hl_enumeration" href="line_8h.html#a3621d2006812bd84f3ed6999b38f90a3">direction</a> ) % <a class="code hl_variable" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.size();</div>
<div class="line"><a id="l02886" name="l02886"></a><span class="lineno"> 2886</span>            <a class="code hl_function" href="classtarget__ui.html#a3ead422f4a78394c13bc3f4c6c953f42">set_cursor_pos</a>( <a class="code hl_variable" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>[new_target]-&gt;pos() );</div>
<div class="line"><a id="l02887" name="l02887"></a><span class="lineno"> 2887</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02888" name="l02888"></a><span class="lineno"> 2888</span>        }</div>
<div class="line"><a id="l02889" name="l02889"></a><span class="lineno"> 2889</span>    }</div>
<div class="line"><a id="l02890" name="l02890"></a><span class="lineno"> 2890</span> </div>
<div class="line"><a id="l02891" name="l02891"></a><span class="lineno"> 2891</span>    <span class="comment">// There is either no creature under the cursor or the player can&#39;t see it.</span></div>
<div class="line"><a id="l02892" name="l02892"></a><span class="lineno"> 2892</span>    <span class="comment">// Use the closest/farthest target in this case</span></div>
<div class="line"><a id="l02893" name="l02893"></a><span class="lineno"> 2893</span>    <span class="keywordflow">if</span>( <a class="code hl_enumeration" href="line_8h.html#a3621d2006812bd84f3ed6999b38f90a3">direction</a> == 1 ) {</div>
<div class="line"><a id="l02894" name="l02894"></a><span class="lineno"> 2894</span>        <a class="code hl_function" href="classtarget__ui.html#a3ead422f4a78394c13bc3f4c6c953f42">set_cursor_pos</a>( <a class="code hl_variable" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.front()-&gt;pos() );</div>
<div class="line"><a id="l02895" name="l02895"></a><span class="lineno"> 2895</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02896" name="l02896"></a><span class="lineno"> 2896</span>        <a class="code hl_function" href="classtarget__ui.html#a3ead422f4a78394c13bc3f4c6c953f42">set_cursor_pos</a>( <a class="code hl_variable" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.back()-&gt;pos() );</div>
<div class="line"><a id="l02897" name="l02897"></a><span class="lineno"> 2897</span>    }</div>
<div class="line"><a id="l02898" name="l02898"></a><span class="lineno"> 2898</span>}</div>
<div class="line"><a id="l02899" name="l02899"></a><span class="lineno"> 2899</span> </div>
<div class="line"><a id="l02900" name="l02900"></a><span class="lineno"><a class="line" href="classtarget__ui.html#abcb5ba4fec5983a480a4f765da7abe23"> 2900</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#abcb5ba4fec5983a480a4f765da7abe23">target_ui::set_view_offset</a>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;new_offset )</div>
<div class="line"><a id="l02901" name="l02901"></a><span class="lineno"> 2901</span>{</div>
<div class="line"><a id="l02902" name="l02902"></a><span class="lineno"> 2902</span>    <a class="code hl_struct" href="structtripoint.html">tripoint</a> new_( new_offset.<a class="code hl_function" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>(), <a class="code hl_function" href="cata__utility_8h.html#ad22b4a043b6eb4c2c06f87f83b720b15">clamp</a>( new_offset.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>, -<a class="code hl_variable" href="cached__options_8cpp.html#a0cb65464a3fa34c1ed5474f5d2d853a7">fov_3d_z_range</a>, <a class="code hl_variable" href="cached__options_8cpp.html#a0cb65464a3fa34c1ed5474f5d2d853a7">fov_3d_z_range</a> ) );</div>
<div class="line"><a id="l02903" name="l02903"></a><span class="lineno"> 2903</span>    new_.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> = <a class="code hl_function" href="cata__utility_8h.html#ad22b4a043b6eb4c2c06f87f83b720b15">clamp</a>( new_.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> + <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>, -<a class="code hl_variable" href="game__constants_8h.html#aad0eacfa516a8f7e005674027d7640fe">OVERMAP_DEPTH</a>, <a class="code hl_variable" href="game__constants_8h.html#a3984a9476d1edc78e4e7b886a08d4d4b">OVERMAP_HEIGHT</a> ) - <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>;</div>
<div class="line"><a id="l02904" name="l02904"></a><span class="lineno"> 2904</span> </div>
<div class="line"><a id="l02905" name="l02905"></a><span class="lineno"> 2905</span>    <span class="keywordtype">bool</span> changed_z = <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classplayer.html#a625b6dd5247589902251e845d07a2154">view_offset</a>.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> != new_.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>;</div>
<div class="line"><a id="l02906" name="l02906"></a><span class="lineno"> 2906</span>    <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classplayer.html#a625b6dd5247589902251e845d07a2154">view_offset</a> = new_;</div>
<div class="line"><a id="l02907" name="l02907"></a><span class="lineno"> 2907</span>    <span class="keywordflow">if</span>( changed_z ) {</div>
<div class="line"><a id="l02908" name="l02908"></a><span class="lineno"> 2908</span>        <span class="comment">// We need to do a bunch of cache updates since we&#39;re</span></div>
<div class="line"><a id="l02909" name="l02909"></a><span class="lineno"> 2909</span>        <span class="comment">// looking at a different z-level.</span></div>
<div class="line"><a id="l02910" name="l02910"></a><span class="lineno"> 2910</span>        <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>().<a class="code hl_function" href="classmap.html#af839ef9ba53f51b09259e0af06881fe6">invalidate_map_cache</a>( new_.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a id="l02911" name="l02911"></a><span class="lineno"> 2911</span>    }</div>
<div class="line"><a id="l02912" name="l02912"></a><span class="lineno"> 2912</span>}</div>
<div class="line"><a id="l02913" name="l02913"></a><span class="lineno"> 2913</span> </div>
<div class="line"><a id="l02914" name="l02914"></a><span class="lineno"><a class="line" href="classtarget__ui.html#aa955ab0c7cfbd2c8c5d439f5aed608ef"> 2914</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#aa955ab0c7cfbd2c8c5d439f5aed608ef">target_ui::update_turrets_in_range</a>()</div>
<div class="line"><a id="l02915" name="l02915"></a><span class="lineno"> 2915</span>{</div>
<div class="line"><a id="l02916" name="l02916"></a><span class="lineno"> 2916</span>    <a class="code hl_variable" href="classtarget__ui.html#ae8d4216fdc3f48ee8f6dd5f22c33d9d9">turrets_in_range</a>.clear();</div>
<div class="line"><a id="l02917" name="l02917"></a><span class="lineno"> 2917</span>    <span class="keywordflow">for</span>( <a class="code hl_struct" href="structvehicle__part.html">vehicle_part</a> *t : *<a class="code hl_variable" href="classtarget__ui.html#ae7a7446b4088911709b2eb6a1d3973e5">vturrets</a> ) {</div>
<div class="line"><a id="l02918" name="l02918"></a><span class="lineno"> 2918</span>        <a class="code hl_class" href="classturret__data.html">turret_data</a> td = <a class="code hl_variable" href="classtarget__ui.html#ac2200f3f97047dbc1e1cf14bae201c34">veh</a>-&gt;<a class="code hl_function" href="classvehicle.html#accfab81af66cd979bdfff4c39e5a3a8e">turret_query</a>( *t );</div>
<div class="line"><a id="l02919" name="l02919"></a><span class="lineno"> 2919</span>        <span class="keywordflow">if</span>( td.<a class="code hl_function" href="classturret__data.html#ad8b9e08531f26de34c61d5821ca69d7c">in_range</a>( <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> ) ) {</div>
<div class="line"><a id="l02920" name="l02920"></a><span class="lineno"> 2920</span>            <a class="code hl_struct" href="structtripoint.html">tripoint</a> <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> = <a class="code hl_variable" href="classtarget__ui.html#ac2200f3f97047dbc1e1cf14bae201c34">veh</a>-&gt;<a class="code hl_function" href="classvehicle.html#ae8132c34a1ea24866889e6e599796adc">global_part_pos3</a>( *t );</div>
<div class="line"><a id="l02921" name="l02921"></a><span class="lineno"> 2921</span>            <a class="code hl_variable" href="classtarget__ui.html#ae8d4216fdc3f48ee8f6dd5f22c33d9d9">turrets_in_range</a>.push_back( { t, <a class="code hl_function" href="coordinates_8h.html#a4a34f7ffa4c18effba7f8239c68c8738">line_to</a>( <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> ) } );</div>
<div class="line"><a id="l02922" name="l02922"></a><span class="lineno"> 2922</span>        }</div>
<div class="line"><a id="l02923" name="l02923"></a><span class="lineno"> 2923</span>    }</div>
<div class="line"><a id="l02924" name="l02924"></a><span class="lineno"> 2924</span>}</div>
<div class="line"><a id="l02925" name="l02925"></a><span class="lineno"> 2925</span> </div>
<div class="line"><a id="l02926" name="l02926"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a1403890979533cd6ea29897e3ee81ab5"> 2926</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a1403890979533cd6ea29897e3ee81ab5">target_ui::recalc_aim_turning_penalty</a>()</div>
<div class="line"><a id="l02927" name="l02927"></a><span class="lineno"> 2927</span>{</div>
<div class="line"><a id="l02928" name="l02928"></a><span class="lineno"> 2928</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> != <a class="code hl_enumvalue" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a0c6ad70beb3a7e76c3fc7adab7c46acc">Status::Good</a> ) {</div>
<div class="line"><a id="l02929" name="l02929"></a><span class="lineno"> 2929</span>        <span class="comment">// We don&#39;t care about invalid situations</span></div>
<div class="line"><a id="l02930" name="l02930"></a><span class="lineno"> 2930</span>        <a class="code hl_variable" href="classtarget__ui.html#ac0a5aad7e60b30082e7ec2ff97f8f6d4">predicted_recoil</a> = <a class="code hl_variable" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a>;</div>
<div class="line"><a id="l02931" name="l02931"></a><span class="lineno"> 2931</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02932" name="l02932"></a><span class="lineno"> 2932</span>    }</div>
<div class="line"><a id="l02933" name="l02933"></a><span class="lineno"> 2933</span> </div>
<div class="line"><a id="l02934" name="l02934"></a><span class="lineno"> 2934</span>    <span class="keywordtype">double</span> curr_recoil = <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a>;</div>
<div class="line"><a id="l02935" name="l02935"></a><span class="lineno"> 2935</span>    <a class="code hl_struct" href="structtripoint.html">tripoint</a> curr_recoil_pos;</div>
<div class="line"><a id="l02936" name="l02936"></a><span class="lineno"> 2936</span>    <a class="code hl_typedef" href="memory__fast_8h.html#ada897699f31fc8b37c5af09d95d45840">shared_ptr_fast&lt;Creature&gt;</a> ptr_lock = <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classplayer.html#ab679d40f5584e38a6af33bcd7e3c102d">last_target</a>.lock();</div>
<div class="line"><a id="l02937" name="l02937"></a><span class="lineno"> 2937</span>    <span class="keyword">const</span> <a class="code hl_class" href="classCreature.html">Creature</a> *lt_ptr = ptr_lock.get();</div>
<div class="line"><a id="l02938" name="l02938"></a><span class="lineno"> 2938</span>    <span class="keywordflow">if</span>( lt_ptr ) {</div>
<div class="line"><a id="l02939" name="l02939"></a><span class="lineno"> 2939</span>        curr_recoil_pos = lt_ptr-&gt;<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>();</div>
<div class="line"><a id="l02940" name="l02940"></a><span class="lineno"> 2940</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classplayer.html#a9aac4afb832dc4762430b0b3545cbfea">last_target_pos</a> ) {</div>
<div class="line"><a id="l02941" name="l02941"></a><span class="lineno"> 2941</span>        curr_recoil_pos = <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>().<a class="code hl_function" href="classmap.html#a426c21f7244ff80a61685a89e9146fec">getlocal</a>( *<a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classplayer.html#a9aac4afb832dc4762430b0b3545cbfea">last_target_pos</a> );</div>
<div class="line"><a id="l02942" name="l02942"></a><span class="lineno"> 2942</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02943" name="l02943"></a><span class="lineno"> 2943</span>        curr_recoil_pos = <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>;</div>
<div class="line"><a id="l02944" name="l02944"></a><span class="lineno"> 2944</span>    }</div>
<div class="line"><a id="l02945" name="l02945"></a><span class="lineno"> 2945</span> </div>
<div class="line"><a id="l02946" name="l02946"></a><span class="lineno"> 2946</span>    <span class="keywordflow">if</span>( curr_recoil_pos == <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> ) {</div>
<div class="line"><a id="l02947" name="l02947"></a><span class="lineno"> 2947</span>        <span class="comment">// We&#39;re aiming at that point right now, no penalty</span></div>
<div class="line"><a id="l02948" name="l02948"></a><span class="lineno"> 2948</span>        <a class="code hl_variable" href="classtarget__ui.html#ac0a5aad7e60b30082e7ec2ff97f8f6d4">predicted_recoil</a> = curr_recoil;</div>
<div class="line"><a id="l02949" name="l02949"></a><span class="lineno"> 2949</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( curr_recoil_pos == <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> ) {</div>
<div class="line"><a id="l02950" name="l02950"></a><span class="lineno"> 2950</span>        <span class="comment">// The player wasn&#39;t aiming anywhere, max it out</span></div>
<div class="line"><a id="l02951" name="l02951"></a><span class="lineno"> 2951</span>        <a class="code hl_variable" href="classtarget__ui.html#ac0a5aad7e60b30082e7ec2ff97f8f6d4">predicted_recoil</a> = <a class="code hl_variable" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a>;</div>
<div class="line"><a id="l02952" name="l02952"></a><span class="lineno"> 2952</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02953" name="l02953"></a><span class="lineno"> 2953</span>        <span class="comment">// Raise it proportionally to how much</span></div>
<div class="line"><a id="l02954" name="l02954"></a><span class="lineno"> 2954</span>        <span class="comment">// the player has to turn from previous aiming point</span></div>
<div class="line"><a id="l02955" name="l02955"></a><span class="lineno"> 2955</span>        <span class="keyword">const</span> <span class="keywordtype">double</span> recoil_per_degree = <a class="code hl_variable" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a> / 180.0;</div>
<div class="line"><a id="l02956" name="l02956"></a><span class="lineno"> 2956</span>        <span class="keyword">const</span> <a class="code hl_class" href="classunits_1_1quantity.html">units::angle</a> angle_curr = <a class="code hl_function" href="line_8cpp.html#a22f984836636053038f43340f9c50149">coord_to_angle</a>( <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, curr_recoil_pos );</div>
<div class="line"><a id="l02957" name="l02957"></a><span class="lineno"> 2957</span>        <span class="keyword">const</span> <a class="code hl_class" href="classunits_1_1quantity.html">units::angle</a> angle_desired = <a class="code hl_function" href="line_8cpp.html#a22f984836636053038f43340f9c50149">coord_to_angle</a>( <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> );</div>
<div class="line"><a id="l02958" name="l02958"></a><span class="lineno"> 2958</span>        <span class="keyword">const</span> <a class="code hl_class" href="classunits_1_1quantity.html">units::angle</a> phi = <a class="code hl_function" href="namespacedetail.html#a955ad02ade4f07084391a60ed80701bf">normalize</a>( angle_curr - angle_desired );</div>
<div class="line"><a id="l02959" name="l02959"></a><span class="lineno"> 2959</span>        <span class="keyword">const</span> <a class="code hl_class" href="classunits_1_1quantity.html">units::angle</a> <a class="code hl_typedef" href="namespaceunits.html#a2c7fe916bf04655f9fb4f2abdc5d28ed">angle</a> = std::min( phi, 360.0_degrees - phi );</div>
<div class="line"><a id="l02960" name="l02960"></a><span class="lineno"> 2960</span>        <a class="code hl_variable" href="classtarget__ui.html#ac0a5aad7e60b30082e7ec2ff97f8f6d4">predicted_recoil</a> =</div>
<div class="line"><a id="l02961" name="l02961"></a><span class="lineno"> 2961</span>            std::min( <a class="code hl_variable" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a>, curr_recoil + <a class="code hl_function" href="namespaceunits.html#a9ce2bc1618fa4acf9f9e98effd9f1ae0">to_degrees</a>( <a class="code hl_typedef" href="namespaceunits.html#a2c7fe916bf04655f9fb4f2abdc5d28ed">angle</a> ) * recoil_per_degree );</div>
<div class="line"><a id="l02962" name="l02962"></a><span class="lineno"> 2962</span>    }</div>
<div class="line"><a id="l02963" name="l02963"></a><span class="lineno"> 2963</span>}</div>
<div class="line"><a id="l02964" name="l02964"></a><span class="lineno"> 2964</span> </div>
<div class="line"><a id="l02965" name="l02965"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a40bd320b465d966959268698b54a0d98"> 2965</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a40bd320b465d966959268698b54a0d98">target_ui::apply_aim_turning_penalty</a>()</div>
<div class="line"><a id="l02966" name="l02966"></a><span class="lineno"> 2966</span>{</div>
<div class="line"><a id="l02967" name="l02967"></a><span class="lineno"> 2967</span>    <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> = <a class="code hl_variable" href="classtarget__ui.html#ac0a5aad7e60b30082e7ec2ff97f8f6d4">predicted_recoil</a>;</div>
<div class="line"><a id="l02968" name="l02968"></a><span class="lineno"> 2968</span>}</div>
<div class="line"><a id="l02969" name="l02969"></a><span class="lineno"> 2969</span> </div>
<div class="line"><a id="l02970" name="l02970"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a691e0bd6f4c5f82b309fd0e026f77825"> 2970</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a691e0bd6f4c5f82b309fd0e026f77825">target_ui::action_switch_mode</a>()</div>
<div class="line"><a id="l02971" name="l02971"></a><span class="lineno"> 2971</span>{</div>
<div class="line"><a id="l02972" name="l02972"></a><span class="lineno"> 2972</span>    <a class="code hl_class" href="classuilist.html">uilist</a> menu;</div>
<div class="line"><a id="l02973" name="l02973"></a><span class="lineno"> 2973</span>    menu.<a class="code hl_function" href="classuilist.html#a5ed3c6e3829c033040fa9f11f1a7d0aa">settext</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Select preferences&quot;</span> ) );</div>
<div class="line"><a id="l02974" name="l02974"></a><span class="lineno"> 2974</span> </div>
<div class="line"><a id="l02975" name="l02975"></a><span class="lineno"> 2975</span>    std::vector&lt;std::function&lt;void()&gt;&gt; on_select;</div>
<div class="line"><a id="l02976" name="l02976"></a><span class="lineno"> 2976</span> </div>
<div class="line"><a id="l02977" name="l02977"></a><span class="lineno"> 2977</span>    <span class="keywordflow">if</span>( !<a class="code hl_variable" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a>.empty() ) {</div>
<div class="line"><a id="l02978" name="l02978"></a><span class="lineno"> 2978</span>        menu.<a class="code hl_function" href="classuilist.html#af99f28334902af64487e2d0758df2ab9">addentry</a>( -1, <span class="keyword">false</span>, 0, <span class="stringliteral">&quot;  &quot;</span> + std::string( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Default aiming mode&quot;</span> ) ) );</div>
<div class="line"><a id="l02979" name="l02979"></a><span class="lineno"> 2979</span>        menu.<a class="code hl_variable" href="classuilist.html#af5fc2972d43a795c49a632dbcf58132b">entries</a>.back().force_color = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02980" name="l02980"></a><span class="lineno"> 2980</span>        menu.<a class="code hl_variable" href="classuilist.html#af5fc2972d43a795c49a632dbcf58132b">entries</a>.back().text_color = <a class="code hl_define" href="color_8h.html#a95b67111e2e4be7fcac981d2b7b208f6">c_cyan</a>;</div>
<div class="line"><a id="l02981" name="l02981"></a><span class="lineno"> 2981</span> </div>
<div class="line"><a id="l02982" name="l02982"></a><span class="lineno"> 2982</span>        <span class="keywordflow">for</span>( <span class="keyword">auto</span> it = <a class="code hl_variable" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a>.begin(); it != <a class="code hl_variable" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a>.end(); ++it ) {</div>
<div class="line"><a id="l02983" name="l02983"></a><span class="lineno"> 2983</span>            <span class="keyword">const</span> <span class="keywordtype">bool</span> is_active_aim_mode = <a class="code hl_variable" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">aim_mode</a> == it;</div>
<div class="line"><a id="l02984" name="l02984"></a><span class="lineno"> 2984</span>            <span class="keyword">const</span> std::string text = ( it-&gt;name.empty() ? <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Immediate&quot;</span> ) : it-&gt;name ) +</div>
<div class="line"><a id="l02985" name="l02985"></a><span class="lineno"> 2985</span>                                     ( is_active_aim_mode ? <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot; (active)&quot;</span> ) : <span class="stringliteral">&quot;&quot;</span> );</div>
<div class="line"><a id="l02986" name="l02986"></a><span class="lineno"> 2986</span> </div>
<div class="line"><a id="l02987" name="l02987"></a><span class="lineno"> 2987</span>            menu.<a class="code hl_function" href="classuilist.html#af99f28334902af64487e2d0758df2ab9">addentry</a>( on_select.size(), <span class="keyword">true</span>, <a class="code hl_variable" href="ui_8h.html#a06d5f3667ed71fa40939c4e7367e30ce">MENU_AUTOASSIGN</a>, text );</div>
<div class="line"><a id="l02988" name="l02988"></a><span class="lineno"> 2988</span>            on_select.emplace_back( [it, <span class="keyword">this</span>]() {</div>
<div class="line"><a id="l02989" name="l02989"></a><span class="lineno"> 2989</span>                <a class="code hl_variable" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">aim_mode</a> = it;</div>
<div class="line"><a id="l02990" name="l02990"></a><span class="lineno"> 2990</span>                <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classavatar.html#a98553758b9d158c58dd11c77d97ff55e">preferred_aiming_mode</a> = it-&gt;action;</div>
<div class="line"><a id="l02991" name="l02991"></a><span class="lineno"> 2991</span>            } );</div>
<div class="line"><a id="l02992" name="l02992"></a><span class="lineno"> 2992</span>            <span class="keywordflow">if</span>( is_active_aim_mode ) {</div>
<div class="line"><a id="l02993" name="l02993"></a><span class="lineno"> 2993</span>                menu.<a class="code hl_variable" href="classuilist.html#af5fc2972d43a795c49a632dbcf58132b">entries</a>.back().text_color = <a class="code hl_define" href="color_8h.html#a2236aa1fe66b707a104f19ad45c23230">c_light_green</a>;</div>
<div class="line"><a id="l02994" name="l02994"></a><span class="lineno"> 2994</span>            }</div>
<div class="line"><a id="l02995" name="l02995"></a><span class="lineno"> 2995</span>        }</div>
<div class="line"><a id="l02996" name="l02996"></a><span class="lineno"> 2996</span>    }</div>
<div class="line"><a id="l02997" name="l02997"></a><span class="lineno"> 2997</span> </div>
<div class="line"><a id="l02998" name="l02998"></a><span class="lineno"> 2998</span>    <span class="keyword">const</span> std::map&lt;gun_mode_id, gun_mode&gt; &amp;all_gun_modes = <a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code hl_function" href="classitem.html#aa1a2ecb3e9ebf95dc7fedac4c1de32b4">gun_all_modes</a>();</div>
<div class="line"><a id="l02999" name="l02999"></a><span class="lineno"> 2999</span>    <span class="keywordflow">if</span>( !all_gun_modes.empty() ) {</div>
<div class="line"><a id="l03000" name="l03000"></a><span class="lineno"> 3000</span>        menu.<a class="code hl_function" href="classuilist.html#af99f28334902af64487e2d0758df2ab9">addentry</a>( -1, <span class="keyword">false</span>, 0, <span class="stringliteral">&quot;  &quot;</span> + std::string( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Firing mode&quot;</span> ) ) );</div>
<div class="line"><a id="l03001" name="l03001"></a><span class="lineno"> 3001</span>        menu.<a class="code hl_variable" href="classuilist.html#af5fc2972d43a795c49a632dbcf58132b">entries</a>.back().force_color = <span class="keyword">true</span>;</div>
<div class="line"><a id="l03002" name="l03002"></a><span class="lineno"> 3002</span>        menu.<a class="code hl_variable" href="classuilist.html#af5fc2972d43a795c49a632dbcf58132b">entries</a>.back().text_color = <a class="code hl_define" href="color_8h.html#a95b67111e2e4be7fcac981d2b7b208f6">c_cyan</a>;</div>
<div class="line"><a id="l03003" name="l03003"></a><span class="lineno"> 3003</span> </div>
<div class="line"><a id="l03004" name="l03004"></a><span class="lineno"> 3004</span>        <span class="keywordflow">for</span>( <span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> : all_gun_modes ) {</div>
<div class="line"><a id="l03005" name="l03005"></a><span class="lineno"> 3005</span>            <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a>.second.melee() ) {</div>
<div class="line"><a id="l03006" name="l03006"></a><span class="lineno"> 3006</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l03007" name="l03007"></a><span class="lineno"> 3007</span>            }</div>
<div class="line"><a id="l03008" name="l03008"></a><span class="lineno"> 3008</span>            <span class="keyword">const</span> <span class="keywordtype">bool</span> active_gun_mode = <a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code hl_function" href="classitem.html#a3b83c2e0d1313b542801169382be1605">gun_get_mode_id</a>() == <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a>.first;</div>
<div class="line"><a id="l03009" name="l03009"></a><span class="lineno"> 3009</span> </div>
<div class="line"><a id="l03010" name="l03010"></a><span class="lineno"> 3010</span>            <span class="comment">// If gun mode is from a gunmod use gunmod&#39;s name, pay attention to the &quot;-&gt;&quot; on tname</span></div>
<div class="line"><a id="l03011" name="l03011"></a><span class="lineno"> 3011</span>            std::string text = ( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a>.second.target == <a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a> )</div>
<div class="line"><a id="l03012" name="l03012"></a><span class="lineno"> 3012</span>                               ? <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a>.second.tname()</div>
<div class="line"><a id="l03013" name="l03013"></a><span class="lineno"> 3013</span>                               : <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a>.second-&gt;tname() + <span class="stringliteral">&quot; (&quot;</span> + <a class="code hl_function" href="calendar_8cpp.html#aeb989652ea2bf7fd03b07a74fd30bd7a">std::to_string</a>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a>.second.qty ) + <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a id="l03014" name="l03014"></a><span class="lineno"> 3014</span> </div>
<div class="line"><a id="l03015" name="l03015"></a><span class="lineno"> 3015</span>            text += ( active_gun_mode ? <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot; (active)&quot;</span> ) : <span class="stringliteral">&quot;&quot;</span> );</div>
<div class="line"><a id="l03016" name="l03016"></a><span class="lineno"> 3016</span> </div>
<div class="line"><a id="l03017" name="l03017"></a><span class="lineno"> 3017</span>            menu.<a class="code hl_variable" href="classuilist.html#af5fc2972d43a795c49a632dbcf58132b">entries</a>.emplace_back( <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( on_select.size() ), <span class="keyword">true</span>, <a class="code hl_variable" href="ui_8h.html#a06d5f3667ed71fa40939c4e7367e30ce">MENU_AUTOASSIGN</a>, text );</div>
<div class="line"><a id="l03018" name="l03018"></a><span class="lineno"> 3018</span>            on_select.emplace_back( [<a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a>, <span class="keyword">this</span>]() {</div>
<div class="line"><a id="l03019" name="l03019"></a><span class="lineno"> 3019</span>                <a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code hl_function" href="classitem.html#afcc181d2e2fe380ac28dd70f814798c2">gun_set_mode</a>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a>.first );</div>
<div class="line"><a id="l03020" name="l03020"></a><span class="lineno"> 3020</span>            } );</div>
<div class="line"><a id="l03021" name="l03021"></a><span class="lineno"> 3021</span>            <span class="keywordflow">if</span>( active_gun_mode ) {</div>
<div class="line"><a id="l03022" name="l03022"></a><span class="lineno"> 3022</span>                menu.<a class="code hl_variable" href="classuilist.html#af5fc2972d43a795c49a632dbcf58132b">entries</a>.back().text_color = <a class="code hl_define" href="color_8h.html#a2236aa1fe66b707a104f19ad45c23230">c_light_green</a>;</div>
<div class="line"><a id="l03023" name="l03023"></a><span class="lineno"> 3023</span>                <span class="keywordflow">if</span>( menu.<a class="code hl_variable" href="classuilist.html#ab0890d56d6d29dd98a0b3f17bb3ebba3">selected</a> == 0 ) {</div>
<div class="line"><a id="l03024" name="l03024"></a><span class="lineno"> 3024</span>                    menu.<a class="code hl_variable" href="classuilist.html#ab0890d56d6d29dd98a0b3f17bb3ebba3">selected</a> = menu.<a class="code hl_variable" href="classuilist.html#af5fc2972d43a795c49a632dbcf58132b">entries</a>.size() - 1;</div>
<div class="line"><a id="l03025" name="l03025"></a><span class="lineno"> 3025</span>                }</div>
<div class="line"><a id="l03026" name="l03026"></a><span class="lineno"> 3026</span>            }</div>
<div class="line"><a id="l03027" name="l03027"></a><span class="lineno"> 3027</span>        }</div>
<div class="line"><a id="l03028" name="l03028"></a><span class="lineno"> 3028</span>    }</div>
<div class="line"><a id="l03029" name="l03029"></a><span class="lineno"> 3029</span> </div>
<div class="line"><a id="l03030" name="l03030"></a><span class="lineno"> 3030</span>    menu.<a class="code hl_function" href="group__UI.html#ga7604af7545244003f0a52ac87ce37979">query</a>();</div>
<div class="line"><a id="l03031" name="l03031"></a><span class="lineno"> 3031</span>    <span class="keywordflow">if</span>( menu.<a class="code hl_variable" href="classuilist.html#a0baa34622db6972a59d47d478bfd21d6">ret</a> &gt;= 0 &amp;&amp; menu.<a class="code hl_variable" href="classuilist.html#a0baa34622db6972a59d47d478bfd21d6">ret</a> &lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( on_select.size() ) ) {</div>
<div class="line"><a id="l03032" name="l03032"></a><span class="lineno"> 3032</span>        <span class="keywordtype">size_t</span> i = <span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>( menu.<a class="code hl_variable" href="classuilist.html#a0baa34622db6972a59d47d478bfd21d6">ret</a> );</div>
<div class="line"><a id="l03033" name="l03033"></a><span class="lineno"> 3033</span>        on_select[i]();</div>
<div class="line"><a id="l03034" name="l03034"></a><span class="lineno"> 3034</span>    } <span class="comment">// else - just refresh</span></div>
<div class="line"><a id="l03035" name="l03035"></a><span class="lineno"> 3035</span> </div>
<div class="line"><a id="l03036" name="l03036"></a><span class="lineno"> 3036</span>    <a class="code hl_function" href="classtarget__ui.html#a92256c0cb72fe5b2520a5808a5fcb79a">ensure_ranged_gun_mode</a>();</div>
<div class="line"><a id="l03037" name="l03037"></a><span class="lineno"> 3037</span>    <a class="code hl_function" href="classtarget__ui.html#a77429c16aec83b5c81d3a1c259259cd5">update_ammo_range_from_gun_mode</a>();</div>
<div class="line"><a id="l03038" name="l03038"></a><span class="lineno"> 3038</span>    <a class="code hl_function" href="classtarget__ui.html#aaf459ec49ad96c44eddeb94d0c22fb36">on_range_ammo_changed</a>();</div>
<div class="line"><a id="l03039" name="l03039"></a><span class="lineno"> 3039</span>}</div>
<div class="line"><a id="l03040" name="l03040"></a><span class="lineno"> 3040</span> </div>
<div class="line"><a id="l03041" name="l03041"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a92256c0cb72fe5b2520a5808a5fcb79a"> 3041</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a92256c0cb72fe5b2520a5808a5fcb79a">target_ui::ensure_ranged_gun_mode</a>()</div>
<div class="line"><a id="l03042" name="l03042"></a><span class="lineno"> 3042</span>{</div>
<div class="line"><a id="l03043" name="l03043"></a><span class="lineno"> 3043</span>    <span class="keywordflow">while</span>( <a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code hl_function" href="classitem.html#a1a94ea108d695febf7f2bcf090f097fa">gun_current_mode</a>().<a class="code hl_function" href="classgun__mode.html#a29fb11a5199f83a9c5801bf2af6d99e9">melee</a>() ) {</div>
<div class="line"><a id="l03044" name="l03044"></a><span class="lineno"> 3044</span>        <a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code hl_function" href="classitem.html#a74a90ea94f124f8d857058c2704a7fc7">gun_cycle_mode</a>();</div>
<div class="line"><a id="l03045" name="l03045"></a><span class="lineno"> 3045</span>    }</div>
<div class="line"><a id="l03046" name="l03046"></a><span class="lineno"> 3046</span>}</div>
<div class="line"><a id="l03047" name="l03047"></a><span class="lineno"> 3047</span> </div>
<div class="line"><a id="l03048" name="l03048"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a77429c16aec83b5c81d3a1c259259cd5"> 3048</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a77429c16aec83b5c81d3a1c259259cd5">target_ui::update_ammo_range_from_gun_mode</a>()</div>
<div class="line"><a id="l03049" name="l03049"></a><span class="lineno"> 3049</span>{</div>
<div class="line"><a id="l03050" name="l03050"></a><span class="lineno"> 3050</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70">TargetMode::TurretManual</a> ) {</div>
<div class="line"><a id="l03051" name="l03051"></a><span class="lineno"> 3051</span>        <a class="code hl_class" href="classstring__id.html">itype_id</a> ammo_current = <a class="code hl_variable" href="classtarget__ui.html#ae9e40adc2b44c3cd4cdbcc62dd8a1e30">turret</a>-&gt;<a class="code hl_function" href="classturret__data.html#aee56a3a0b07255f5b008cd16898b75e0">ammo_current</a>();</div>
<div class="line"><a id="l03052" name="l03052"></a><span class="lineno"> 3052</span>        <span class="comment">// Test no-ammo and not a UPS weapon</span></div>
<div class="line"><a id="l03053" name="l03053"></a><span class="lineno"> 3053</span>        <span class="keywordflow">if</span>( !ammo_current &amp;&amp; ( <a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code hl_function" href="classitem.html#af6bd135500675d45eb9b79b196d9558e">get_gun_ups_drain</a>() == 0 ) ) {</div>
<div class="line"><a id="l03054" name="l03054"></a><span class="lineno"> 3054</span>            <a class="code hl_variable" href="classtarget__ui.html#ae5ae79a739fcab56301077b8802355ce">ammo</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l03055" name="l03055"></a><span class="lineno"> 3055</span>            <a class="code hl_variable" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> = 0;</div>
<div class="line"><a id="l03056" name="l03056"></a><span class="lineno"> 3056</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03057" name="l03057"></a><span class="lineno"> 3057</span>            <a class="code hl_variable" href="classtarget__ui.html#ae5ae79a739fcab56301077b8802355ce">ammo</a> = &amp;*ammo_current;</div>
<div class="line"><a id="l03058" name="l03058"></a><span class="lineno"> 3058</span>            <a class="code hl_variable" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> = <a class="code hl_variable" href="classtarget__ui.html#ae9e40adc2b44c3cd4cdbcc62dd8a1e30">turret</a>-&gt;<a class="code hl_function" href="classturret__data.html#a78df34a41feb7bf25a677dba1e8181d5">range</a>();</div>
<div class="line"><a id="l03059" name="l03059"></a><span class="lineno"> 3059</span>        }</div>
<div class="line"><a id="l03060" name="l03060"></a><span class="lineno"> 3060</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03061" name="l03061"></a><span class="lineno"> 3061</span>        <a class="code hl_variable" href="classtarget__ui.html#ae5ae79a739fcab56301077b8802355ce">ammo</a> = <a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code hl_function" href="classitem.html#a1a94ea108d695febf7f2bcf090f097fa">gun_current_mode</a>().<a class="code hl_variable" href="classgun__mode.html#aadaa36507ace08fc621348ae1052647e">target</a>-&gt;<a class="code hl_function" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>();</div>
<div class="line"><a id="l03062" name="l03062"></a><span class="lineno"> 3062</span>        <a class="code hl_variable" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> = <a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code hl_function" href="classitem.html#a1a94ea108d695febf7f2bcf090f097fa">gun_current_mode</a>().<a class="code hl_variable" href="classgun__mode.html#aadaa36507ace08fc621348ae1052647e">target</a>-&gt;<a class="code hl_function" href="classitem.html#af443024fa9e01c97953b3fcf81c9cfb1">gun_range</a>( <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a> );</div>
<div class="line"><a id="l03063" name="l03063"></a><span class="lineno"> 3063</span>    }</div>
<div class="line"><a id="l03064" name="l03064"></a><span class="lineno"> 3064</span>}</div>
<div class="line"><a id="l03065" name="l03065"></a><span class="lineno"> 3065</span> </div>
<div class="line"><a id="l03066" name="l03066"></a><span class="lineno"><a class="line" href="classtarget__ui.html#acbdcdc8f41dd8bcbf887b12d96c9948d"> 3066</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classtarget__ui.html#acbdcdc8f41dd8bcbf887b12d96c9948d">target_ui::action_switch_ammo</a>()</div>
<div class="line"><a id="l03067" name="l03067"></a><span class="lineno"> 3067</span>{</div>
<div class="line"><a id="l03068" name="l03068"></a><span class="lineno"> 3068</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70">TargetMode::TurretManual</a> ) {</div>
<div class="line"><a id="l03069" name="l03069"></a><span class="lineno"> 3069</span>        <span class="comment">// For turrets that use vehicle tanks &amp; can fire multiple liquids</span></div>
<div class="line"><a id="l03070" name="l03070"></a><span class="lineno"> 3070</span>        <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#ae9e40adc2b44c3cd4cdbcc62dd8a1e30">turret</a>-&gt;<a class="code hl_function" href="classturret__data.html#af1938c9e7db9350ae08fef7a921f19c6">ammo_options</a>().size() &gt; 1 ) {</div>
<div class="line"><a id="l03071" name="l03071"></a><span class="lineno"> 3071</span>            <span class="keyword">const</span> <span class="keyword">auto</span> opts = <a class="code hl_variable" href="classtarget__ui.html#ae9e40adc2b44c3cd4cdbcc62dd8a1e30">turret</a>-&gt;<a class="code hl_function" href="classturret__data.html#af1938c9e7db9350ae08fef7a921f19c6">ammo_options</a>();</div>
<div class="line"><a id="l03072" name="l03072"></a><span class="lineno"> 3072</span>            <span class="keyword">auto</span> iter = opts.find( <a class="code hl_variable" href="classtarget__ui.html#ae9e40adc2b44c3cd4cdbcc62dd8a1e30">turret</a>-&gt;<a class="code hl_function" href="classturret__data.html#aee56a3a0b07255f5b008cd16898b75e0">ammo_current</a>() );</div>
<div class="line"><a id="l03073" name="l03073"></a><span class="lineno"> 3073</span>            <a class="code hl_variable" href="classtarget__ui.html#ae9e40adc2b44c3cd4cdbcc62dd8a1e30">turret</a>-&gt;<a class="code hl_function" href="classturret__data.html#a21fc6c32651797ffe152775d1b51687b">ammo_select</a>( ++iter != opts.end() ? *iter : *opts.begin() );</div>
<div class="line"><a id="l03074" name="l03074"></a><span class="lineno"> 3074</span>            <a class="code hl_variable" href="classtarget__ui.html#ae5ae79a739fcab56301077b8802355ce">ammo</a> = &amp;*<a class="code hl_variable" href="classtarget__ui.html#ae9e40adc2b44c3cd4cdbcc62dd8a1e30">turret</a>-&gt;<a class="code hl_function" href="classturret__data.html#aee56a3a0b07255f5b008cd16898b75e0">ammo_current</a>();</div>
<div class="line"><a id="l03075" name="l03075"></a><span class="lineno"> 3075</span>            <a class="code hl_variable" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> = <a class="code hl_variable" href="classtarget__ui.html#ae9e40adc2b44c3cd4cdbcc62dd8a1e30">turret</a>-&gt;<a class="code hl_function" href="classturret__data.html#a78df34a41feb7bf25a677dba1e8181d5">range</a>();</div>
<div class="line"><a id="l03076" name="l03076"></a><span class="lineno"> 3076</span>        }</div>
<div class="line"><a id="l03077" name="l03077"></a><span class="lineno"> 3077</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03078" name="l03078"></a><span class="lineno"> 3078</span>        <span class="comment">// Leave aiming UI and open reloading UI since</span></div>
<div class="line"><a id="l03079" name="l03079"></a><span class="lineno"> 3079</span>        <span class="comment">// reloading annihilates our aim anyway</span></div>
<div class="line"><a id="l03080" name="l03080"></a><span class="lineno"> 3080</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03081" name="l03081"></a><span class="lineno"> 3081</span>    }</div>
<div class="line"><a id="l03082" name="l03082"></a><span class="lineno"> 3082</span>    <a class="code hl_function" href="classtarget__ui.html#aaf459ec49ad96c44eddeb94d0c22fb36">on_range_ammo_changed</a>();</div>
<div class="line"><a id="l03083" name="l03083"></a><span class="lineno"> 3083</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l03084" name="l03084"></a><span class="lineno"> 3084</span>}</div>
<div class="line"><a id="l03085" name="l03085"></a><span class="lineno"> 3085</span> </div>
<div class="line"><a id="l03086" name="l03086"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a6c0468c35f79fb501be1a3a50b4081d4"> 3086</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classtarget__ui.html#a6c0468c35f79fb501be1a3a50b4081d4">target_ui::action_aim</a>()</div>
<div class="line"><a id="l03087" name="l03087"></a><span class="lineno"> 3087</span>{</div>
<div class="line"><a id="l03088" name="l03088"></a><span class="lineno"> 3088</span>    <a class="code hl_function" href="classtarget__ui.html#aa53ba52da62f64baa29130908cf8637b">set_last_target</a>();</div>
<div class="line"><a id="l03089" name="l03089"></a><span class="lineno"> 3089</span>    <a class="code hl_function" href="classtarget__ui.html#a40bd320b465d966959268698b54a0d98">apply_aim_turning_penalty</a>();</div>
<div class="line"><a id="l03090" name="l03090"></a><span class="lineno"> 3090</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> min_recoil = <a class="code hl_function" href="ranged_8cpp.html#a4c4dcbdeaad877776816e6f5b2dd1739">calculate_aim_cap</a>( *<a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>, <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> );</div>
<div class="line"><a id="l03091" name="l03091"></a><span class="lineno"> 3091</span>    <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; 10; ++i ) {</div>
<div class="line"><a id="l03092" name="l03092"></a><span class="lineno"> 3092</span>        <a class="code hl_function" href="ranged_8cpp.html#a7dcffd38110cb6a93c24f11258461023">do_aim</a>( *<a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>, *<a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>, min_recoil );</div>
<div class="line"><a id="l03093" name="l03093"></a><span class="lineno"> 3093</span>    }</div>
<div class="line"><a id="l03094" name="l03094"></a><span class="lineno"> 3094</span> </div>
<div class="line"><a id="l03095" name="l03095"></a><span class="lineno"> 3095</span>    <span class="comment">// We&#39;ve changed pc.recoil, update penalty</span></div>
<div class="line"><a id="l03096" name="l03096"></a><span class="lineno"> 3096</span>    <a class="code hl_function" href="classtarget__ui.html#a1403890979533cd6ea29897e3ee81ab5">recalc_aim_turning_penalty</a>();</div>
<div class="line"><a id="l03097" name="l03097"></a><span class="lineno"> 3097</span> </div>
<div class="line"><a id="l03098" name="l03098"></a><span class="lineno"> 3098</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a> &gt; 0;</div>
<div class="line"><a id="l03099" name="l03099"></a><span class="lineno"> 3099</span>}</div>
<div class="line"><a id="l03100" name="l03100"></a><span class="lineno"> 3100</span> </div>
<div class="line"><a id="l03101" name="l03101"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a21275763803a2ce0d00e02dc0076a36c"> 3101</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classtarget__ui.html#a21275763803a2ce0d00e02dc0076a36c">target_ui::action_aim_and_shoot</a>( <span class="keyword">const</span> std::string &amp;<a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> )</div>
<div class="line"><a id="l03102" name="l03102"></a><span class="lineno"> 3102</span>{</div>
<div class="line"><a id="l03103" name="l03103"></a><span class="lineno"> 3103</span>    std::vector&lt;aim_type&gt;::iterator it;</div>
<div class="line"><a id="l03104" name="l03104"></a><span class="lineno"> 3104</span>    <span class="keywordflow">for</span>( it = <a class="code hl_variable" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a>.begin(); it != <a class="code hl_variable" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a>.end(); it++ ) {</div>
<div class="line"><a id="l03105" name="l03105"></a><span class="lineno"> 3105</span>        <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == it-&gt;action ) {</div>
<div class="line"><a id="l03106" name="l03106"></a><span class="lineno"> 3106</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l03107" name="l03107"></a><span class="lineno"> 3107</span>        }</div>
<div class="line"><a id="l03108" name="l03108"></a><span class="lineno"> 3108</span>    }</div>
<div class="line"><a id="l03109" name="l03109"></a><span class="lineno"> 3109</span>    <span class="keywordflow">if</span>( it == <a class="code hl_variable" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a>.end() ) {</div>
<div class="line"><a id="l03110" name="l03110"></a><span class="lineno"> 3110</span>        <a class="code hl_define" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Could not find a valid aim_type for %s&quot;</span>, <a class="code hl_enumvalue" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>.c_str() );</div>
<div class="line"><a id="l03111" name="l03111"></a><span class="lineno"> 3111</span>        <a class="code hl_variable" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">aim_mode</a> = <a class="code hl_variable" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a>.begin();</div>
<div class="line"><a id="l03112" name="l03112"></a><span class="lineno"> 3112</span>    }</div>
<div class="line"><a id="l03113" name="l03113"></a><span class="lineno"> 3113</span>    <span class="keywordtype">int</span> aim_threshold = it-&gt;threshold;</div>
<div class="line"><a id="l03114" name="l03114"></a><span class="lineno"> 3114</span>    <a class="code hl_function" href="classtarget__ui.html#aa53ba52da62f64baa29130908cf8637b">set_last_target</a>();</div>
<div class="line"><a id="l03115" name="l03115"></a><span class="lineno"> 3115</span>    <a class="code hl_function" href="classtarget__ui.html#a40bd320b465d966959268698b54a0d98">apply_aim_turning_penalty</a>();</div>
<div class="line"><a id="l03116" name="l03116"></a><span class="lineno"> 3116</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> min_recoil = <a class="code hl_function" href="ranged_8cpp.html#a4c4dcbdeaad877776816e6f5b2dd1739">calculate_aim_cap</a>( *<a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>, <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> );</div>
<div class="line"><a id="l03117" name="l03117"></a><span class="lineno"> 3117</span>    <span class="keywordflow">do</span> {</div>
<div class="line"><a id="l03118" name="l03118"></a><span class="lineno"> 3118</span>        <a class="code hl_function" href="ranged_8cpp.html#a7dcffd38110cb6a93c24f11258461023">do_aim</a>( *<a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>, <a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a> ? *<a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a> : <a class="code hl_function" href="item_8cpp.html#a300b99af4ea719590afac661e0bff7a1">null_item_reference</a>(), min_recoil );</div>
<div class="line"><a id="l03119" name="l03119"></a><span class="lineno"> 3119</span>    } <span class="keywordflow">while</span>( <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a> &gt; 0 &amp;&amp; <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> &gt; aim_threshold &amp;&amp;</div>
<div class="line"><a id="l03120" name="l03120"></a><span class="lineno"> 3120</span>             <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> - <a class="code hl_variable" href="classtarget__ui.html#a2e6f4c9c827b91ce215a1a7b32a4affb">sight_dispersion</a> &gt; min_recoil );</div>
<div class="line"><a id="l03121" name="l03121"></a><span class="lineno"> 3121</span> </div>
<div class="line"><a id="l03122" name="l03122"></a><span class="lineno"> 3122</span>    <span class="comment">// If we made it under the aim threshold, go ahead and fire.</span></div>
<div class="line"><a id="l03123" name="l03123"></a><span class="lineno"> 3123</span>    <span class="comment">// Also fire if we&#39;re at our best aim level already.</span></div>
<div class="line"><a id="l03124" name="l03124"></a><span class="lineno"> 3124</span>    <span class="comment">// If no critter is at dst then sight dispersion does not apply,</span></div>
<div class="line"><a id="l03125" name="l03125"></a><span class="lineno"> 3125</span>    <span class="comment">// so it would lock into an infinite loop.</span></div>
<div class="line"><a id="l03126" name="l03126"></a><span class="lineno"> 3126</span>    <span class="keywordtype">bool</span> done_aiming = <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> &lt;= aim_threshold || <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> - <a class="code hl_variable" href="classtarget__ui.html#a2e6f4c9c827b91ce215a1a7b32a4affb">sight_dispersion</a> == min_recoil ||</div>
<div class="line"><a id="l03127" name="l03127"></a><span class="lineno"> 3127</span>                       ( !<a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;critter_at( <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> ) &amp;&amp; <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> == min_recoil );</div>
<div class="line"><a id="l03128" name="l03128"></a><span class="lineno"> 3128</span>    <span class="keywordflow">return</span> done_aiming;</div>
<div class="line"><a id="l03129" name="l03129"></a><span class="lineno"> 3129</span>}</div>
<div class="line"><a id="l03130" name="l03130"></a><span class="lineno"> 3130</span> </div>
<div class="line"><a id="l03131" name="l03131"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a15d523ae27fc66cbff7adac5e9fa91dd"> 3131</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a15d523ae27fc66cbff7adac5e9fa91dd">target_ui::draw_terrain_overlay</a>()</div>
<div class="line"><a id="l03132" name="l03132"></a><span class="lineno"> 3132</span>{</div>
<div class="line"><a id="l03133" name="l03133"></a><span class="lineno"> 3133</span>    <a class="code hl_struct" href="structtripoint.html">tripoint</a> <a class="code hl_enumvalue" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a> = <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() + <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classplayer.html#a625b6dd5247589902251e845d07a2154">view_offset</a>;</div>
<div class="line"><a id="l03134" name="l03134"></a><span class="lineno"> 3134</span> </div>
<div class="line"><a id="l03135" name="l03135"></a><span class="lineno"> 3135</span>    <span class="comment">// Removes parts that don&#39;t belong to currently visible Z level</span></div>
<div class="line"><a id="l03136" name="l03136"></a><span class="lineno"> 3136</span>    <span class="keyword">const</span> <span class="keyword">auto</span> filter_this_z = [&amp;<a class="code hl_enumvalue" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a>]( <span class="keyword">const</span> std::vector&lt;tripoint&gt; &amp;<a class="code hl_variable" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">traj</a> ) {</div>
<div class="line"><a id="l03137" name="l03137"></a><span class="lineno"> 3137</span>        std::vector&lt;tripoint&gt; this_z = <a class="code hl_variable" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">traj</a>;</div>
<div class="line"><a id="l03138" name="l03138"></a><span class="lineno"> 3138</span>        this_z.erase( std::remove_if( this_z.begin(), this_z.end(),</div>
<div class="line"><a id="l03139" name="l03139"></a><span class="lineno"> 3139</span>        [&amp;<a class="code hl_enumvalue" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a>]( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp; p ) {</div>
<div class="line"><a id="l03140" name="l03140"></a><span class="lineno"> 3140</span>            return p.z != center.z;</div>
<div class="line"><a id="l03141" name="l03141"></a><span class="lineno"> 3141</span>        } ), this_z.end() );</div>
<div class="line"><a id="l03142" name="l03142"></a><span class="lineno"> 3142</span>        <span class="keywordflow">return</span> this_z;</div>
<div class="line"><a id="l03143" name="l03143"></a><span class="lineno"> 3143</span>    };</div>
<div class="line"><a id="l03144" name="l03144"></a><span class="lineno"> 3144</span> </div>
<div class="line"><a id="l03145" name="l03145"></a><span class="lineno"> 3145</span>    <span class="comment">// FIXME: TILES version of g-&gt;draw_line helpfully draws a cursor at last point.</span></div>
<div class="line"><a id="l03146" name="l03146"></a><span class="lineno"> 3146</span>    <span class="comment">//        This creates a fake cursor if &#39;dst&#39; is on a z-level we cannot see.</span></div>
<div class="line"><a id="l03147" name="l03147"></a><span class="lineno"> 3147</span> </div>
<div class="line"><a id="l03148" name="l03148"></a><span class="lineno"> 3148</span>    <span class="comment">// Draw approximate line of fire for each turret in range</span></div>
<div class="line"><a id="l03149" name="l03149"></a><span class="lineno"> 3149</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">TargetMode::Turrets</a> &amp;&amp; <a class="code hl_variable" href="classtarget__ui.html#a63ac73585a9794e93d181362f7473b50">draw_turret_lines</a> ) {</div>
<div class="line"><a id="l03150" name="l03150"></a><span class="lineno"> 3150</span>        <span class="comment">// TODO: TILES version doesn&#39;t know how to draw more than 1 line at a time.</span></div>
<div class="line"><a id="l03151" name="l03151"></a><span class="lineno"> 3151</span>        <span class="comment">//       We merge all lines together and draw them as a big malformed one</span></div>
<div class="line"><a id="l03152" name="l03152"></a><span class="lineno"> 3152</span>        std::set&lt;tripoint&gt; points;</div>
<div class="line"><a id="l03153" name="l03153"></a><span class="lineno"> 3153</span>        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_struct" href="structtarget__ui_1_1turret__with__lof.html">turret_with_lof</a> &amp;it : <a class="code hl_variable" href="classtarget__ui.html#ae8d4216fdc3f48ee8f6dd5f22c33d9d9">turrets_in_range</a> ) {</div>
<div class="line"><a id="l03154" name="l03154"></a><span class="lineno"> 3154</span>            std::vector&lt;tripoint&gt; this_z = filter_this_z( it.line );</div>
<div class="line"><a id="l03155" name="l03155"></a><span class="lineno"> 3155</span>            <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;p : this_z ) {</div>
<div class="line"><a id="l03156" name="l03156"></a><span class="lineno"> 3156</span>                points.insert( p );</div>
<div class="line"><a id="l03157" name="l03157"></a><span class="lineno"> 3157</span>            }</div>
<div class="line"><a id="l03158" name="l03158"></a><span class="lineno"> 3158</span>        }</div>
<div class="line"><a id="l03159" name="l03159"></a><span class="lineno"> 3159</span>        <span class="comment">// Since &quot;trajectory&quot; for each turret is just a straight line,</span></div>
<div class="line"><a id="l03160" name="l03160"></a><span class="lineno"> 3160</span>        <span class="comment">// we can draw it even if the player can&#39;t see some parts</span></div>
<div class="line"><a id="l03161" name="l03161"></a><span class="lineno"> 3161</span>        points.erase( <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> ); <span class="comment">// Workaround for fake cursor on TILES</span></div>
<div class="line"><a id="l03162" name="l03162"></a><span class="lineno"> 3162</span>        std::vector&lt;tripoint&gt; l( points.begin(), points.end() );</div>
<div class="line"><a id="l03163" name="l03163"></a><span class="lineno"> 3163</span>        <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a>.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> == <a class="code hl_enumvalue" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a>.z ) {</div>
<div class="line"><a id="l03164" name="l03164"></a><span class="lineno"> 3164</span>            <span class="comment">// Workaround for fake cursor bug on TILES</span></div>
<div class="line"><a id="l03165" name="l03165"></a><span class="lineno"> 3165</span>            l.push_back( <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> );</div>
<div class="line"><a id="l03166" name="l03166"></a><span class="lineno"> 3166</span>        }</div>
<div class="line"><a id="l03167" name="l03167"></a><span class="lineno"> 3167</span>        <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;draw_line( <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, <a class="code hl_enumvalue" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a>, l, <span class="keyword">true</span> );</div>
<div class="line"><a id="l03168" name="l03168"></a><span class="lineno"> 3168</span>    }</div>
<div class="line"><a id="l03169" name="l03169"></a><span class="lineno"> 3169</span> </div>
<div class="line"><a id="l03170" name="l03170"></a><span class="lineno"> 3170</span>    <span class="comment">// Draw trajectory</span></div>
<div class="line"><a id="l03171" name="l03171"></a><span class="lineno"> 3171</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> != <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">TargetMode::Turrets</a> &amp;&amp; <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> != <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> ) {</div>
<div class="line"><a id="l03172" name="l03172"></a><span class="lineno"> 3172</span>        std::vector&lt;tripoint&gt; this_z = filter_this_z( <a class="code hl_variable" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">traj</a> );</div>
<div class="line"><a id="l03173" name="l03173"></a><span class="lineno"> 3173</span> </div>
<div class="line"><a id="l03174" name="l03174"></a><span class="lineno"> 3174</span>        <span class="comment">// Draw a highlighted trajectory only if we can see the endpoint.</span></div>
<div class="line"><a id="l03175" name="l03175"></a><span class="lineno"> 3175</span>        <span class="comment">// Provides feedback to the player, but avoids leaking information</span></div>
<div class="line"><a id="l03176" name="l03176"></a><span class="lineno"> 3176</span>        <span class="comment">// about tiles they can&#39;t see.</span></div>
<div class="line"><a id="l03177" name="l03177"></a><span class="lineno"> 3177</span>        <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;draw_line( <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a>, <a class="code hl_enumvalue" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a>, this_z );</div>
<div class="line"><a id="l03178" name="l03178"></a><span class="lineno"> 3178</span>    }</div>
<div class="line"><a id="l03179" name="l03179"></a><span class="lineno"> 3179</span> </div>
<div class="line"><a id="l03180" name="l03180"></a><span class="lineno"> 3180</span>    <span class="comment">// Since draw_line does nothing if destination is not visible,</span></div>
<div class="line"><a id="l03181" name="l03181"></a><span class="lineno"> 3181</span>    <span class="comment">// cursor also disappears. Draw it explicitly.</span></div>
<div class="line"><a id="l03182" name="l03182"></a><span class="lineno"> 3182</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a>.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> == <a class="code hl_enumvalue" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a>.z ) {</div>
<div class="line"><a id="l03183" name="l03183"></a><span class="lineno"> 3183</span>        <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;draw_cursor( <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> );</div>
<div class="line"><a id="l03184" name="l03184"></a><span class="lineno"> 3184</span>    }</div>
<div class="line"><a id="l03185" name="l03185"></a><span class="lineno"> 3185</span> </div>
<div class="line"><a id="l03186" name="l03186"></a><span class="lineno"> 3186</span>    <span class="comment">// Draw spell AOE</span></div>
<div class="line"><a id="l03187" name="l03187"></a><span class="lineno"> 3187</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd">TargetMode::Spell</a> ) {</div>
<div class="line"><a id="l03188" name="l03188"></a><span class="lineno"> 3188</span>        <a class="code hl_struct" href="structdrawsq__params.html">drawsq_params</a> params = <a class="code hl_struct" href="structdrawsq__params.html">drawsq_params</a>().<a class="code hl_function" href="structdrawsq__params.html#a07e0031d80c902338e81e0625215c8ee">highlight</a>( <span class="keyword">true</span> ).<a class="code hl_function" href="structdrawsq__params.html#a62c9449e7c7cf3d1a7828e2c65100ac8">center</a>( <a class="code hl_enumvalue" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a> );</div>
<div class="line"><a id="l03189" name="l03189"></a><span class="lineno"> 3189</span>        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;tile : <a class="code hl_variable" href="classtarget__ui.html#ab855722580bd112ef0590b5a9b4f3556">spell_aoe</a> ) {</div>
<div class="line"><a id="l03190" name="l03190"></a><span class="lineno"> 3190</span>            <span class="keywordflow">if</span>( tile.z != <a class="code hl_enumvalue" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a>.z ) {</div>
<div class="line"><a id="l03191" name="l03191"></a><span class="lineno"> 3191</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l03192" name="l03192"></a><span class="lineno"> 3192</span>            }</div>
<div class="line"><a id="l03193" name="l03193"></a><span class="lineno"> 3193</span><span class="preprocessor">#ifdef TILES</span></div>
<div class="line"><a id="l03194" name="l03194"></a><span class="lineno"> 3194</span>            <span class="keywordflow">if</span>( <a class="code hl_variable" href="cached__options_8cpp.html#a9b72c9314ac0439a25820b3abf2229f3">use_tiles</a> ) {</div>
<div class="line"><a id="l03195" name="l03195"></a><span class="lineno"> 3195</span>                <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;draw_highlight( tile );</div>
<div class="line"><a id="l03196" name="l03196"></a><span class="lineno"> 3196</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03197" name="l03197"></a><span class="lineno"> 3197</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03198" name="l03198"></a><span class="lineno"> 3198</span>                <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>().<a class="code hl_function" href="classmap.html#ad189f4216a9eaacbf9c5aa0ceedaea18">drawsq</a>( <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;w_terrain, tile, params );</div>
<div class="line"><a id="l03199" name="l03199"></a><span class="lineno"> 3199</span><span class="preprocessor">#ifdef TILES</span></div>
<div class="line"><a id="l03200" name="l03200"></a><span class="lineno"> 3200</span>            }</div>
<div class="line"><a id="l03201" name="l03201"></a><span class="lineno"> 3201</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03202" name="l03202"></a><span class="lineno"> 3202</span>        }</div>
<div class="line"><a id="l03203" name="l03203"></a><span class="lineno"> 3203</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a880c1273b27d27cfc82004c3a4b205c9">TargetMode::Shape</a> ) {</div>
<div class="line"><a id="l03204" name="l03204"></a><span class="lineno"> 3204</span>        <a class="code hl_struct" href="structdrawsq__params.html">drawsq_params</a> params = <a class="code hl_struct" href="structdrawsq__params.html">drawsq_params</a>().<a class="code hl_function" href="structdrawsq__params.html#a07e0031d80c902338e81e0625215c8ee">highlight</a>( <span class="keyword">true</span> ).<a class="code hl_function" href="structdrawsq__params.html#a62c9449e7c7cf3d1a7828e2c65100ac8">center</a>( <a class="code hl_enumvalue" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a> );</div>
<div class="line"><a id="l03205" name="l03205"></a><span class="lineno"> 3205</span>        <span class="keywordflow">for</span>( <span class="keyword">const</span> std::pair&lt;const tripoint, double&gt; &amp;pr : <a class="code hl_variable" href="classtarget__ui.html#a6f2c970f904d7b8c06e403dbc4560f4d">shape_coverage</a> ) {</div>
<div class="line"><a id="l03206" name="l03206"></a><span class="lineno"> 3206</span>            <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;tile = pr.first;</div>
<div class="line"><a id="l03207" name="l03207"></a><span class="lineno"> 3207</span><span class="preprocessor">#ifdef TILES</span></div>
<div class="line"><a id="l03208" name="l03208"></a><span class="lineno"> 3208</span>            <span class="keywordflow">if</span>( <a class="code hl_variable" href="cached__options_8cpp.html#a9b72c9314ac0439a25820b3abf2229f3">use_tiles</a> ) {</div>
<div class="line"><a id="l03209" name="l03209"></a><span class="lineno"> 3209</span>                <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;draw_highlight( tile );</div>
<div class="line"><a id="l03210" name="l03210"></a><span class="lineno"> 3210</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03211" name="l03211"></a><span class="lineno"> 3211</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03212" name="l03212"></a><span class="lineno"> 3212</span>                <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>().<a class="code hl_function" href="classmap.html#ad189f4216a9eaacbf9c5aa0ceedaea18">drawsq</a>( <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;w_terrain, tile, params );</div>
<div class="line"><a id="l03213" name="l03213"></a><span class="lineno"> 3213</span>                <a class="code hl_class" href="classCreature.html">Creature</a> *critter = <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;critter_at( tile );</div>
<div class="line"><a id="l03214" name="l03214"></a><span class="lineno"> 3214</span>                <span class="keywordflow">if</span>( critter != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a id="l03215" name="l03215"></a><span class="lineno"> 3215</span>                    <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;draw_critter_highlighted( *critter, <a class="code hl_enumvalue" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a> );</div>
<div class="line"><a id="l03216" name="l03216"></a><span class="lineno"> 3216</span>                }</div>
<div class="line"><a id="l03217" name="l03217"></a><span class="lineno"> 3217</span><span class="preprocessor">#ifdef TILES</span></div>
<div class="line"><a id="l03218" name="l03218"></a><span class="lineno"> 3218</span>            }</div>
<div class="line"><a id="l03219" name="l03219"></a><span class="lineno"> 3219</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03220" name="l03220"></a><span class="lineno"> 3220</span>        }</div>
<div class="line"><a id="l03221" name="l03221"></a><span class="lineno"> 3221</span>    }</div>
<div class="line"><a id="l03222" name="l03222"></a><span class="lineno"> 3222</span>}</div>
<div class="line"><a id="l03223" name="l03223"></a><span class="lineno"> 3223</span> </div>
<div class="line"><a id="l03224" name="l03224"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a93a478e95d201324548329f39a087208"> 3224</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a93a478e95d201324548329f39a087208">target_ui::draw_ui_window</a>()</div>
<div class="line"><a id="l03225" name="l03225"></a><span class="lineno"> 3225</span>{</div>
<div class="line"><a id="l03226" name="l03226"></a><span class="lineno"> 3226</span>    <span class="comment">// Clear target window and make it non-transparent.</span></div>
<div class="line"><a id="l03227" name="l03227"></a><span class="lineno"> 3227</span>    <span class="keywordtype">int</span> width = <a class="code hl_function" href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">getmaxx</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> );</div>
<div class="line"><a id="l03228" name="l03228"></a><span class="lineno"> 3228</span>    <span class="keywordtype">int</span> height = <a class="code hl_function" href="namespacecatacurses.html#adc81ca40445dc062af12fb6d7a4793d0">getmaxy</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> );</div>
<div class="line"><a id="l03229" name="l03229"></a><span class="lineno"> 3229</span>    <span class="keywordflow">for</span>( <span class="keywordtype">int</span> y = 0; y &lt; height; y++ ) {</div>
<div class="line"><a id="l03230" name="l03230"></a><span class="lineno"> 3230</span>        <span class="keywordflow">for</span>( <span class="keywordtype">int</span> x = 0; x &lt; width; x++ ) {</div>
<div class="line"><a id="l03231" name="l03231"></a><span class="lineno"> 3231</span>            <a class="code hl_function" href="output_8cpp.html#afb5597c87a5847c7d64b878ab3a77d5b">mvwputch</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_struct" href="structpoint.html">point</a>( x, y ), <a class="code hl_define" href="color_8h.html#a0d06dc49b9761bbc54607397213728bb">c_white</a>, <span class="charliteral">&#39; &#39;</span> );</div>
<div class="line"><a id="l03232" name="l03232"></a><span class="lineno"> 3232</span>        }</div>
<div class="line"><a id="l03233" name="l03233"></a><span class="lineno"> 3233</span>    }</div>
<div class="line"><a id="l03234" name="l03234"></a><span class="lineno"> 3234</span> </div>
<div class="line"><a id="l03235" name="l03235"></a><span class="lineno"> 3235</span>    <a class="code hl_function" href="output_8cpp.html#afea9968fcee47ebca0e45d27099d1c22">draw_border</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> );</div>
<div class="line"><a id="l03236" name="l03236"></a><span class="lineno"> 3236</span>    <a class="code hl_function" href="classtarget__ui.html#ad62889056a10382de6835688498cf20e">draw_window_title</a>();</div>
<div class="line"><a id="l03237" name="l03237"></a><span class="lineno"> 3237</span>    <a class="code hl_function" href="classtarget__ui.html#acc5b1b952d220d0cd766f9c32ab5eb38">draw_help_notice</a>();</div>
<div class="line"><a id="l03238" name="l03238"></a><span class="lineno"> 3238</span> </div>
<div class="line"><a id="l03239" name="l03239"></a><span class="lineno"> 3239</span>    <span class="keywordtype">int</span> text_y = 1; <span class="comment">// Skip top border</span></div>
<div class="line"><a id="l03240" name="l03240"></a><span class="lineno"> 3240</span> </div>
<div class="line"><a id="l03241" name="l03241"></a><span class="lineno"> 3241</span>    <a class="code hl_function" href="classtarget__ui.html#a86966228ce7aad77c233058bf1285962">panel_cursor_info</a>( text_y );</div>
<div class="line"><a id="l03242" name="l03242"></a><span class="lineno"> 3242</span>    text_y += <a class="code hl_variable" href="classtarget__ui.html#a34b69263e28fa4472b51104ec1d2e6f0">compact</a> ? 0 : 1;</div>
<div class="line"><a id="l03243" name="l03243"></a><span class="lineno"> 3243</span> </div>
<div class="line"><a id="l03244" name="l03244"></a><span class="lineno"> 3244</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> || <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70">TargetMode::TurretManual</a> ) {</div>
<div class="line"><a id="l03245" name="l03245"></a><span class="lineno"> 3245</span>        <a class="code hl_function" href="classtarget__ui.html#a545580558b81b3d44c43b52fc5ff1b77">panel_gun_info</a>( text_y );</div>
<div class="line"><a id="l03246" name="l03246"></a><span class="lineno"> 3246</span>        <a class="code hl_function" href="classtarget__ui.html#a9f08c10cac1401587f330fb97f5c2183">panel_recoil</a>( text_y );</div>
<div class="line"><a id="l03247" name="l03247"></a><span class="lineno"> 3247</span>        text_y += <a class="code hl_variable" href="classtarget__ui.html#a34b69263e28fa4472b51104ec1d2e6f0">compact</a> ? 0 : 1;</div>
<div class="line"><a id="l03248" name="l03248"></a><span class="lineno"> 3248</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd">TargetMode::Spell</a> ) {</div>
<div class="line"><a id="l03249" name="l03249"></a><span class="lineno"> 3249</span>        <a class="code hl_function" href="classtarget__ui.html#a14b8ebef108aaa7ad8c5176a04f600bb">panel_spell_info</a>( text_y );</div>
<div class="line"><a id="l03250" name="l03250"></a><span class="lineno"> 3250</span>        text_y += <a class="code hl_variable" href="classtarget__ui.html#a34b69263e28fa4472b51104ec1d2e6f0">compact</a> ? 0 : 1;</div>
<div class="line"><a id="l03251" name="l03251"></a><span class="lineno"> 3251</span>    }</div>
<div class="line"><a id="l03252" name="l03252"></a><span class="lineno"> 3252</span> </div>
<div class="line"><a id="l03253" name="l03253"></a><span class="lineno"> 3253</span>    <span class="keywordtype">bool</span> fill_with_blank_if_no_target = !<a class="code hl_variable" href="classtarget__ui.html#a1e6534092ef1b213639575c914030eb1">tiny</a>;</div>
<div class="line"><a id="l03254" name="l03254"></a><span class="lineno"> 3254</span>    <a class="code hl_function" href="classtarget__ui.html#a4bb70bd52ece44447bec77880106009d">panel_target_info</a>( text_y, fill_with_blank_if_no_target );</div>
<div class="line"><a id="l03255" name="l03255"></a><span class="lineno"> 3255</span>    text_y += <a class="code hl_variable" href="classtarget__ui.html#a34b69263e28fa4472b51104ec1d2e6f0">compact</a> ? 0 : 1;</div>
<div class="line"><a id="l03256" name="l03256"></a><span class="lineno"> 3256</span> </div>
<div class="line"><a id="l03257" name="l03257"></a><span class="lineno"> 3257</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">TargetMode::Turrets</a> ) {</div>
<div class="line"><a id="l03258" name="l03258"></a><span class="lineno"> 3258</span>        <a class="code hl_function" href="classtarget__ui.html#ad4a9c004a4c4cf26ad705174612584ea">panel_turret_list</a>( text_y );</div>
<div class="line"><a id="l03259" name="l03259"></a><span class="lineno"> 3259</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a0c6ad70beb3a7e76c3fc7adab7c46acc">Status::Good</a> ) {</div>
<div class="line"><a id="l03260" name="l03260"></a><span class="lineno"> 3260</span>        <span class="comment">// TODO: these are old, consider refactoring</span></div>
<div class="line"><a id="l03261" name="l03261"></a><span class="lineno"> 3261</span>        <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> ) {</div>
<div class="line"><a id="l03262" name="l03262"></a><span class="lineno"> 3262</span>            <a class="code hl_function" href="classtarget__ui.html#aa5c1e8816cd2a0f9c10e3ea2095eefe1">panel_fire_mode_aim</a>( text_y );</div>
<div class="line"><a id="l03263" name="l03263"></a><span class="lineno"> 3263</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8ce61dd2505effd96f937fa743b6491f">TargetMode::Throw</a> || <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8f61cfb2c3938627416432409d2f6e86">TargetMode::ThrowBlind</a> ) {</div>
<div class="line"><a id="l03264" name="l03264"></a><span class="lineno"> 3264</span>            <span class="keywordtype">bool</span> blind = ( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8f61cfb2c3938627416432409d2f6e86">TargetMode::ThrowBlind</a> );</div>
<div class="line"><a id="l03265" name="l03265"></a><span class="lineno"> 3265</span>            <a class="code hl_function" href="ranged_8cpp.html#a2e072a7b4bbd9c0deff64e0a8f1ffb85">draw_throw_aim</a>( *<a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>, <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, text_y, <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>, *<a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>, <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a>, blind );</div>
<div class="line"><a id="l03266" name="l03266"></a><span class="lineno"> 3266</span>        }</div>
<div class="line"><a id="l03267" name="l03267"></a><span class="lineno"> 3267</span>    }</div>
<div class="line"><a id="l03268" name="l03268"></a><span class="lineno"> 3268</span> </div>
<div class="line"><a id="l03269" name="l03269"></a><span class="lineno"> 3269</span>    <span class="keywordflow">if</span>( !<a class="code hl_variable" href="classtarget__ui.html#a4b525b1e2a39f4748409b97e8984947b">narrow</a> ) {</div>
<div class="line"><a id="l03270" name="l03270"></a><span class="lineno"> 3270</span>        <a class="code hl_function" href="classtarget__ui.html#a7d5114b61c688d3810c108986ddc8bf7">draw_controls_list</a>( text_y );</div>
<div class="line"><a id="l03271" name="l03271"></a><span class="lineno"> 3271</span>    }</div>
<div class="line"><a id="l03272" name="l03272"></a><span class="lineno"> 3272</span> </div>
<div class="line"><a id="l03273" name="l03273"></a><span class="lineno"> 3273</span>    <a class="code hl_function" href="namespacecatacurses.html#aa9823d249c21fa50daf277957fabb175">wnoutrefresh</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> );</div>
<div class="line"><a id="l03274" name="l03274"></a><span class="lineno"> 3274</span>}</div>
<div class="line"><a id="l03275" name="l03275"></a><span class="lineno"> 3275</span> </div>
<div class="line"><a id="l03276" name="l03276"></a><span class="lineno"><a class="line" href="classtarget__ui.html#abae2f397600dc6b01bb03f22bcd18666"> 3276</a></span>std::string <a class="code hl_function" href="classtarget__ui.html#abae2f397600dc6b01bb03f22bcd18666">target_ui::uitext_title</a>()</div>
<div class="line"><a id="l03277" name="l03277"></a><span class="lineno"> 3277</span>{</div>
<div class="line"><a id="l03278" name="l03278"></a><span class="lineno"> 3278</span>    <span class="keywordflow">switch</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> ) {</div>
<div class="line"><a id="l03279" name="l03279"></a><span class="lineno"> 3279</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a>:</div>
<div class="line"><a id="l03280" name="l03280"></a><span class="lineno"> 3280</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70">TargetMode::TurretManual</a>:</div>
<div class="line"><a id="l03281" name="l03281"></a><span class="lineno"> 3281</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Firing %s&quot;</span> ), <a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l03282" name="l03282"></a><span class="lineno"> 3282</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8ce61dd2505effd96f937fa743b6491f">TargetMode::Throw</a>:</div>
<div class="line"><a id="l03283" name="l03283"></a><span class="lineno"> 3283</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Throwing %s&quot;</span> ), <a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l03284" name="l03284"></a><span class="lineno"> 3284</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8f61cfb2c3938627416432409d2f6e86">TargetMode::ThrowBlind</a>:</div>
<div class="line"><a id="l03285" name="l03285"></a><span class="lineno"> 3285</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Blind throwing %s&quot;</span> ), <a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l03286" name="l03286"></a><span class="lineno"> 3286</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l03287" name="l03287"></a><span class="lineno"> 3287</span>            <span class="keywordflow">return</span> <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Set target&quot;</span> );</div>
<div class="line"><a id="l03288" name="l03288"></a><span class="lineno"> 3288</span>    }</div>
<div class="line"><a id="l03289" name="l03289"></a><span class="lineno"> 3289</span>}</div>
<div class="line"><a id="l03290" name="l03290"></a><span class="lineno"> 3290</span> </div>
<div class="line"><a id="l03291" name="l03291"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a2c23b4913b52b2a5f80357f34d92700c"> 3291</a></span>std::string <a class="code hl_function" href="classtarget__ui.html#a2c23b4913b52b2a5f80357f34d92700c">target_ui::uitext_fire</a>()</div>
<div class="line"><a id="l03292" name="l03292"></a><span class="lineno"> 3292</span>{</div>
<div class="line"><a id="l03293" name="l03293"></a><span class="lineno"> 3293</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8ce61dd2505effd96f937fa743b6491f">TargetMode::Throw</a> || <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8f61cfb2c3938627416432409d2f6e86">TargetMode::ThrowBlind</a> ) {</div>
<div class="line"><a id="l03294" name="l03294"></a><span class="lineno"> 3294</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="translations_8cpp.html#a176e288c640c6506a86330cb10fbe13a">to_translation</a>( <span class="stringliteral">&quot;[Hotkey] to throw&quot;</span>, <span class="stringliteral">&quot;to throw&quot;</span> ).<a class="code hl_function" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a id="l03295" name="l03295"></a><span class="lineno"> 3295</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997ab350f6de1060afddbefbdf47552464ae">TargetMode::Reach</a> ) {</div>
<div class="line"><a id="l03296" name="l03296"></a><span class="lineno"> 3296</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="translations_8cpp.html#a176e288c640c6506a86330cb10fbe13a">to_translation</a>( <span class="stringliteral">&quot;[Hotkey] to attack&quot;</span>, <span class="stringliteral">&quot;to attack&quot;</span> ).<a class="code hl_function" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a id="l03297" name="l03297"></a><span class="lineno"> 3297</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd">TargetMode::Spell</a> ) {</div>
<div class="line"><a id="l03298" name="l03298"></a><span class="lineno"> 3298</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="translations_8cpp.html#a176e288c640c6506a86330cb10fbe13a">to_translation</a>( <span class="stringliteral">&quot;[Hotkey] to cast the spell&quot;</span>, <span class="stringliteral">&quot;to cast&quot;</span> ).<a class="code hl_function" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a id="l03299" name="l03299"></a><span class="lineno"> 3299</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03300" name="l03300"></a><span class="lineno"> 3300</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="translations_8cpp.html#a176e288c640c6506a86330cb10fbe13a">to_translation</a>( <span class="stringliteral">&quot;[Hotkey] to fire&quot;</span>, <span class="stringliteral">&quot;to fire&quot;</span> ).<a class="code hl_function" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a id="l03301" name="l03301"></a><span class="lineno"> 3301</span>    }</div>
<div class="line"><a id="l03302" name="l03302"></a><span class="lineno"> 3302</span>}</div>
<div class="line"><a id="l03303" name="l03303"></a><span class="lineno"> 3303</span> </div>
<div class="line"><a id="l03304" name="l03304"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ad62889056a10382de6835688498cf20e"> 3304</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#ad62889056a10382de6835688498cf20e">target_ui::draw_window_title</a>()</div>
<div class="line"><a id="l03305" name="l03305"></a><span class="lineno"> 3305</span>{</div>
<div class="line"><a id="l03306" name="l03306"></a><span class="lineno"> 3306</span>    <a class="code hl_function" href="output_8cpp.html#a1184e3eda011b110d09bf2dcf08228f5">mvwprintz</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_struct" href="structpoint.html">point</a>( 2, 0 ), <a class="code hl_define" href="color_8h.html#a0d06dc49b9761bbc54607397213728bb">c_white</a>, <span class="stringliteral">&quot;&lt; &quot;</span> );</div>
<div class="line"><a id="l03307" name="l03307"></a><span class="lineno"> 3307</span>    <a class="code hl_function" href="output_8cpp.html#ab7abbbd98907f496533db9bc2a02cf4a">trim_and_print</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_struct" href="structpoint.html">point</a>( 4, 0 ), <a class="code hl_function" href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">getmaxx</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> ) - 7, <a class="code hl_define" href="color_8h.html#af0a87eaef36305269f4506dfa34d94c0">c_red</a>, <a class="code hl_function" href="classtarget__ui.html#abae2f397600dc6b01bb03f22bcd18666">uitext_title</a>() );</div>
<div class="line"><a id="l03308" name="l03308"></a><span class="lineno"> 3308</span>    <a class="code hl_function" href="output_8cpp.html#aedec608a42edd33ec812f7769a9ed0c9">wprintz</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_define" href="color_8h.html#a0d06dc49b9761bbc54607397213728bb">c_white</a>, <span class="stringliteral">&quot; &gt;&quot;</span> );</div>
<div class="line"><a id="l03309" name="l03309"></a><span class="lineno"> 3309</span>}</div>
<div class="line"><a id="l03310" name="l03310"></a><span class="lineno"> 3310</span> </div>
<div class="line"><a id="l03311" name="l03311"></a><span class="lineno"><a class="line" href="classtarget__ui.html#acc5b1b952d220d0cd766f9c32ab5eb38"> 3311</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#acc5b1b952d220d0cd766f9c32ab5eb38">target_ui::draw_help_notice</a>()</div>
<div class="line"><a id="l03312" name="l03312"></a><span class="lineno"> 3312</span>{</div>
<div class="line"><a id="l03313" name="l03313"></a><span class="lineno"> 3313</span>    <span class="keywordtype">int</span> text_y = <a class="code hl_function" href="namespacecatacurses.html#adc81ca40445dc062af12fb6d7a4793d0">getmaxy</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> ) - 1;</div>
<div class="line"><a id="l03314" name="l03314"></a><span class="lineno"> 3314</span>    <span class="keywordtype">int</span> width = <a class="code hl_function" href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">getmaxx</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> );</div>
<div class="line"><a id="l03315" name="l03315"></a><span class="lineno"> 3315</span>    <span class="keyword">const</span> std::string label_help = <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>(</div>
<div class="line"><a id="l03316" name="l03316"></a><span class="lineno"> 3316</span>                                       <a class="code hl_variable" href="classtarget__ui.html#a4b525b1e2a39f4748409b97e8984947b">narrow</a> ? <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;[%s] show help&quot;</span> ) : <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;[%s] show all controls&quot;</span> ),</div>
<div class="line"><a id="l03317" name="l03317"></a><span class="lineno"> 3317</span>                                       <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#abe76d2c284f2a277cbd2f367963fa9ab">get_desc</a>( <span class="stringliteral">&quot;HELP_KEYBINDINGS&quot;</span>, 1 ) );</div>
<div class="line"><a id="l03318" name="l03318"></a><span class="lineno"> 3318</span>    <span class="keywordtype">int</span> label_width = std::min( <a class="code hl_function" href="catacharset_8cpp.html#a7616a48a4b48437c60b6683439a8f3e2">utf8_width</a>( label_help ), width - 6 ); <span class="comment">// 6 for borders and &quot;&lt; &quot; + &quot; &gt;&quot;</span></div>
<div class="line"><a id="l03319" name="l03319"></a><span class="lineno"> 3319</span>    <span class="keywordtype">int</span> text_x = width - label_width - 6;</div>
<div class="line"><a id="l03320" name="l03320"></a><span class="lineno"> 3320</span>    <a class="code hl_function" href="output_8cpp.html#a1184e3eda011b110d09bf2dcf08228f5">mvwprintz</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_struct" href="structpoint.html">point</a>( text_x + 1, text_y ), <a class="code hl_define" href="color_8h.html#a0d06dc49b9761bbc54607397213728bb">c_white</a>, <span class="stringliteral">&quot;&lt; &quot;</span> );</div>
<div class="line"><a id="l03321" name="l03321"></a><span class="lineno"> 3321</span>    <a class="code hl_function" href="output_8cpp.html#ab7abbbd98907f496533db9bc2a02cf4a">trim_and_print</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_struct" href="structpoint.html">point</a>( text_x + 3, text_y ), label_width, <a class="code hl_define" href="color_8h.html#a0d06dc49b9761bbc54607397213728bb">c_white</a>, label_help );</div>
<div class="line"><a id="l03322" name="l03322"></a><span class="lineno"> 3322</span>    <a class="code hl_function" href="output_8cpp.html#aedec608a42edd33ec812f7769a9ed0c9">wprintz</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_define" href="color_8h.html#a0d06dc49b9761bbc54607397213728bb">c_white</a>, <span class="stringliteral">&quot; &gt;&quot;</span> );</div>
<div class="line"><a id="l03323" name="l03323"></a><span class="lineno"> 3323</span>}</div>
<div class="line"><a id="l03324" name="l03324"></a><span class="lineno"> 3324</span> </div>
<div class="line"><a id="l03325" name="l03325"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a7d5114b61c688d3810c108986ddc8bf7"> 3325</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a7d5114b61c688d3810c108986ddc8bf7">target_ui::draw_controls_list</a>( <span class="keywordtype">int</span> text_y )</div>
<div class="line"><a id="l03326" name="l03326"></a><span class="lineno"> 3326</span>{</div>
<div class="line"><a id="l03327" name="l03327"></a><span class="lineno"> 3327</span>    <span class="comment">// Change UI colors for visual feedback</span></div>
<div class="line"><a id="l03328" name="l03328"></a><span class="lineno"> 3328</span>    <span class="comment">// TODO: Colorize keys inside brackets to be consistent with other UI windows</span></div>
<div class="line"><a id="l03329" name="l03329"></a><span class="lineno"> 3329</span>    <a class="code hl_class" href="classnc__color.html">nc_color</a> col_enabled = <a class="code hl_define" href="color_8h.html#a0d06dc49b9761bbc54607397213728bb">c_white</a>;</div>
<div class="line"><a id="l03330" name="l03330"></a><span class="lineno"> 3330</span>    <a class="code hl_class" href="classnc__color.html">nc_color</a> col_disabled = <a class="code hl_define" href="color_8h.html#a1b1e3c0bef566a83c3535e38a93ad733">c_light_gray</a>;</div>
<div class="line"><a id="l03331" name="l03331"></a><span class="lineno"> 3331</span>    <a class="code hl_class" href="classnc__color.html">nc_color</a> col_move = ( <a class="code hl_variable" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> != <a class="code hl_enumvalue" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202aaa5b08f858f7353c5d012d6706525773">Status::OutOfAmmo</a> ? col_enabled : col_disabled );</div>
<div class="line"><a id="l03332" name="l03332"></a><span class="lineno"> 3332</span>    <a class="code hl_class" href="classnc__color.html">nc_color</a> col_fire = ( <a class="code hl_variable" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a0c6ad70beb3a7e76c3fc7adab7c46acc">Status::Good</a> ? col_enabled : col_disabled );</div>
<div class="line"><a id="l03333" name="l03333"></a><span class="lineno"> 3333</span> </div>
<div class="line"><a id="l03334" name="l03334"></a><span class="lineno"> 3334</span>    <span class="comment">// Get first key bound to given action OR &#39; &#39; if there are none.</span></div>
<div class="line"><a id="l03335" name="l03335"></a><span class="lineno"> 3335</span>    <span class="keyword">const</span> <span class="keyword">auto</span> bound_key = [<span class="keyword">this</span>]( <span class="keyword">const</span> std::string &amp; s ) {</div>
<div class="line"><a id="l03336" name="l03336"></a><span class="lineno"> 3336</span>        <span class="keyword">const</span> std::vector&lt;char&gt; keys = this-&gt;ctxt.<a class="code hl_function" href="classinput__context.html#af2b7d6cab67d5a2eeb1122f3041edf79">keys_bound_to</a>( s );</div>
<div class="line"><a id="l03337" name="l03337"></a><span class="lineno"> 3337</span>        <span class="keywordflow">return</span> keys.empty() ? <span class="charliteral">&#39; &#39;</span> : keys.front();</div>
<div class="line"><a id="l03338" name="l03338"></a><span class="lineno"> 3338</span>    };</div>
<div class="line"><a id="l03339" name="l03339"></a><span class="lineno"> 3339</span>    <span class="keyword">const</span> <span class="keyword">auto</span> colored = [col_enabled]( <a class="code hl_class" href="classnc__color.html">nc_color</a> <a class="code hl_function" href="editmap_8cpp.html#a025a5c063205294df20818edc4cfe355">color</a>, <span class="keyword">const</span> std::string &amp; s ) {</div>
<div class="line"><a id="l03340" name="l03340"></a><span class="lineno"> 3340</span>        <span class="keywordflow">if</span>( <a class="code hl_function" href="editmap_8cpp.html#a025a5c063205294df20818edc4cfe355">color</a> == col_enabled ) {</div>
<div class="line"><a id="l03341" name="l03341"></a><span class="lineno"> 3341</span>            <span class="comment">// col_enabled is the default one when printing</span></div>
<div class="line"><a id="l03342" name="l03342"></a><span class="lineno"> 3342</span>            <span class="keywordflow">return</span> s;</div>
<div class="line"><a id="l03343" name="l03343"></a><span class="lineno"> 3343</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03344" name="l03344"></a><span class="lineno"> 3344</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="color_8cpp.html#a0f25678be1fc95cb81381a004493a4cc">colorize</a>( s, <a class="code hl_function" href="editmap_8cpp.html#a025a5c063205294df20818edc4cfe355">color</a> );</div>
<div class="line"><a id="l03345" name="l03345"></a><span class="lineno"> 3345</span>        }</div>
<div class="line"><a id="l03346" name="l03346"></a><span class="lineno"> 3346</span>    };</div>
<div class="line"><a id="l03347" name="l03347"></a><span class="lineno"> 3347</span> </div>
<div class="line"><a id="l03348" name="l03348"></a><span class="lineno"> 3348</span>    <span class="keyword">struct </span><a class="code hl_function" href="mapgen_8cpp.html#a90f1f53dc044e93e7f7f9314cef1bd45">line</a> {</div>
<div class="line"><a id="l03349" name="l03349"></a><span class="lineno"> 3349</span>        <span class="keywordtype">size_t</span> order; <span class="comment">// Lines with highest &#39;order&#39; are removed first</span></div>
<div class="line"><a id="l03350" name="l03350"></a><span class="lineno"> 3350</span>        std::string str;</div>
<div class="line"><a id="l03351" name="l03351"></a><span class="lineno"> 3351</span>    };</div>
<div class="line"><a id="l03352" name="l03352"></a><span class="lineno"> 3352</span>    std::vector&lt;line&gt; lines;</div>
<div class="line"><a id="l03353" name="l03353"></a><span class="lineno"> 3353</span> </div>
<div class="line"><a id="l03354" name="l03354"></a><span class="lineno"> 3354</span>    <span class="comment">// Compile full list</span></div>
<div class="line"><a id="l03355" name="l03355"></a><span class="lineno"> 3355</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a122323ec4c1e72c291e76643ccfd3fde">shifting_view</a> ) {</div>
<div class="line"><a id="l03356" name="l03356"></a><span class="lineno"> 3356</span>        lines.push_back( { 8, colored( col_move, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Shift view with directional keys&quot;</span> ) ) } );</div>
<div class="line"><a id="l03357" name="l03357"></a><span class="lineno"> 3357</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03358" name="l03358"></a><span class="lineno"> 3358</span>        lines.push_back( { 8, colored( col_move, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Move cursor with directional keys&quot;</span> ) ) } );</div>
<div class="line"><a id="l03359" name="l03359"></a><span class="lineno"> 3359</span>    }</div>
<div class="line"><a id="l03360" name="l03360"></a><span class="lineno"> 3360</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="input_8cpp.html#aceedd903724817bad81fbc03216ff125">is_mouse_enabled</a>() ) {</div>
<div class="line"><a id="l03361" name="l03361"></a><span class="lineno"> 3361</span>        std::string <a class="code hl_function" href="namespaceavatar__action.html#a76ba74774376a08222b8cdcce08f7304">move</a> = <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Mouse: LMB: Target, Wheel: Cycle,&quot;</span> );</div>
<div class="line"><a id="l03362" name="l03362"></a><span class="lineno"> 3362</span>        std::string <a class="code hl_function" href="handle__action_8cpp.html#ad56544ec96a0f79ea4e47ae8f8754d10">fire</a> = <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;RMB: Fire&quot;</span> );</div>
<div class="line"><a id="l03363" name="l03363"></a><span class="lineno"> 3363</span>        lines.push_back( { 7, colored( col_move, <a class="code hl_function" href="namespaceavatar__action.html#a76ba74774376a08222b8cdcce08f7304">move</a> ) + <span class="stringliteral">&quot; &quot;</span> + colored( col_fire, <a class="code hl_function" href="handle__action_8cpp.html#ad56544ec96a0f79ea4e47ae8f8754d10">fire</a> ) } );</div>
<div class="line"><a id="l03364" name="l03364"></a><span class="lineno"> 3364</span>    }</div>
<div class="line"><a id="l03365" name="l03365"></a><span class="lineno"> 3365</span>    {</div>
<div class="line"><a id="l03366" name="l03366"></a><span class="lineno"> 3366</span>        std::string cycle = <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;[%s] Cycle targets;&quot;</span> ), <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code hl_function" href="classinput__context.html#abe76d2c284f2a277cbd2f367963fa9ab">get_desc</a>( <span class="stringliteral">&quot;NEXT_TARGET&quot;</span>, 1 ) );</div>
<div class="line"><a id="l03367" name="l03367"></a><span class="lineno"> 3367</span>        std::string <a class="code hl_function" href="handle__action_8cpp.html#ad56544ec96a0f79ea4e47ae8f8754d10">fire</a> = <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;[%c] %s.&quot;</span> ), bound_key( <span class="stringliteral">&quot;FIRE&quot;</span> ), <a class="code hl_function" href="classtarget__ui.html#a2c23b4913b52b2a5f80357f34d92700c">uitext_fire</a>() );</div>
<div class="line"><a id="l03368" name="l03368"></a><span class="lineno"> 3368</span>        lines.push_back( { 0, colored( col_move, cycle ) + <span class="stringliteral">&quot; &quot;</span> + colored( col_fire, <a class="code hl_function" href="handle__action_8cpp.html#ad56544ec96a0f79ea4e47ae8f8754d10">fire</a> ) } );</div>
<div class="line"><a id="l03369" name="l03369"></a><span class="lineno"> 3369</span>    }</div>
<div class="line"><a id="l03370" name="l03370"></a><span class="lineno"> 3370</span>    {</div>
<div class="line"><a id="l03371" name="l03371"></a><span class="lineno"> 3371</span>        std::string text = <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;[%c] target self; [%c] toggle snap-to-target&quot;</span> ),</div>
<div class="line"><a id="l03372" name="l03372"></a><span class="lineno"> 3372</span>                                          bound_key( <span class="stringliteral">&quot;CENTER&quot;</span> ), bound_key( <span class="stringliteral">&quot;TOGGLE_SNAP_TO_TARGET&quot;</span> ) );</div>
<div class="line"><a id="l03373" name="l03373"></a><span class="lineno"> 3373</span>        lines.push_back( { 3, colored( col_enabled, text ) } );</div>
<div class="line"><a id="l03374" name="l03374"></a><span class="lineno"> 3374</span>    }</div>
<div class="line"><a id="l03375" name="l03375"></a><span class="lineno"> 3375</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> ) {</div>
<div class="line"><a id="l03376" name="l03376"></a><span class="lineno"> 3376</span>        std::string aim_and_fire;</div>
<div class="line"><a id="l03377" name="l03377"></a><span class="lineno"> 3377</span>        <span class="keywordflow">for</span>( <span class="keyword">const</span> <span class="keyword">auto</span> &amp;e : <a class="code hl_variable" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a> ) {</div>
<div class="line"><a id="l03378" name="l03378"></a><span class="lineno"> 3378</span>            <span class="keywordflow">if</span>( e.has_threshold ) {</div>
<div class="line"><a id="l03379" name="l03379"></a><span class="lineno"> 3379</span>                aim_and_fire += <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <span class="stringliteral">&quot;[%c] &quot;</span>, bound_key( e.action ) );</div>
<div class="line"><a id="l03380" name="l03380"></a><span class="lineno"> 3380</span>            }</div>
<div class="line"><a id="l03381" name="l03381"></a><span class="lineno"> 3381</span>        }</div>
<div class="line"><a id="l03382" name="l03382"></a><span class="lineno"> 3382</span>        aim_and_fire += <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;to aim and fire.&quot;</span> );</div>
<div class="line"><a id="l03383" name="l03383"></a><span class="lineno"> 3383</span> </div>
<div class="line"><a id="l03384" name="l03384"></a><span class="lineno"> 3384</span>        std::string aim = <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;[%c] to steady your aim.  (10 moves)&quot;</span> ),</div>
<div class="line"><a id="l03385" name="l03385"></a><span class="lineno"> 3385</span>                                         bound_key( <span class="stringliteral">&quot;AIM&quot;</span> ) );</div>
<div class="line"><a id="l03386" name="l03386"></a><span class="lineno"> 3386</span> </div>
<div class="line"><a id="l03387" name="l03387"></a><span class="lineno"> 3387</span>        lines.push_back( { 2, colored( col_fire, aim ) } );</div>
<div class="line"><a id="l03388" name="l03388"></a><span class="lineno"> 3388</span>        lines.push_back( { 4, colored( col_fire, aim_and_fire ) } );</div>
<div class="line"><a id="l03389" name="l03389"></a><span class="lineno"> 3389</span>    }</div>
<div class="line"><a id="l03390" name="l03390"></a><span class="lineno"> 3390</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> || <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70">TargetMode::TurretManual</a> ) {</div>
<div class="line"><a id="l03391" name="l03391"></a><span class="lineno"> 3391</span>        lines.push_back( { 5, colored( col_enabled, <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;[%c] to switch firing modes.&quot;</span> ),</div>
<div class="line"><a id="l03392" name="l03392"></a><span class="lineno"> 3392</span>                                       bound_key( <span class="stringliteral">&quot;SWITCH_MODE&quot;</span> ) ) ) } );</div>
<div class="line"><a id="l03393" name="l03393"></a><span class="lineno"> 3393</span>        lines.push_back( { 6, colored( col_enabled, <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;[%c] to switch ammo.&quot;</span> ),</div>
<div class="line"><a id="l03394" name="l03394"></a><span class="lineno"> 3394</span>                                       bound_key( <span class="stringliteral">&quot;SWITCH_AMMO&quot;</span> ) ) ) } );</div>
<div class="line"><a id="l03395" name="l03395"></a><span class="lineno"> 3395</span>    }</div>
<div class="line"><a id="l03396" name="l03396"></a><span class="lineno"> 3396</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">TargetMode::Turrets</a> ) {</div>
<div class="line"><a id="l03397" name="l03397"></a><span class="lineno"> 3397</span>        <span class="keyword">const</span> std::string <a class="code hl_struct" href="structlabel.html">label</a> = <a class="code hl_variable" href="classtarget__ui.html#a63ac73585a9794e93d181362f7473b50">draw_turret_lines</a></div>
<div class="line"><a id="l03398" name="l03398"></a><span class="lineno"> 3398</span>                                  ? <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;[%c] Hide lines of fire&quot;</span> )</div>
<div class="line"><a id="l03399" name="l03399"></a><span class="lineno"> 3399</span>                                  : <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;[%c] Show lines of fire&quot;</span> );</div>
<div class="line"><a id="l03400" name="l03400"></a><span class="lineno"> 3400</span>        lines.push_back( { 1, colored( col_enabled, <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_struct" href="structlabel.html">label</a>, bound_key( <span class="stringliteral">&quot;TOGGLE_TURRET_LINES&quot;</span> ) ) ) } );</div>
<div class="line"><a id="l03401" name="l03401"></a><span class="lineno"> 3401</span>    }</div>
<div class="line"><a id="l03402" name="l03402"></a><span class="lineno"> 3402</span> </div>
<div class="line"><a id="l03403" name="l03403"></a><span class="lineno"> 3403</span>    <span class="comment">// Shrink the list until it fits</span></div>
<div class="line"><a id="l03404" name="l03404"></a><span class="lineno"> 3404</span>    <span class="keywordtype">int</span> height = <a class="code hl_function" href="namespacecatacurses.html#adc81ca40445dc062af12fb6d7a4793d0">getmaxy</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> );</div>
<div class="line"><a id="l03405" name="l03405"></a><span class="lineno"> 3405</span>    <span class="keywordtype">int</span> available_lines = height - text_y - 1; <span class="comment">// 1 for bottom border</span></div>
<div class="line"><a id="l03406" name="l03406"></a><span class="lineno"> 3406</span>    <span class="keywordflow">if</span>( available_lines &lt;= 0 ) {</div>
<div class="line"><a id="l03407" name="l03407"></a><span class="lineno"> 3407</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03408" name="l03408"></a><span class="lineno"> 3408</span>    }</div>
<div class="line"><a id="l03409" name="l03409"></a><span class="lineno"> 3409</span>    <span class="keywordflow">while</span>( lines.size() &gt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>( available_lines ) ) {</div>
<div class="line"><a id="l03410" name="l03410"></a><span class="lineno"> 3410</span>        lines.erase( std::max_element( lines.begin(), lines.end(), []( <span class="keyword">const</span> <a class="code hl_function" href="mapgen_8cpp.html#a90f1f53dc044e93e7f7f9314cef1bd45">line</a> &amp; l1, <span class="keyword">const</span> <a class="code hl_function" href="mapgen_8cpp.html#a90f1f53dc044e93e7f7f9314cef1bd45">line</a> &amp; l2 ) {</div>
<div class="line"><a id="l03411" name="l03411"></a><span class="lineno"> 3411</span>            return l1.order &lt; l2.order;</div>
<div class="line"><a id="l03412" name="l03412"></a><span class="lineno"> 3412</span>        } ) );</div>
<div class="line"><a id="l03413" name="l03413"></a><span class="lineno"> 3413</span>    }</div>
<div class="line"><a id="l03414" name="l03414"></a><span class="lineno"> 3414</span> </div>
<div class="line"><a id="l03415" name="l03415"></a><span class="lineno"> 3415</span>    text_y = height - lines.size() - 1;</div>
<div class="line"><a id="l03416" name="l03416"></a><span class="lineno"> 3416</span>    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_function" href="mapgen_8cpp.html#a90f1f53dc044e93e7f7f9314cef1bd45">line</a> &amp;l : lines ) {</div>
<div class="line"><a id="l03417" name="l03417"></a><span class="lineno"> 3417</span>        <a class="code hl_class" href="classnc__color.html">nc_color</a> col = col_enabled;</div>
<div class="line"><a id="l03418" name="l03418"></a><span class="lineno"> 3418</span>        <a class="code hl_function" href="output_8cpp.html#a9fcad5b904c8019b15fe1ac8e665a1cb">print_colored_text</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_struct" href="structpoint.html">point</a>( 1, text_y++ ), col, col, l.str );</div>
<div class="line"><a id="l03419" name="l03419"></a><span class="lineno"> 3419</span>    }</div>
<div class="line"><a id="l03420" name="l03420"></a><span class="lineno"> 3420</span>}</div>
<div class="line"><a id="l03421" name="l03421"></a><span class="lineno"> 3421</span> </div>
<div class="line"><a id="l03422" name="l03422"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a86966228ce7aad77c233058bf1285962"> 3422</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a86966228ce7aad77c233058bf1285962">target_ui::panel_cursor_info</a>( <span class="keywordtype">int</span> &amp;text_y )</div>
<div class="line"><a id="l03423" name="l03423"></a><span class="lineno"> 3423</span>{</div>
<div class="line"><a id="l03424" name="l03424"></a><span class="lineno"> 3424</span>    std::string label_range;</div>
<div class="line"><a id="l03425" name="l03425"></a><span class="lineno"> 3425</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> == <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> ) {</div>
<div class="line"><a id="l03426" name="l03426"></a><span class="lineno"> 3426</span>        label_range = <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <span class="stringliteral">&quot;Range: %d&quot;</span>, <a class="code hl_variable" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> );</div>
<div class="line"><a id="l03427" name="l03427"></a><span class="lineno"> 3427</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03428" name="l03428"></a><span class="lineno"> 3428</span>        label_range = <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <span class="stringliteral">&quot;Range: %d/%d&quot;</span>, <a class="code hl_function" href="classtarget__ui.html#ab236848678058afb7605e6d82a5c8fa9">dist_fn</a>( <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> ), <a class="code hl_variable" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> );</div>
<div class="line"><a id="l03429" name="l03429"></a><span class="lineno"> 3429</span>    }</div>
<div class="line"><a id="l03430" name="l03430"></a><span class="lineno"> 3430</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a365b2699d38b61ef4b4c8a1066c8468f">Status::OutOfRange</a> &amp;&amp; <a class="code hl_variable" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> != <a class="code hl_enumvalue" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">TargetMode::Turrets</a> ) {</div>
<div class="line"><a id="l03431" name="l03431"></a><span class="lineno"> 3431</span>        <span class="comment">// Since each turret has its own range, highlighting cursor</span></div>
<div class="line"><a id="l03432" name="l03432"></a><span class="lineno"> 3432</span>        <span class="comment">// range with red would be misleading</span></div>
<div class="line"><a id="l03433" name="l03433"></a><span class="lineno"> 3433</span>        label_range = <a class="code hl_function" href="color_8cpp.html#a0f25678be1fc95cb81381a004493a4cc">colorize</a>( label_range, <a class="code hl_define" href="color_8h.html#af0a87eaef36305269f4506dfa34d94c0">c_red</a> );</div>
<div class="line"><a id="l03434" name="l03434"></a><span class="lineno"> 3434</span>    }</div>
<div class="line"><a id="l03435" name="l03435"></a><span class="lineno"> 3435</span> </div>
<div class="line"><a id="l03436" name="l03436"></a><span class="lineno"> 3436</span>    std::vector&lt;std::string&gt; labels;</div>
<div class="line"><a id="l03437" name="l03437"></a><span class="lineno"> 3437</span>    labels.push_back( label_range );</div>
<div class="line"><a id="l03438" name="l03438"></a><span class="lineno"> 3438</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a45f98789c877903961a56a54b17d9e96">allow_zlevel_shift</a> ) {</div>
<div class="line"><a id="l03439" name="l03439"></a><span class="lineno"> 3439</span>        labels.push_back( <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Elevation: %d&quot;</span> ), <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a>.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> - <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>.<a class="code hl_variable" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> ) );</div>
<div class="line"><a id="l03440" name="l03440"></a><span class="lineno"> 3440</span>    }</div>
<div class="line"><a id="l03441" name="l03441"></a><span class="lineno"> 3441</span>    labels.push_back( <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Targets: %d&quot;</span> ), <a class="code hl_variable" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.size() ) );</div>
<div class="line"><a id="l03442" name="l03442"></a><span class="lineno"> 3442</span> </div>
<div class="line"><a id="l03443" name="l03443"></a><span class="lineno"> 3443</span>    <a class="code hl_class" href="classnc__color.html">nc_color</a> col = <a class="code hl_define" href="color_8h.html#a1b1e3c0bef566a83c3535e38a93ad733">c_light_gray</a>;</div>
<div class="line"><a id="l03444" name="l03444"></a><span class="lineno"> 3444</span>    <span class="keywordtype">int</span> width = <a class="code hl_function" href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">getmaxx</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> );</div>
<div class="line"><a id="l03445" name="l03445"></a><span class="lineno"> 3445</span>    <span class="keywordtype">int</span> text_x = 1;</div>
<div class="line"><a id="l03446" name="l03446"></a><span class="lineno"> 3446</span>    <span class="keywordflow">for</span>( <span class="keyword">const</span> std::string &amp;s : labels ) {</div>
<div class="line"><a id="l03447" name="l03447"></a><span class="lineno"> 3447</span>        <span class="keywordtype">int</span> x_left = width - text_x - 1;</div>
<div class="line"><a id="l03448" name="l03448"></a><span class="lineno"> 3448</span>        <span class="keywordtype">int</span> len = <a class="code hl_function" href="catacharset_8cpp.html#a7616a48a4b48437c60b6683439a8f3e2">utf8_width</a>( s, <span class="keyword">true</span> );</div>
<div class="line"><a id="l03449" name="l03449"></a><span class="lineno"> 3449</span>        <span class="keywordflow">if</span>( len &gt; x_left ) {</div>
<div class="line"><a id="l03450" name="l03450"></a><span class="lineno"> 3450</span>            text_x = 1;</div>
<div class="line"><a id="l03451" name="l03451"></a><span class="lineno"> 3451</span>            text_y++;</div>
<div class="line"><a id="l03452" name="l03452"></a><span class="lineno"> 3452</span>        }</div>
<div class="line"><a id="l03453" name="l03453"></a><span class="lineno"> 3453</span>        <a class="code hl_function" href="output_8cpp.html#a9fcad5b904c8019b15fe1ac8e665a1cb">print_colored_text</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_struct" href="structpoint.html">point</a>( text_x, text_y ), col, col, s );</div>
<div class="line"><a id="l03454" name="l03454"></a><span class="lineno"> 3454</span>        text_x += len + 1; <span class="comment">// 1 for space</span></div>
<div class="line"><a id="l03455" name="l03455"></a><span class="lineno"> 3455</span>    }</div>
<div class="line"><a id="l03456" name="l03456"></a><span class="lineno"> 3456</span>    text_y++;</div>
<div class="line"><a id="l03457" name="l03457"></a><span class="lineno"> 3457</span>}</div>
<div class="line"><a id="l03458" name="l03458"></a><span class="lineno"> 3458</span> </div>
<div class="line"><a id="l03459" name="l03459"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a545580558b81b3d44c43b52fc5ff1b77"> 3459</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a545580558b81b3d44c43b52fc5ff1b77">target_ui::panel_gun_info</a>( <span class="keywordtype">int</span> &amp;text_y )</div>
<div class="line"><a id="l03460" name="l03460"></a><span class="lineno"> 3460</span>{</div>
<div class="line"><a id="l03461" name="l03461"></a><span class="lineno"> 3461</span>    <a class="code hl_class" href="classgun__mode.html">gun_mode</a> m = <a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code hl_function" href="classitem.html#a1a94ea108d695febf7f2bcf090f097fa">gun_current_mode</a>();</div>
<div class="line"><a id="l03462" name="l03462"></a><span class="lineno"> 3462</span>    std::string mode_name = m.<a class="code hl_function" href="classgun__mode.html#a583a586a605731dbd36af20553c0e51d">tname</a>();</div>
<div class="line"><a id="l03463" name="l03463"></a><span class="lineno"> 3463</span>    std::string gunmod_name;</div>
<div class="line"><a id="l03464" name="l03464"></a><span class="lineno"> 3464</span>    <span class="keywordflow">if</span>( m.<a class="code hl_variable" href="classgun__mode.html#aadaa36507ace08fc621348ae1052647e">target</a> != <a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a> ) {</div>
<div class="line"><a id="l03465" name="l03465"></a><span class="lineno"> 3465</span>        <span class="comment">// Gun mode comes from a gunmod, not base gun. Add gunmod&#39;s name</span></div>
<div class="line"><a id="l03466" name="l03466"></a><span class="lineno"> 3466</span>        gunmod_name = m-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() + <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a id="l03467" name="l03467"></a><span class="lineno"> 3467</span>    }</div>
<div class="line"><a id="l03468" name="l03468"></a><span class="lineno"> 3468</span>    std::string str = <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Firing mode: &lt;color_cyan&gt;%s%s (%d)&lt;/color&gt;&quot;</span> ),</div>
<div class="line"><a id="l03469" name="l03469"></a><span class="lineno"> 3469</span>                                     gunmod_name, mode_name, m.<a class="code hl_variable" href="classgun__mode.html#a0b58020ecc1a637010d13f0ee7c40ef8">qty</a></div>
<div class="line"><a id="l03470" name="l03470"></a><span class="lineno"> 3470</span>                                   );</div>
<div class="line"><a id="l03471" name="l03471"></a><span class="lineno"> 3471</span>    <a class="code hl_class" href="classnc__color.html">nc_color</a> clr = <a class="code hl_define" href="color_8h.html#a1b1e3c0bef566a83c3535e38a93ad733">c_light_gray</a>;</div>
<div class="line"><a id="l03472" name="l03472"></a><span class="lineno"> 3472</span>    <a class="code hl_function" href="output_8cpp.html#a9fcad5b904c8019b15fe1ac8e665a1cb">print_colored_text</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_struct" href="structpoint.html">point</a>( 1, text_y++ ), clr, clr, str );</div>
<div class="line"><a id="l03473" name="l03473"></a><span class="lineno"> 3473</span> </div>
<div class="line"><a id="l03474" name="l03474"></a><span class="lineno"> 3474</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> == <a class="code hl_enumvalue" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202aaa5b08f858f7353c5d012d6706525773">Status::OutOfAmmo</a> ) {</div>
<div class="line"><a id="l03475" name="l03475"></a><span class="lineno"> 3475</span>        <a class="code hl_function" href="output_8cpp.html#a1184e3eda011b110d09bf2dcf08228f5">mvwprintz</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_struct" href="structpoint.html">point</a>( 1, text_y++ ), <a class="code hl_define" href="color_8h.html#af0a87eaef36305269f4506dfa34d94c0">c_red</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;OUT OF AMMO&quot;</span> ) );</div>
<div class="line"><a id="l03476" name="l03476"></a><span class="lineno"> 3476</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#ae5ae79a739fcab56301077b8802355ce">ammo</a> ) {</div>
<div class="line"><a id="l03477" name="l03477"></a><span class="lineno"> 3477</span>        str = <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( m-&gt;<a class="code hl_function" href="classitem.html#a26c025fd4909bd31c8e91ed87905507b">ammo_remaining</a>() ? <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Ammo: %s (%d/%d)&quot;</span> ) : <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Ammo: %s&quot;</span> ),</div>
<div class="line"><a id="l03478" name="l03478"></a><span class="lineno"> 3478</span>                             <a class="code hl_function" href="color_8cpp.html#a0f25678be1fc95cb81381a004493a4cc">colorize</a>( <a class="code hl_variable" href="classtarget__ui.html#ae5ae79a739fcab56301077b8802355ce">ammo</a>-&gt;<a class="code hl_function" href="structitype.html#ad35fbe0013544c1c396944b20b264421">nname</a>( std::max( m-&gt;<a class="code hl_function" href="classitem.html#a26c025fd4909bd31c8e91ed87905507b">ammo_remaining</a>(), 1 ) ), <a class="code hl_variable" href="classtarget__ui.html#ae5ae79a739fcab56301077b8802355ce">ammo</a>-&gt;<a class="code hl_variable" href="structitype.html#af4d6fc9396d1e09f23d2008f974ac757">color</a> ), m-&gt;<a class="code hl_function" href="classitem.html#a26c025fd4909bd31c8e91ed87905507b">ammo_remaining</a>(),</div>
<div class="line"><a id="l03479" name="l03479"></a><span class="lineno"> 3479</span>                             m-&gt;<a class="code hl_function" href="classitem.html#a5d89f04a2a08245ec865db0865e8a6c1">ammo_capacity</a>() );</div>
<div class="line"><a id="l03480" name="l03480"></a><span class="lineno"> 3480</span>        <a class="code hl_function" href="output_8cpp.html#a9fcad5b904c8019b15fe1ac8e665a1cb">print_colored_text</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_struct" href="structpoint.html">point</a>( 1, text_y++ ), clr, clr, str );</div>
<div class="line"><a id="l03481" name="l03481"></a><span class="lineno"> 3481</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03482" name="l03482"></a><span class="lineno"> 3482</span>        <span class="comment">// Weapon doesn&#39;t use ammunition</span></div>
<div class="line"><a id="l03483" name="l03483"></a><span class="lineno"> 3483</span>        text_y++;</div>
<div class="line"><a id="l03484" name="l03484"></a><span class="lineno"> 3484</span>    }</div>
<div class="line"><a id="l03485" name="l03485"></a><span class="lineno"> 3485</span>}</div>
<div class="line"><a id="l03486" name="l03486"></a><span class="lineno"> 3486</span> </div>
<div class="line"><a id="l03487" name="l03487"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a9f08c10cac1401587f330fb97f5c2183"> 3487</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a9f08c10cac1401587f330fb97f5c2183">target_ui::panel_recoil</a>( <span class="keywordtype">int</span> &amp;text_y )</div>
<div class="line"><a id="l03488" name="l03488"></a><span class="lineno"> 3488</span>{</div>
<div class="line"><a id="l03489" name="l03489"></a><span class="lineno"> 3489</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> val = <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_function" href="classCharacter.html#aec46a4b513360ef60f6143830bbb711d">recoil_total</a>();</div>
<div class="line"><a id="l03490" name="l03490"></a><span class="lineno"> 3490</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> min_recoil = <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_function" href="classCharacter.html#a37855668c0e9260587d5561b044f5510">effective_dispersion</a>( <a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code hl_function" href="classitem.html#af0b7e5875297be57d675270f57ff775a">sight_dispersion</a>() );</div>
<div class="line"><a id="l03491" name="l03491"></a><span class="lineno"> 3491</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> recoil_range = <a class="code hl_variable" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a> - min_recoil;</div>
<div class="line"><a id="l03492" name="l03492"></a><span class="lineno"> 3492</span>    std::string str;</div>
<div class="line"><a id="l03493" name="l03493"></a><span class="lineno"> 3493</span>    <span class="keywordflow">if</span>( val &gt;= min_recoil + ( recoil_range * 2 / 3 ) ) {</div>
<div class="line"><a id="l03494" name="l03494"></a><span class="lineno"> 3494</span>        str = <a class="code hl_function" href="translations_8cpp.html#af0c79b5c75a7cf2df78663485b03ed9a">pgettext</a>( <span class="stringliteral">&quot;amount of backward momentum&quot;</span>, <span class="stringliteral">&quot;&lt;color_red&gt;High&lt;/color&gt;&quot;</span> );</div>
<div class="line"><a id="l03495" name="l03495"></a><span class="lineno"> 3495</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( val &gt;= min_recoil + ( recoil_range / 2 ) ) {</div>
<div class="line"><a id="l03496" name="l03496"></a><span class="lineno"> 3496</span>        str = <a class="code hl_function" href="translations_8cpp.html#af0c79b5c75a7cf2df78663485b03ed9a">pgettext</a>( <span class="stringliteral">&quot;amount of backward momentum&quot;</span>, <span class="stringliteral">&quot;&lt;color_yellow&gt;Medium&lt;/color&gt;&quot;</span> );</div>
<div class="line"><a id="l03497" name="l03497"></a><span class="lineno"> 3497</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( val &gt;= min_recoil + ( recoil_range / 4 ) ) {</div>
<div class="line"><a id="l03498" name="l03498"></a><span class="lineno"> 3498</span>        str = <a class="code hl_function" href="translations_8cpp.html#af0c79b5c75a7cf2df78663485b03ed9a">pgettext</a>( <span class="stringliteral">&quot;amount of backward momentum&quot;</span>, <span class="stringliteral">&quot;&lt;color_light_green&gt;Low&lt;/color&gt;&quot;</span> );</div>
<div class="line"><a id="l03499" name="l03499"></a><span class="lineno"> 3499</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03500" name="l03500"></a><span class="lineno"> 3500</span>        str = <a class="code hl_function" href="translations_8cpp.html#af0c79b5c75a7cf2df78663485b03ed9a">pgettext</a>( <span class="stringliteral">&quot;amount of backward momentum&quot;</span>, <span class="stringliteral">&quot;&lt;color_cyan&gt;None&lt;/color&gt;&quot;</span> );</div>
<div class="line"><a id="l03501" name="l03501"></a><span class="lineno"> 3501</span>    }</div>
<div class="line"><a id="l03502" name="l03502"></a><span class="lineno"> 3502</span>    str = <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Recoil: %s&quot;</span> ), str );</div>
<div class="line"><a id="l03503" name="l03503"></a><span class="lineno"> 3503</span>    <a class="code hl_class" href="classnc__color.html">nc_color</a> clr = <a class="code hl_define" href="color_8h.html#a1b1e3c0bef566a83c3535e38a93ad733">c_light_gray</a>;</div>
<div class="line"><a id="l03504" name="l03504"></a><span class="lineno"> 3504</span>    <a class="code hl_function" href="output_8cpp.html#a9fcad5b904c8019b15fe1ac8e665a1cb">print_colored_text</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_struct" href="structpoint.html">point</a>( 1, text_y++ ), clr, clr, str );</div>
<div class="line"><a id="l03505" name="l03505"></a><span class="lineno"> 3505</span>}</div>
<div class="line"><a id="l03506" name="l03506"></a><span class="lineno"> 3506</span> </div>
<div class="line"><a id="l03507" name="l03507"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a14b8ebef108aaa7ad8c5176a04f600bb"> 3507</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a14b8ebef108aaa7ad8c5176a04f600bb">target_ui::panel_spell_info</a>( <span class="keywordtype">int</span> &amp;text_y )</div>
<div class="line"><a id="l03508" name="l03508"></a><span class="lineno"> 3508</span>{</div>
<div class="line"><a id="l03509" name="l03509"></a><span class="lineno"> 3509</span>    <a class="code hl_class" href="classnc__color.html">nc_color</a> clr = <a class="code hl_define" href="color_8h.html#a1b1e3c0bef566a83c3535e38a93ad733">c_light_gray</a>;</div>
<div class="line"><a id="l03510" name="l03510"></a><span class="lineno"> 3510</span> </div>
<div class="line"><a id="l03511" name="l03511"></a><span class="lineno"> 3511</span>    <a class="code hl_function" href="output_8cpp.html#a1184e3eda011b110d09bf2dcf08228f5">mvwprintz</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_struct" href="structpoint.html">point</a>( 1, text_y++ ), <a class="code hl_define" href="color_8h.html#a2236aa1fe66b707a104f19ad45c23230">c_light_green</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Casting: %s (Level %u)&quot;</span> ),</div>
<div class="line"><a id="l03512" name="l03512"></a><span class="lineno"> 3512</span>               <a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code hl_function" href="classspell.html#abdf34d5415c3fdafcd84fe3a7101bddb">name</a>(),</div>
<div class="line"><a id="l03513" name="l03513"></a><span class="lineno"> 3513</span>               <a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code hl_function" href="classspell.html#a006cfd33c15f732b2463eda1ae0686cc">get_level</a>() );</div>
<div class="line"><a id="l03514" name="l03514"></a><span class="lineno"> 3514</span>    <span class="keywordflow">if</span>( !<a class="code hl_variable" href="classtarget__ui.html#ac9b01fafb341eaec6c8f85582fd7f32f">no_mana</a> || <a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code hl_function" href="classspell.html#a9e3016a896d4431fed8428ea82ab6539">energy_source</a>() == <a class="code hl_enumvalue" href="magic_8h.html#a3c314c02f97a7d720f18adcd1dbd7313ac5dea5bec6450a607e6b31abd578d55b">energy_type::none_energy</a> ) {</div>
<div class="line"><a id="l03515" name="l03515"></a><span class="lineno"> 3515</span>        <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code hl_function" href="classspell.html#a9e3016a896d4431fed8428ea82ab6539">energy_source</a>() == <a class="code hl_enumvalue" href="magic_8h.html#a3c314c02f97a7d720f18adcd1dbd7313a035da4b29716d283ad9e6f63574058b3">energy_type::hp_energy</a> ) {</div>
<div class="line"><a id="l03516" name="l03516"></a><span class="lineno"> 3516</span>            text_y += <a class="code hl_function" href="output_8cpp.html#ab9659cbe9ec23a2efd813f795cb7fb73">fold_and_print</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_struct" href="structpoint.html">point</a>( 1, text_y ), <a class="code hl_function" href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">getmaxx</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> ) - 2,</div>
<div class="line"><a id="l03517" name="l03517"></a><span class="lineno"> 3517</span>                                      clr,</div>
<div class="line"><a id="l03518" name="l03518"></a><span class="lineno"> 3518</span>                                      <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Cost: %s %s&quot;</span> ), <a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code hl_function" href="classspell.html#a0d3f68783edb1af2e111e85f7a1715fa">energy_cost_string</a>( *<a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a> ), <a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code hl_function" href="classspell.html#aeb55e6084337fb199e3cab09260ad916">energy_string</a>() );</div>
<div class="line"><a id="l03519" name="l03519"></a><span class="lineno"> 3519</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03520" name="l03520"></a><span class="lineno"> 3520</span>            text_y += <a class="code hl_function" href="output_8cpp.html#ab9659cbe9ec23a2efd813f795cb7fb73">fold_and_print</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_struct" href="structpoint.html">point</a>( 1, text_y ), <a class="code hl_function" href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">getmaxx</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> ) - 2,</div>
<div class="line"><a id="l03521" name="l03521"></a><span class="lineno"> 3521</span>                                      clr,</div>
<div class="line"><a id="l03522" name="l03522"></a><span class="lineno"> 3522</span>                                      <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Cost: %s %s (Current: %s)&quot;</span> ), <a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code hl_function" href="classspell.html#a0d3f68783edb1af2e111e85f7a1715fa">energy_cost_string</a>( *<a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a> ), <a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code hl_function" href="classspell.html#aeb55e6084337fb199e3cab09260ad916">energy_string</a>(),</div>
<div class="line"><a id="l03523" name="l03523"></a><span class="lineno"> 3523</span>                                      <a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code hl_function" href="classspell.html#a1dc2bd4fd1f177c091237236627bd993">energy_cur_string</a>( *<a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a> ) );</div>
<div class="line"><a id="l03524" name="l03524"></a><span class="lineno"> 3524</span>        }</div>
<div class="line"><a id="l03525" name="l03525"></a><span class="lineno"> 3525</span>    }</div>
<div class="line"><a id="l03526" name="l03526"></a><span class="lineno"> 3526</span> </div>
<div class="line"><a id="l03527" name="l03527"></a><span class="lineno"> 3527</span>    std::string fail_str;</div>
<div class="line"><a id="l03528" name="l03528"></a><span class="lineno"> 3528</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a146d794c8cb9c23e6ba71727c9a25852">no_fail</a> ) {</div>
<div class="line"><a id="l03529" name="l03529"></a><span class="lineno"> 3529</span>        fail_str = <a class="code hl_function" href="color_8cpp.html#a0f25678be1fc95cb81381a004493a4cc">colorize</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;0.0 % Failure Chance&quot;</span> ), <a class="code hl_define" href="color_8h.html#a2236aa1fe66b707a104f19ad45c23230">c_light_green</a> );</div>
<div class="line"><a id="l03530" name="l03530"></a><span class="lineno"> 3530</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03531" name="l03531"></a><span class="lineno"> 3531</span>        fail_str = <a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code hl_function" href="classspell.html#afe11a0854d38e947a10d02e29f7fd84c">colorized_fail_percent</a>( *<a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a> );</div>
<div class="line"><a id="l03532" name="l03532"></a><span class="lineno"> 3532</span>    }</div>
<div class="line"><a id="l03533" name="l03533"></a><span class="lineno"> 3533</span>    <a class="code hl_function" href="output_8cpp.html#a9fcad5b904c8019b15fe1ac8e665a1cb">print_colored_text</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_struct" href="structpoint.html">point</a>( 1, text_y++ ), clr, clr, fail_str );</div>
<div class="line"><a id="l03534" name="l03534"></a><span class="lineno"> 3534</span> </div>
<div class="line"><a id="l03535" name="l03535"></a><span class="lineno"> 3535</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code hl_function" href="classspell.html#a004decbbde4de635b4e652acff65eb8e">aoe</a>() &gt; 0 ) {</div>
<div class="line"><a id="l03536" name="l03536"></a><span class="lineno"> 3536</span>        <a class="code hl_class" href="classnc__color.html">nc_color</a> <a class="code hl_function" href="editmap_8cpp.html#a025a5c063205294df20818edc4cfe355">color</a> = <a class="code hl_define" href="color_8h.html#a1b1e3c0bef566a83c3535e38a93ad733">c_light_gray</a>;</div>
<div class="line"><a id="l03537" name="l03537"></a><span class="lineno"> 3537</span>        <span class="keyword">const</span> std::string fx = <a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code hl_function" href="classspell.html#aa34fc8ebf8b820ac055f4b4dd9d78c35">effect</a>();</div>
<div class="line"><a id="l03538" name="l03538"></a><span class="lineno"> 3538</span>        <span class="keyword">const</span> std::string aoes = <a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code hl_function" href="classspell.html#a7341749ae2cc5f13b784f057b5207252">aoe_string</a>();</div>
<div class="line"><a id="l03539" name="l03539"></a><span class="lineno"> 3539</span>        <span class="keywordflow">if</span>( fx == <span class="stringliteral">&quot;projectile_attack&quot;</span> || fx == <span class="stringliteral">&quot;target_attack&quot;</span> ||</div>
<div class="line"><a id="l03540" name="l03540"></a><span class="lineno"> 3540</span>            fx == <span class="stringliteral">&quot;area_pull&quot;</span> || fx == <span class="stringliteral">&quot;area_push&quot;</span> ||</div>
<div class="line"><a id="l03541" name="l03541"></a><span class="lineno"> 3541</span>            fx == <span class="stringliteral">&quot;ter_transform&quot;</span> ) {</div>
<div class="line"><a id="l03542" name="l03542"></a><span class="lineno"> 3542</span>            text_y += <a class="code hl_function" href="output_8cpp.html#ab9659cbe9ec23a2efd813f795cb7fb73">fold_and_print</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_struct" href="structpoint.html">point</a>( 1, text_y ), <a class="code hl_function" href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">getmaxx</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> ) - 2, <a class="code hl_function" href="editmap_8cpp.html#a025a5c063205294df20818edc4cfe355">color</a>,</div>
<div class="line"><a id="l03543" name="l03543"></a><span class="lineno"> 3543</span>                                      <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Effective Spell Radius: %s%s&quot;</span> ), aoes,</div>
<div class="line"><a id="l03544" name="l03544"></a><span class="lineno"> 3544</span>                                      <a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code hl_function" href="classspell.html#a57d5063164f86d348ea38dab2edaf023">in_aoe</a>( <a class="code hl_variable" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> ) ? <a class="code hl_function" href="color_8cpp.html#a0f25678be1fc95cb81381a004493a4cc">colorize</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot; WARNING!  IN RANGE&quot;</span> ), <a class="code hl_define" href="color_8h.html#af0a87eaef36305269f4506dfa34d94c0">c_red</a> ) : <span class="stringliteral">&quot;&quot;</span> );</div>
<div class="line"><a id="l03545" name="l03545"></a><span class="lineno"> 3545</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fx == <span class="stringliteral">&quot;cone_attack&quot;</span> ) {</div>
<div class="line"><a id="l03546" name="l03546"></a><span class="lineno"> 3546</span>            text_y += <a class="code hl_function" href="output_8cpp.html#ab9659cbe9ec23a2efd813f795cb7fb73">fold_and_print</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_struct" href="structpoint.html">point</a>( 1, text_y ), <a class="code hl_function" href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">getmaxx</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> ) - 2, <a class="code hl_function" href="editmap_8cpp.html#a025a5c063205294df20818edc4cfe355">color</a>,</div>
<div class="line"><a id="l03547" name="l03547"></a><span class="lineno"> 3547</span>                                      <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Cone Arc: %s degrees&quot;</span> ), aoes );</div>
<div class="line"><a id="l03548" name="l03548"></a><span class="lineno"> 3548</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fx == <span class="stringliteral">&quot;line_attack&quot;</span> ) {</div>
<div class="line"><a id="l03549" name="l03549"></a><span class="lineno"> 3549</span>            text_y += <a class="code hl_function" href="output_8cpp.html#ab9659cbe9ec23a2efd813f795cb7fb73">fold_and_print</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_struct" href="structpoint.html">point</a>( 1, text_y ), <a class="code hl_function" href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">getmaxx</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> ) - 2, <a class="code hl_function" href="editmap_8cpp.html#a025a5c063205294df20818edc4cfe355">color</a>,</div>
<div class="line"><a id="l03550" name="l03550"></a><span class="lineno"> 3550</span>                                      <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Line width: %s&quot;</span> ), aoes );</div>
<div class="line"><a id="l03551" name="l03551"></a><span class="lineno"> 3551</span>        }</div>
<div class="line"><a id="l03552" name="l03552"></a><span class="lineno"> 3552</span>    }</div>
<div class="line"><a id="l03553" name="l03553"></a><span class="lineno"> 3553</span> </div>
<div class="line"><a id="l03554" name="l03554"></a><span class="lineno"> 3554</span>    <a class="code hl_function" href="output_8cpp.html#a1184e3eda011b110d09bf2dcf08228f5">mvwprintz</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_struct" href="structpoint.html">point</a>( 1, text_y++ ), <a class="code hl_define" href="color_8h.html#aab11865a3631a7ce78da82b7fb386b71">c_light_red</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Damage: %s&quot;</span> ),</div>
<div class="line"><a id="l03555" name="l03555"></a><span class="lineno"> 3555</span>               <a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code hl_function" href="classspell.html#abe49463868f25cd4e65b184b02e96931">damage_string</a>() );</div>
<div class="line"><a id="l03556" name="l03556"></a><span class="lineno"> 3556</span> </div>
<div class="line"><a id="l03557" name="l03557"></a><span class="lineno"> 3557</span>    text_y += <a class="code hl_function" href="output_8cpp.html#ab9659cbe9ec23a2efd813f795cb7fb73">fold_and_print</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_struct" href="structpoint.html">point</a>( 1, text_y ), <a class="code hl_function" href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">getmaxx</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> ) - 2, clr,</div>
<div class="line"><a id="l03558" name="l03558"></a><span class="lineno"> 3558</span>                              <a class="code hl_variable" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code hl_function" href="classspell.html#acc66691f05cd20a085370d79df52bafa">description</a>() );</div>
<div class="line"><a id="l03559" name="l03559"></a><span class="lineno"> 3559</span>}</div>
<div class="line"><a id="l03560" name="l03560"></a><span class="lineno"> 3560</span> </div>
<div class="line"><a id="l03561" name="l03561"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a4bb70bd52ece44447bec77880106009d"> 3561</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a4bb70bd52ece44447bec77880106009d">target_ui::panel_target_info</a>( <span class="keywordtype">int</span> &amp;text_y, <span class="keywordtype">bool</span> fill_with_blank_if_no_target )</div>
<div class="line"><a id="l03562" name="l03562"></a><span class="lineno"> 3562</span>{</div>
<div class="line"><a id="l03563" name="l03563"></a><span class="lineno"> 3563</span>    <span class="keywordtype">int</span> max_lines = 4;</div>
<div class="line"><a id="l03564" name="l03564"></a><span class="lineno"> 3564</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> ) {</div>
<div class="line"><a id="l03565" name="l03565"></a><span class="lineno"> 3565</span>        <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_function" href="classCharacter.html#aba9bd7517b334e6ed4149889ed32377a">sees</a>( *<a class="code hl_variable" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> ) ) {</div>
<div class="line"><a id="l03566" name="l03566"></a><span class="lineno"> 3566</span>            <span class="comment">// FIXME: print_info doesn&#39;t really care about line limit</span></div>
<div class="line"><a id="l03567" name="l03567"></a><span class="lineno"> 3567</span>            <span class="comment">//        and can always occupy up to 4 of them (or even more?).</span></div>
<div class="line"><a id="l03568" name="l03568"></a><span class="lineno"> 3568</span>            <span class="comment">//        To make things consistent, we ask it for 2 lines</span></div>
<div class="line"><a id="l03569" name="l03569"></a><span class="lineno"> 3569</span>            <span class="comment">//        and somewhat reliably get 4.</span></div>
<div class="line"><a id="l03570" name="l03570"></a><span class="lineno"> 3570</span>            <span class="keywordtype">int</span> fix_for_print_info = max_lines - 2;</div>
<div class="line"><a id="l03571" name="l03571"></a><span class="lineno"> 3571</span>            <a class="code hl_variable" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a>-&gt;<a class="code hl_function" href="classCreature.html#ab0d27ad3c2c730a3c88ee897e55f344f">print_info</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, text_y, fix_for_print_info, 1 );</div>
<div class="line"><a id="l03572" name="l03572"></a><span class="lineno"> 3572</span>            text_y += max_lines;</div>
<div class="line"><a id="l03573" name="l03573"></a><span class="lineno"> 3573</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03574" name="l03574"></a><span class="lineno"> 3574</span>            std::vector&lt;std::string&gt; buf;</div>
<div class="line"><a id="l03575" name="l03575"></a><span class="lineno"> 3575</span>            <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_function" href="classCharacter.html#a9976ba9d9bccdaff264bd834628b97ec">sees_with_infrared</a>( *<a class="code hl_variable" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> ) ) {</div>
<div class="line"><a id="l03576" name="l03576"></a><span class="lineno"> 3576</span>                <a class="code hl_variable" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a>-&gt;<a class="code hl_function" href="classCreature.html#a1eadbc3e5891d1ff578ac49291e12b66">describe_infrared</a>( buf );</div>
<div class="line"><a id="l03577" name="l03577"></a><span class="lineno"> 3577</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_function" href="classCharacter.html#a9333ab3cffa25b588ec5aa932db8d73d">sees_with_specials</a>( *<a class="code hl_variable" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> ) ) {</div>
<div class="line"><a id="l03578" name="l03578"></a><span class="lineno"> 3578</span>                <a class="code hl_variable" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a>-&gt;<a class="code hl_function" href="classCreature.html#a6293c17885ef44d613618b4953a1be17">describe_specials</a>( buf );</div>
<div class="line"><a id="l03579" name="l03579"></a><span class="lineno"> 3579</span>            }</div>
<div class="line"><a id="l03580" name="l03580"></a><span class="lineno"> 3580</span>            <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> i = 0; i &lt; static_cast&lt;size_t&gt;( max_lines ); i++, text_y++ ) {</div>
<div class="line"><a id="l03581" name="l03581"></a><span class="lineno"> 3581</span>                <span class="keywordflow">if</span>( i &gt;= buf.size() ) {</div>
<div class="line"><a id="l03582" name="l03582"></a><span class="lineno"> 3582</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l03583" name="l03583"></a><span class="lineno"> 3583</span>                }</div>
<div class="line"><a id="l03584" name="l03584"></a><span class="lineno"> 3584</span>                <a class="code hl_function" href="namespacecatacurses.html#abde9c157650e464f0a27441d81c84644">mvwprintw</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_struct" href="structpoint.html">point</a>( 1, text_y ), buf[i] );</div>
<div class="line"><a id="l03585" name="l03585"></a><span class="lineno"> 3585</span>            }</div>
<div class="line"><a id="l03586" name="l03586"></a><span class="lineno"> 3586</span>        }</div>
<div class="line"><a id="l03587" name="l03587"></a><span class="lineno"> 3587</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fill_with_blank_if_no_target ) {</div>
<div class="line"><a id="l03588" name="l03588"></a><span class="lineno"> 3588</span>        <span class="comment">// Fill with blank lines to prevent other panels from jumping around</span></div>
<div class="line"><a id="l03589" name="l03589"></a><span class="lineno"> 3589</span>        <span class="comment">// when the cursor moves.</span></div>
<div class="line"><a id="l03590" name="l03590"></a><span class="lineno"> 3590</span>        text_y += max_lines;</div>
<div class="line"><a id="l03591" name="l03591"></a><span class="lineno"> 3591</span>        <span class="comment">// TODO: print info about tile?</span></div>
<div class="line"><a id="l03592" name="l03592"></a><span class="lineno"> 3592</span>    }</div>
<div class="line"><a id="l03593" name="l03593"></a><span class="lineno"> 3593</span>}</div>
<div class="line"><a id="l03594" name="l03594"></a><span class="lineno"> 3594</span> </div>
<div class="line"><a id="l03595" name="l03595"></a><span class="lineno"><a class="line" href="classtarget__ui.html#aa5c1e8816cd2a0f9c10e3ea2095eefe1"> 3595</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#aa5c1e8816cd2a0f9c10e3ea2095eefe1">target_ui::panel_fire_mode_aim</a>( <span class="keywordtype">int</span> &amp;text_y )</div>
<div class="line"><a id="l03596" name="l03596"></a><span class="lineno"> 3596</span>{</div>
<div class="line"><a id="l03597" name="l03597"></a><span class="lineno"> 3597</span>    <span class="comment">// TODO: saving &amp; restoring pc.recoil may actually be unnecessary</span></div>
<div class="line"><a id="l03598" name="l03598"></a><span class="lineno"> 3598</span>    <span class="keywordtype">double</span> saved_pc_recoil = <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a>;</div>
<div class="line"><a id="l03599" name="l03599"></a><span class="lineno"> 3599</span>    <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> = <a class="code hl_variable" href="classtarget__ui.html#ac0a5aad7e60b30082e7ec2ff97f8f6d4">predicted_recoil</a>;</div>
<div class="line"><a id="l03600" name="l03600"></a><span class="lineno"> 3600</span> </div>
<div class="line"><a id="l03601" name="l03601"></a><span class="lineno"> 3601</span>    <span class="keywordtype">double</span> <a class="code hl_variable" href="classtarget__ui.html#ac0a5aad7e60b30082e7ec2ff97f8f6d4">predicted_recoil</a> = <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a>;</div>
<div class="line"><a id="l03602" name="l03602"></a><span class="lineno"> 3602</span>    <span class="keywordtype">int</span> predicted_delay = 0;</div>
<div class="line"><a id="l03603" name="l03603"></a><span class="lineno"> 3603</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">aim_mode</a>-&gt;has_threshold &amp;&amp; <a class="code hl_variable" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">aim_mode</a>-&gt;threshold &lt; <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> ) {</div>
<div class="line"><a id="l03604" name="l03604"></a><span class="lineno"> 3604</span>        <span class="keywordflow">do</span> {</div>
<div class="line"><a id="l03605" name="l03605"></a><span class="lineno"> 3605</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> aim_amount = <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_function" href="classCharacter.html#a851daac85a019452f34ba82a377773b0">aim_per_move</a>( *<a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>, <a class="code hl_variable" href="classtarget__ui.html#ac0a5aad7e60b30082e7ec2ff97f8f6d4">predicted_recoil</a> );</div>
<div class="line"><a id="l03606" name="l03606"></a><span class="lineno"> 3606</span>            <span class="keywordflow">if</span>( aim_amount &gt; 0 ) {</div>
<div class="line"><a id="l03607" name="l03607"></a><span class="lineno"> 3607</span>                predicted_delay++;</div>
<div class="line"><a id="l03608" name="l03608"></a><span class="lineno"> 3608</span>                <a class="code hl_variable" href="classtarget__ui.html#ac0a5aad7e60b30082e7ec2ff97f8f6d4">predicted_recoil</a> = std::max( <a class="code hl_variable" href="classtarget__ui.html#ac0a5aad7e60b30082e7ec2ff97f8f6d4">predicted_recoil</a> - aim_amount, 0.0 );</div>
<div class="line"><a id="l03609" name="l03609"></a><span class="lineno"> 3609</span>            }</div>
<div class="line"><a id="l03610" name="l03610"></a><span class="lineno"> 3610</span>        } <span class="keywordflow">while</span>( <a class="code hl_variable" href="classtarget__ui.html#ac0a5aad7e60b30082e7ec2ff97f8f6d4">predicted_recoil</a> &gt; <a class="code hl_variable" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">aim_mode</a>-&gt;threshold &amp;&amp;</div>
<div class="line"><a id="l03611" name="l03611"></a><span class="lineno"> 3611</span>                 <a class="code hl_variable" href="classtarget__ui.html#ac0a5aad7e60b30082e7ec2ff97f8f6d4">predicted_recoil</a> - <a class="code hl_variable" href="classtarget__ui.html#a2e6f4c9c827b91ce215a1a7b32a4affb">sight_dispersion</a> &gt; 0 );</div>
<div class="line"><a id="l03612" name="l03612"></a><span class="lineno"> 3612</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03613" name="l03613"></a><span class="lineno"> 3613</span>        <a class="code hl_variable" href="classtarget__ui.html#ac0a5aad7e60b30082e7ec2ff97f8f6d4">predicted_recoil</a> = <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a>;</div>
<div class="line"><a id="l03614" name="l03614"></a><span class="lineno"> 3614</span>    }</div>
<div class="line"><a id="l03615" name="l03615"></a><span class="lineno"> 3615</span> </div>
<div class="line"><a id="l03616" name="l03616"></a><span class="lineno"> 3616</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> target_size = <a class="code hl_variable" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> ? <a class="code hl_variable" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a>-&gt;<a class="code hl_function" href="classCreature.html#a1c8ea56d06ff96a720201c46a40969aa">ranged_target_size</a>() :</div>
<div class="line"><a id="l03617" name="l03617"></a><span class="lineno"> 3617</span>                               <a class="code hl_function" href="ranged_8cpp.html#a463802d3c2fe3f6d4ba8cc36a77912c7">occupied_tile_fraction</a>( <a class="code hl_enumvalue" href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592aaef7580aead8b8a18bc50cb6c1f98b31">m_size::MS_MEDIUM</a> );</div>
<div class="line"><a id="l03618" name="l03618"></a><span class="lineno"> 3618</span> </div>
<div class="line"><a id="l03619" name="l03619"></a><span class="lineno"> 3619</span>    text_y = <a class="code hl_function" href="ranged_8cpp.html#aebe27b2e9dd96af665d642596a9b8b43">print_aim</a>( *<a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>, <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, text_y, <a class="code hl_variable" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>, *<a class="code hl_variable" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code hl_function" href="classitem.html#a1a94ea108d695febf7f2bcf090f097fa">gun_current_mode</a>(),</div>
<div class="line"><a id="l03620" name="l03620"></a><span class="lineno"> 3620</span>                        target_size, <a class="code hl_variable" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a>, <a class="code hl_variable" href="classtarget__ui.html#ac0a5aad7e60b30082e7ec2ff97f8f6d4">predicted_recoil</a> );</div>
<div class="line"><a id="l03621" name="l03621"></a><span class="lineno"> 3621</span> </div>
<div class="line"><a id="l03622" name="l03622"></a><span class="lineno"> 3622</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">aim_mode</a>-&gt;has_threshold ) {</div>
<div class="line"><a id="l03623" name="l03623"></a><span class="lineno"> 3623</span>        <a class="code hl_function" href="namespacecatacurses.html#abde9c157650e464f0a27441d81c84644">mvwprintw</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_struct" href="structpoint.html">point</a>( 1, text_y++ ), <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;%s Delay: %i&quot;</span> ), <a class="code hl_variable" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">aim_mode</a>-&gt;name,</div>
<div class="line"><a id="l03624" name="l03624"></a><span class="lineno"> 3624</span>                   predicted_delay );</div>
<div class="line"><a id="l03625" name="l03625"></a><span class="lineno"> 3625</span>    }</div>
<div class="line"><a id="l03626" name="l03626"></a><span class="lineno"> 3626</span> </div>
<div class="line"><a id="l03627" name="l03627"></a><span class="lineno"> 3627</span>    <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> = saved_pc_recoil;</div>
<div class="line"><a id="l03628" name="l03628"></a><span class="lineno"> 3628</span>}</div>
<div class="line"><a id="l03629" name="l03629"></a><span class="lineno"> 3629</span> </div>
<div class="line"><a id="l03630" name="l03630"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ad4a9c004a4c4cf26ad705174612584ea"> 3630</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#ad4a9c004a4c4cf26ad705174612584ea">target_ui::panel_turret_list</a>( <span class="keywordtype">int</span> &amp;text_y )</div>
<div class="line"><a id="l03631" name="l03631"></a><span class="lineno"> 3631</span>{</div>
<div class="line"><a id="l03632" name="l03632"></a><span class="lineno"> 3632</span>    <a class="code hl_function" href="namespacecatacurses.html#abde9c157650e464f0a27441d81c84644">mvwprintw</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_struct" href="structpoint.html">point</a>( 1, text_y++ ), <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Turrets in range: %d/%d&quot;</span> ), <a class="code hl_variable" href="classtarget__ui.html#ae8d4216fdc3f48ee8f6dd5f22c33d9d9">turrets_in_range</a>.size(),</div>
<div class="line"><a id="l03633" name="l03633"></a><span class="lineno"> 3633</span>               <a class="code hl_variable" href="classtarget__ui.html#ae7a7446b4088911709b2eb6a1d3973e5">vturrets</a>-&gt;size() );</div>
<div class="line"><a id="l03634" name="l03634"></a><span class="lineno"> 3634</span> </div>
<div class="line"><a id="l03635" name="l03635"></a><span class="lineno"> 3635</span>    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_struct" href="structtarget__ui_1_1turret__with__lof.html">turret_with_lof</a> &amp;it : <a class="code hl_variable" href="classtarget__ui.html#ae8d4216fdc3f48ee8f6dd5f22c33d9d9">turrets_in_range</a> ) {</div>
<div class="line"><a id="l03636" name="l03636"></a><span class="lineno"> 3636</span>        std::string str = <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <span class="stringliteral">&quot;* %s&quot;</span>, it.turret-&gt;name() );</div>
<div class="line"><a id="l03637" name="l03637"></a><span class="lineno"> 3637</span>        <a class="code hl_class" href="classnc__color.html">nc_color</a> clr = <a class="code hl_define" href="color_8h.html#a0d06dc49b9761bbc54607397213728bb">c_white</a>;</div>
<div class="line"><a id="l03638" name="l03638"></a><span class="lineno"> 3638</span>        <a class="code hl_function" href="output_8cpp.html#a9fcad5b904c8019b15fe1ac8e665a1cb">print_colored_text</a>( <a class="code hl_variable" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code hl_struct" href="structpoint.html">point</a>( 1, text_y++ ), clr, clr, str );</div>
<div class="line"><a id="l03639" name="l03639"></a><span class="lineno"> 3639</span>    }</div>
<div class="line"><a id="l03640" name="l03640"></a><span class="lineno"> 3640</span>}</div>
<div class="line"><a id="l03641" name="l03641"></a><span class="lineno"> 3641</span> </div>
<div class="line"><a id="l03642" name="l03642"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a9d84b28ee34fdefd76ae987c95a29600"> 3642</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classtarget__ui.html#a9d84b28ee34fdefd76ae987c95a29600">target_ui::on_target_accepted</a>( <span class="keywordtype">bool</span> harmful )</div>
<div class="line"><a id="l03643" name="l03643"></a><span class="lineno"> 3643</span>{</div>
<div class="line"><a id="l03644" name="l03644"></a><span class="lineno"> 3644</span>    <span class="comment">// TODO: all of this should be moved into on-hit code</span></div>
<div class="line"><a id="l03645" name="l03645"></a><span class="lineno"> 3645</span>    <span class="keyword">const</span> <span class="keyword">auto</span> lt_ptr = <a class="code hl_variable" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code hl_variable" href="classplayer.html#ab679d40f5584e38a6af33bcd7e3c102d">last_target</a>.lock();</div>
<div class="line"><a id="l03646" name="l03646"></a><span class="lineno"> 3646</span>    <span class="keywordflow">if</span>( <a class="code hl_class" href="classnpc.html">npc</a> *<span class="keyword">const</span> guy = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classnpc.html">npc</a> *<span class="keyword">&gt;</span>( lt_ptr.get() ) ) {</div>
<div class="line"><a id="l03647" name="l03647"></a><span class="lineno"> 3647</span>        <span class="keywordflow">if</span>( harmful ) {</div>
<div class="line"><a id="l03648" name="l03648"></a><span class="lineno"> 3648</span>            <span class="keywordflow">if</span>( !guy-&gt;guaranteed_hostile() ) {</div>
<div class="line"><a id="l03649" name="l03649"></a><span class="lineno"> 3649</span>                <span class="comment">// TODO: get rid of this. Or combine it with effect_hit_by_player</span></div>
<div class="line"><a id="l03650" name="l03650"></a><span class="lineno"> 3650</span>                guy-&gt;hit_by_player = <span class="keyword">true</span>; <span class="comment">// used for morale penalty</span></div>
<div class="line"><a id="l03651" name="l03651"></a><span class="lineno"> 3651</span>            }</div>
<div class="line"><a id="l03652" name="l03652"></a><span class="lineno"> 3652</span>            guy-&gt;make_angry();</div>
<div class="line"><a id="l03653" name="l03653"></a><span class="lineno"> 3653</span>        }</div>
<div class="line"><a id="l03654" name="l03654"></a><span class="lineno"> 3654</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_class" href="classmonster.html">monster</a> *<span class="keyword">const</span> mon = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classmonster.html">monster</a> *<span class="keyword">&gt;</span>( lt_ptr.get() ) ) {</div>
<div class="line"><a id="l03655" name="l03655"></a><span class="lineno"> 3655</span>        mon-&gt;add_effect( <a class="code hl_variable" href="ranged_8cpp.html#a4de2ef4c2e145815427b09adfaa0def5">effect_hit_by_player</a>, 10_minutes );</div>
<div class="line"><a id="l03656" name="l03656"></a><span class="lineno"> 3656</span>    }</div>
<div class="line"><a id="l03657" name="l03657"></a><span class="lineno"> 3657</span>}</div>
<div class="line"><a id="l03658" name="l03658"></a><span class="lineno"> 3658</span> </div>
<div class="line"><a id="l03659" name="l03659"></a><span class="lineno"><a class="line" href="namespaceranged.html#aed4420a1fd77e160a72de2a528e56da5"> 3659</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="namespaceranged.html#aed4420a1fd77e160a72de2a528e56da5">ranged::gunmode_checks_common</a>( <a class="code hl_class" href="classavatar.html">avatar</a> &amp;you, <span class="keyword">const</span> <a class="code hl_class" href="classmap.html">map</a> &amp;m, std::vector&lt;std::string&gt; &amp;messages,</div>
<div class="line"><a id="l03660" name="l03660"></a><span class="lineno"> 3660</span>                                    <span class="keyword">const</span> <a class="code hl_class" href="classgun__mode.html">gun_mode</a> &amp;gmode )</div>
<div class="line"><a id="l03661" name="l03661"></a><span class="lineno"> 3661</span>{</div>
<div class="line"><a id="l03662" name="l03662"></a><span class="lineno"> 3662</span>    <span class="keywordtype">bool</span> <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l03663" name="l03663"></a><span class="lineno"> 3663</span> </div>
<div class="line"><a id="l03664" name="l03664"></a><span class="lineno"> 3664</span>    <span class="comment">// Check that passed gun mode is valid and we are able to use it</span></div>
<div class="line"><a id="l03665" name="l03665"></a><span class="lineno"> 3665</span>    <span class="keywordflow">if</span>( !( gmode &amp;&amp; you.<a class="code hl_function" href="classCharacter.html#a4eddeb86babf626e7869882079b40651">can_use</a>( *gmode ) ) ) {</div>
<div class="line"><a id="l03666" name="l03666"></a><span class="lineno"> 3666</span>        messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You can&#39;t currently fire your %s.&quot;</span> ),</div>
<div class="line"><a id="l03667" name="l03667"></a><span class="lineno"> 3667</span>                                           gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() ) );</div>
<div class="line"><a id="l03668" name="l03668"></a><span class="lineno"> 3668</span>        <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03669" name="l03669"></a><span class="lineno"> 3669</span>    }</div>
<div class="line"><a id="l03670" name="l03670"></a><span class="lineno"> 3670</span> </div>
<div class="line"><a id="l03671" name="l03671"></a><span class="lineno"> 3671</span>    <span class="keyword">const</span> <a class="code hl_class" href="classoptional__vpart__position.html">optional_vpart_position</a> vp = m.<a class="code hl_function" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( you.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() );</div>
<div class="line"><a id="l03672" name="l03672"></a><span class="lineno"> 3672</span>    <span class="keywordflow">if</span>( vp &amp;&amp; vp-&gt;vehicle().player_in_control( you ) &amp;&amp; ( gmode-&gt;<a class="code hl_function" href="classitem.html#af373f646c1ee172941490dc7cc04bbcd">is_two_handed</a>( you ) ||</div>
<div class="line"><a id="l03673" name="l03673"></a><span class="lineno"> 3673</span>            gmode-&gt;<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a02edfa7a6cb1a0f7a67ae1aca7a34753">flag_FIRE_TWOHAND</a> ) ) ) {</div>
<div class="line"><a id="l03674" name="l03674"></a><span class="lineno"> 3674</span>        messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You can&#39;t fire your %s while driving.&quot;</span> ),</div>
<div class="line"><a id="l03675" name="l03675"></a><span class="lineno"> 3675</span>                                           gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() ) );</div>
<div class="line"><a id="l03676" name="l03676"></a><span class="lineno"> 3676</span>        <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03677" name="l03677"></a><span class="lineno"> 3677</span>    }</div>
<div class="line"><a id="l03678" name="l03678"></a><span class="lineno"> 3678</span> </div>
<div class="line"><a id="l03679" name="l03679"></a><span class="lineno"> 3679</span>    <span class="keywordflow">if</span>( gmode-&gt;<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a02edfa7a6cb1a0f7a67ae1aca7a34753">flag_FIRE_TWOHAND</a> ) &amp;&amp; ( !you.<a class="code hl_function" href="classCharacter.html#a8e2d2e1c01bfbb36401ae221300370f5">has_two_arms</a>() ||</div>
<div class="line"><a id="l03680" name="l03680"></a><span class="lineno"> 3680</span>            you.<a class="code hl_function" href="classCharacter.html#a3aaa75382f6308a729369c7f2ccf0600">worn_with_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#aeac06317fd010c6001b6b71968bc15c1">flag_RESTRICT_HANDS</a> ) ) ) {</div>
<div class="line"><a id="l03681" name="l03681"></a><span class="lineno"> 3681</span>        messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You need two free hands to fire your %s.&quot;</span> ),</div>
<div class="line"><a id="l03682" name="l03682"></a><span class="lineno"> 3682</span>                                           gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() ) );</div>
<div class="line"><a id="l03683" name="l03683"></a><span class="lineno"> 3683</span>        <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03684" name="l03684"></a><span class="lineno"> 3684</span>    }</div>
<div class="line"><a id="l03685" name="l03685"></a><span class="lineno"> 3685</span> </div>
<div class="line"><a id="l03686" name="l03686"></a><span class="lineno"> 3686</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">ranged::get_str_draw_penalty</a>( *gmode, you ) &lt; 0.5f ) {</div>
<div class="line"><a id="l03687" name="l03687"></a><span class="lineno"> 3687</span>        messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You don&#39;t have enough strength to fire your %s.&quot;</span> ),</div>
<div class="line"><a id="l03688" name="l03688"></a><span class="lineno"> 3688</span>                                           gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() ) );</div>
<div class="line"><a id="l03689" name="l03689"></a><span class="lineno"> 3689</span>        <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03690" name="l03690"></a><span class="lineno"> 3690</span>    }</div>
<div class="line"><a id="l03691" name="l03691"></a><span class="lineno"> 3691</span> </div>
<div class="line"><a id="l03692" name="l03692"></a><span class="lineno"> 3692</span>    <span class="keywordflow">return</span> <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a>;</div>
<div class="line"><a id="l03693" name="l03693"></a><span class="lineno"> 3693</span>}</div>
<div class="line"><a id="l03694" name="l03694"></a><span class="lineno"> 3694</span> </div>
<div class="line"><a id="l03695" name="l03695"></a><span class="lineno"><a class="line" href="namespaceranged.html#a743f9e35b20c136e56ca9e9480fb27bc"> 3695</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="namespaceranged.html#a743f9e35b20c136e56ca9e9480fb27bc">ranged::gunmode_checks_weapon</a>( <a class="code hl_class" href="classavatar.html">avatar</a> &amp;you, <span class="keyword">const</span> <a class="code hl_class" href="classmap.html">map</a> &amp;m, std::vector&lt;std::string&gt; &amp;messages,</div>
<div class="line"><a id="l03696" name="l03696"></a><span class="lineno"> 3696</span>                                    <span class="keyword">const</span> <a class="code hl_class" href="classgun__mode.html">gun_mode</a> &amp;gmode )</div>
<div class="line"><a id="l03697" name="l03697"></a><span class="lineno"> 3697</span>{</div>
<div class="line"><a id="l03698" name="l03698"></a><span class="lineno"> 3698</span>    <span class="keywordtype">bool</span> <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l03699" name="l03699"></a><span class="lineno"> 3699</span> </div>
<div class="line"><a id="l03700" name="l03700"></a><span class="lineno"> 3700</span>    <span class="keywordflow">if</span>( !gmode-&gt;<a class="code hl_function" href="classitem.html#a8efcfdc21aadbc25a8cc95cf54685489">ammo_sufficient</a>() &amp;&amp; !gmode-&gt;<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a30c9d25adcf2167a8bff0fe6ca21fdaf">flag_RELOAD_AND_SHOOT</a> ) ) {</div>
<div class="line"><a id="l03701" name="l03701"></a><span class="lineno"> 3701</span>        <span class="keywordflow">if</span>( !gmode-&gt;<a class="code hl_function" href="classitem.html#a26c025fd4909bd31c8e91ed87905507b">ammo_remaining</a>() ) {</div>
<div class="line"><a id="l03702" name="l03702"></a><span class="lineno"> 3702</span>            messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s is empty!&quot;</span> ), gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() ) );</div>
<div class="line"><a id="l03703" name="l03703"></a><span class="lineno"> 3703</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03704" name="l03704"></a><span class="lineno"> 3704</span>            messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s needs %i charges to fire!&quot;</span> ),</div>
<div class="line"><a id="l03705" name="l03705"></a><span class="lineno"> 3705</span>                                               gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>(), gmode-&gt;<a class="code hl_function" href="classitem.html#a7dc5d9ccf5638ae80cebe1864050fa26">ammo_required</a>() ) );</div>
<div class="line"><a id="l03706" name="l03706"></a><span class="lineno"> 3706</span>        }</div>
<div class="line"><a id="l03707" name="l03707"></a><span class="lineno"> 3707</span>        <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03708" name="l03708"></a><span class="lineno"> 3708</span>    }</div>
<div class="line"><a id="l03709" name="l03709"></a><span class="lineno"> 3709</span> </div>
<div class="line"><a id="l03710" name="l03710"></a><span class="lineno"> 3710</span>    <span class="keywordflow">if</span>( gmode-&gt;<a class="code hl_function" href="classitem.html#af6bd135500675d45eb9b79b196d9558e">get_gun_ups_drain</a>() &gt; 0 ) {</div>
<div class="line"><a id="l03711" name="l03711"></a><span class="lineno"> 3711</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> ups_drain = gmode-&gt;<a class="code hl_function" href="classitem.html#af6bd135500675d45eb9b79b196d9558e">get_gun_ups_drain</a>();</div>
<div class="line"><a id="l03712" name="l03712"></a><span class="lineno"> 3712</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> adv_ups_drain = std::max( 1, ups_drain * 3 / 5 );</div>
<div class="line"><a id="l03713" name="l03713"></a><span class="lineno"> 3713</span>        <span class="keywordtype">bool</span> is_mech_weapon = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03714" name="l03714"></a><span class="lineno"> 3714</span>        <span class="keywordflow">if</span>( you.<a class="code hl_function" href="classCharacter.html#a67b51491c2529df09755e07bc633cc55">is_mounted</a>() ) {</div>
<div class="line"><a id="l03715" name="l03715"></a><span class="lineno"> 3715</span>            <a class="code hl_class" href="classmonster.html">monster</a> *mons = <a class="code hl_function" href="character_8cpp.html#a2fcb25d686f4a35fca374c6f71280311">get_player_character</a>().<a class="code hl_variable" href="classCharacter.html#ac3d46549b7cdaac1f98991167ad5f1b3">mounted_creature</a>.get();</div>
<div class="line"><a id="l03716" name="l03716"></a><span class="lineno"> 3716</span>            <span class="keywordflow">if</span>( !mons-&gt;<a class="code hl_variable" href="classmonster.html#aa30f973bf524ba275ada847f6118b048">type</a>-&gt;<a class="code hl_variable" href="structmtype.html#abe1e1f1cacb0be37406c667e226003c4">mech_weapon</a>.<a class="code hl_function" href="classstring__id.html#ac180a60056901aaf79f5c4b728a257bd">is_empty</a>() ) {</div>
<div class="line"><a id="l03717" name="l03717"></a><span class="lineno"> 3717</span>                is_mech_weapon = <span class="keyword">true</span>;</div>
<div class="line"><a id="l03718" name="l03718"></a><span class="lineno"> 3718</span>            }</div>
<div class="line"><a id="l03719" name="l03719"></a><span class="lineno"> 3719</span>        }</div>
<div class="line"><a id="l03720" name="l03720"></a><span class="lineno"> 3720</span>        <span class="keywordflow">if</span>( !is_mech_weapon ) {</div>
<div class="line"><a id="l03721" name="l03721"></a><span class="lineno"> 3721</span>            <span class="keywordflow">if</span>( !( you.<a class="code hl_function" href="classCharacter.html#a9bff3208a5e121c4e3a71b81b378e4e7">has_charges</a>( <a class="code hl_variable" href="ranged_8cpp.html#ae89306fd36cf36b57fe05dad0db3f71b">itype_UPS_off</a>, ups_drain ) ||</div>
<div class="line"><a id="l03722" name="l03722"></a><span class="lineno"> 3722</span>                   you.<a class="code hl_function" href="classCharacter.html#a9bff3208a5e121c4e3a71b81b378e4e7">has_charges</a>( <a class="code hl_variable" href="ranged_8cpp.html#a1c359a305b979b2e5fc87d15db51e903">itype_adv_UPS_off</a>, adv_ups_drain ) ||</div>
<div class="line"><a id="l03723" name="l03723"></a><span class="lineno"> 3723</span>                   ( you.<a class="code hl_function" href="classCharacter.html#af9c7419575e23d52745c94009929fafb">has_active_bionic</a>( <a class="code hl_variable" href="ranged_8cpp.html#ac48fadf8e0cc0bf9f6800029de9084d6">bio_ups</a> ) &amp;&amp;</div>
<div class="line"><a id="l03724" name="l03724"></a><span class="lineno"> 3724</span>                     you.<a class="code hl_function" href="classCharacter.html#add22510ff2fa20a662868b4dd86e030e">get_power_level</a>() &gt;= <a class="code hl_function" href="namespaceunits.html#ada24d52c1ffd0df8d52a363d013d3231">units::from_kilojoule</a>( ups_drain ) ) ) ) {</div>
<div class="line"><a id="l03725" name="l03725"></a><span class="lineno"> 3725</span>                messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>(</div>
<div class="line"><a id="l03726" name="l03726"></a><span class="lineno"> 3726</span>                                        <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You need a UPS with at least %2$d charges or an advanced UPS with at least %3$d charges to fire the %1$s!&quot;</span> ),</div>
<div class="line"><a id="l03727" name="l03727"></a><span class="lineno"> 3727</span>                                        gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>(), ups_drain, adv_ups_drain ) );</div>
<div class="line"><a id="l03728" name="l03728"></a><span class="lineno"> 3728</span>                <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03729" name="l03729"></a><span class="lineno"> 3729</span>            }</div>
<div class="line"><a id="l03730" name="l03730"></a><span class="lineno"> 3730</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03731" name="l03731"></a><span class="lineno"> 3731</span>            <span class="keywordflow">if</span>( !you.<a class="code hl_function" href="classCharacter.html#a9bff3208a5e121c4e3a71b81b378e4e7">has_charges</a>( <a class="code hl_variable" href="ranged_8cpp.html#a55a80a9bbab1925d5462d46d355c2b6e">itype_UPS</a>, ups_drain ) ) {</div>
<div class="line"><a id="l03732" name="l03732"></a><span class="lineno"> 3732</span>                messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your mech has an empty battery, its %s will not fire.&quot;</span> ),</div>
<div class="line"><a id="l03733" name="l03733"></a><span class="lineno"> 3733</span>                                                   gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() ) );</div>
<div class="line"><a id="l03734" name="l03734"></a><span class="lineno"> 3734</span>                <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03735" name="l03735"></a><span class="lineno"> 3735</span>            }</div>
<div class="line"><a id="l03736" name="l03736"></a><span class="lineno"> 3736</span>        }</div>
<div class="line"><a id="l03737" name="l03737"></a><span class="lineno"> 3737</span>    }</div>
<div class="line"><a id="l03738" name="l03738"></a><span class="lineno"> 3738</span> </div>
<div class="line"><a id="l03739" name="l03739"></a><span class="lineno"> 3739</span>    <span class="keywordflow">if</span>( gmode-&gt;<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a9a327f2be95a30526c2d1ab6a31f72b2">flag_MOUNTED_GUN</a> ) ) {</div>
<div class="line"><a id="l03740" name="l03740"></a><span class="lineno"> 3740</span>        <span class="keyword">const</span> <span class="keywordtype">bool</span> v_mountable = <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>( m.<a class="code hl_function" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( you.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() ).<a class="code hl_function" href="classoptional__vpart__position.html#a2f0829fa83c2c4d3007e26b91af11856">part_with_feature</a>( <span class="stringliteral">&quot;MOUNTABLE&quot;</span>,</div>
<div class="line"><a id="l03741" name="l03741"></a><span class="lineno"> 3741</span>                                 <span class="keyword">true</span> ) );</div>
<div class="line"><a id="l03742" name="l03742"></a><span class="lineno"> 3742</span>        <span class="keywordtype">bool</span> t_mountable = m.<a class="code hl_function" href="classmap.html#a516c0764134cc86b57297811520395f7">has_flag_ter_or_furn</a>( <a class="code hl_function" href="ranged_8cpp.html#abca795246deac76d5cf0515c16bb75c8">flag_MOUNTABLE</a>, you.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() );</div>
<div class="line"><a id="l03743" name="l03743"></a><span class="lineno"> 3743</span>        <span class="keywordflow">if</span>( !t_mountable &amp;&amp; !v_mountable &amp;&amp; !( you.<a class="code hl_function" href="classCharacter.html#aa5ca0f6c4fb1c08bb93ece1c9746c368">get_size</a>() &gt; <a class="code hl_enumvalue" href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592aaef7580aead8b8a18bc50cb6c1f98b31">MS_MEDIUM</a> ) ) {</div>
<div class="line"><a id="l03744" name="l03744"></a><span class="lineno"> 3744</span>            messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>(</div>
<div class="line"><a id="l03745" name="l03745"></a><span class="lineno"> 3745</span>                                    <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You must stand near acceptable terrain or furniture to fire the %s.  A table, a mound of dirt, a broken window, etc.&quot;</span> ),</div>
<div class="line"><a id="l03746" name="l03746"></a><span class="lineno"> 3746</span>                                    gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() ) );</div>
<div class="line"><a id="l03747" name="l03747"></a><span class="lineno"> 3747</span>            <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03748" name="l03748"></a><span class="lineno"> 3748</span>        }</div>
<div class="line"><a id="l03749" name="l03749"></a><span class="lineno"> 3749</span>    }</div>
<div class="line"><a id="l03750" name="l03750"></a><span class="lineno"> 3750</span> </div>
<div class="line"><a id="l03751" name="l03751"></a><span class="lineno"> 3751</span>    <span class="keywordflow">return</span> <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a>;</div>
<div class="line"><a id="l03752" name="l03752"></a><span class="lineno"> 3752</span>}</div>
<div class="line"><a id="l03753" name="l03753"></a><span class="lineno"> 3753</span> </div>
<div class="line"><a id="l03754" name="l03754"></a><span class="lineno"><a class="line" href="namespaceranged.html#ae7778ea8feb8352ac65fe74e81164ebc"> 3754</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="namespaceranged.html#ae7778ea8feb8352ac65fe74e81164ebc">ranged::prompt_select_default_ammo_for</a>( <a class="code hl_class" href="classavatar.html">avatar</a> &amp;u, <span class="keyword">const</span> <a class="code hl_class" href="classitem.html">item</a> &amp;w )</div>
<div class="line"><a id="l03755" name="l03755"></a><span class="lineno"> 3755</span>{</div>
<div class="line"><a id="l03756" name="l03756"></a><span class="lineno"> 3756</span>    <a class="code hl_class" href="classitem_1_1reload__option.html">item::reload_option</a> opt = u.<a class="code hl_function" href="classplayer.html#a43a0479640831a4268c76fa19bbd1051">select_ammo</a>( w, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">true</span> );</div>
<div class="line"><a id="l03757" name="l03757"></a><span class="lineno"> 3757</span>    <span class="keywordflow">if</span>( opt ) {</div>
<div class="line"><a id="l03758" name="l03758"></a><span class="lineno"> 3758</span>        <span class="keywordflow">if</span>( u.<a class="code hl_variable" href="classplayer.html#a5f1ee4ce958fda62c4766dd8762529c2">ammo_location</a> &amp;&amp; opt.<a class="code hl_variable" href="classitem_1_1reload__option.html#afec3eb8ab3dff71940912db4a84ae7ea">ammo</a> == u.<a class="code hl_variable" href="classplayer.html#a5f1ee4ce958fda62c4766dd8762529c2">ammo_location</a> ) {</div>
<div class="line"><a id="l03759" name="l03759"></a><span class="lineno"> 3759</span>            u.<a class="code hl_function" href="classplayer.html#ae7009d849f19a4f5ebe877cbe463c459">add_msg_if_player</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Cleared ammo preferences for %s.&quot;</span> ), w.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l03760" name="l03760"></a><span class="lineno"> 3760</span>            u.<a class="code hl_variable" href="classplayer.html#a5f1ee4ce958fda62c4766dd8762529c2">ammo_location</a> = <a class="code hl_class" href="classitem__location.html">item_location</a>();</div>
<div class="line"><a id="l03761" name="l03761"></a><span class="lineno"> 3761</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( u.<a class="code hl_function" href="classvisitable.html#af49d5ef7b3f2f0a8664c23097a56373f">has_item</a>( *opt.<a class="code hl_variable" href="classitem_1_1reload__option.html#afec3eb8ab3dff71940912db4a84ae7ea">ammo</a> ) ) {</div>
<div class="line"><a id="l03762" name="l03762"></a><span class="lineno"> 3762</span>            u.<a class="code hl_function" href="classplayer.html#ae7009d849f19a4f5ebe877cbe463c459">add_msg_if_player</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Selected %s as default ammo for %s.&quot;</span> ), opt.<a class="code hl_variable" href="classitem_1_1reload__option.html#afec3eb8ab3dff71940912db4a84ae7ea">ammo</a>-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>(), w.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l03763" name="l03763"></a><span class="lineno"> 3763</span>            u.<a class="code hl_variable" href="classplayer.html#a5f1ee4ce958fda62c4766dd8762529c2">ammo_location</a> = opt.<a class="code hl_variable" href="classitem_1_1reload__option.html#afec3eb8ab3dff71940912db4a84ae7ea">ammo</a>;</div>
<div class="line"><a id="l03764" name="l03764"></a><span class="lineno"> 3764</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03765" name="l03765"></a><span class="lineno"> 3765</span>            u.<a class="code hl_function" href="classplayer.html#ae7009d849f19a4f5ebe877cbe463c459">add_msg_if_player</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You don&#39;t have that ammo on you.&quot;</span> ) );</div>
<div class="line"><a id="l03766" name="l03766"></a><span class="lineno"> 3766</span>        }</div>
<div class="line"><a id="l03767" name="l03767"></a><span class="lineno"> 3767</span>    }</div>
<div class="line"><a id="l03768" name="l03768"></a><span class="lineno"> 3768</span>}</div>
<div class="ttc" id="aactivity__actor__definitions_8h_html"><div class="ttname"><a href="activity__actor__definitions_8h.html">activity_actor_definitions.h</a></div></div>
<div class="ttc" id="aactivity__item__handling_8cpp_html_a0572000ec0976f2d095ae0cd9d20e78b"><div class="ttname"><a href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a></div><div class="ttdeci">static int move_cost(const item &amp;it, const tripoint &amp;src, const tripoint &amp;dest)</div><div class="ttdef"><b>Definition:</b> <a href="activity__item__handling_8cpp_source.html#l00898">activity_item_handling.cpp:898</a></div></div>
<div class="ttc" id="aartifact_8cpp_html_a70800e95389f34dd34186fafaea2a840"><div class="ttname"><a href="artifact_8cpp.html#a70800e95389f34dd34186fafaea2a840">rng</a></div><div class="ttdeci">units::quantity&lt; V, B &gt; rng(const units::quantity&lt; V, B &gt; &amp;min, const units::quantity&lt; V, B &gt; &amp;max)</div><div class="ttdef"><b>Definition:</b> <a href="artifact_8cpp_source.html#l00032">artifact.cpp:32</a></div></div>
<div class="ttc" id="aavatar_8h_html"><div class="ttname"><a href="avatar_8h.html">avatar.h</a></div></div>
<div class="ttc" id="aballistics_8cpp_html_aeded5f16540ef8f873a7d9eb5edca240"><div class="ttname"><a href="ballistics_8cpp.html#aeded5f16540ef8f873a7d9eb5edca240">projectile_attack</a></div><div class="ttdeci">dealt_projectile_attack projectile_attack(const projectile &amp;proj_arg, const tripoint &amp;source, const tripoint &amp;target_arg, const dispersion_sources &amp;dispersion, Creature *origin, const vehicle *in_veh)</div><div class="ttdoc">Fires a projectile at the target point from the source point with total_dispersion dispersion.</div><div class="ttdef"><b>Definition:</b> <a href="ballistics_8cpp_source.html#l00202">ballistics.cpp:202</a></div></div>
<div class="ttc" id="aballistics_8h_html"><div class="ttname"><a href="ballistics_8h.html">ballistics.h</a></div></div>
<div class="ttc" id="abodypart_8h_html"><div class="ttname"><a href="bodypart_8h.html">bodypart.h</a></div></div>
<div class="ttc" id="abodypart_8h_html_af618290c4c2de42aab87977ac7311980a2055386ee220ee2ca3e61d13df65e868"><div class="ttname"><a href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a2055386ee220ee2ca3e61d13df65e868">bp_eyes</a></div><div class="ttdeci">@ bp_eyes</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00042">bodypart.h:42</a></div></div>
<div class="ttc" id="abodypart_8h_html_af618290c4c2de42aab87977ac7311980a2806629e65a2c2eb5d8049e29e77910e"><div class="ttname"><a href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a2806629e65a2c2eb5d8049e29e77910e">bp_hand_l</a></div><div class="ttdeci">@ bp_hand_l</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00046">bodypart.h:46</a></div></div>
<div class="ttc" id="abodypart_8h_html_af618290c4c2de42aab87977ac7311980a441080ba1d3930d38f635658d9b28e01"><div class="ttname"><a href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a441080ba1d3930d38f635658d9b28e01">bp_arm_l</a></div><div class="ttdeci">@ bp_arm_l</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00044">bodypart.h:44</a></div></div>
<div class="ttc" id="abodypart_8h_html_af618290c4c2de42aab87977ac7311980a54721306a0e05318b6d0440349c1a0fb"><div class="ttname"><a href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a54721306a0e05318b6d0440349c1a0fb">bp_hand_r</a></div><div class="ttdeci">@ bp_hand_r</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00047">bodypart.h:47</a></div></div>
<div class="ttc" id="abodypart_8h_html_af618290c4c2de42aab87977ac7311980ab4b216482dcc0e468819f023c3aeddd1"><div class="ttname"><a href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980ab4b216482dcc0e468819f023c3aeddd1">bp_torso</a></div><div class="ttdeci">@ bp_torso</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00040">bodypart.h:40</a></div></div>
<div class="ttc" id="abodypart_8h_html_af618290c4c2de42aab87977ac7311980ae5f21c7494ad730a0c6abf6957976cb3"><div class="ttname"><a href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980ae5f21c7494ad730a0c6abf6957976cb3">bp_arm_r</a></div><div class="ttdeci">@ bp_arm_r</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00045">bodypart.h:45</a></div></div>
<div class="ttc" id="acached__options_8cpp_html_a0cb65464a3fa34c1ed5474f5d2d853a7"><div class="ttname"><a href="cached__options_8cpp.html#a0cb65464a3fa34c1ed5474f5d2d853a7">fov_3d_z_range</a></div><div class="ttdeci">int fov_3d_z_range</div><div class="ttdoc">3D FoV range, in Z levels, in both directions.</div><div class="ttdef"><b>Definition:</b> <a href="cached__options_8cpp_source.html#l00014">cached_options.cpp:14</a></div></div>
<div class="ttc" id="acached__options_8cpp_html_a406fb460d3cd96ac0e1cc3ccdef6340a"><div class="ttname"><a href="cached__options_8cpp.html#a406fb460d3cd96ac0e1cc3ccdef6340a">tile_iso</a></div><div class="ttdeci">bool tile_iso</div><div class="ttdoc">Using isometric tileset.</div><div class="ttdef"><b>Definition:</b> <a href="cached__options_8cpp_source.html#l00015">cached_options.cpp:15</a></div></div>
<div class="ttc" id="acached__options_8cpp_html_a40b9d88f6d95e646490329d0071ec931"><div class="ttname"><a href="cached__options_8cpp.html#a40b9d88f6d95e646490329d0071ec931">trigdist</a></div><div class="ttdeci">bool trigdist</div><div class="ttdoc">Circular distances.</div><div class="ttdef"><b>Definition:</b> <a href="cached__options_8cpp_source.html#l00012">cached_options.cpp:12</a></div></div>
<div class="ttc" id="acached__options_8cpp_html_a9b72c9314ac0439a25820b3abf2229f3"><div class="ttname"><a href="cached__options_8cpp.html#a9b72c9314ac0439a25820b3abf2229f3">use_tiles</a></div><div class="ttdeci">bool use_tiles</div><div class="ttdoc">Use tiles for display.</div><div class="ttdef"><b>Definition:</b> <a href="cached__options_8cpp_source.html#l00007">cached_options.cpp:7</a></div></div>
<div class="ttc" id="acalendar_8cpp_html_a359120c15f92d54a49fec9de7bcb571f"><div class="ttname"><a href="calendar_8cpp.html#a359120c15f92d54a49fec9de7bcb571f">x_in_y</a></div><div class="ttdeci">bool x_in_y(const time_duration &amp;a, const time_duration &amp;b)</div><div class="ttdef"><b>Definition:</b> <a href="calendar_8cpp_source.html#l00521">calendar.cpp:521</a></div></div>
<div class="ttc" id="acalendar_8cpp_html_aeb989652ea2bf7fd03b07a74fd30bd7a"><div class="ttname"><a href="calendar_8cpp.html#aeb989652ea2bf7fd03b07a74fd30bd7a">to_string</a></div><div class="ttdeci">std::string to_string(const time_duration &amp;d)</div><div class="ttdoc">Returns a string showing a duration.</div><div class="ttdef"><b>Definition:</b> <a href="calendar_8cpp_source.html#l00327">calendar.cpp:327</a></div></div>
<div class="ttc" id="acalendar_8h_html"><div class="ttname"><a href="calendar_8h.html">calendar.h</a></div></div>
<div class="ttc" id="acata__tiles_8h_html_affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667"><div class="ttname"><a href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">text_alignment::center</a></div><div class="ttdeci">@ center</div></div>
<div class="ttc" id="acata__utility_8cpp_html_ac49c7bae3c3ac926a5501ffb127c1e97"><div class="ttname"><a href="cata__utility_8cpp.html#ac49c7bae3c3ac926a5501ffb127c1e97">multi_lerp</a></div><div class="ttdeci">float multi_lerp(const std::vector&lt; std::pair&lt; float, float &gt; &gt; &amp;points, float x)</div><div class="ttdoc">From points, finds p1 and p2 such that p1.first &lt; x &lt; p2.first Then linearly interpolates between p1....</div><div class="ttdef"><b>Definition:</b> <a href="cata__utility_8cpp_source.html#l00156">cata_utility.cpp:156</a></div></div>
<div class="ttc" id="acata__utility_8h_html"><div class="ttname"><a href="cata__utility_8h.html">cata_utility.h</a></div></div>
<div class="ttc" id="acata__utility_8h_html_ad22b4a043b6eb4c2c06f87f83b720b15"><div class="ttname"><a href="cata__utility_8h.html#ad22b4a043b6eb4c2c06f87f83b720b15">clamp</a></div><div class="ttdeci">constexpr T clamp(const T &amp;val, const T &amp;min, const T &amp;max)</div><div class="ttdoc">Clamp first argument so that it is no lower than second and no higher than third.</div><div class="ttdef"><b>Definition:</b> <a href="cata__utility_8h_source.html#l00145">cata_utility.h:145</a></div></div>
<div class="ttc" id="acatacharset_8cpp_html_a7616a48a4b48437c60b6683439a8f3e2"><div class="ttname"><a href="catacharset_8cpp.html#a7616a48a4b48437c60b6683439a8f3e2">utf8_width</a></div><div class="ttdeci">int utf8_width(const char *s, const bool ignore_tags)</div><div class="ttdef"><b>Definition:</b> <a href="catacharset_8cpp_source.html#l00142">catacharset.cpp:142</a></div></div>
<div class="ttc" id="acatacharset_8h_html"><div class="ttname"><a href="catacharset_8h.html">catacharset.h</a></div></div>
<div class="ttc" id="acharacter_8cpp_html_a2fcb25d686f4a35fca374c6f71280311"><div class="ttname"><a href="character_8cpp.html#a2fcb25d686f4a35fca374c6f71280311">get_player_character</a></div><div class="ttdeci">Character &amp; get_player_character()</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00387">character.cpp:387</a></div></div>
<div class="ttc" id="acharacter_8h_html"><div class="ttname"><a href="character_8h.html">character.h</a></div></div>
<div class="ttc" id="aclassCharacter_html"><div class="ttname"><a href="classCharacter.html">Character</a></div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00202">character.h:203</a></div></div>
<div class="ttc" id="aclassCharacter_html_a057d68671b298012a18f4e289b39935d"><div class="ttname"><a href="classCharacter.html#a057d68671b298012a18f4e289b39935d">Character::recoil</a></div><div class="ttdeci">double recoil</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00561">character.h:561</a></div></div>
<div class="ttc" id="aclassCharacter_html_a1e1996b6d6fc0a86d917cd155e1656d8"><div class="ttname"><a href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">Character::disp_name</a></div><div class="ttdeci">std::string disp_name(bool possessive=false, bool capitalize_first=false) const override</div><div class="ttdoc">Returns either &quot;you&quot; or the player's name.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00546">character.cpp:546</a></div></div>
<div class="ttc" id="aclassCharacter_html_a34a927d0f161ac92ab0d462397828bd5"><div class="ttname"><a href="classCharacter.html#a34a927d0f161ac92ab0d462397828bd5">Character::get_dex</a></div><div class="ttdeci">virtual int get_dex() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04068">character.cpp:4068</a></div></div>
<div class="ttc" id="aclassCharacter_html_a35f89e2e6eb1144b623be5281f4f221b"><div class="ttname"><a href="classCharacter.html#a35f89e2e6eb1144b623be5281f4f221b">Character::i_rem</a></div><div class="ttdeci">item i_rem(int pos)</div><div class="ttdoc">Remove a specific item from player possession.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l02424">character.cpp:2424</a></div></div>
<div class="ttc" id="aclassCharacter_html_a37855668c0e9260587d5561b044f5510"><div class="ttname"><a href="classCharacter.html#a37855668c0e9260587d5561b044f5510">Character::effective_dispersion</a></div><div class="ttdeci">int effective_dispersion(int dispersion) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00567">character.cpp:567</a></div></div>
<div class="ttc" id="aclassCharacter_html_a3aaa75382f6308a729369c7f2ccf0600"><div class="ttname"><a href="classCharacter.html#a3aaa75382f6308a729369c7f2ccf0600">Character::worn_with_flag</a></div><div class="ttdeci">bool worn_with_flag(const std::string &amp;flag, const bodypart_id &amp;bp=bodypart_str_id::NULL_ID()) const</div><div class="ttdoc">Returns true if the player is wearing an item with the given flag.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l03270">character.cpp:3270</a></div></div>
<div class="ttc" id="aclassCharacter_html_a3d0ec2b4e80527bd2daad576c2bbb187"><div class="ttname"><a href="classCharacter.html#a3d0ec2b4e80527bd2daad576c2bbb187">Character::use_charges</a></div><div class="ttdeci">std::list&lt; item &gt; use_charges(const itype_id &amp;what, int qty, const std::function&lt; bool(const item &amp;)&gt; &amp;filter=return_true&lt; item &gt;)</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l09656">character.cpp:9656</a></div></div>
<div class="ttc" id="aclassCharacter_html_a455c06bf0dab6e3558f759fe43e27e98"><div class="ttname"><a href="classCharacter.html#a455c06bf0dab6e3558f759fe43e27e98">Character::throw_range</a></div><div class="ttdeci">int throw_range(const item &amp;) const</div><div class="ttdoc">Maximum thrown range with a given item, taking all active effects into account.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l06266">character.cpp:6266</a></div></div>
<div class="ttc" id="aclassCharacter_html_a4eddeb86babf626e7869882079b40651"><div class="ttname"><a href="classCharacter.html#a4eddeb86babf626e7869882079b40651">Character::can_use</a></div><div class="ttdeci">bool can_use(const item &amp;it, const item &amp;context=item()) const</div><div class="ttdoc">Checks if character stats and skills meet minimum requirements for the item.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l02917">character.cpp:2917</a></div></div>
<div class="ttc" id="aclassCharacter_html_a51a6b8e64f0e18cd2d0bbfcff2edae57"><div class="ttname"><a href="classCharacter.html#a51a6b8e64f0e18cd2d0bbfcff2edae57">Character::has_morale</a></div><div class="ttdeci">bool has_morale(const morale_type &amp;type) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l09100">character.cpp:9100</a></div></div>
<div class="ttc" id="aclassCharacter_html_a5751b689e5a4ecd43b6de5c3e2d31541"><div class="ttname"><a href="classCharacter.html#a5751b689e5a4ecd43b6de5c3e2d31541">Character::has_bionic</a></div><div class="ttdeci">bool has_bionic(const bionic_id &amp;b) const</div><div class="ttdoc">Returns true if the player has the entered bionic id.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l01877">character.cpp:1877</a></div></div>
<div class="ttc" id="aclassCharacter_html_a5aba683ccf77cb560a0a932308289bd9"><div class="ttname"><a href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">Character::get_str</a></div><div class="ttdeci">virtual int get_str() const</div><div class="ttdoc">Getters for stats exclusive to characters.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04064">character.cpp:4064</a></div></div>
<div class="ttc" id="aclassCharacter_html_a61bc9422c35b63128532af268e52cb71"><div class="ttname"><a href="classCharacter.html#a61bc9422c35b63128532af268e52cb71">Character::in_vehicle</a></div><div class="ttdeci">bool in_vehicle</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l01511">character.h:1511</a></div></div>
<div class="ttc" id="aclassCharacter_html_a6592c35167738421f3e04ca8808d37db"><div class="ttname"><a href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">Character::name</a></div><div class="ttdeci">std::string name</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l01504">character.h:1504</a></div></div>
<div class="ttc" id="aclassCharacter_html_a67b51491c2529df09755e07bc633cc55"><div class="ttname"><a href="classCharacter.html#a67b51491c2529df09755e07bc633cc55">Character::is_mounted</a></div><div class="ttdeci">bool is_mounted() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l01143">character.cpp:1143</a></div></div>
<div class="ttc" id="aclassCharacter_html_a7a8f9ffd035435c9f2777e007059e68d"><div class="ttname"><a href="classCharacter.html#a7a8f9ffd035435c9f2777e007059e68d">Character::get_aim_types</a></div><div class="ttdeci">std::vector&lt; aim_type &gt; get_aim_types(const item &amp;gun) const</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01628">ranged.cpp:1628</a></div></div>
<div class="ttc" id="aclassCharacter_html_a851daac85a019452f34ba82a377773b0"><div class="ttname"><a href="classCharacter.html#a851daac85a019452f34ba82a377773b0">Character::aim_per_move</a></div><div class="ttdeci">double aim_per_move(const item &amp;gun, double recoil) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00665">character.cpp:665</a></div></div>
<div class="ttc" id="aclassCharacter_html_a8e2d2e1c01bfbb36401ae221300370f5"><div class="ttname"><a href="classCharacter.html#a8e2d2e1c01bfbb36401ae221300370f5">Character::has_two_arms</a></div><div class="ttdeci">bool has_two_arms() const</div><div class="ttdoc">Returns true if the player has two functioning arms.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l01280">character.cpp:1280</a></div></div>
<div class="ttc" id="aclassCharacter_html_a9333ab3cffa25b588ec5aa932db8d73d"><div class="ttname"><a href="classCharacter.html#a9333ab3cffa25b588ec5aa932db8d73d">Character::sees_with_specials</a></div><div class="ttdeci">bool sees_with_specials(const Creature &amp;critter) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l06424">character.cpp:6424</a></div></div>
<div class="ttc" id="aclassCharacter_html_a9976ba9d9bccdaff264bd834628b97ec"><div class="ttname"><a href="classCharacter.html#a9976ba9d9bccdaff264bd834628b97ec">Character::sees_with_infrared</a></div><div class="ttdeci">bool sees_with_infrared(const Creature &amp;critter) const</div><div class="ttdoc">Check whether the this player can see the other creature with infrared.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l10198">character.cpp:10198</a></div></div>
<div class="ttc" id="aclassCharacter_html_a9bff3208a5e121c4e3a71b81b378e4e7"><div class="ttname"><a href="classCharacter.html#a9bff3208a5e121c4e3a71b81b378e4e7">Character::has_charges</a></div><div class="ttdeci">bool has_charges(const itype_id &amp;it, int quantity, const std::function&lt; bool(const item &amp;)&gt; &amp;filter=return_true&lt; item &gt;) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l09596">character.cpp:9596</a></div></div>
<div class="ttc" id="aclassCharacter_html_aa5ca0f6c4fb1c08bb93ece1c9746c368"><div class="ttname"><a href="classCharacter.html#aa5ca0f6c4fb1c08bb93ece1c9746c368">Character::get_size</a></div><div class="ttdeci">m_size get_size() const override</div><div class="ttdoc">Get size class of character.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00541">character.cpp:541</a></div></div>
<div class="ttc" id="aclassCharacter_html_aaef1f2b773b9e659b6b69f813ea4dafb"><div class="ttname"><a href="classCharacter.html#aaef1f2b773b9e659b6b69f813ea4dafb">Character::ranged_dex_mod</a></div><div class="ttdeci">virtual int ranged_dex_mod() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04129">character.cpp:4129</a></div></div>
<div class="ttc" id="aclassCharacter_html_ab6b6b317ae10bfb8f358fe289d645c96"><div class="ttname"><a href="classCharacter.html#ab6b6b317ae10bfb8f358fe289d645c96">Character::add_morale</a></div><div class="ttdeci">void add_morale(const morale_type &amp;type, int bonus, int max_bonus=0, const time_duration &amp;duration=1_hours, const time_duration &amp;decay_start=30_minutes, bool capped=false, const itype *item_type=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l09089">character.cpp:9089</a></div></div>
<div class="ttc" id="aclassCharacter_html_aba9bd7517b334e6ed4149889ed32377a"><div class="ttname"><a href="classCharacter.html#aba9bd7517b334e6ed4149889ed32377a">Character::sees</a></div><div class="ttdeci">bool sees(const tripoint &amp;t, bool is_player=false, int range_mod=0) const override</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l10409">character.cpp:10409</a></div></div>
<div class="ttc" id="aclassCharacter_html_ac29de3d2bc90dd1c8d921b539fb05cfb"><div class="ttname"><a href="classCharacter.html#ac29de3d2bc90dd1c8d921b539fb05cfb">Character::mod_stamina</a></div><div class="ttdeci">void mod_stamina(int mod)</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l07211">character.cpp:7211</a></div></div>
<div class="ttc" id="aclassCharacter_html_ac3d46549b7cdaac1f98991167ad5f1b3"><div class="ttname"><a href="classCharacter.html#ac3d46549b7cdaac1f98991167ad5f1b3">Character::mounted_creature</a></div><div class="ttdeci">shared_ptr_fast&lt; monster &gt; mounted_creature</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l01556">character.h:1556</a></div></div>
<div class="ttc" id="aclassCharacter_html_ac55733961846b5c57183bd3b0fde9eae"><div class="ttname"><a href="classCharacter.html#ac55733961846b5c57183bd3b0fde9eae">Character::rem_morale</a></div><div class="ttdeci">void rem_morale(const morale_type &amp;type)</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l09110">character.cpp:9110</a></div></div>
<div class="ttc" id="aclassCharacter_html_accd6b165a9454cad9972bc153061215a"><div class="ttname"><a href="classCharacter.html#accd6b165a9454cad9972bc153061215a">Character::recoil_vehicle</a></div><div class="ttdeci">double recoil_vehicle() const</div><div class="ttdoc">Get maximum recoil penalty due to vehicle motion.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02050">ranged.cpp:2050</a></div></div>
<div class="ttc" id="aclassCharacter_html_ad24859164517ed6e392e21df69527199"><div class="ttname"><a href="classCharacter.html#ad24859164517ed6e392e21df69527199">Character::pos</a></div><div class="ttdeci">const tripoint &amp; pos() const override</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00714">character.cpp:714</a></div></div>
<div class="ttc" id="aclassCharacter_html_adb54bdcb284abb66b6be99c8ae225065"><div class="ttname"><a href="classCharacter.html#adb54bdcb284abb66b6be99c8ae225065">Character::getID</a></div><div class="ttdeci">character_id getID() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00477">character.cpp:477</a></div></div>
<div class="ttc" id="aclassCharacter_html_adc1fd84a88722a905e57fea8bfd5b6b0"><div class="ttname"><a href="classCharacter.html#adc1fd84a88722a905e57fea8bfd5b6b0">Character::encumb</a></div><div class="ttdeci">int encumb(body_part bp) const</div><div class="ttdoc">Returns ENC provided by armor, etc.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04001">character.cpp:4001</a></div></div>
<div class="ttc" id="aclassCharacter_html_add22510ff2fa20a662868b4dd86e030e"><div class="ttname"><a href="classCharacter.html#add22510ff2fa20a662868b4dd86e030e">Character::get_power_level</a></div><div class="ttdeci">units::energy get_power_level() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l01967">character.cpp:1967</a></div></div>
<div class="ttc" id="aclassCharacter_html_ae68b7a6565646ba662e448bded8b6599"><div class="ttname"><a href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">Character::weapon</a></div><div class="ttdeci">item weapon</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l01521">character.h:1521</a></div></div>
<div class="ttc" id="aclassCharacter_html_aec46a4b513360ef60f6143830bbb711d"><div class="ttname"><a href="classCharacter.html#aec46a4b513360ef60f6143830bbb711d">Character::recoil_total</a></div><div class="ttdeci">double recoil_total() const</div><div class="ttdoc">Current total maximum recoil penalty from all sources.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02062">ranged.cpp:2062</a></div></div>
<div class="ttc" id="aclassCharacter_html_af06dd97724f4f05df782e7a4b4f9cfe1"><div class="ttname"><a href="classCharacter.html#af06dd97724f4f05df782e7a4b4f9cfe1">Character::has_trait</a></div><div class="ttdeci">bool has_trait(const trait_id &amp;b) const override</div><div class="ttdoc">Returns true if the player has the entered trait.</div><div class="ttdef"><b>Definition:</b> <a href="mutation_8cpp_source.html#l00103">mutation.cpp:103</a></div></div>
<div class="ttc" id="aclassCharacter_html_af9c7419575e23d52745c94009929fafb"><div class="ttname"><a href="classCharacter.html#af9c7419575e23d52745c94009929fafb">Character::has_active_bionic</a></div><div class="ttdeci">bool has_active_bionic(const bionic_id &amp;b) const</div><div class="ttdoc">Returns true if the player has the entered bionic id and it is powered on.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l01887">character.cpp:1887</a></div></div>
<div class="ttc" id="aclassCharacter_html_afa95fe499ca6b55ab97f1b442a4c95c5"><div class="ttname"><a href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">Character::get_skill_level</a></div><div class="ttdeci">int get_skill_level(const skill_id &amp;ident) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l03356">character.cpp:3356</a></div></div>
<div class="ttc" id="aclassCreature_html"><div class="ttname"><a href="classCreature.html">Creature</a></div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00077">creature.h:78</a></div></div>
<div class="ttc" id="aclassCreature_html_a1c8ea56d06ff96a720201c46a40969aa"><div class="ttname"><a href="classCreature.html#a1c8ea56d06ff96a720201c46a40969aa">Creature::ranged_target_size</a></div><div class="ttdeci">double ranged_target_size() const</div><div class="ttdoc">Size of the target this creature presents to ranged weapons.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00541">ranged.cpp:541</a></div></div>
<div class="ttc" id="aclassCreature_html_a1eadbc3e5891d1ff578ac49291e12b66"><div class="ttname"><a href="classCreature.html#a1eadbc3e5891d1ff578ac49291e12b66">Creature::describe_infrared</a></div><div class="ttdeci">void describe_infrared(std::vector&lt; std::string &gt; &amp;buf) const</div><div class="ttdoc">Describe this creature as seen by the avatar via infrared vision.</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01976">creature.cpp:1976</a></div></div>
<div class="ttc" id="aclassCreature_html_a21b8fbeb525a28615eec6a6c22beff44"><div class="ttname"><a href="classCreature.html#a21b8fbeb525a28615eec6a6c22beff44">Creature::facing</a></div><div class="ttdeci">FacingDirection facing</div><div class="ttdoc">return the direction the creature is facing, for sdl horizontal flip</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00135">creature.h:135</a></div></div>
<div class="ttc" id="aclassCreature_html_a45926a7ba63ccc9be744f87a4d540b7d"><div class="ttname"><a href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">Creature::pos</a></div><div class="ttdeci">virtual const tripoint &amp; pos() const =0</div></div>
<div class="ttc" id="aclassCreature_html_a5698402eb4d7bbb013213f11f5768c92"><div class="ttname"><a href="classCreature.html#a5698402eb4d7bbb013213f11f5768c92">Creature::attitude_to</a></div><div class="ttdeci">virtual Attitude attitude_to(const Creature &amp;other) const =0</div><div class="ttdoc">Attitude (of this creature) towards another creature.</div></div>
<div class="ttc" id="aclassCreature_html_a5a2346f549de9c87e8f2afeec1e71366"><div class="ttname"><a href="classCreature.html#a5a2346f549de9c87e8f2afeec1e71366">Creature::is_underwater</a></div><div class="ttdeci">virtual bool is_underwater() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l00174">creature.cpp:174</a></div></div>
<div class="ttc" id="aclassCreature_html_a6293c17885ef44d613618b4953a1be17"><div class="ttname"><a href="classCreature.html#a6293c17885ef44d613618b4953a1be17">Creature::describe_specials</a></div><div class="ttdeci">void describe_specials(std::vector&lt; std::string &gt; &amp;buf) const</div><div class="ttdoc">Describe this creature as detected by the avatar's special senses.</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l02004">creature.cpp:2004</a></div></div>
<div class="ttc" id="aclassCreature_html_a6fb79df9315dc2bed6f34d9a2e37da90"><div class="ttname"><a href="classCreature.html#a6fb79df9315dc2bed6f34d9a2e37da90">Creature::has_effect</a></div><div class="ttdeci">bool has_effect(const efftype_id &amp;eff_id, body_part bp=num_bp) const</div><div class="ttdoc">Check if creature has the matching effect.</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01179">creature.cpp:1179</a></div></div>
<div class="ttc" id="aclassCreature_html_a73b9cb6320e4447addaec375887e7861"><div class="ttname"><a href="classCreature.html#a73b9cb6320e4447addaec375887e7861">Creature::dispersion_for_even_chance_of_good_hit</a></div><div class="ttdeci">static std::vector&lt; int &gt; dispersion_for_even_chance_of_good_hit</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00848">creature.h:848</a></div></div>
<div class="ttc" id="aclassCreature_html_a7cf71d2bd6c350f2ceda3f1d64046e63"><div class="ttname"><a href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">Creature::add_msg_player_or_npc</a></div><div class="ttdeci">virtual void add_msg_player_or_npc(const std::string &amp;, const std::string &amp;) const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00677">creature.h:677</a></div></div>
<div class="ttc" id="aclassCreature_html_a891bc2d0c564449cb462178317819254"><div class="ttname"><a href="classCreature.html#a891bc2d0c564449cb462178317819254">Creature::mod_moves</a></div><div class="ttdeci">void mod_moves(int nmoves)</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01408">creature.cpp:1408</a></div></div>
<div class="ttc" id="aclassCreature_html_a8a475630b3289c468bd06cf114008217"><div class="ttname"><a href="classCreature.html#a8a475630b3289c468bd06cf114008217">Creature::Attitude</a></div><div class="ttdeci">Attitude</div><div class="ttdoc">Simplified attitude towards any creature: hostile - hate, want to kill, etc.</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00168">creature.h:168</a></div></div>
<div class="ttc" id="aclassCreature_html_a8a475630b3289c468bd06cf114008217a8972817fc4b645a5fee948a7ab4d3cc2"><div class="ttname"><a href="classCreature.html#a8a475630b3289c468bd06cf114008217a8972817fc4b645a5fee948a7ab4d3cc2">Creature::A_HOSTILE</a></div><div class="ttdeci">@ A_HOSTILE</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00169">creature.h:169</a></div></div>
<div class="ttc" id="aclassCreature_html_a8a475630b3289c468bd06cf114008217ac45ee12dee5d3dc56de7fe86e4484bea"><div class="ttname"><a href="classCreature.html#a8a475630b3289c468bd06cf114008217ac45ee12dee5d3dc56de7fe86e4484bea">Creature::A_FRIENDLY</a></div><div class="ttdeci">@ A_FRIENDLY</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00171">creature.h:171</a></div></div>
<div class="ttc" id="aclassCreature_html_a8c5a392caa213bee9581b47e9f0e2052"><div class="ttname"><a href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">Creature::moves</a></div><div class="ttdeci">int moves</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00569">creature.h:569</a></div></div>
<div class="ttc" id="aclassCreature_html_a993e0edf9322ff4aba71a9a3a4f5485c"><div class="ttname"><a href="classCreature.html#a993e0edf9322ff4aba71a9a3a4f5485c">Creature::has_flag</a></div><div class="ttdeci">virtual bool has_flag(const m_flag) const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00482">creature.h:482</a></div></div>
<div class="ttc" id="aclassCreature_html_aaa501dbe3d1e90d47da43fb9ea57b3be"><div class="ttname"><a href="classCreature.html#aaa501dbe3d1e90d47da43fb9ea57b3be">Creature::get_dodge</a></div><div class="ttdeci">virtual float get_dodge() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01508">creature.cpp:1508</a></div></div>
<div class="ttc" id="aclassCreature_html_ab0d27ad3c2c730a3c88ee897e55f344f"><div class="ttname"><a href="classCreature.html#ab0d27ad3c2c730a3c88ee897e55f344f">Creature::print_info</a></div><div class="ttdeci">virtual int print_info(const catacurses::window &amp;w, int vStart, int vLines, int column) const =0</div><div class="ttdoc">Write information about this creature.</div></div>
<div class="ttc" id="aclassCreature_html_ab4c5777adaad4601b9ca17330371f5b7"><div class="ttname"><a href="classCreature.html#ab4c5777adaad4601b9ca17330371f5b7">Creature::get_size</a></div><div class="ttdeci">virtual m_size get_size() const =0</div></div>
<div class="ttc" id="aclassCreature_html_aed84fe52e1335d48d53f482f8a278c87"><div class="ttname"><a href="classCreature.html#aed84fe52e1335d48d53f482f8a278c87">Creature::is_npc</a></div><div class="ttdeci">virtual bool is_npc() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00098">creature.h:98</a></div></div>
<div class="ttc" id="aclassCreature_html_af826bfbdc9d7f81a8b9e53775f43d080"><div class="ttname"><a href="classCreature.html#af826bfbdc9d7f81a8b9e53775f43d080">Creature::set_moves</a></div><div class="ttdeci">void set_moves(int nmoves)</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01412">creature.cpp:1412</a></div></div>
<div class="ttc" id="aclassSkill_html_a879f0e8d0da73f0cdebd825134cd32d6"><div class="ttname"><a href="classSkill.html#a879f0e8d0da73f0cdebd825134cd32d6">Skill::time_to_attack</a></div><div class="ttdeci">time_info_t time_to_attack() const</div><div class="ttdef"><b>Definition:</b> <a href="skill_8h_source.html#l00081">skill.h:81</a></div></div>
<div class="ttc" id="aclassaim__activity__actor_html"><div class="ttname"><a href="classaim__activity__actor.html">aim_activity_actor</a></div><div class="ttdef"><b>Definition:</b> <a href="activity__actor__definitions_8h_source.html#l00019">activity_actor_definitions.h:20</a></div></div>
<div class="ttc" id="aclassaim__activity__actor_html_a064e415f122aefc25c29b9d3eee4fa4e"><div class="ttname"><a href="classaim__activity__actor.html#a064e415f122aefc25c29b9d3eee4fa4e">aim_activity_actor::aborted</a></div><div class="ttdeci">bool aborted</div><div class="ttdoc">Target UI requested to abort aiming.</div><div class="ttdef"><b>Definition:</b> <a href="activity__actor__definitions_8h_source.html#l00035">activity_actor_definitions.h:35</a></div></div>
<div class="ttc" id="aclassaim__activity__actor_html_a289353e8cf59d999c2e3db1db5d89f12"><div class="ttname"><a href="classaim__activity__actor.html#a289353e8cf59d999c2e3db1db5d89f12">aim_activity_actor::snap_to_target</a></div><div class="ttdeci">bool snap_to_target</div><div class="ttdef"><b>Definition:</b> <a href="activity__actor__definitions_8h_source.html#l00031">activity_actor_definitions.h:31</a></div></div>
<div class="ttc" id="aclassaim__activity__actor_html_a59cdab2e147fa7c2d2d46b9440083e05"><div class="ttname"><a href="classaim__activity__actor.html#a59cdab2e147fa7c2d2d46b9440083e05">aim_activity_actor::first_turn</a></div><div class="ttdeci">bool first_turn</div><div class="ttdef"><b>Definition:</b> <a href="activity__actor__definitions_8h_source.html#l00027">activity_actor_definitions.h:27</a></div></div>
<div class="ttc" id="aclassaim__activity__actor_html_a5a65a1ad1452654bdf0ce924ba8dcf53"><div class="ttname"><a href="classaim__activity__actor.html#a5a65a1ad1452654bdf0ce924ba8dcf53">aim_activity_actor::reload_requested</a></div><div class="ttdeci">bool reload_requested</div><div class="ttdoc">Target UI requested to abort aiming and reload weapon Implies aborted = true.</div><div class="ttdef"><b>Definition:</b> <a href="activity__actor__definitions_8h_source.html#l00042">activity_actor_definitions.h:42</a></div></div>
<div class="ttc" id="aclassaim__activity__actor_html_a5e4630c6a7a1630c7d93714d221ed78e"><div class="ttname"><a href="classaim__activity__actor.html#a5e4630c6a7a1630c7d93714d221ed78e">aim_activity_actor::aif_duration</a></div><div class="ttdeci">int aif_duration</div><div class="ttdef"><b>Definition:</b> <a href="activity__actor__definitions_8h_source.html#l00029">activity_actor_definitions.h:29</a></div></div>
<div class="ttc" id="aclassaim__activity__actor_html_a8f9b4001d182a0fc1ab4fdd8bd5b1507"><div class="ttname"><a href="classaim__activity__actor.html#a8f9b4001d182a0fc1ab4fdd8bd5b1507">aim_activity_actor::aiming_at_critter</a></div><div class="ttdeci">bool aiming_at_critter</div><div class="ttdef"><b>Definition:</b> <a href="activity__actor__definitions_8h_source.html#l00030">activity_actor_definitions.h:30</a></div></div>
<div class="ttc" id="aclassaim__activity__actor_html_a9835661ff059c7c690bf26075417b9b9"><div class="ttname"><a href="classaim__activity__actor.html#a9835661ff059c7c690bf26075417b9b9">aim_activity_actor::acceptable_losses</a></div><div class="ttdeci">std::vector&lt; weak_ptr_fast&lt; Creature &gt; &gt; acceptable_losses</div><div class="ttdoc">A friendly creature may enter line of fire during aim-and-shoot, and that generates a warning to proc...</div><div class="ttdef"><b>Definition:</b> <a href="activity__actor__definitions_8h_source.html#l00049">activity_actor_definitions.h:49</a></div></div>
<div class="ttc" id="aclassaim__activity__actor_html_ab7b696d1eb458e907dbccf99a5dd54aa"><div class="ttname"><a href="classaim__activity__actor.html#ab7b696d1eb458e907dbccf99a5dd54aa">aim_activity_actor::shifting_view</a></div><div class="ttdeci">bool shifting_view</div><div class="ttdef"><b>Definition:</b> <a href="activity__actor__definitions_8h_source.html#l00032">activity_actor_definitions.h:32</a></div></div>
<div class="ttc" id="aclassaim__activity__actor_html_ae287f1e168ac9ea8cfc16f0f55d323ef"><div class="ttname"><a href="classaim__activity__actor.html#ae287f1e168ac9ea8cfc16f0f55d323ef">aim_activity_actor::action</a></div><div class="ttdeci">std::string action</div><div class="ttdef"><b>Definition:</b> <a href="activity__actor__definitions_8h_source.html#l00028">activity_actor_definitions.h:28</a></div></div>
<div class="ttc" id="aclassavatar_html"><div class="ttname"><a href="classavatar.html">avatar</a></div><div class="ttdef"><b>Definition:</b> <a href="avatar_8h_source.html#l00053">avatar.h:54</a></div></div>
<div class="ttc" id="aclassavatar_html_a98553758b9d158c58dd11c77d97ff55e"><div class="ttname"><a href="classavatar.html#a98553758b9d158c58dd11c77d97ff55e">avatar::preferred_aiming_mode</a></div><div class="ttdeci">std::string preferred_aiming_mode</div><div class="ttdef"><b>Definition:</b> <a href="avatar_8h_source.html#l00190">avatar.h:190</a></div></div>
<div class="ttc" id="aclasscata_1_1optional_html"><div class="ttname"><a href="classcata_1_1optional.html">cata::optional</a></div><div class="ttdef"><b>Definition:</b> <a href="optional_8h_source.html#l00030">optional.h:31</a></div></div>
<div class="ttc" id="aclasscata_1_1optional_html_ad5b847e0e2f1db1387a10bac3751ccf4"><div class="ttname"><a href="classcata_1_1optional.html#ad5b847e0e2f1db1387a10bac3751ccf4">cata::optional::has_value</a></div><div class="ttdeci">constexpr bool has_value() const noexcept</div><div class="ttdef"><b>Definition:</b> <a href="optional_8h_source.html#l00120">optional.h:120</a></div></div>
<div class="ttc" id="aclasscatacurses_1_1window_html"><div class="ttname"><a href="classcatacurses_1_1window.html">catacurses::window</a></div><div class="ttdoc">A wrapper over a pointer to a curses window.</div><div class="ttdef"><b>Definition:</b> <a href="cursesdef_8h_source.html#l00054">cursesdef.h:55</a></div></div>
<div class="ttc" id="aclassdispersion__sources_html"><div class="ttname"><a href="classdispersion__sources.html">dispersion_sources</a></div><div class="ttdef"><b>Definition:</b> <a href="dispersion_8h_source.html#l00008">dispersion.h:9</a></div></div>
<div class="ttc" id="aclassdispersion__sources_html_a3b8451b0f7c962f1b9f1c19e48d0cf65"><div class="ttname"><a href="classdispersion__sources.html#a3b8451b0f7c962f1b9f1c19e48d0cf65">dispersion_sources::add_multiplier</a></div><div class="ttdeci">void add_multiplier(double new_multiplier)</div><div class="ttdef"><b>Definition:</b> <a href="dispersion_8h_source.html#l00023">dispersion.h:23</a></div></div>
<div class="ttc" id="aclassdispersion__sources_html_ac3dc7f13e78a217aeaba57740f3af17c"><div class="ttname"><a href="classdispersion__sources.html#ac3dc7f13e78a217aeaba57740f3af17c">dispersion_sources::max</a></div><div class="ttdeci">double max() const</div><div class="ttdef"><b>Definition:</b> <a href="dispersion_8cpp_source.html#l00020">dispersion.cpp:20</a></div></div>
<div class="ttc" id="aclassdispersion__sources_html_acaee96ee2b8a0c87b6fb5a9e2d4285d9"><div class="ttname"><a href="classdispersion__sources.html#acaee96ee2b8a0c87b6fb5a9e2d4285d9">dispersion_sources::roll</a></div><div class="ttdeci">double roll() const</div><div class="ttdef"><b>Definition:</b> <a href="dispersion_8cpp_source.html#l00005">dispersion.cpp:5</a></div></div>
<div class="ttc" id="aclassdispersion__sources_html_af9119f90d39a52caf16086dca87b1cac"><div class="ttname"><a href="classdispersion__sources.html#af9119f90d39a52caf16086dca87b1cac">dispersion_sources::add_range</a></div><div class="ttdeci">void add_range(double new_source)</div><div class="ttdef"><b>Definition:</b> <a href="dispersion_8h_source.html#l00020">dispersion.h:20</a></div></div>
<div class="ttc" id="aclassgun__mode_html"><div class="ttname"><a href="classgun__mode.html">gun_mode</a></div><div class="ttdef"><b>Definition:</b> <a href="gun__mode_8h_source.html#l00012">gun_mode.h:13</a></div></div>
<div class="ttc" id="aclassgun__mode_html_a0b58020ecc1a637010d13f0ee7c40ef8"><div class="ttname"><a href="classgun__mode.html#a0b58020ecc1a637010d13f0ee7c40ef8">gun_mode::qty</a></div><div class="ttdeci">int qty</div><div class="ttdoc">burst size for is_gun() firearms, or melee range for is_melee() weapons</div><div class="ttdef"><b>Definition:</b> <a href="gun__mode_8h_source.html#l00021">gun_mode.h:21</a></div></div>
<div class="ttc" id="aclassgun__mode_html_a29fb11a5199f83a9c5801bf2af6d99e9"><div class="ttname"><a href="classgun__mode.html#a29fb11a5199f83a9c5801bf2af6d99e9">gun_mode::melee</a></div><div class="ttdeci">bool melee() const</div><div class="ttdoc">if true perform a melee attach as opposed to shooting</div><div class="ttdef"><b>Definition:</b> <a href="gun__mode_8h_source.html#l00033">gun_mode.h:33</a></div></div>
<div class="ttc" id="aclassgun__mode_html_a583a586a605731dbd36af20553c0e51d"><div class="ttname"><a href="classgun__mode.html#a583a586a605731dbd36af20553c0e51d">gun_mode::tname</a></div><div class="ttdeci">std::string tname() const</div><div class="ttdef"><b>Definition:</b> <a href="gun__mode_8h_source.html#l00059">gun_mode.h:59</a></div></div>
<div class="ttc" id="aclassgun__mode_html_aadaa36507ace08fc621348ae1052647e"><div class="ttname"><a href="classgun__mode.html#aadaa36507ace08fc621348ae1052647e">gun_mode::target</a></div><div class="ttdeci">item * target</div><div class="ttdoc">pointer to item providing this mode - base gun or attached gunmod</div><div class="ttdef"><b>Definition:</b> <a href="gun__mode_8h_source.html#l00019">gun_mode.h:19</a></div></div>
<div class="ttc" id="aclassinput__context_html"><div class="ttname"><a href="classinput__context.html">input_context</a></div><div class="ttdoc">Represents a context in which a set of actions can be performed.</div><div class="ttdef"><b>Definition:</b> <a href="input_8h_source.html#l00381">input.h:382</a></div></div>
<div class="ttc" id="aclassinput__context_html_a0937bc6e559b46c12c78aa65bea21942"><div class="ttname"><a href="classinput__context.html#a0937bc6e559b46c12c78aa65bea21942">input_context::get_coordinates</a></div><div class="ttdeci">cata::optional&lt; tripoint &gt; get_coordinates(const catacurses::window &amp;capture_win_)</div><div class="ttdoc">Get the coordinates associated with the last mouse click (if any).</div><div class="ttdef"><b>Definition:</b> <a href="input_8cpp_source.html#l01338">input.cpp:1338</a></div></div>
<div class="ttc" id="aclassinput__context_html_a26d796fbe876b21a2d8b85eb5d59195f"><div class="ttname"><a href="classinput__context.html#a26d796fbe876b21a2d8b85eb5d59195f">input_context::register_directions</a></div><div class="ttdeci">void register_directions()</div><div class="ttdef"><b>Definition:</b> <a href="input_8cpp_source.html#l00915">input.cpp:915</a></div></div>
<div class="ttc" id="aclassinput__context_html_a3c252676d2f1f2d49a0ec9c7fc7aae2b"><div class="ttname"><a href="classinput__context.html#a3c252676d2f1f2d49a0ec9c7fc7aae2b">input_context::get_direction</a></div><div class="ttdeci">cata::optional&lt; tripoint &gt; get_direction(const std::string &amp;action) const</div><div class="ttdoc">Convert a direction action (UP, DOWN etc) to a delta vector.</div><div class="ttdef"><b>Definition:</b> <a href="input_8cpp_source.html#l00961">input.cpp:961</a></div></div>
<div class="ttc" id="aclassinput__context_html_a43aa2fcd42cabfd04056def8986bc927"><div class="ttname"><a href="classinput__context.html#a43aa2fcd42cabfd04056def8986bc927">input_context::handle_input</a></div><div class="ttdeci">const std::string &amp; handle_input()</div><div class="ttdoc">Handles input and returns the next action in the queue.</div><div class="ttdef"><b>Definition:</b> <a href="input_8cpp_source.html#l00854">input.cpp:854</a></div></div>
<div class="ttc" id="aclassinput__context_html_abe76d2c284f2a277cbd2f367963fa9ab"><div class="ttname"><a href="classinput__context.html#abe76d2c284f2a277cbd2f367963fa9ab">input_context::get_desc</a></div><div class="ttdeci">std::string get_desc(const std::string &amp;action_descriptor, unsigned int max_limit=0, const input_event_filter &amp;evt_filter=allow_all_keys) const</div><div class="ttdoc">Get a description text for the key/other input method associated with the given action.</div><div class="ttdef"><b>Definition:</b> <a href="input_8cpp_source.html#l00756">input.cpp:756</a></div></div>
<div class="ttc" id="aclassinput__context_html_ac66ac124d5c0ac5637b5806f124d428f"><div class="ttname"><a href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">input_context::register_action</a></div><div class="ttdeci">void register_action(const std::string &amp;action_descriptor)</div><div class="ttdoc">Register an action with this input context.</div><div class="ttdef"><b>Definition:</b> <a href="input_8cpp_source.html#l00676">input.cpp:676</a></div></div>
<div class="ttc" id="aclassinput__context_html_aec8e809c4ee9afcde858709e07b5f64b"><div class="ttname"><a href="classinput__context.html#aec8e809c4ee9afcde858709e07b5f64b">input_context::set_iso</a></div><div class="ttdeci">void set_iso(bool mode=true)</div><div class="ttdef"><b>Definition:</b> <a href="input_8cpp_source.html#l01429">input.cpp:1429</a></div></div>
<div class="ttc" id="aclassinput__context_html_af2b7d6cab67d5a2eeb1122f3041edf79"><div class="ttname"><a href="classinput__context.html#af2b7d6cab67d5a2eeb1122f3041edf79">input_context::keys_bound_to</a></div><div class="ttdeci">std::vector&lt; char &gt; keys_bound_to(const std::string &amp;action_descriptor, bool restrict_to_printable=true) const</div><div class="ttdoc">Keys (and only keys, other input types are not included) that trigger the given action.</div><div class="ttdef"><b>Definition:</b> <a href="input_8cpp_source.html#l00695">input.cpp:695</a></div></div>
<div class="ttc" id="aclassint__id_html_a315169d32cce4267b7c8dceff4b0d1d7"><div class="ttname"><a href="classint__id.html#a315169d32cce4267b7c8dceff4b0d1d7">int_id::obj</a></div><div class="ttdeci">const ammo_effect &amp; obj() const</div><div class="ttdef"><b>Definition:</b> <a href="ammo__effect_8cpp_source.html#l00026">ammo_effect.cpp:26</a></div></div>
<div class="ttc" id="aclassitem_1_1reload__option_html"><div class="ttname"><a href="classitem_1_1reload__option.html">item::reload_option</a></div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l00470">item.h:471</a></div></div>
<div class="ttc" id="aclassitem_1_1reload__option_html_afec3eb8ab3dff71940912db4a84ae7ea"><div class="ttname"><a href="classitem_1_1reload__option.html#afec3eb8ab3dff71940912db4a84ae7ea">item::reload_option::ammo</a></div><div class="ttdeci">item_location ammo</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l00483">item.h:483</a></div></div>
<div class="ttc" id="aclassitem__location_html"><div class="ttname"><a href="classitem__location.html">item_location</a></div><div class="ttdoc">A lightweight handle to an item independent of it's location Unlike a raw pointer can be (de-)seriali...</div><div class="ttdef"><b>Definition:</b> <a href="item__location_8h_source.html#l00022">item_location.h:23</a></div></div>
<div class="ttc" id="aclassitem_html"><div class="ttname"><a href="classitem.html">item</a></div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l00175">item.h:176</a></div></div>
<div class="ttc" id="aclassitem_html_a04985a2b99688b687432463fb2f0a853"><div class="ttname"><a href="classitem.html#a04985a2b99688b687432463fb2f0a853">item::reach_range</a></div><div class="ttdeci">int reach_range(const Character &amp;guy) const</div><div class="ttdoc">Max range of melee attack this weapon can be used for.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05148">item.cpp:5148</a></div></div>
<div class="ttc" id="aclassitem_html_a0b12108a604ac9d940716bb8f1368cf5"><div class="ttname"><a href="classitem.html#a0b12108a604ac9d940716bb8f1368cf5">item::get_var</a></div><div class="ttdeci">double get_var(const std::string &amp;name, double default_value) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l01024">item.cpp:1024</a></div></div>
<div class="ttc" id="aclassitem_html_a12a6fa8aac1350f3ca4362a1bdccd9b0"><div class="ttname"><a href="classitem.html#a12a6fa8aac1350f3ca4362a1bdccd9b0">item::faults</a></div><div class="ttdeci">std::set&lt; fault_id &gt; faults</div><div class="ttdoc">What faults (if any) currently apply to this item.</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l02160">item.h:2160</a></div></div>
<div class="ttc" id="aclassitem_html_a13b2b008995a2f2f2daa63be578b27c8"><div class="ttname"><a href="classitem.html#a13b2b008995a2f2f2daa63be578b27c8">item::base_damage_thrown</a></div><div class="ttdeci">damage_instance base_damage_thrown() const</div><div class="ttdoc">All damage types this item deals when thrown (no skill modifiers etc.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05142">item.cpp:5142</a></div></div>
<div class="ttc" id="aclassitem_html_a19e6dd5afd4bada41c8d97792fd0815d"><div class="ttname"><a href="classitem.html#a19e6dd5afd4bada41c8d97792fd0815d">item::get_property_int64_t</a></div><div class="ttdeci">int64_t get_property_int64_t(const std::string &amp;prop, int64_t def=0) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05252">item.cpp:5252</a></div></div>
<div class="ttc" id="aclassitem_html_a1a94ea108d695febf7f2bcf090f097fa"><div class="ttname"><a href="classitem.html#a1a94ea108d695febf7f2bcf090f097fa">item::gun_current_mode</a></div><div class="ttdeci">gun_mode gun_current_mode() const</div><div class="ttdoc">Get the current mode for this gun (or an invalid mode if item is not a gun)</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07730">item.cpp:7730</a></div></div>
<div class="ttc" id="aclassitem_html_a26c025fd4909bd31c8e91ed87905507b"><div class="ttname"><a href="classitem.html#a26c025fd4909bd31c8e91ed87905507b">item::ammo_remaining</a></div><div class="ttdeci">int ammo_remaining() const</div><div class="ttdoc">Quantity of ammunition currently loaded in tool, gun or auxiliary gunmod.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07220">item.cpp:7220</a></div></div>
<div class="ttc" id="aclassitem_html_a26ffce6c038cc9d398103dcd296275bd"><div class="ttname"><a href="classitem.html#a26ffce6c038cc9d398103dcd296275bd">item::gunmod_find</a></div><div class="ttdeci">item * gunmod_find(const itype_id &amp;mod)</div><div class="ttdoc">Get first attached gunmod matching type or nullptr if no such mod or item is not a gun.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07582">item.cpp:7582</a></div></div>
<div class="ttc" id="aclassitem_html_a2899a37f781e1efea9465a98277141c7"><div class="ttname"><a href="classitem.html#a2899a37f781e1efea9465a98277141c7">item::get_min_str</a></div><div class="ttdeci">int get_min_str() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l09865">item.cpp:9865</a></div></div>
<div class="ttc" id="aclassitem_html_a2912b2e15a4eec07a5070fffbbd152e8"><div class="ttname"><a href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">item::is_gun</a></div><div class="ttdeci">bool is_gun() const</div><div class="ttdoc">Can this item be used to perform a ranged attack?</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06361">item.cpp:6361</a></div></div>
<div class="ttc" id="aclassitem_html_a2993eb10a5ae589e6bb1be0a74cb65c1"><div class="ttname"><a href="classitem.html#a2993eb10a5ae589e6bb1be0a74cb65c1">item::active</a></div><div class="ttdeci">bool active</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l02233">item.h:2233</a></div></div>
<div class="ttc" id="aclassitem_html_a3157f01f1da6fe89bdbc87db2605afb9"><div class="ttname"><a href="classitem.html#a3157f01f1da6fe89bdbc87db2605afb9">item::weight</a></div><div class="ttdeci">units::mass weight(bool include_contents=true, bool integral=false) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l04838">item.cpp:4838</a></div></div>
<div class="ttc" id="aclassitem_html_a3694c5d9138956736af2444bd7b3972e"><div class="ttname"><a href="classitem.html#a3694c5d9138956736af2444bd7b3972e">item::gun_noise</a></div><div class="ttdeci">sound_data gun_noise(bool burst=false) const</div><div class="ttdoc">Returns the sound of the gun being fired.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01778">ranged.cpp:1778</a></div></div>
<div class="ttc" id="aclassitem_html_a3841e9e250af73e45b14d5bb3cc7a043"><div class="ttname"><a href="classitem.html#a3841e9e250af73e45b14d5bb3cc7a043">item::put_in</a></div><div class="ttdeci">void put_in(const item &amp;payload)</div><div class="ttdoc">Puts the given item into this one, no checks are performed.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l00989">item.cpp:989</a></div></div>
<div class="ttc" id="aclassitem_html_a3b83c2e0d1313b542801169382be1605"><div class="ttname"><a href="classitem.html#a3b83c2e0d1313b542801169382be1605">item::gun_get_mode_id</a></div><div class="ttdeci">gun_mode_id gun_get_mode_id() const</div><div class="ttdoc">Get id of mode a gun is currently set to, e.g.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07735">item.cpp:7735</a></div></div>
<div class="ttc" id="aclassitem_html_a3d8542661f2e2a82e8cb3792584912f3"><div class="ttname"><a href="classitem.html#a3d8542661f2e2a82e8cb3792584912f3">item::gun_skill</a></div><div class="ttdeci">skill_id gun_skill() const</div><div class="ttdoc">The skill used to operate the gun.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07020">item.cpp:7020</a></div></div>
<div class="ttc" id="aclassitem_html_a40963a016376016eb408bdb9dbb94388"><div class="ttname"><a href="classitem.html#a40963a016376016eb408bdb9dbb94388">item::count_by_charges</a></div><div class="ttdeci">bool count_by_charges() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05849">item.cpp:5849</a></div></div>
<div class="ttc" id="aclassitem_html_a4326944ae95f4d265c8ca1c76ed89a03"><div class="ttname"><a href="classitem.html#a4326944ae95f4d265c8ca1c76ed89a03">item::made_of</a></div><div class="ttdeci">const std::vector&lt; material_id &gt; &amp; made_of() const</div><div class="ttdoc">The ids of all the materials this is made of.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06257">item.cpp:6257</a></div></div>
<div class="ttc" id="aclassitem_html_a45bcd33992b7d26eb4ae9f76a16b58fa"><div class="ttname"><a href="classitem.html#a45bcd33992b7d26eb4ae9f76a16b58fa">item::has_fault</a></div><div class="ttdeci">bool has_fault(const fault_id &amp;fault) const</div><div class="ttdoc">Does this item have the specified fault.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05176">item.cpp:5176</a></div></div>
<div class="ttc" id="aclassitem_html_a4938361b8fe897c4e85d66020ef91aff"><div class="ttname"><a href="classitem.html#a4938361b8fe897c4e85d66020ef91aff">item::set_var</a></div><div class="ttdeci">void set_var(const std::string &amp;name, int value)</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l00994">item.cpp:994</a></div></div>
<div class="ttc" id="aclassitem_html_a4adcc4a3a5f5fb20a4d245d79109640a"><div class="ttname"><a href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">item::ammo_data</a></div><div class="ttdeci">const itype * ammo_data() const</div><div class="ttdoc">Specific ammo data, returns nullptr if item is neither ammo nor loaded with any.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07370">item.cpp:7370</a></div></div>
<div class="ttc" id="aclassitem_html_a4dbbda81cd9bc9ed386b9c5bf71d5acd"><div class="ttname"><a href="classitem.html#a4dbbda81cd9bc9ed386b9c5bf71d5acd">item::gun_recoil</a></div><div class="ttdeci">int gun_recoil(bool bipod=false) const</div><div class="ttdoc">Get effective recoil considering handling, loaded ammo and effects of attached gunmods.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07162">item.cpp:7162</a></div></div>
<div class="ttc" id="aclassitem_html_a51eafbdf8b331d88b741c0c527f98eb9"><div class="ttname"><a href="classitem.html#a51eafbdf8b331d88b741c0c527f98eb9">item::volume</a></div><div class="ttdeci">units::volume volume(bool integral=false) const</div><div class="ttdoc">Total volume of an item accounting for all contained/integrated items NOTE: Result is rounded up to n...</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l04985">item.cpp:4985</a></div></div>
<div class="ttc" id="aclassitem_html_a5cc833f71e0454446fd0f877d24f6585"><div class="ttname"><a href="classitem.html#a5cc833f71e0454446fd0f877d24f6585">item::common_ammo_default</a></div><div class="ttdeci">itype_id common_ammo_default(bool conversion=true) const</div><div class="ttdoc">Get default ammo for the first ammotype common to an item and its current magazine or &quot;NULL&quot; if none ...</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07449">item.cpp:7449</a></div></div>
<div class="ttc" id="aclassitem_html_a5d89f04a2a08245ec865db0865e8a6c1"><div class="ttname"><a href="classitem.html#a5d89f04a2a08245ec865db0865e8a6c1">item::ammo_capacity</a></div><div class="ttdeci">int ammo_capacity() const</div><div class="ttdoc">Maximum quantity of ammunition loadable for tool, gun or auxiliary gunmod.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07247">item.cpp:7247</a></div></div>
<div class="ttc" id="aclassitem_html_a624c3b7ec10ae766a9e75718af71e647"><div class="ttname"><a href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">item::ammo_current</a></div><div class="ttdeci">itype_id ammo_current() const</div><div class="ttdoc">Specific ammo type, returns &quot;null&quot; if item is neither ammo nor loaded with any.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07396">item.cpp:7396</a></div></div>
<div class="ttc" id="aclassitem_html_a6a3f16444c412bce4b75a7d600d6a3fe"><div class="ttname"><a href="classitem.html#a6a3f16444c412bce4b75a7d600d6a3fe">item::ammo_set</a></div><div class="ttdeci">item &amp; ammo_set(const itype_id &amp;ammo, int qty=-1)</div><div class="ttdoc">Filter setting the ammo for this instance Any existing ammo is removed.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l00589">item.cpp:589</a></div></div>
<div class="ttc" id="aclassitem_html_a6bfb92ab5d41e0eb3a1da160fac71b0e"><div class="ttname"><a href="classitem.html#a6bfb92ab5d41e0eb3a1da160fac71b0e">item::charges</a></div><div class="ttdeci">int charges</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l02195">item.h:2195</a></div></div>
<div class="ttc" id="aclassitem_html_a723753bab4cc789e3ec186846c9916a3"><div class="ttname"><a href="classitem.html#a723753bab4cc789e3ec186846c9916a3">item::is_container</a></div><div class="ttdeci">bool is_container() const</div><div class="ttdoc">Whether this is container.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06563">item.cpp:6563</a></div></div>
<div class="ttc" id="aclassitem_html_a74a90ea94f124f8d857058c2704a7fc7"><div class="ttname"><a href="classitem.html#a74a90ea94f124f8d857058c2704a7fc7">item::gun_cycle_mode</a></div><div class="ttdeci">void gun_cycle_mode()</div><div class="ttdoc">Switch to the next available firing mode.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07752">item.cpp:7752</a></div></div>
<div class="ttc" id="aclassitem_html_a75fa277bb39c1d2922137986c67d48fb"><div class="ttname"><a href="classitem.html#a75fa277bb39c1d2922137986c67d48fb">item::ammo_effects</a></div><div class="ttdeci">std::set&lt; ammo_effect_str_id &gt; ammo_effects(bool with_ammo=true) const</div><div class="ttdoc">Get ammo effects for item optionally inclusive of any resulting from the loaded ammo.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07465">item.cpp:7465</a></div></div>
<div class="ttc" id="aclassitem_html_a7dc5d9ccf5638ae80cebe1864050fa26"><div class="ttname"><a href="classitem.html#a7dc5d9ccf5638ae80cebe1864050fa26">item::ammo_required</a></div><div class="ttdeci">int ammo_required() const</div><div class="ttdoc">Quantity of ammunition consumed per usage of tool or with each shot of gun.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07290">item.cpp:7290</a></div></div>
<div class="ttc" id="aclassitem_html_a7e78e26dcf9b357cda769c3ca2938eda"><div class="ttname"><a href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">item::tname</a></div><div class="ttdeci">std::string tname(unsigned int quantity=1, bool with_prefix=true, unsigned int truncate=0) const</div><div class="ttdoc">Return the (translated) item name.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l04438">item.cpp:4438</a></div></div>
<div class="ttc" id="aclassitem_html_a7f1ae4e309841707eea0852dd4cd95a3"><div class="ttname"><a href="classitem.html#a7f1ae4e309841707eea0852dd4cd95a3">item::activate</a></div><div class="ttdeci">item &amp; activate()</div><div class="ttdoc">Filter converting instance to active state.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l00556">item.cpp:556</a></div></div>
<div class="ttc" id="aclassitem_html_a8efcfdc21aadbc25a8cc95cf54685489"><div class="ttname"><a href="classitem.html#a8efcfdc21aadbc25a8cc95cf54685489">item::ammo_sufficient</a></div><div class="ttdeci">bool ammo_sufficient(int qty=1) const</div><div class="ttdoc">Check if sufficient ammo is loaded for given number of uses.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07313">item.cpp:7313</a></div></div>
<div class="ttc" id="aclassitem_html_a9e2c24734b538e61e186fb6777b62c25"><div class="ttname"><a href="classitem.html#a9e2c24734b538e61e186fb6777b62c25">item::made_of_any</a></div><div class="ttdeci">bool made_of_any(const std::set&lt; material_id &gt; &amp;mat_idents) const</div><div class="ttdoc">Check we are made of at least one of a set (e.g.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06279">item.cpp:6279</a></div></div>
<div class="ttc" id="aclassitem_html_aa1a2ecb3e9ebf95dc7fedac4c1de32b4"><div class="ttname"><a href="classitem.html#aa1a2ecb3e9ebf95dc7fedac4c1de32b4">item::gun_all_modes</a></div><div class="ttdeci">std::map&lt; gun_mode_id, gun_mode &gt; gun_all_modes() const</div><div class="ttdoc">Get all possible modes for this gun inclusive of any attached gunmods.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07671">item.cpp:7671</a></div></div>
<div class="ttc" id="aclassitem_html_aaa5aeb6f838927babb10ede535cf2a73"><div class="ttname"><a href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">item::has_flag</a></div><div class="ttdeci">bool has_flag(const std::string &amp;flag) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05186">item.cpp:5186</a></div></div>
<div class="ttc" id="aclassitem_html_aaf0e79cb1bc190daa4804cfd62f279c4"><div class="ttname"><a href="classitem.html#aaf0e79cb1bc190daa4804cfd62f279c4">item::set_flag</a></div><div class="ttdeci">item &amp; set_flag(const std::string &amp;flag)</div><div class="ttdoc">Idempotent filter setting an item specific flag.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05215">item.cpp:5215</a></div></div>
<div class="ttc" id="aclassitem_html_ab07d96e30c441a84435972df842f4c77"><div class="ttname"><a href="classitem.html#ab07d96e30c441a84435972df842f4c77">item::ammo_default</a></div><div class="ttdeci">itype_id ammo_default(bool conversion=true) const</div><div class="ttdoc">Get default ammo used by item or a null id if item does not have a default ammo type.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07433">item.cpp:7433</a></div></div>
<div class="ttc" id="aclassitem_html_ab22fc9a4e0f9c6f5569b93e00deccfac"><div class="ttname"><a href="classitem.html#ab22fc9a4e0f9c6f5569b93e00deccfac">item::magazine_current</a></div><div class="ttdeci">item * magazine_current()</div><div class="ttdoc">Currently loaded magazine (if any)</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07559">item.cpp:7559</a></div></div>
<div class="ttc" id="aclassitem_html_ac1d2c4c33b8a499812f3437cb2fad742"><div class="ttname"><a href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">item::type</a></div><div class="ttdeci">const itype * type</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l02156">item.h:2156</a></div></div>
<div class="ttc" id="aclassitem_html_aca60af3c295738c2c1fddf0fd669f9a1"><div class="ttname"><a href="classitem.html#aca60af3c295738c2c1fddf0fd669f9a1">item::inc_damage</a></div><div class="ttdeci">bool inc_damage(damage_type dt)</div><div class="ttdoc">Increment item damage by itype::damage_scale constrained by max_damage.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06097">item.cpp:6097</a></div></div>
<div class="ttc" id="aclassitem_html_acbc651b09ebafad57974d0cfa04b8e5d"><div class="ttname"><a href="classitem.html#acbc651b09ebafad57974d0cfa04b8e5d">item::get_container_capacity</a></div><div class="ttdeci">units::volume get_container_capacity() const</div><div class="ttdoc">It returns the total capacity (volume) of the container for liquids.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l08233">item.cpp:8233</a></div></div>
<div class="ttc" id="aclassitem_html_acd78321ba4d5c09d39f1d58d20b68484"><div class="ttname"><a href="classitem.html#acd78321ba4d5c09d39f1d58d20b68484">item::gunmods</a></div><div class="ttdeci">std::vector&lt; item * &gt; gunmods()</div><div class="ttdoc">Returns all gunmods currently attached to this item (always empty if item not a gun)</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07572">item.cpp:7572</a></div></div>
<div class="ttc" id="aclassitem_html_ada111938a57ec6c7b47fcca30ec9d36c"><div class="ttname"><a href="classitem.html#ada111938a57ec6c7b47fcca30ec9d36c">item::gun_damage</a></div><div class="ttdeci">damage_instance gun_damage(bool with_ammo=true) const</div><div class="ttdoc">Summed ranged damage, armor piercing, and multipliers for both, of a gun, including values from mods.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07113">item.cpp:7113</a></div></div>
<div class="ttc" id="aclassitem_html_adaaa3ece39eb40637371659dad8550e3"><div class="ttname"><a href="classitem.html#adaaa3ece39eb40637371659dad8550e3">item::faults_potential</a></div><div class="ttdeci">std::set&lt; fault_id &gt; faults_potential() const</div><div class="ttdoc">What faults can potentially occur with this item?</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06648">item.cpp:6648</a></div></div>
<div class="ttc" id="aclassitem_html_adfd6f9946d4895a6ef2190e07c2486a3"><div class="ttname"><a href="classitem.html#adfd6f9946d4895a6ef2190e07c2486a3">item::gun_dispersion</a></div><div class="ttdeci">int gun_dispersion(bool with_ammo=true, bool with_scaling=true) const</div><div class="ttdoc">Summed dispersion of a gun, including values from mods.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07066">item.cpp:7066</a></div></div>
<div class="ttc" id="aclassitem_html_ae00bce86206993cc672387f9a2c77f92"><div class="ttname"><a href="classitem.html#ae00bce86206993cc672387f9a2c77f92">item::ammo_consume</a></div><div class="ttdeci">int ammo_consume(int qty, const tripoint &amp;pos)</div><div class="ttdoc">Consume ammo (if available) and return the amount of ammo that was consumed.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07318">item.cpp:7318</a></div></div>
<div class="ttc" id="aclassitem_html_ae75cd02ac10dda906018f27096a6efa9"><div class="ttname"><a href="classitem.html#ae75cd02ac10dda906018f27096a6efa9">item::attack_cost</a></div><div class="ttdeci">int attack_cost() const</div><div class="ttdoc">Base number of moves (Creature::moves) that a single melee attack with this items takes.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05078">item.cpp:5078</a></div></div>
<div class="ttc" id="aclassitem_html_ae8a58c6fe3c80cded11d6f3ccfa548a3"><div class="ttname"><a href="classitem.html#ae8a58c6fe3c80cded11d6f3ccfa548a3">item::damage</a></div><div class="ttdeci">int damage() const</div><div class="ttdoc">How much damage has the item sustained?</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l00695">item.cpp:695</a></div></div>
<div class="ttc" id="aclassitem_html_aeb49bb1b64eba3731e606ffe83e95b4f"><div class="ttname"><a href="classitem.html#aeb49bb1b64eba3731e606ffe83e95b4f">item::has_property</a></div><div class="ttdeci">bool has_property(const std::string &amp;prop) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05241">item.cpp:5241</a></div></div>
<div class="ttc" id="aclassitem_html_aeb62f6d93e37bf01af71f795cc39f4f1"><div class="ttname"><a href="classitem.html#aeb62f6d93e37bf01af71f795cc39f4f1">item::get_contained</a></div><div class="ttdeci">const item &amp; get_contained() const</div><div class="ttdoc">Return a contained item (if any and only one).</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06884">item.cpp:6884</a></div></div>
<div class="ttc" id="aclassitem_html_af0b7e5875297be57d675270f57ff775a"><div class="ttname"><a href="classitem.html#af0b7e5875297be57d675270f57ff775a">item::sight_dispersion</a></div><div class="ttdeci">int sight_dispersion() const</div><div class="ttdoc">Get lowest dispersion of either integral or any attached sights.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07094">item.cpp:7094</a></div></div>
<div class="ttc" id="aclassitem_html_af373f646c1ee172941490dc7cc04bbcd"><div class="ttname"><a href="classitem.html#af373f646c1ee172941490dc7cc04bbcd">item::is_two_handed</a></div><div class="ttdeci">bool is_two_handed(const Character &amp;guy) const</div><div class="ttdoc">Whether the character needs both hands to wield this item.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06248">item.cpp:6248</a></div></div>
<div class="ttc" id="aclassitem_html_af443024fa9e01c97953b3fcf81c9cfb1"><div class="ttname"><a href="classitem.html#af443024fa9e01c97953b3fcf81c9cfb1">item::gun_range</a></div><div class="ttdeci">int gun_range(const player *p) const</div><div class="ttdoc">The weapons range in map squares.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07195">item.cpp:7195</a></div></div>
<div class="ttc" id="aclassitem_html_af6bd135500675d45eb9b79b196d9558e"><div class="ttname"><a href="classitem.html#af6bd135500675d45eb9b79b196d9558e">item::get_gun_ups_drain</a></div><div class="ttdeci">int get_gun_ups_drain() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l09753">item.cpp:9753</a></div></div>
<div class="ttc" id="aclassitem_html_afcc181d2e2fe380ac28dd70f814798c2"><div class="ttname"><a href="classitem.html#afcc181d2e2fe380ac28dd70f814798c2">item::gun_set_mode</a></div><div class="ttdeci">bool gun_set_mode(const gun_mode_id &amp;mode)</div><div class="ttdoc">Try to set the mode for a gun, returning false if no such mode is possible.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07743">item.cpp:7743</a></div></div>
<div class="ttc" id="aclassmap_html"><div class="ttname"><a href="classmap.html">map</a></div><div class="ttdoc">Manage and cache data about a part of the map.</div><div class="ttdef"><b>Definition:</b> <a href="map_8h_source.html#l00388">map.h:389</a></div></div>
<div class="ttc" id="aclassmap_html_a0f73359be972a030063b4e84f770275e"><div class="ttname"><a href="classmap.html#a0f73359be972a030063b4e84f770275e">map::find_clear_path</a></div><div class="ttdeci">std::vector&lt; tripoint &gt; find_clear_path(const tripoint &amp;source, const tripoint &amp;destination) const</div><div class="ttdoc">Iteratively tries Bresenham lines with different biases until it finds a clear line or decides there ...</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l06245">map.cpp:6245</a></div></div>
<div class="ttc" id="aclassmap_html_a426c21f7244ff80a61685a89e9146fec"><div class="ttname"><a href="classmap.html#a426c21f7244ff80a61685a89e9146fec">map::getlocal</a></div><div class="ttdeci">tripoint getlocal(const tripoint &amp;p) const</div><div class="ttdoc">Inverse of getabs.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l08222">map.cpp:8222</a></div></div>
<div class="ttc" id="aclassmap_html_a501f3a1d449ac022f1b36b99da653e94"><div class="ttname"><a href="classmap.html#a501f3a1d449ac022f1b36b99da653e94">map::getabs</a></div><div class="ttdeci">tripoint getabs(const tripoint &amp;p) const</div><div class="ttdoc">Translates local (to this map) coordinates of a square to global absolute coordinates.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l08217">map.cpp:8217</a></div></div>
<div class="ttc" id="aclassmap_html_a516c0764134cc86b57297811520395f7"><div class="ttname"><a href="classmap.html#a516c0764134cc86b57297811520395f7">map::has_flag_ter_or_furn</a></div><div class="ttdeci">bool has_flag_ter_or_furn(const std::string &amp;flag, const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02319">map.cpp:2319</a></div></div>
<div class="ttc" id="aclassmap_html_a5579e13088b4ccd9c5a75458919d528a"><div class="ttname"><a href="classmap.html#a5579e13088b4ccd9c5a75458919d528a">map::add_item_or_charges</a></div><div class="ttdeci">item &amp; add_item_or_charges(const tripoint &amp;pos, item obj, bool overflow=true)</div><div class="ttdoc">Adds an item to map tile or stacks charges.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l04216">map.cpp:4216</a></div></div>
<div class="ttc" id="aclassmap_html_aa487d96256c3d35db7a1bf273156b64a"><div class="ttname"><a href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">map::veh_at</a></div><div class="ttdeci">optional_vpart_position veh_at(const tripoint &amp;p) const</div><div class="ttdoc">Checks if tile is occupied by vehicle and by which part.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l01006">map.cpp:1006</a></div></div>
<div class="ttc" id="aclassmap_html_abff2fded83a8e96e5e20084c3cb59579"><div class="ttname"><a href="classmap.html#abff2fded83a8e96e5e20084c3cb59579">map::has_zlevels</a></div><div class="ttdeci">bool has_zlevels() const</div><div class="ttdef"><b>Definition:</b> <a href="map_8h_source.html#l01681">map.h:1681</a></div></div>
<div class="ttc" id="aclassmap_html_ad189f4216a9eaacbf9c5aa0ceedaea18"><div class="ttname"><a href="classmap.html#ad189f4216a9eaacbf9c5aa0ceedaea18">map::drawsq</a></div><div class="ttdeci">void drawsq(const catacurses::window &amp;w, const tripoint &amp;p, const drawsq_params &amp;params) const</div><div class="ttdoc">Draw the map tile at the given coordinate.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l05812">map.cpp:5812</a></div></div>
<div class="ttc" id="aclassmap_html_af839ef9ba53f51b09259e0af06881fe6"><div class="ttname"><a href="classmap.html#af839ef9ba53f51b09259e0af06881fe6">map::invalidate_map_cache</a></div><div class="ttdeci">void invalidate_map_cache(const int zlev)</div><div class="ttdef"><b>Definition:</b> <a href="map_8h_source.html#l00475">map.h:475</a></div></div>
<div class="ttc" id="aclassmonster_html"><div class="ttname"><a href="classmonster.html">monster</a></div><div class="ttdef"><b>Definition:</b> <a href="monster_8h_source.html#l00083">monster.h:84</a></div></div>
<div class="ttc" id="aclassmonster_html_aa30f973bf524ba275ada847f6118b048"><div class="ttname"><a href="classmonster.html#aa30f973bf524ba275ada847f6118b048">monster::type</a></div><div class="ttdeci">const mtype * type</div><div class="ttdef"><b>Definition:</b> <a href="monster_8h_source.html#l00480">monster.h:480</a></div></div>
<div class="ttc" id="aclassnc__color_html"><div class="ttname"><a href="classnc__color.html">nc_color</a></div><div class="ttdef"><b>Definition:</b> <a href="color_8h_source.html#l00348">color.h:349</a></div></div>
<div class="ttc" id="aclassnpc_html"><div class="ttname"><a href="classnpc.html">npc</a></div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00780">npc.h:781</a></div></div>
<div class="ttc" id="aclassnpc_html_ac7ecd979db776f376e3ccb34553e45d6"><div class="ttname"><a href="classnpc.html#ac7ecd979db776f376e3ccb34553e45d6">npc::pretend_fire</a></div><div class="ttdeci">void pretend_fire(npc *source, int shots, item &amp;gun)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00756">ranged.cpp:756</a></div></div>
<div class="ttc" id="aclassnpc_html_adc0b90f197e58b09eb6eb92132d432f0"><div class="ttname"><a href="classnpc.html#adc0b90f197e58b09eb6eb92132d432f0">npc::guaranteed_hostile</a></div><div class="ttdeci">bool guaranteed_hostile() const</div><div class="ttdoc">Is enemy or will turn into one (can't be convinced not to attack).</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02002">npc.cpp:2002</a></div></div>
<div class="ttc" id="aclasson__out__of__scope_html"><div class="ttname"><a href="classon__out__of__scope.html">on_out_of_scope</a></div><div class="ttdef"><b>Definition:</b> <a href="cata__utility_8h_source.html#l00250">cata_utility.h:251</a></div></div>
<div class="ttc" id="aclassoptional__vpart__position_html"><div class="ttname"><a href="classoptional__vpart__position.html">optional_vpart_position</a></div><div class="ttdoc">Simple wrapper to forward functions that may return a cata::optional to vpart_position.</div><div class="ttdef"><b>Definition:</b> <a href="vpart__position_8h_source.html#l00101">vpart_position.h:102</a></div></div>
<div class="ttc" id="aclassoptional__vpart__position_html_a2f0829fa83c2c4d3007e26b91af11856"><div class="ttname"><a href="classoptional__vpart__position.html#a2f0829fa83c2c4d3007e26b91af11856">optional_vpart_position::part_with_feature</a></div><div class="ttdeci">cata::optional&lt; vpart_reference &gt; part_with_feature(const std::string &amp;f, bool unbroken) const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l02481">vehicle.cpp:2481</a></div></div>
<div class="ttc" id="aclasspanel__manager_html_a1196cd08699822653246ccafd856f72c"><div class="ttname"><a href="classpanel__manager.html#a1196cd08699822653246ccafd856f72c">panel_manager::get_manager</a></div><div class="ttdeci">static panel_manager &amp; get_manager()</div><div class="ttdef"><b>Definition:</b> <a href="panels_8h_source.html#l00072">panels.h:72</a></div></div>
<div class="ttc" id="aclasspanel__manager_html_a3f6290efcd5bca21c3cf44762bca2a91"><div class="ttname"><a href="classpanel__manager.html#a3f6290efcd5bca21c3cf44762bca2a91">panel_manager::get_current_layout_id</a></div><div class="ttdeci">std::string get_current_layout_id() const</div><div class="ttdef"><b>Definition:</b> <a href="panels_8cpp_source.html#l02289">panels.cpp:2289</a></div></div>
<div class="ttc" id="aclassplayer_html"><div class="ttname"><a href="classplayer.html">player</a></div><div class="ttdef"><b>Definition:</b> <a href="player_8h_source.html#l00089">player.h:90</a></div></div>
<div class="ttc" id="aclassplayer_html_a20589432777baec94c204b4f5efbfcfb"><div class="ttname"><a href="classplayer.html#a20589432777baec94c204b4f5efbfcfb">player::volume</a></div><div class="ttdeci">int volume</div><div class="ttdef"><b>Definition:</b> <a href="player_8h_source.html#l00602">player.h:602</a></div></div>
<div class="ttc" id="aclassplayer_html_a347590f5f5ca932d3ffc5c5cc5cdc723"><div class="ttname"><a href="classplayer.html#a347590f5f5ca932d3ffc5c5cc5cdc723">player::throw_item</a></div><div class="ttdeci">dealt_projectile_attack throw_item(const tripoint &amp;target, const item &amp;to_throw, const cata::optional&lt; tripoint &gt; &amp;blind_throw_from_pos=cata::nullopt)</div><div class="ttdoc">Execute a throw.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01109">ranged.cpp:1109</a></div></div>
<div class="ttc" id="aclassplayer_html_a3deecf5e0ddfe40130d97c61c57e2fe2"><div class="ttname"><a href="classplayer.html#a3deecf5e0ddfe40130d97c61c57e2fe2">player::get_weapon_dispersion</a></div><div class="ttdeci">dispersion_sources get_weapon_dispersion(const item &amp;obj) const</div><div class="ttdoc">Returns a weapon's modified dispersion value.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01883">ranged.cpp:1883</a></div></div>
<div class="ttc" id="aclassplayer_html_a43a0479640831a4268c76fa19bbd1051"><div class="ttname"><a href="classplayer.html#a43a0479640831a4268c76fa19bbd1051">player::select_ammo</a></div><div class="ttdeci">item::reload_option select_ammo(const item &amp;base, bool prompt=false, bool include_empty_mags=true, bool include_potential=false) const</div><div class="ttdoc">Select suitable ammo with which to reload the item.</div><div class="ttdef"><b>Definition:</b> <a href="player_8cpp_source.html#l02285">player.cpp:2285</a></div></div>
<div class="ttc" id="aclassplayer_html_a44202fda7322e9ba557a37a7081e249c"><div class="ttname"><a href="classplayer.html#a44202fda7322e9ba557a37a7081e249c">player::fire_gun</a></div><div class="ttdeci">int fire_gun(const tripoint &amp;target, int shots=1)</div><div class="ttdoc">Fires a gun or auxiliary gunmod (ignoring any current mode)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00805">ranged.cpp:805</a></div></div>
<div class="ttc" id="aclassplayer_html_a5f1ee4ce958fda62c4766dd8762529c2"><div class="ttname"><a href="classplayer.html#a5f1ee4ce958fda62c4766dd8762529c2">player::ammo_location</a></div><div class="ttdeci">item_location ammo_location</div><div class="ttdef"><b>Definition:</b> <a href="player_8h_source.html#l00610">player.h:610</a></div></div>
<div class="ttc" id="aclassplayer_html_a625b6dd5247589902251e845d07a2154"><div class="ttname"><a href="classplayer.html#a625b6dd5247589902251e845d07a2154">player::view_offset</a></div><div class="ttdeci">tripoint view_offset</div><div class="ttdef"><b>Definition:</b> <a href="player_8h_source.html#l00599">player.h:599</a></div></div>
<div class="ttc" id="aclassplayer_html_a9aac4afb832dc4762430b0b3545cbfea"><div class="ttname"><a href="classplayer.html#a9aac4afb832dc4762430b0b3545cbfea">player::last_target_pos</a></div><div class="ttdeci">cata::optional&lt; tripoint &gt; last_target_pos</div><div class="ttdef"><b>Definition:</b> <a href="player_8h_source.html#l00608">player.h:608</a></div></div>
<div class="ttc" id="aclassplayer_html_a9c356da8331dbc6964aa054fa8030d45"><div class="ttname"><a href="classplayer.html#a9c356da8331dbc6964aa054fa8030d45">player::gun_engagement_moves</a></div><div class="ttdeci">int gun_engagement_moves(const item &amp;gun, int target=0, int start=MAX_RECOIL) const</div><div class="ttdoc">How many moves does it take to aim gun to the target accuracy.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00572">ranged.cpp:572</a></div></div>
<div class="ttc" id="aclassplayer_html_aa57c61de29a5e410c100aee07798b9b1"><div class="ttname"><a href="classplayer.html#aa57c61de29a5e410c100aee07798b9b1">player::practice</a></div><div class="ttdeci">void practice(const skill_id &amp;id, int amount, int cap=99, bool suppress_warning=false)</div><div class="ttdoc">This handles giving xp for a skill.</div><div class="ttdef"><b>Definition:</b> <a href="player_8cpp_source.html#l03650">player.cpp:3650</a></div></div>
<div class="ttc" id="aclassplayer_html_ab679d40f5584e38a6af33bcd7e3c102d"><div class="ttname"><a href="classplayer.html#ab679d40f5584e38a6af33bcd7e3c102d">player::last_target</a></div><div class="ttdeci">weak_ptr_fast&lt; Creature &gt; last_target</div><div class="ttdef"><b>Definition:</b> <a href="player_8h_source.html#l00607">player.h:607</a></div></div>
<div class="ttc" id="aclassplayer_html_ad7cc78075e6defac1a555615a4a0451a"><div class="ttname"><a href="classplayer.html#ad7cc78075e6defac1a555615a4a0451a">player::gun_value</a></div><div class="ttdeci">double gun_value(const item &amp;weap, int ammo=10) const</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01933">ranged.cpp:1933</a></div></div>
<div class="ttc" id="aclassplayer_html_ae1d6e52d9fb8fdf08eecb74890a28342"><div class="ttname"><a href="classplayer.html#ae1d6e52d9fb8fdf08eecb74890a28342">player::impact</a></div><div class="ttdeci">int impact(int force, const tripoint &amp;pos) override</div><div class="ttdoc">Deals falling/collision damage with terrain/creature at pos.</div><div class="ttdef"><b>Definition:</b> <a href="player_8cpp_source.html#l01022">player.cpp:1022</a></div></div>
<div class="ttc" id="aclassplayer_html_ae7009d849f19a4f5ebe877cbe463c459"><div class="ttname"><a href="classplayer.html#ae7009d849f19a4f5ebe877cbe463c459">player::add_msg_if_player</a></div><div class="ttdeci">void add_msg_if_player(const std::string &amp;msg) const override</div><div class="ttdef"><b>Definition:</b> <a href="player_8cpp_source.html#l03973">player.cpp:3973</a></div></div>
<div class="ttc" id="aclassrestore__on__out__of__scope_html"><div class="ttname"><a href="classrestore__on__out__of__scope.html">restore_on_out_of_scope</a></div><div class="ttdef"><b>Definition:</b> <a href="cata__utility_8h_source.html#l00270">cata_utility.h:271</a></div></div>
<div class="ttc" id="aclassshape__factory_html"><div class="ttname"><a href="classshape__factory.html">shape_factory</a></div><div class="ttdoc">A class that produces shapes from two points: origin and destination.</div><div class="ttdef"><b>Definition:</b> <a href="shape_8h_source.html#l00044">shape.h:45</a></div></div>
<div class="ttc" id="aclassshape__factory_html_a9ad58bfa6ae742e4588a0419429d2663"><div class="ttname"><a href="classshape__factory.html#a9ad58bfa6ae742e4588a0419429d2663">shape_factory::get_range</a></div><div class="ttdeci">double get_range() const</div><div class="ttdef"><b>Definition:</b> <a href="shape_8cpp_source.html#l00092">shape.cpp:92</a></div></div>
<div class="ttc" id="aclassshape_html"><div class="ttname"><a href="classshape.html">shape</a></div><div class="ttdoc">Class describing shapes in 3D space.</div><div class="ttdef"><b>Definition:</b> <a href="shape_8h_source.html#l00021">shape.h:22</a></div></div>
<div class="ttc" id="aclassspell_html"><div class="ttname"><a href="classspell.html">spell</a></div><div class="ttdef"><b>Definition:</b> <a href="magic_8h_source.html#l00285">magic.h:286</a></div></div>
<div class="ttc" id="aclassspell_html_a004decbbde4de635b4e652acff65eb8e"><div class="ttname"><a href="classspell.html#a004decbbde4de635b4e652acff65eb8e">spell::aoe</a></div><div class="ttdeci">int aoe() const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l00518">magic.cpp:518</a></div></div>
<div class="ttc" id="aclassspell_html_a006cfd33c15f732b2463eda1ae0686cc"><div class="ttname"><a href="classspell.html#a006cfd33c15f732b2463eda1ae0686cc">spell::get_level</a></div><div class="ttdeci">int get_level() const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l01034">magic.cpp:1034</a></div></div>
<div class="ttc" id="aclassspell_html_a0d3f68783edb1af2e111e85f7a1715fa"><div class="ttname"><a href="classspell.html#a0d3f68783edb1af2e111e85f7a1715fa">spell::energy_cost_string</a></div><div class="ttdeci">std::string energy_cost_string(const Character &amp;guy) const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l00838">magic.cpp:838</a></div></div>
<div class="ttc" id="aclassspell_html_a1dc2bd4fd1f177c091237236627bd993"><div class="ttname"><a href="classspell.html#a1dc2bd4fd1f177c091237236627bd993">spell::energy_cur_string</a></div><div class="ttdeci">std::string energy_cur_string(const Character &amp;guy) const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l00861">magic.cpp:861</a></div></div>
<div class="ttc" id="aclassspell_html_a57d5063164f86d348ea38dab2edaf023"><div class="ttname"><a href="classspell.html#a57d5063164f86d348ea38dab2edaf023">spell::in_aoe</a></div><div class="ttdeci">bool in_aoe(const tripoint &amp;source, const tripoint &amp;target) const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l00533">magic.cpp:533</a></div></div>
<div class="ttc" id="aclassspell_html_a62a42d1597639881eafc04506095695d"><div class="ttname"><a href="classspell.html#a62a42d1597639881eafc04506095695d">spell::damage</a></div><div class="ttdeci">int damage() const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l00483">magic.cpp:483</a></div></div>
<div class="ttc" id="aclassspell_html_a7341749ae2cc5f13b784f057b5207252"><div class="ttname"><a href="classspell.html#a7341749ae2cc5f13b784f057b5207252">spell::aoe_string</a></div><div class="ttdeci">std::string aoe_string() const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l00542">magic.cpp:542</a></div></div>
<div class="ttc" id="aclassspell_html_a805518bf44455e4652d16db9922945f5"><div class="ttname"><a href="classspell.html#a805518bf44455e4652d16db9922945f5">spell::range</a></div><div class="ttdeci">int range() const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l00551">magic.cpp:551</a></div></div>
<div class="ttc" id="aclassspell_html_a9e3016a896d4431fed8428ea82ab6539"><div class="ttname"><a href="classspell.html#a9e3016a896d4431fed8428ea82ab6539">spell::energy_source</a></div><div class="ttdeci">energy_type energy_source() const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l00940">magic.cpp:940</a></div></div>
<div class="ttc" id="aclassspell_html_aa34fc8ebf8b820ac055f4b4dd9d78c35"><div class="ttname"><a href="classspell.html#aa34fc8ebf8b820ac055f4b4dd9d78c35">spell::effect</a></div><div class="ttdeci">std::string effect() const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l00935">magic.cpp:935</a></div></div>
<div class="ttc" id="aclassspell_html_ab2631d5fc9da8a5ec04f7c3757e6c9f5"><div class="ttname"><a href="classspell.html#ab2631d5fc9da8a5ec04f7c3757e6c9f5">spell::can_cast</a></div><div class="ttdeci">bool can_cast(const Character &amp;guy) const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l00671">magic.cpp:671</a></div></div>
<div class="ttc" id="aclassspell_html_abdf34d5415c3fdafcd84fe3a7101bddb"><div class="ttname"><a href="classspell.html#abdf34d5415c3fdafcd84fe3a7101bddb">spell::name</a></div><div class="ttdeci">std::string name() const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l00729">magic.cpp:729</a></div></div>
<div class="ttc" id="aclassspell_html_abe49463868f25cd4e65b184b02e96931"><div class="ttname"><a href="classspell.html#abe49463868f25cd4e65b184b02e96931">spell::damage_string</a></div><div class="ttdeci">std::string damage_string() const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l00499">magic.cpp:499</a></div></div>
<div class="ttc" id="aclassspell_html_acc66691f05cd20a085370d79df52bafa"><div class="ttname"><a href="classspell.html#acc66691f05cd20a085370d79df52bafa">spell::description</a></div><div class="ttdeci">std::string description() const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l00990">magic.cpp:990</a></div></div>
<div class="ttc" id="aclassspell_html_adc1aee8fd855fce28ebb1dcc39e37a12"><div class="ttname"><a href="classspell.html#adc1aee8fd855fce28ebb1dcc39e37a12">spell::is_valid_target</a></div><div class="ttdeci">bool is_valid_target(const Creature &amp;caster, const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l00955">magic.cpp:955</a></div></div>
<div class="ttc" id="aclassspell_html_aeb55e6084337fb199e3cab09260ad916"><div class="ttname"><a href="classspell.html#aeb55e6084337fb199e3cab09260ad916">spell::energy_string</a></div><div class="ttdeci">std::string energy_string() const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l00820">magic.cpp:820</a></div></div>
<div class="ttc" id="aclassspell_html_afe11a0854d38e947a10d02e29f7fd84c"><div class="ttname"><a href="classspell.html#afe11a0854d38e947a10d02e29f7fd84c">spell::colorized_fail_percent</a></div><div class="ttdeci">std::string colorized_fail_percent(const Character &amp;guy) const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l00782">magic.cpp:782</a></div></div>
<div class="ttc" id="aclassstring__id_html"><div class="ttname"><a href="classstring__id.html">string_id</a></div><div class="ttdef"><b>Definition:</b> <a href="string__id_8h_source.html#l00196">string_id.h:197</a></div></div>
<div class="ttc" id="aclassstring__id_html_a3ca78345025397b3d3ac22729ba1684b"><div class="ttname"><a href="classstring__id.html#a3ca78345025397b3d3ac22729ba1684b">string_id::is_null</a></div><div class="ttdeci">bool is_null() const</div><div class="ttdoc">Returns whether this represents the id of the null-object (in which case it's the null-id).</div><div class="ttdef"><b>Definition:</b> <a href="string__id_8h_source.html#l00317">string_id.h:317</a></div></div>
<div class="ttc" id="aclassstring__id_html_aa7dabc565f0c067e1a237ea224b18f93"><div class="ttname"><a href="classstring__id.html#aa7dabc565f0c067e1a237ea224b18f93">string_id::str</a></div><div class="ttdeci">const std::string &amp; str() const</div><div class="ttdoc">Returns the identifier as plain std::string.</div><div class="ttdef"><b>Definition:</b> <a href="string__id_8h_source.html#l00255">string_id.h:255</a></div></div>
<div class="ttc" id="aclassstring__id_html_ac180a60056901aaf79f5c4b728a257bd"><div class="ttname"><a href="classstring__id.html#ac180a60056901aaf79f5c4b728a257bd">string_id::is_empty</a></div><div class="ttdeci">bool is_empty() const</div><div class="ttdoc">Returns whether this id is empty.</div><div class="ttdef"><b>Definition:</b> <a href="string__id_8h_source.html#l00298">string_id.h:298</a></div></div>
<div class="ttc" id="aclasstarget__ui_html"><div class="ttname"><a href="classtarget__ui.html">target_ui</a></div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00164">ranged.cpp:165</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a11be420f4d6ffd6128dd23d01be6c310"><div class="ttname"><a href="classtarget__ui.html#a11be420f4d6ffd6128dd23d01be6c310">target_ui::run</a></div><div class="ttdeci">target_handler::trajectory run()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02151">ranged.cpp:2151</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a122323ec4c1e72c291e76643ccfd3fde"><div class="ttname"><a href="classtarget__ui.html#a122323ec4c1e72c291e76643ccfd3fde">target_ui::shifting_view</a></div><div class="ttdeci">bool shifting_view</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00248">ranged.cpp:248</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a1403890979533cd6ea29897e3ee81ab5"><div class="ttname"><a href="classtarget__ui.html#a1403890979533cd6ea29897e3ee81ab5">target_ui::recalc_aim_turning_penalty</a></div><div class="ttdeci">void recalc_aim_turning_penalty()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02926">ranged.cpp:2926</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a146d794c8cb9c23e6ba71727c9a25852"><div class="ttname"><a href="classtarget__ui.html#a146d794c8cb9c23e6ba71727c9a25852">target_ui::no_fail</a></div><div class="ttdeci">bool no_fail</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00197">ranged.cpp:197</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a14b8ebef108aaa7ad8c5176a04f600bb"><div class="ttname"><a href="classtarget__ui.html#a14b8ebef108aaa7ad8c5176a04f600bb">target_ui::panel_spell_info</a></div><div class="ttdeci">void panel_spell_info(int &amp;text_y)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03507">ranged.cpp:3507</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a1591b490e9f8d48547b108ae481f982e"><div class="ttname"><a href="classtarget__ui.html#a1591b490e9f8d48547b108ae481f982e">target_ui::choose_initial_target</a></div><div class="ttdeci">tripoint choose_initial_target()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02691">ranged.cpp:2691</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a15d523ae27fc66cbff7adac5e9fa91dd"><div class="ttname"><a href="classtarget__ui.html#a15d523ae27fc66cbff7adac5e9fa91dd">target_ui::draw_terrain_overlay</a></div><div class="ttdeci">void draw_terrain_overlay()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03131">ranged.cpp:3131</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a190a8193e6454bb636bc8f5288b4a27b"><div class="ttname"><a href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">target_ui::relevant</a></div><div class="ttdeci">item * relevant</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00185">ranged.cpp:185</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a1e6534092ef1b213639575c914030eb1"><div class="ttname"><a href="classtarget__ui.html#a1e6534092ef1b213639575c914030eb1">target_ui::tiny</a></div><div class="ttdeci">bool tiny</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00253">ranged.cpp:253</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a21275763803a2ce0d00e02dc0076a36c"><div class="ttname"><a href="classtarget__ui.html#a21275763803a2ce0d00e02dc0076a36c">target_ui::action_aim_and_shoot</a></div><div class="ttdeci">bool action_aim_and_shoot(const std::string &amp;action)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03101">ranged.cpp:3101</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a246e6aa2bb08bb724c44571e8451ac30"><div class="ttname"><a href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">target_ui::w_target</a></div><div class="ttdeci">catacurses::window w_target</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00258">ranged.cpp:258</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a270f72c5bfef55a533d3cd9b3cf57ea0"><div class="ttname"><a href="classtarget__ui.html#a270f72c5bfef55a533d3cd9b3cf57ea0">target_ui::snap_to_target</a></div><div class="ttdeci">bool snap_to_target</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00245">ranged.cpp:245</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a281f9ea6ae900ff7991e457f1d34b8f6"><div class="ttname"><a href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">target_ui::targets</a></div><div class="ttdeci">std::vector&lt; Creature * &gt; targets</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00239">ranged.cpp:239</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a2c23b4913b52b2a5f80357f34d92700c"><div class="ttname"><a href="classtarget__ui.html#a2c23b4913b52b2a5f80357f34d92700c">target_ui::uitext_fire</a></div><div class="ttdeci">std::string uitext_fire()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03291">ranged.cpp:3291</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a2e6f4c9c827b91ce215a1a7b32a4affb"><div class="ttname"><a href="classtarget__ui.html#a2e6f4c9c827b91ce215a1a7b32a4affb">target_ui::sight_dispersion</a></div><div class="ttdeci">int sight_dispersion</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00264">ranged.cpp:264</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a2f93a66a18420fd252e275a9c6f536d4"><div class="ttname"><a href="classtarget__ui.html#a2f93a66a18420fd252e275a9c6f536d4">target_ui::shape_gen</a></div><div class="ttdeci">cata::optional&lt; shape_factory &gt; shape_gen</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00203">ranged.cpp:203</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a34b69263e28fa4472b51104ec1d2e6f0"><div class="ttname"><a href="classtarget__ui.html#a34b69263e28fa4472b51104ec1d2e6f0">target_ui::compact</a></div><div class="ttdeci">bool compact</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00251">ranged.cpp:251</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a3594a3a61aa50c8a0ce8c7ea20796202"><div class="ttname"><a href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202">target_ui::Status</a></div><div class="ttdeci">Status</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00216">ranged.cpp:216</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a3594a3a61aa50c8a0ce8c7ea20796202a0c6ad70beb3a7e76c3fc7adab7c46acc"><div class="ttname"><a href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a0c6ad70beb3a7e76c3fc7adab7c46acc">target_ui::Status::Good</a></div><div class="ttdeci">@ Good</div></div>
<div class="ttc" id="aclasstarget__ui_html_a3594a3a61aa50c8a0ce8c7ea20796202a365b2699d38b61ef4b4c8a1066c8468f"><div class="ttname"><a href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a365b2699d38b61ef4b4c8a1066c8468f">target_ui::Status::OutOfRange</a></div><div class="ttdeci">@ OutOfRange</div></div>
<div class="ttc" id="aclasstarget__ui_html_a3594a3a61aa50c8a0ce8c7ea20796202a45c9ef8264639e178f18806be2b9a408"><div class="ttname"><a href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a45c9ef8264639e178f18806be2b9a408">target_ui::Status::BadTarget</a></div><div class="ttdeci">@ BadTarget</div></div>
<div class="ttc" id="aclasstarget__ui_html_a3594a3a61aa50c8a0ce8c7ea20796202aaa5b08f858f7353c5d012d6706525773"><div class="ttname"><a href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202aaa5b08f858f7353c5d012d6706525773">target_ui::Status::OutOfAmmo</a></div><div class="ttdeci">@ OutOfAmmo</div></div>
<div class="ttc" id="aclasstarget__ui_html_a362df365f84b306e2ff14edf099a1000"><div class="ttname"><a href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">target_ui::dst_critter</a></div><div class="ttdeci">Creature * dst_critter</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00237">ranged.cpp:237</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a3ead422f4a78394c13bc3f4c6c953f42"><div class="ttname"><a href="classtarget__ui.html#a3ead422f4a78394c13bc3f4c6c953f42">target_ui::set_cursor_pos</a></div><div class="ttdeci">bool set_cursor_pos(const tripoint &amp;new_pos)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02533">ranged.cpp:2533</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a40bd320b465d966959268698b54a0d98"><div class="ttname"><a href="classtarget__ui.html#a40bd320b465d966959268698b54a0d98">target_ui::apply_aim_turning_penalty</a></div><div class="ttdeci">void apply_aim_turning_penalty()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02965">ranged.cpp:2965</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a45f98789c877903961a56a54b17d9e96"><div class="ttname"><a href="classtarget__ui.html#a45f98789c877903961a56a54b17d9e96">target_ui::allow_zlevel_shift</a></div><div class="ttdeci">bool allow_zlevel_shift</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00242">ranged.cpp:242</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a4b525b1e2a39f4748409b97e8984947b"><div class="ttname"><a href="classtarget__ui.html#a4b525b1e2a39f4748409b97e8984947b">target_ui::narrow</a></div><div class="ttdeci">bool narrow</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00256">ranged.cpp:256</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a4bb70bd52ece44447bec77880106009d"><div class="ttname"><a href="classtarget__ui.html#a4bb70bd52ece44447bec77880106009d">target_ui::panel_target_info</a></div><div class="ttdeci">void panel_target_info(int &amp;text_y, bool fill_with_blank_if_no_target)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03561">ranged.cpp:3561</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a4e5479e5dd0b2883bbf2927c489ddb6a"><div class="ttname"><a href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">target_ui::ctxt</a></div><div class="ttdeci">input_context ctxt</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00260">ranged.cpp:260</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a542ba80f542b41ea6a81f1ab8b14b521"><div class="ttname"><a href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">target_ui::traj</a></div><div class="ttdeci">std::vector&lt; tripoint &gt; traj</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00229">ranged.cpp:229</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a545580558b81b3d44c43b52fc5ff1b77"><div class="ttname"><a href="classtarget__ui.html#a545580558b81b3d44c43b52fc5ff1b77">target_ui::panel_gun_info</a></div><div class="ttdeci">void panel_gun_info(int &amp;text_y)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03459">ranged.cpp:3459</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a5c885fc69abc2190e1850b7f23601ac2"><div class="ttname"><a href="classtarget__ui.html#a5c885fc69abc2190e1850b7f23601ac2">target_ui::try_reacquire_target</a></div><div class="ttdeci">bool try_reacquire_target(bool critter, tripoint &amp;new_dst)</div><div class="ttdoc">Try to re-acquire target for aim-and-fire.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02719">ranged.cpp:2719</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a607a068ce45aeed17810fd8ca433e5a3"><div class="ttname"><a href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">target_ui::aim_mode</a></div><div class="ttdeci">std::vector&lt; aim_type &gt;::iterator aim_mode</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00268">ranged.cpp:268</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a63ac73585a9794e93d181362f7473b50"><div class="ttname"><a href="classtarget__ui.html#a63ac73585a9794e93d181362f7473b50">target_ui::draw_turret_lines</a></div><div class="ttdeci">bool draw_turret_lines</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00294">ranged.cpp:294</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a691e0bd6f4c5f82b309fd0e026f77825"><div class="ttname"><a href="classtarget__ui.html#a691e0bd6f4c5f82b309fd0e026f77825">target_ui::action_switch_mode</a></div><div class="ttdeci">void action_switch_mode()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02970">ranged.cpp:2970</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a6c0468c35f79fb501be1a3a50b4081d4"><div class="ttname"><a href="classtarget__ui.html#a6c0468c35f79fb501be1a3a50b4081d4">target_ui::action_aim</a></div><div class="ttdeci">bool action_aim()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03086">ranged.cpp:3086</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a6f2c970f904d7b8c06e403dbc4560f4d"><div class="ttname"><a href="classtarget__ui.html#a6f2c970f904d7b8c06e403dbc4560f4d">target_ui::shape_coverage</a></div><div class="ttdeci">std::map&lt; tripoint, double &gt; shape_coverage</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00281">ranged.cpp:281</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a77429c16aec83b5c81d3a1c259259cd5"><div class="ttname"><a href="classtarget__ui.html#a77429c16aec83b5c81d3a1c259259cd5">target_ui::update_ammo_range_from_gun_mode</a></div><div class="ttdeci">void update_ammo_range_from_gun_mode()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03048">ranged.cpp:3048</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a779bc721417ab8ee4a6b103d8a1030f5"><div class="ttname"><a href="classtarget__ui.html#a779bc721417ab8ee4a6b103d8a1030f5">target_ui::toggle_snap_to_target</a></div><div class="ttdeci">void toggle_snap_to_target()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02862">ranged.cpp:2862</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a7d5114b61c688d3810c108986ddc8bf7"><div class="ttname"><a href="classtarget__ui.html#a7d5114b61c688d3810c108986ddc8bf7">target_ui::draw_controls_list</a></div><div class="ttdeci">void draw_controls_list(int text_y)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03325">ranged.cpp:3325</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a83609daab209a1d8e462919182014d33"><div class="ttname"><a href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">target_ui::you</a></div><div class="ttdeci">avatar * you</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00181">ranged.cpp:181</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a86966228ce7aad77c233058bf1285962"><div class="ttname"><a href="classtarget__ui.html#a86966228ce7aad77c233058bf1285962">target_ui::panel_cursor_info</a></div><div class="ttdeci">void panel_cursor_info(int &amp;text_y)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03422">ranged.cpp:3422</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a92256c0cb72fe5b2520a5808a5fcb79a"><div class="ttname"><a href="classtarget__ui.html#a92256c0cb72fe5b2520a5808a5fcb79a">target_ui::ensure_ranged_gun_mode</a></div><div class="ttdeci">void ensure_ranged_gun_mode()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03041">ranged.cpp:3041</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a93a478e95d201324548329f39a087208"><div class="ttname"><a href="classtarget__ui.html#a93a478e95d201324548329f39a087208">target_ui::draw_ui_window</a></div><div class="ttdeci">void draw_ui_window()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03224">ranged.cpp:3224</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a954878eb50877ad7fc1902a28beb2539"><div class="ttname"><a href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">target_ui::dst</a></div><div class="ttdeci">tripoint dst</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00234">ranged.cpp:234</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a97d244cde8cae12d0266daf6fc083014"><div class="ttname"><a href="classtarget__ui.html#a97d244cde8cae12d0266daf6fc083014">target_ui::confirm_non_enemy_target</a></div><div class="ttdeci">bool confirm_non_enemy_target()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02791">ranged.cpp:2791</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a9d84b28ee34fdefd76ae987c95a29600"><div class="ttname"><a href="classtarget__ui.html#a9d84b28ee34fdefd76ae987c95a29600">target_ui::on_target_accepted</a></div><div class="ttdeci">void on_target_accepted(bool harmful)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03642">ranged.cpp:3642</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a9f08c10cac1401587f330fb97f5c2183"><div class="ttname"><a href="classtarget__ui.html#a9f08c10cac1401587f330fb97f5c2183">target_ui::panel_recoil</a></div><div class="ttdeci">void panel_recoil(int &amp;text_y)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03487">ranged.cpp:3487</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_aa3c8602522a1638d3af42b10f1750e26"><div class="ttname"><a href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">target_ui::range</a></div><div class="ttdeci">int range</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00187">ranged.cpp:187</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_aa53ba52da62f64baa29130908cf8637b"><div class="ttname"><a href="classtarget__ui.html#aa53ba52da62f64baa29130908cf8637b">target_ui::set_last_target</a></div><div class="ttdeci">void set_last_target()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02781">ranged.cpp:2781</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_aa5c1e8816cd2a0f9c10e3ea2095eefe1"><div class="ttname"><a href="classtarget__ui.html#aa5c1e8816cd2a0f9c10e3ea2095eefe1">target_ui::panel_fire_mode_aim</a></div><div class="ttdeci">void panel_fire_mode_aim(int &amp;text_y)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03595">ranged.cpp:3595</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_aa955ab0c7cfbd2c8c5d439f5aed608ef"><div class="ttname"><a href="classtarget__ui.html#aa955ab0c7cfbd2c8c5d439f5aed608ef">target_ui::update_turrets_in_range</a></div><div class="ttdeci">void update_turrets_in_range()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02914">ranged.cpp:2914</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_aa98e28471bb023e99404674ad6331ad6"><div class="ttname"><a href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6">target_ui::ExitCode</a></div><div class="ttdeci">ExitCode</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00209">ranged.cpp:209</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_aa98e28471bb023e99404674ad6331ad6a4d1c8263ba1036754f8db14a98f9f006"><div class="ttname"><a href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6a4d1c8263ba1036754f8db14a98f9f006">target_ui::ExitCode::Reload</a></div><div class="ttdeci">@ Reload</div></div>
<div class="ttc" id="aclasstarget__ui_html_aa98e28471bb023e99404674ad6331ad6a727b63583e01fa2b3952dab580c84dc2"><div class="ttname"><a href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6a727b63583e01fa2b3952dab580c84dc2">target_ui::ExitCode::Abort</a></div><div class="ttdeci">@ Abort</div></div>
<div class="ttc" id="aclasstarget__ui_html_aa98e28471bb023e99404674ad6331ad6abd2b7e5f85a6ea65065c4ebc6d7c95bb"><div class="ttname"><a href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6abd2b7e5f85a6ea65065c4ebc6d7c95bb">target_ui::ExitCode::Fire</a></div><div class="ttdeci">@ Fire</div></div>
<div class="ttc" id="aclasstarget__ui_html_aa98e28471bb023e99404674ad6331ad6ac85a251cc457840f1e032f1b733e9398"><div class="ttname"><a href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6ac85a251cc457840f1e032f1b733e9398">target_ui::ExitCode::Timeout</a></div><div class="ttdeci">@ Timeout</div></div>
<div class="ttc" id="aclasstarget__ui_html_aaf459ec49ad96c44eddeb94d0c22fb36"><div class="ttname"><a href="classtarget__ui.html#aaf459ec49ad96c44eddeb94d0c22fb36">target_ui::on_range_ammo_changed</a></div><div class="ttdeci">void on_range_ammo_changed()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02665">ranged.cpp:2665</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ab236848678058afb7605e6d82a5c8fa9"><div class="ttname"><a href="classtarget__ui.html#ab236848678058afb7605e6d82a5c8fa9">target_ui::dist_fn</a></div><div class="ttdeci">int dist_fn(const tripoint &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02776">ranged.cpp:2776</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ab290e475e7cd308b447788ec369053b0"><div class="ttname"><a href="classtarget__ui.html#ab290e475e7cd308b447788ec369053b0">target_ui::handle_cursor_movement</a></div><div class="ttdeci">bool handle_cursor_movement(const std::string &amp;action, bool &amp;skip_redraw)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02475">ranged.cpp:2475</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ab855722580bd112ef0590b5a9b4f3556"><div class="ttname"><a href="classtarget__ui.html#ab855722580bd112ef0590b5a9b4f3556">target_ui::spell_aoe</a></div><div class="ttdeci">std::set&lt; tripoint &gt; spell_aoe</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00278">ranged.cpp:278</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_abae2f397600dc6b01bb03f22bcd18666"><div class="ttname"><a href="classtarget__ui.html#abae2f397600dc6b01bb03f22bcd18666">target_ui::uitext_title</a></div><div class="ttdeci">std::string uitext_title()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03276">ranged.cpp:3276</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_abb6df512b8b794227dc5f1d9afe17bf1"><div class="ttname"><a href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">target_ui::status</a></div><div class="ttdeci">Status status</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00224">ranged.cpp:224</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_abcb5ba4fec5983a480a4f765da7abe23"><div class="ttname"><a href="classtarget__ui.html#abcb5ba4fec5983a480a4f765da7abe23">target_ui::set_view_offset</a></div><div class="ttdeci">void set_view_offset(const tripoint &amp;new_offset)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02900">ranged.cpp:2900</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ac0a5aad7e60b30082e7ec2ff97f8f6d4"><div class="ttname"><a href="classtarget__ui.html#ac0a5aad7e60b30082e7ec2ff97f8f6d4">target_ui::predicted_recoil</a></div><div class="ttdeci">double predicted_recoil</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00274">ranged.cpp:274</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ac2200f3f97047dbc1e1cf14bae201c34"><div class="ttname"><a href="classtarget__ui.html#ac2200f3f97047dbc1e1cf14bae201c34">target_ui::veh</a></div><div class="ttdeci">vehicle * veh</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00193">ranged.cpp:193</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ac352f6aae1cb28945f8115b76fea2eb6"><div class="ttname"><a href="classtarget__ui.html#ac352f6aae1cb28945f8115b76fea2eb6">target_ui::list_friendlies_in_lof</a></div><div class="ttdeci">std::vector&lt; weak_ptr_fast&lt; Creature &gt; &gt; list_friendlies_in_lof()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02838">ranged.cpp:2838</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ac9b01fafb341eaec6c8f85582fd7f32f"><div class="ttname"><a href="classtarget__ui.html#ac9b01fafb341eaec6c8f85582fd7f32f">target_ui::no_mana</a></div><div class="ttdeci">bool no_mana</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00199">ranged.cpp:199</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_acbdcdc8f41dd8bcbf887b12d96c9948d"><div class="ttname"><a href="classtarget__ui.html#acbdcdc8f41dd8bcbf887b12d96c9948d">target_ui::action_switch_ammo</a></div><div class="ttdeci">bool action_switch_ammo()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03066">ranged.cpp:3066</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_acc5b1b952d220d0cd766f9c32ab5eb38"><div class="ttname"><a href="classtarget__ui.html#acc5b1b952d220d0cd766f9c32ab5eb38">target_ui::draw_help_notice</a></div><div class="ttdeci">void draw_help_notice()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03311">ranged.cpp:3311</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ad1e40f0212d403109c8969d7308e493f"><div class="ttname"><a href="classtarget__ui.html#ad1e40f0212d403109c8969d7308e493f">target_ui::update_status</a></div><div class="ttdeci">void update_status()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02747">ranged.cpp:2747</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ad2ca7887fd647df92c825e8ee153ff84"><div class="ttname"><a href="classtarget__ui.html#ad2ca7887fd647df92c825e8ee153ff84">target_ui::prompt_friendlies_in_lof</a></div><div class="ttdeci">bool prompt_friendlies_in_lof()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02800">ranged.cpp:2800</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ad4a9c004a4c4cf26ad705174612584ea"><div class="ttname"><a href="classtarget__ui.html#ad4a9c004a4c4cf26ad705174612584ea">target_ui::panel_turret_list</a></div><div class="ttdeci">void panel_turret_list(int &amp;text_y)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03630">ranged.cpp:3630</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ad62889056a10382de6835688498cf20e"><div class="ttname"><a href="classtarget__ui.html#ad62889056a10382de6835688498cf20e">target_ui::draw_window_title</a></div><div class="ttdeci">void draw_window_title()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03304">ranged.cpp:3304</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ae0dd055ba040ba97125cbf165a33c997"><div class="ttname"><a href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997">target_ui::TargetMode</a></div><div class="ttdeci">TargetMode</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00169">ranged.cpp:169</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ae0dd055ba040ba97125cbf165a33c997a880c1273b27d27cfc82004c3a4b205c9"><div class="ttname"><a href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a880c1273b27d27cfc82004c3a4b205c9">target_ui::TargetMode::Shape</a></div><div class="ttdeci">@ Shape</div></div>
<div class="ttc" id="aclasstarget__ui_html_ae0dd055ba040ba97125cbf165a33c997a8ce61dd2505effd96f937fa743b6491f"><div class="ttname"><a href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8ce61dd2505effd96f937fa743b6491f">target_ui::TargetMode::Throw</a></div><div class="ttdeci">@ Throw</div></div>
<div class="ttc" id="aclasstarget__ui_html_ae0dd055ba040ba97125cbf165a33c997a8f61cfb2c3938627416432409d2f6e86"><div class="ttname"><a href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8f61cfb2c3938627416432409d2f6e86">target_ui::TargetMode::ThrowBlind</a></div><div class="ttdeci">@ ThrowBlind</div></div>
<div class="ttc" id="aclasstarget__ui_html_ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb"><div class="ttname"><a href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">target_ui::TargetMode::Turrets</a></div><div class="ttdeci">@ Turrets</div></div>
<div class="ttc" id="aclasstarget__ui_html_ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd"><div class="ttname"><a href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd">target_ui::TargetMode::Spell</a></div><div class="ttdeci">@ Spell</div></div>
<div class="ttc" id="aclasstarget__ui_html_ae0dd055ba040ba97125cbf165a33c997ab350f6de1060afddbefbdf47552464ae"><div class="ttname"><a href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997ab350f6de1060afddbefbdf47552464ae">target_ui::TargetMode::Reach</a></div><div class="ttdeci">@ Reach</div></div>
<div class="ttc" id="aclasstarget__ui_html_ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb"><div class="ttname"><a href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">target_ui::TargetMode::Fire</a></div><div class="ttdeci">@ Fire</div></div>
<div class="ttc" id="aclasstarget__ui_html_ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70"><div class="ttname"><a href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70">target_ui::TargetMode::TurretManual</a></div><div class="ttdeci">@ TurretManual</div></div>
<div class="ttc" id="aclasstarget__ui_html_ae5ae79a739fcab56301077b8802355ce"><div class="ttname"><a href="classtarget__ui.html#ae5ae79a739fcab56301077b8802355ce">target_ui::ammo</a></div><div class="ttdeci">const itype * ammo</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00227">ranged.cpp:227</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ae7a7446b4088911709b2eb6a1d3973e5"><div class="ttname"><a href="classtarget__ui.html#ae7a7446b4088911709b2eb6a1d3973e5">target_ui::vturrets</a></div><div class="ttdeci">const std::vector&lt; vehicle_part * &gt; * vturrets</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00191">ranged.cpp:191</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ae8d4216fdc3f48ee8f6dd5f22c33d9d9"><div class="ttname"><a href="classtarget__ui.html#ae8d4216fdc3f48ee8f6dd5f22c33d9d9">target_ui::turrets_in_range</a></div><div class="ttdeci">std::vector&lt; turret_with_lof &gt; turrets_in_range</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00290">ranged.cpp:290</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ae9e40adc2b44c3cd4cdbcc62dd8a1e30"><div class="ttname"><a href="classtarget__ui.html#ae9e40adc2b44c3cd4cdbcc62dd8a1e30">target_ui::turret</a></div><div class="ttdeci">turret_data * turret</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00189">ranged.cpp:189</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_aeee1b122468e838a1f62691b2cd43396"><div class="ttname"><a href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">target_ui::mode</a></div><div class="ttdeci">TargetMode mode</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00183">ranged.cpp:183</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_af007dd5fcc266ee10d673299ca90c29c"><div class="ttname"><a href="classtarget__ui.html#af007dd5fcc266ee10d673299ca90c29c">target_ui::cycle_targets</a></div><div class="ttdeci">void cycle_targets(int direction)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02873">ranged.cpp:2873</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_af17fecf6fc24afc0a1af11ee1447b39a"><div class="ttname"><a href="classtarget__ui.html#af17fecf6fc24afc0a1af11ee1447b39a">target_ui::update_target_list</a></div><div class="ttdeci">void update_target_list()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02671">ranged.cpp:2671</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_af184a9cc7c52521c129182e2cc643375"><div class="ttname"><a href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">target_ui::casting</a></div><div class="ttdeci">spell * casting</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00195">ranged.cpp:195</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_af1dc50e9e2195f48ffdb87a1daacc178"><div class="ttname"><a href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">target_ui::activity</a></div><div class="ttdeci">aim_activity_actor * activity</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00201">ranged.cpp:201</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_af3857720f2059a0a2f23896bc7e808c7"><div class="ttname"><a href="classtarget__ui.html#af3857720f2059a0a2f23896bc7e808c7">target_ui::init_window_and_input</a></div><div class="ttdeci">void init_window_and_input()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02392">ranged.cpp:2392</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_af8c42cdc72ea5432ee63a1d2ba3f6967"><div class="ttname"><a href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">target_ui::aim_types</a></div><div class="ttdeci">std::vector&lt; aim_type &gt; aim_types</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00266">ranged.cpp:266</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_afe4c97cc5abb0ce402bd9e89411e1778"><div class="ttname"><a href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">target_ui::src</a></div><div class="ttdeci">tripoint src</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00231">ranged.cpp:231</a></div></div>
<div class="ttc" id="aclasstranslation_html_a30b5b9d586c786942c2321701a53e572"><div class="ttname"><a href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translation::translated</a></div><div class="ttdeci">std::string translated(int num=1) const</div><div class="ttdoc">Returns raw string if no translation is needed, otherwise returns the translated string.</div><div class="ttdef"><b>Definition:</b> <a href="translations_8cpp_source.html#l00309">translations.cpp:309</a></div></div>
<div class="ttc" id="aclassturret__data_html"><div class="ttname"><a href="classturret__data.html">turret_data</a></div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00473">vehicle.h:474</a></div></div>
<div class="ttc" id="aclassturret__data_html_a21fc6c32651797ffe152775d1b51687b"><div class="ttname"><a href="classturret__data.html#a21fc6c32651797ffe152775d1b51687b">turret_data::ammo_select</a></div><div class="ttdeci">bool ammo_select(const itype_id &amp;ammo)</div><div class="ttdoc">Attempts selecting ammo type and returns true if selection was valid.</div><div class="ttdef"><b>Definition:</b> <a href="turret_8cpp_source.html#l00166">turret.cpp:166</a></div></div>
<div class="ttc" id="aclassturret__data_html_a585d18f2c33116bc1e9028210fccadbc"><div class="ttname"><a href="classturret__data.html#a585d18f2c33116bc1e9028210fccadbc">turret_data::query</a></div><div class="ttdeci">status query() const</div><div class="ttdef"><b>Definition:</b> <a href="turret_8cpp_source.html#l00232">turret.cpp:232</a></div></div>
<div class="ttc" id="aclassturret__data_html_a737465cce9c8f1e87eec808ee1363421"><div class="ttname"><a href="classturret__data.html#a737465cce9c8f1e87eec808ee1363421">turret_data::base</a></div><div class="ttdeci">item_location base()</div><div class="ttdoc">Get base item location.</div><div class="ttdef"><b>Definition:</b> <a href="turret_8cpp_source.html#l00084">turret.cpp:84</a></div></div>
<div class="ttc" id="aclassturret__data_html_a78df34a41feb7bf25a677dba1e8181d5"><div class="ttname"><a href="classturret__data.html#a78df34a41feb7bf25a677dba1e8181d5">turret_data::range</a></div><div class="ttdeci">int range() const</div><div class="ttdoc">Maximum range considering current ammo (if any)</div><div class="ttdef"><b>Definition:</b> <a href="turret_8cpp_source.html#l00188">turret.cpp:188</a></div></div>
<div class="ttc" id="aclassturret__data_html_aa11f464b221b987d03a8859293e07ab6ab2fdab230a2c39f3595a947861863cb7"><div class="ttname"><a href="classturret__data.html#aa11f464b221b987d03a8859293e07ab6ab2fdab230a2c39f3595a947861863cb7">turret_data::status::ready</a></div><div class="ttdeci">@ ready</div></div>
<div class="ttc" id="aclassturret__data_html_aca7944937ce0285293b927c0c893d65a"><div class="ttname"><a href="classturret__data.html#aca7944937ce0285293b927c0c893d65a">turret_data::get_veh</a></div><div class="ttdeci">const vehicle * get_veh() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00495">vehicle.h:495</a></div></div>
<div class="ttc" id="aclassturret__data_html_ad8b9e08531f26de34c61d5821ca69d7c"><div class="ttname"><a href="classturret__data.html#ad8b9e08531f26de34c61d5821ca69d7c">turret_data::in_range</a></div><div class="ttdeci">bool in_range(const tripoint &amp;target) const</div><div class="ttdoc">Check if target is in range of this turret (considers current ammo) Assumes this turret's status is '...</div><div class="ttdef"><b>Definition:</b> <a href="turret_8cpp_source.html#l00202">turret.cpp:202</a></div></div>
<div class="ttc" id="aclassturret__data_html_aee56a3a0b07255f5b008cd16898b75e0"><div class="ttname"><a href="classturret__data.html#aee56a3a0b07255f5b008cd16898b75e0">turret_data::ammo_current</a></div><div class="ttdeci">itype_id ammo_current() const</div><div class="ttdoc">Specific ammo type or returns &quot;null&quot; if no ammo available.</div><div class="ttdef"><b>Definition:</b> <a href="turret_8cpp_source.html#l00124">turret.cpp:124</a></div></div>
<div class="ttc" id="aclassturret__data_html_af1938c9e7db9350ae08fef7a921f19c6"><div class="ttname"><a href="classturret__data.html#af1938c9e7db9350ae08fef7a921f19c6">turret_data::ammo_options</a></div><div class="ttdeci">std::set&lt; itype_id &gt; ammo_options() const</div><div class="ttdoc">What ammo is available for this turret (may be multiple if uses tanks)</div><div class="ttdef"><b>Definition:</b> <a href="turret_8cpp_source.html#l00139">turret.cpp:139</a></div></div>
<div class="ttc" id="aclassui__adaptor_html"><div class="ttname"><a href="classui__adaptor.html">ui_adaptor</a></div><div class="ttdef"><b>Definition:</b> <a href="ui__manager_8h_source.html#l00015">ui_manager.h:16</a></div></div>
<div class="ttc" id="aclassuilist_html"><div class="ttname"><a href="classuilist.html">uilist</a></div><div class="ttdoc">uilist: scrolling vertical list menu</div><div class="ttdef"><b>Definition:</b> <a href="ui_8h_source.html#l00186">ui.h:187</a></div></div>
<div class="ttc" id="aclassuilist_html_a0baa34622db6972a59d47d478bfd21d6"><div class="ttname"><a href="classuilist.html#a0baa34622db6972a59d47d478bfd21d6">uilist::ret</a></div><div class="ttdeci">int ret</div><div class="ttdef"><b>Definition:</b> <a href="ui_8h_source.html#l00412">ui.h:412</a></div></div>
<div class="ttc" id="aclassuilist_html_a5ed3c6e3829c033040fa9f11f1a7d0aa"><div class="ttname"><a href="classuilist.html#a5ed3c6e3829c033040fa9f11f1a7d0aa">uilist::settext</a></div><div class="ttdeci">void settext(const std::string &amp;str)</div><div class="ttdef"><b>Definition:</b> <a href="ui_8cpp_source.html#l00958">ui.cpp:958</a></div></div>
<div class="ttc" id="aclassuilist_html_ab0890d56d6d29dd98a0b3f17bb3ebba3"><div class="ttname"><a href="classuilist.html#ab0890d56d6d29dd98a0b3f17bb3ebba3">uilist::selected</a></div><div class="ttdeci">int selected</div><div class="ttdef"><b>Definition:</b> <a href="ui_8h_source.html#l00415">ui.h:415</a></div></div>
<div class="ttc" id="aclassuilist_html_af5fc2972d43a795c49a632dbcf58132b"><div class="ttname"><a href="classuilist.html#af5fc2972d43a795c49a632dbcf58132b">uilist::entries</a></div><div class="ttdeci">std::vector&lt; uilist_entry &gt; entries</div><div class="ttdef"><b>Definition:</b> <a href="ui_8h_source.html#l00323">ui.h:323</a></div></div>
<div class="ttc" id="aclassuilist_html_af99f28334902af64487e2d0758df2ab9"><div class="ttname"><a href="classuilist.html#af99f28334902af64487e2d0758df2ab9">uilist::addentry</a></div><div class="ttdeci">void addentry(const std::string &amp;str)</div><div class="ttdef"><b>Definition:</b> <a href="ui_8cpp_source.html#l00932">ui.cpp:932</a></div></div>
<div class="ttc" id="aclassunits_1_1quantity_html"><div class="ttname"><a href="classunits_1_1quantity.html">units::quantity</a></div><div class="ttdef"><b>Definition:</b> <a href="units__def_8h_source.html#l00014">units_def.h:15</a></div></div>
<div class="ttc" id="aclassunits_1_1quantity_html_a239e9b238064a23fab11ff2094537958"><div class="ttname"><a href="classunits_1_1quantity.html#a239e9b238064a23fab11ff2094537958">units::quantity::value</a></div><div class="ttdeci">constexpr const value_type &amp; value() const</div><div class="ttdoc">Access the raw dimensionless value.</div><div class="ttdef"><b>Definition:</b> <a href="units__def_8h_source.html#l00044">units_def.h:44</a></div></div>
<div class="ttc" id="aclassvehicle_html"><div class="ttname"><a href="classvehicle.html">vehicle</a></div><div class="ttdoc">A vehicle as a whole with all its components.</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00674">vehicle.h:675</a></div></div>
<div class="ttc" id="aclassvehicle_html_accfab81af66cd979bdfff4c39e5a3a8e"><div class="ttname"><a href="classvehicle.html#accfab81af66cd979bdfff4c39e5a3a8e">vehicle::turret_query</a></div><div class="ttdeci">turret_data turret_query(vehicle_part &amp;pt)</div><div class="ttdoc">Get firing data for a turret.</div><div class="ttdef"><b>Definition:</b> <a href="turret_8cpp_source.html#l00055">turret.cpp:55</a></div></div>
<div class="ttc" id="aclassvehicle_html_ae8132c34a1ea24866889e6e599796adc"><div class="ttname"><a href="classvehicle.html#ae8132c34a1ea24866889e6e599796adc">vehicle::global_part_pos3</a></div><div class="ttdeci">tripoint global_part_pos3(const int &amp;index) const</div><div class="ttdoc">Get the coordinates of the studied part of the vehicle.</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l03286">vehicle.cpp:3286</a></div></div>
<div class="ttc" id="aclassvisitable_html_a073dab39ca059a87742a05300402ab01"><div class="ttname"><a href="classvisitable.html#a073dab39ca059a87742a05300402ab01">visitable&lt; Character &gt;::find_parent</a></div><div class="ttdeci">item * find_parent(const item &amp;it)</div><div class="ttdoc">Determine the immediate parent container (if any) for an item.</div><div class="ttdef"><b>Definition:</b> <a href="visitable_8cpp_source.html#l00050">visitable.cpp:49</a></div></div>
<div class="ttc" id="aclassvisitable_html_a517e20b6f6c13b8316d5cce8e310b871"><div class="ttname"><a href="classvisitable.html#a517e20b6f6c13b8316d5cce8e310b871">visitable&lt; Character &gt;::charges_of</a></div><div class="ttdeci">int charges_of(const itype_id &amp;what, int limit=INT_MAX, const std::function&lt; bool(const item &amp;)&gt; &amp;filter=return_true&lt; item &gt;, std::function&lt; void(int)&gt; visitor=nullptr) const</div><div class="ttdoc">Count maximum available charges from this instance and any contained items.</div><div class="ttdef"><b>Definition:</b> <a href="visitable_8cpp_source.html#l00079">visitable.cpp:943</a></div></div>
<div class="ttc" id="aclassvisitable_html_af49d5ef7b3f2f0a8664c23097a56373f"><div class="ttname"><a href="classvisitable.html#af49d5ef7b3f2f0a8664c23097a56373f">visitable&lt; Character &gt;::has_item</a></div><div class="ttdeci">bool has_item(const item &amp;it) const</div><div class="ttdoc">Returns true if this visitable instance contains the item.</div><div class="ttdef"><b>Definition:</b> <a href="visitable_8cpp_source.html#l00061">visitable.cpp:95</a></div></div>
<div class="ttc" id="acolor_8cpp_html_a0f25678be1fc95cb81381a004493a4cc"><div class="ttname"><a href="color_8cpp.html#a0f25678be1fc95cb81381a004493a4cc">colorize</a></div><div class="ttdeci">std::string colorize(const std::string &amp;text, const nc_color &amp;color)</div><div class="ttdef"><b>Definition:</b> <a href="color_8cpp_source.html#l00669">color.cpp:669</a></div></div>
<div class="ttc" id="acolor_8h_html"><div class="ttname"><a href="color_8h.html">color.h</a></div></div>
<div class="ttc" id="acolor_8h_html_a0d06dc49b9761bbc54607397213728bb"><div class="ttname"><a href="color_8h.html#a0d06dc49b9761bbc54607397213728bb">c_white</a></div><div class="ttdeci">#define c_white</div><div class="ttdef"><b>Definition:</b> <a href="color_8h_source.html#l00018">color.h:18</a></div></div>
<div class="ttc" id="acolor_8h_html_a1b1e3c0bef566a83c3535e38a93ad733"><div class="ttname"><a href="color_8h.html#a1b1e3c0bef566a83c3535e38a93ad733">c_light_gray</a></div><div class="ttdeci">#define c_light_gray</div><div class="ttdef"><b>Definition:</b> <a href="color_8h_source.html#l00019">color.h:19</a></div></div>
<div class="ttc" id="acolor_8h_html_a2236aa1fe66b707a104f19ad45c23230"><div class="ttname"><a href="color_8h.html#a2236aa1fe66b707a104f19ad45c23230">c_light_green</a></div><div class="ttdeci">#define c_light_green</div><div class="ttdef"><b>Definition:</b> <a href="color_8h_source.html#l00028">color.h:28</a></div></div>
<div class="ttc" id="acolor_8h_html_a5738d18ff9e165cca088a623cb1883ae"><div class="ttname"><a href="color_8h.html#a5738d18ff9e165cca088a623cb1883ae">c_dark_gray</a></div><div class="ttdeci">#define c_dark_gray</div><div class="ttdef"><b>Definition:</b> <a href="color_8h_source.html#l00020">color.h:20</a></div></div>
<div class="ttc" id="acolor_8h_html_a7b00fb82de0be83f6fc5f7965ea86623"><div class="ttname"><a href="color_8h.html#a7b00fb82de0be83f6fc5f7965ea86623">c_light_blue</a></div><div class="ttdeci">#define c_light_blue</div><div class="ttdef"><b>Definition:</b> <a href="color_8h_source.html#l00029">color.h:29</a></div></div>
<div class="ttc" id="acolor_8h_html_a95b67111e2e4be7fcac981d2b7b208f6"><div class="ttname"><a href="color_8h.html#a95b67111e2e4be7fcac981d2b7b208f6">c_cyan</a></div><div class="ttdeci">#define c_cyan</div><div class="ttdef"><b>Definition:</b> <a href="color_8h_source.html#l00024">color.h:24</a></div></div>
<div class="ttc" id="acolor_8h_html_aab11865a3631a7ce78da82b7fb386b71"><div class="ttname"><a href="color_8h.html#aab11865a3631a7ce78da82b7fb386b71">c_light_red</a></div><div class="ttdeci">#define c_light_red</div><div class="ttdef"><b>Definition:</b> <a href="color_8h_source.html#l00027">color.h:27</a></div></div>
<div class="ttc" id="acolor_8h_html_af0a87eaef36305269f4506dfa34d94c0"><div class="ttname"><a href="color_8h.html#af0a87eaef36305269f4506dfa34d94c0">c_red</a></div><div class="ttdeci">#define c_red</div><div class="ttdef"><b>Definition:</b> <a href="color_8h_source.html#l00021">color.h:21</a></div></div>
<div class="ttc" id="acoordinates_8h_html_a13a12943d34d5f17e6c3b4e730659fc6"><div class="ttname"><a href="coordinates_8h.html#a13a12943d34d5f17e6c3b4e730659fc6">closest_points_first</a></div><div class="ttdeci">std::vector&lt; coords::coord_point&lt; Point, Origin, Scale &gt; &gt; closest_points_first(const coords::coord_point&lt; Point, Origin, Scale &gt; &amp;loc, int min_dist, int max_dist)</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00596">coordinates.h:596</a></div></div>
<div class="ttc" id="acoordinates_8h_html_a47953b33a873caa0861b12222842a5ec"><div class="ttname"><a href="coordinates_8h.html#a47953b33a873caa0861b12222842a5ec">rl_dist</a></div><div class="ttdeci">int rl_dist(const coords::coord_point&lt; Point, Origin, Scale &gt; &amp;loc1, const coords::coord_point&lt; Point, Origin, Scale &gt; &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00519">coordinates.h:519</a></div></div>
<div class="ttc" id="acoordinates_8h_html_a4a34f7ffa4c18effba7f8239c68c8738"><div class="ttname"><a href="coordinates_8h.html#a4a34f7ffa4c18effba7f8239c68c8738">line_to</a></div><div class="ttdeci">std::vector&lt; coords::coord_point&lt; Point, Origin, Scale &gt; &gt; line_to(const coords::coord_point&lt; Point, Origin, Scale &gt; &amp;loc1, const coords::coord_point&lt; Point, Origin, Scale &gt; &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00548">coordinates.h:548</a></div></div>
<div class="ttc" id="acoordinates_8h_html_a5ca1722555a6d5ab9ab7ae8e35c35eaa"><div class="ttname"><a href="coordinates_8h.html#a5ca1722555a6d5ab9ab7ae8e35c35eaa">square_dist</a></div><div class="ttdeci">int square_dist(const coords::coord_point&lt; Point, Origin, Scale &gt; &amp;loc1, const coords::coord_point&lt; Point, Origin, Scale &gt; &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00505">coordinates.h:505</a></div></div>
<div class="ttc" id="acoordinates_8h_html_adf2fa43699f878fca49a987112d4aa03"><div class="ttname"><a href="coordinates_8h.html#adf2fa43699f878fca49a987112d4aa03">trig_dist</a></div><div class="ttdeci">int trig_dist(const coords::coord_point&lt; Point, Origin, Scale &gt; &amp;loc1, const coords::coord_point&lt; Point, Origin, Scale &gt; &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00512">coordinates.h:512</a></div></div>
<div class="ttc" id="acreature_8h_html"><div class="ttname"><a href="creature_8h.html">creature.h</a></div></div>
<div class="ttc" id="acreature_8h_html_a94151e401c177b20ea9b8bcadf74f592"><div class="ttname"><a href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592">m_size</a></div><div class="ttdeci">m_size</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00057">creature.h:57</a></div></div>
<div class="ttc" id="acreature_8h_html_a94151e401c177b20ea9b8bcadf74f592a07b6bf6678272622a1fb127d59cf0614"><div class="ttname"><a href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592a07b6bf6678272622a1fb127d59cf0614">MS_TINY</a></div><div class="ttdeci">@ MS_TINY</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00058">creature.h:58</a></div></div>
<div class="ttc" id="acreature_8h_html_a94151e401c177b20ea9b8bcadf74f592a50d9f673ed0348953b2715fa33683791"><div class="ttname"><a href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592a50d9f673ed0348953b2715fa33683791">MS_LARGE</a></div><div class="ttdeci">@ MS_LARGE</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00061">creature.h:61</a></div></div>
<div class="ttc" id="acreature_8h_html_a94151e401c177b20ea9b8bcadf74f592a6a1920ba558cd6584b689f53519e9e96"><div class="ttname"><a href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592a6a1920ba558cd6584b689f53519e9e96">MS_SMALL</a></div><div class="ttdeci">@ MS_SMALL</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00059">creature.h:59</a></div></div>
<div class="ttc" id="acreature_8h_html_a94151e401c177b20ea9b8bcadf74f592a75a0e62060c8f624b2c71038a5a77ae9"><div class="ttname"><a href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592a75a0e62060c8f624b2c71038a5a77ae9">MS_HUGE</a></div><div class="ttdeci">@ MS_HUGE</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00062">creature.h:62</a></div></div>
<div class="ttc" id="acreature_8h_html_a94151e401c177b20ea9b8bcadf74f592aaef7580aead8b8a18bc50cb6c1f98b31"><div class="ttname"><a href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592aaef7580aead8b8a18bc50cb6c1f98b31">MS_MEDIUM</a></div><div class="ttdeci">@ MS_MEDIUM</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00060">creature.h:60</a></div></div>
<div class="ttc" id="acreature_8h_html_ad75f2d1f6565bcf922f3f2ddab4c6b11a68b715cd56911c8b0ce1b82f76547b6b"><div class="ttname"><a href="creature_8h.html#ad75f2d1f6565bcf922f3f2ddab4c6b11a68b715cd56911c8b0ce1b82f76547b6b">FD_LEFT</a></div><div class="ttdeci">@ FD_LEFT</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00073">creature.h:73</a></div></div>
<div class="ttc" id="acreature_8h_html_ad75f2d1f6565bcf922f3f2ddab4c6b11a86dc1254b0f072b9cb90b4cf14cb2917"><div class="ttname"><a href="creature_8h.html#ad75f2d1f6565bcf922f3f2ddab4c6b11a86dc1254b0f072b9cb90b4cf14cb2917">FD_RIGHT</a></div><div class="ttdeci">@ FD_RIGHT</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00075">creature.h:74</a></div></div>
<div class="ttc" id="acursesdef_8h_html"><div class="ttname"><a href="cursesdef_8h.html">cursesdef.h</a></div></div>
<div class="ttc" id="adamage_8h_html"><div class="ttname"><a href="damage_8h.html">damage.h</a></div></div>
<div class="ttc" id="adamage_8h_html_ae63a2cf8429f9edf77b547d34ffe4e7aa5f8b46c6c239266403858fa2ae90ef23"><div class="ttname"><a href="damage_8h.html#ae63a2cf8429f9edf77b547d34ffe4e7aa5f8b46c6c239266403858fa2ae90ef23">DT_BASH</a></div><div class="ttdeci">@ DT_BASH</div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00024">damage.h:24</a></div></div>
<div class="ttc" id="adamage_8h_html_ae63a2cf8429f9edf77b547d34ffe4e7aa8ff698c0509e78ff65c7c7ec899b4f51"><div class="ttname"><a href="damage_8h.html#ae63a2cf8429f9edf77b547d34ffe4e7aa8ff698c0509e78ff65c7c7ec899b4f51">DT_CUT</a></div><div class="ttdeci">@ DT_CUT</div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00025">damage.h:25</a></div></div>
<div class="ttc" id="adebug_8h_html"><div class="ttname"><a href="debug_8h.html">debug.h</a></div></div>
<div class="ttc" id="adebug_8h_html_a87e509562277a7ada3a75330d00cb445"><div class="ttname"><a href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a></div><div class="ttdeci">#define debugmsg(...)</div><div class="ttdoc">Debug message of level DL::Error and class DC::DebugMsg, also includes the source file name and line,...</div><div class="ttdef"><b>Definition:</b> <a href="debug_8h_source.html#l00074">debug.h:74</a></div></div>
<div class="ttc" id="adialogue_8h_html_abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8"><div class="ttname"><a href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a></div><div class="ttdeci">@ action</div><div class="ttdef"><b>Definition:</b> <a href="dialogue_8h_source.html#l00037">dialogue.h:36</a></div></div>
<div class="ttc" id="adispersion_8h_html"><div class="ttname"><a href="dispersion_8h.html">dispersion.h</a></div></div>
<div class="ttc" id="aeditmap_8cpp_html_a025a5c063205294df20818edc4cfe355"><div class="ttname"><a href="editmap_8cpp.html#a025a5c063205294df20818edc4cfe355">color</a></div><div class="ttdeci">static nc_color color(const T_t &amp;t)</div></div>
<div class="ttc" id="aenums_8h_html"><div class="ttname"><a href="enums_8h.html">enums.h</a></div></div>
<div class="ttc" id="aenums_8h_html_a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481"><div class="ttname"><a href="enums_8h.html#a18cc141c508bf4f277abaf39fc9c3d96aaaddc3454ccbefbb2d8d8461f8f7f481">distraction_type::noise</a></div><div class="ttdeci">@ noise</div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096ea2f644bab8f796b847285eab073040f10"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea2f644bab8f796b847285eab073040f10">m_good</a></div><div class="ttdeci">@ m_good</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00253">enums.h:253</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096ea5d3734a51686ceb1848704dd277dfc7f"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea5d3734a51686ceb1848704dd277dfc7f">m_info</a></div><div class="ttdeci">@ m_info</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00258">enums.h:258</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a></div><div class="ttdeci">@ m_bad</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00254">enums.h:254</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096ea9855e523119c93601d8f67718994df05"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea9855e523119c93601d8f67718994df05">m_debug</a></div><div class="ttdeci">@ m_debug</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00264">enums.h:264</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096eaed9222dd268c0a08567f6c9081b3e687"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096eaed9222dd268c0a08567f6c9081b3e687">m_warning</a></div><div class="ttdeci">@ m_warning</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00257">enums.h:257</a></div></div>
<div class="ttc" id="aenums_8h_html_ac7c2392f800a8be2feb093ef5fe48d40af3725cafa78eb43cc647b405bb6ecfab"><div class="ttname"><a href="enums_8h.html#ac7c2392f800a8be2feb093ef5fe48d40af3725cafa78eb43cc647b405bb6ecfab">type</a></div><div class="ttdeci">@ type</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00075">enums.h:75</a></div></div>
<div class="ttc" id="aenums_8h_html_ade8f325e8cc8463cef8f944f3209d0e5aa87f9501ff2b390be1ea7d261b0d7cce"><div class="ttname"><a href="enums_8h.html#ade8f325e8cc8463cef8f944f3209d0e5aa87f9501ff2b390be1ea7d261b0d7cce">LIQUID</a></div><div class="ttdeci">@ LIQUID</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00175">enums.h:175</a></div></div>
<div class="ttc" id="aevent_8h_html"><div class="ttname"><a href="event_8h.html">event.h</a></div></div>
<div class="ttc" id="aevent_8h_html_a430b444c74dd3fd1472a31714ec5f1cea365dbc32084e314b4788756b6fa66ecb"><div class="ttname"><a href="event_8h.html#a430b444c74dd3fd1472a31714ec5f1cea365dbc32084e314b4788756b6fa66ecb">event_type::character_gets_headshot</a></div><div class="ttdeci">@ character_gets_headshot</div></div>
<div class="ttc" id="aevent__bus_8h_html"><div class="ttname"><a href="event__bus_8h.html">event_bus.h</a></div></div>
<div class="ttc" id="agame_8cpp_html_abeb98e93502d73818b4a73fabe191bc1"><div class="ttname"><a href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a></div><div class="ttdeci">std::unique_ptr&lt; game &gt; g</div><div class="ttdef"><b>Definition:</b> <a href="game_8cpp_source.html#l00270">game.cpp:270</a></div></div>
<div class="ttc" id="agame_8h_html"><div class="ttname"><a href="game_8h.html">game.h</a></div></div>
<div class="ttc" id="agame__constants_8h_html"><div class="ttname"><a href="game__constants_8h.html">game_constants.h</a></div></div>
<div class="ttc" id="agame__constants_8h_html_a32b6b0daa47aeb1caa71bc0585e24684"><div class="ttname"><a href="game__constants_8h.html#a32b6b0daa47aeb1caa71bc0585e24684">accuracy_critical</a></div><div class="ttdeci">constexpr double accuracy_critical</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00121">game_constants.h:121</a></div></div>
<div class="ttc" id="agame__constants_8h_html_a3984a9476d1edc78e4e7b886a08d4d4b"><div class="ttname"><a href="game__constants_8h.html#a3984a9476d1edc78e4e7b886a08d4d4b">OVERMAP_HEIGHT</a></div><div class="ttdeci">static constexpr int OVERMAP_HEIGHT</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00063">game_constants.h:63</a></div></div>
<div class="ttc" id="agame__constants_8h_html_a45b6e116f09ae6af4ef31f1495cf48a1"><div class="ttname"><a href="game__constants_8h.html#a45b6e116f09ae6af4ef31f1495cf48a1">accuracy_grazing</a></div><div class="ttdeci">constexpr double accuracy_grazing</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00124">game_constants.h:124</a></div></div>
<div class="ttc" id="agame__constants_8h_html_a8226e8a134603e5bc06df05efd13d8d1"><div class="ttname"><a href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a></div><div class="ttdeci">constexpr double MAX_RECOIL</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00128">game_constants.h:128</a></div></div>
<div class="ttc" id="agame__constants_8h_html_aad0eacfa516a8f7e005674027d7640fe"><div class="ttname"><a href="game__constants_8h.html#aad0eacfa516a8f7e005674027d7640fe">OVERMAP_DEPTH</a></div><div class="ttdeci">static constexpr int OVERMAP_DEPTH</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00061">game_constants.h:61</a></div></div>
<div class="ttc" id="agame__constants_8h_html_ae5e219227693b7de2d1bb823567b01c7"><div class="ttname"><a href="game__constants_8h.html#ae5e219227693b7de2d1bb823567b01c7">accuracy_standard</a></div><div class="ttdeci">constexpr double accuracy_standard</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00123">game_constants.h:123</a></div></div>
<div class="ttc" id="agame__constants_8h_html_ae9c0ec5b4724c15132efddb8862ca652"><div class="ttname"><a href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a></div><div class="ttdeci">static constexpr int MAX_SKILL</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00111">game_constants.h:111</a></div></div>
<div class="ttc" id="agroup__UI_html_ga7604af7545244003f0a52ac87ce37979"><div class="ttname"><a href="group__UI.html#ga7604af7545244003f0a52ac87ce37979">uilist::query</a></div><div class="ttdeci">void query(bool loop=true, int timeout=-1)</div><div class="ttdoc">Handle input and update display.</div><div class="ttdef"><b>Definition:</b> <a href="ui_8cpp_source.html#l00828">ui.cpp:828</a></div></div>
<div class="ttc" id="agun__mode_8h_html"><div class="ttname"><a href="gun__mode_8h.html">gun_mode.h</a></div></div>
<div class="ttc" id="ahandle__action_8cpp_html_ad56544ec96a0f79ea4e47ae8f8754d10"><div class="ttname"><a href="handle__action_8cpp.html#ad56544ec96a0f79ea4e47ae8f8754d10">fire</a></div><div class="ttdeci">static void fire()</div><div class="ttdef"><b>Definition:</b> <a href="handle__action_8cpp_source.html#l01317">handle_action.cpp:1317</a></div></div>
<div class="ttc" id="ainput_8cpp_html_aceedd903724817bad81fbc03216ff125"><div class="ttname"><a href="input_8cpp.html#aceedd903724817bad81fbc03216ff125">is_mouse_enabled</a></div><div class="ttdeci">bool is_mouse_enabled()</div><div class="ttdef"><b>Definition:</b> <a href="input_8cpp_source.html#l00074">input.cpp:74</a></div></div>
<div class="ttc" id="ainput_8h_html"><div class="ttname"><a href="input_8h.html">input.h</a></div></div>
<div class="ttc" id="aitem_8cpp_html_a300b99af4ea719590afac661e0bff7a1"><div class="ttname"><a href="item_8cpp.html#a300b99af4ea719590afac661e0bff7a1">null_item_reference</a></div><div class="ttdeci">item &amp; null_item_reference()</div><div class="ttdoc">Returns a reference to a null item (see item::is_null).</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l00321">item.cpp:321</a></div></div>
<div class="ttc" id="aitem_8h_html"><div class="ttname"><a href="item_8h.html">item.h</a></div></div>
<div class="ttc" id="aitem__location_8h_html"><div class="ttname"><a href="item__location_8h.html">item_location.h</a></div></div>
<div class="ttc" id="aitype_8h_html"><div class="ttname"><a href="itype_8h.html">itype.h</a></div></div>
<div class="ttc" id="aline_8cpp_html_a22f984836636053038f43340f9c50149"><div class="ttname"><a href="line_8cpp.html#a22f984836636053038f43340f9c50149">coord_to_angle</a></div><div class="ttdeci">units::angle coord_to_angle(const tripoint &amp;a, const tripoint &amp;b)</div><div class="ttdoc">Calculates the horizontal angle between the lines from (0,0,0) to a and the line from (0,...</div><div class="ttdef"><b>Definition:</b> <a href="line_8cpp_source.html#l00781">line.cpp:781</a></div></div>
<div class="ttc" id="aline_8cpp_html_a2d906c9af0b0586f48bc34cff0838817"><div class="ttname"><a href="line_8cpp.html#a2d906c9af0b0586f48bc34cff0838817">rl_dist_exact</a></div><div class="ttdeci">float rl_dist_exact(const tripoint &amp;loc1, const tripoint &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="line_8cpp_source.html#l00292">line.cpp:292</a></div></div>
<div class="ttc" id="aline_8cpp_html_aaa43dcdfe5b511b116fafb32c5cff349"><div class="ttname"><a href="line_8cpp.html#aaa43dcdfe5b511b116fafb32c5cff349">atan2</a></div><div class="ttdeci">units::angle atan2(const point &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="line_8cpp_source.html#l00321">line.cpp:321</a></div></div>
<div class="ttc" id="aline_8cpp_html_abe565ec8aa356531238f99029077c3a1"><div class="ttname"><a href="line_8cpp.html#abe565ec8aa356531238f99029077c3a1">iso_tangent</a></div><div class="ttdeci">double iso_tangent(double distance, units::angle vertex)</div><div class="ttdoc">Calculate base of an isosceles triangle.</div><div class="ttdef"><b>Definition:</b> <a href="line_8cpp_source.html#l00018">line.cpp:18</a></div></div>
<div class="ttc" id="aline_8h_html"><div class="ttname"><a href="line_8h.html">line.h</a></div></div>
<div class="ttc" id="aline_8h_html_a3621d2006812bd84f3ed6999b38f90a3"><div class="ttname"><a href="line_8h.html#a3621d2006812bd84f3ed6999b38f90a3">direction</a></div><div class="ttdeci">direction</div><div class="ttdef"><b>Definition:</b> <a href="line_8h_source.html#l00039">line.h:39</a></div></div>
<div class="ttc" id="amagic_8cpp_html_a188caae18b60b66f9f44214c7e28ac1f"><div class="ttname"><a href="magic_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a></div><div class="ttdeci">constexpr double a</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l01030">magic.cpp:1030</a></div></div>
<div class="ttc" id="amagic_8cpp_html_a6753ecfe87da659675b18c2f81d6ec12"><div class="ttname"><a href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a></div><div class="ttdeci">constexpr double c</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l01032">magic.cpp:1032</a></div></div>
<div class="ttc" id="amagic_8h_html"><div class="ttname"><a href="magic_8h.html">magic.h</a></div></div>
<div class="ttc" id="amagic_8h_html_a3c314c02f97a7d720f18adcd1dbd7313a035da4b29716d283ad9e6f63574058b3"><div class="ttname"><a href="magic_8h.html#a3c314c02f97a7d720f18adcd1dbd7313a035da4b29716d283ad9e6f63574058b3">hp_energy</a></div><div class="ttdeci">@ hp_energy</div><div class="ttdef"><b>Definition:</b> <a href="magic_8h_source.html#l00064">magic.h:64</a></div></div>
<div class="ttc" id="amagic_8h_html_a3c314c02f97a7d720f18adcd1dbd7313ac5dea5bec6450a607e6b31abd578d55b"><div class="ttname"><a href="magic_8h.html#a3c314c02f97a7d720f18adcd1dbd7313ac5dea5bec6450a607e6b31abd578d55b">none_energy</a></div><div class="ttdeci">@ none_energy</div><div class="ttdef"><b>Definition:</b> <a href="magic_8h_source.html#l00070">magic.h:69</a></div></div>
<div class="ttc" id="amagic_8h_html_ae9e507f7e02f759a1668864b8a46ae26aa5892df376122d8cc2f5f705351e4a44"><div class="ttname"><a href="magic_8h.html#ae9e507f7e02f759a1668864b8a46ae26aa5892df376122d8cc2f5f705351e4a44">target_self</a></div><div class="ttdeci">@ target_self</div><div class="ttdef"><b>Definition:</b> <a href="magic_8h_source.html#l00075">magic.h:75</a></div></div>
<div class="ttc" id="amap_8cpp_html_acb0b34be6e497bdd2f9f40ae6929d562"><div class="ttname"><a href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a></div><div class="ttdeci">map &amp; get_map()</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l00144">map.cpp:144</a></div></div>
<div class="ttc" id="amap_8h_html"><div class="ttname"><a href="map_8h.html">map.h</a></div></div>
<div class="ttc" id="amapdata_8h_html_aa04d037303ea30193f7cf0cd82304258ac945c31a7a3d56b4f17384b30f73133f"><div class="ttname"><a href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258ac945c31a7a3d56b4f17384b30f73133f">TFLAG_TRANSPARENT</a></div><div class="ttdeci">@ TFLAG_TRANSPARENT</div><div class="ttdef"><b>Definition:</b> <a href="mapdata_8h_source.html#l00276">mapdata.h:276</a></div></div>
<div class="ttc" id="amapgen_8cpp_html_a90f1f53dc044e93e7f7f9314cef1bd45"><div class="ttname"><a href="mapgen_8cpp.html#a90f1f53dc044e93e7f7f9314cef1bd45">line</a></div><div class="ttdeci">void line(map *m, const ter_id &amp;type, const point &amp;p1, const point &amp;p2)</div><div class="ttdef"><b>Definition:</b> <a href="mapgen_8cpp_source.html#l06455">mapgen.cpp:6455</a></div></div>
<div class="ttc" id="amaterial_8h_html"><div class="ttname"><a href="material_8h.html">material.h</a></div></div>
<div class="ttc" id="amath__defines_8h_html"><div class="ttname"><a href="math__defines_8h.html">math_defines.h</a></div></div>
<div class="ttc" id="amath__defines_8h_html_ae71449b1cc6e6250b91f539153a7a0d3"><div class="ttname"><a href="math__defines_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a></div><div class="ttdeci">#define M_PI</div><div class="ttdef"><b>Definition:</b> <a href="math__defines_8h_source.html#l00021">math_defines.h:21</a></div></div>
<div class="ttc" id="amemory__fast_8h_html_ab8afe5baa726add2054cce385cad8855"><div class="ttname"><a href="memory__fast_8h.html#ab8afe5baa726add2054cce385cad8855">weak_ptr_fast</a></div><div class="ttdeci">std::weak_ptr&lt; T &gt; weak_ptr_fast</div><div class="ttdef"><b>Definition:</b> <a href="memory__fast_8h_source.html#l00017">memory_fast.h:17</a></div></div>
<div class="ttc" id="amemory__fast_8h_html_ada897699f31fc8b37c5af09d95d45840"><div class="ttname"><a href="memory__fast_8h.html#ada897699f31fc8b37c5af09d95d45840">shared_ptr_fast</a></div><div class="ttdeci">std::shared_ptr&lt; T &gt; shared_ptr_fast</div><div class="ttdef"><b>Definition:</b> <a href="memory__fast_8h_source.html#l00016">memory_fast.h:16</a></div></div>
<div class="ttc" id="amessages_8cpp_html_a54489326fc37823819c5105addfa27f2"><div class="ttname"><a href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a></div><div class="ttdeci">void add_msg(std::string msg)</div><div class="ttdef"><b>Definition:</b> <a href="messages_8cpp_source.html#l00884">messages.cpp:884</a></div></div>
<div class="ttc" id="amessages_8h_html"><div class="ttname"><a href="messages_8h.html">messages.h</a></div></div>
<div class="ttc" id="amonster_8h_html"><div class="ttname"><a href="monster_8h.html">monster.h</a></div></div>
<div class="ttc" id="amorale__types_8cpp_html_a7a7fa39cff1d7efe58e013c63b7f0ee6"><div class="ttname"><a href="morale__types_8cpp.html#a7a7fa39cff1d7efe58e013c63b7f0ee6">MORALE_PYROMANIA_STARTFIRE</a></div><div class="ttdeci">const morale_type MORALE_PYROMANIA_STARTFIRE(&quot;morale_pyromania_startfire&quot;)</div></div>
<div class="ttc" id="amorale__types_8cpp_html_ae932ffaaef9c3a4092fc8727141405bf"><div class="ttname"><a href="morale__types_8cpp.html#ae932ffaaef9c3a4092fc8727141405bf">MORALE_PYROMANIA_NOFIRE</a></div><div class="ttdeci">const morale_type MORALE_PYROMANIA_NOFIRE(&quot;morale_pyromania_nofire&quot;)</div></div>
<div class="ttc" id="amorale__types_8h_html"><div class="ttname"><a href="morale__types_8h.html">morale_types.h</a></div></div>
<div class="ttc" id="amtype_8h_html"><div class="ttname"><a href="mtype_8h.html">mtype.h</a></div></div>
<div class="ttc" id="amtype_8h_html_afa4c966d04d2ddb261a7cde725eca842a37c58dddbff266cb28888d8547d91175"><div class="ttname"><a href="mtype_8h.html#afa4c966d04d2ddb261a7cde725eca842a37c58dddbff266cb28888d8547d91175">MF_HARDTOSHOOT</a></div><div class="ttdeci">@ MF_HARDTOSHOOT</div><div class="ttdef"><b>Definition:</b> <a href="mtype_8h_source.html#l00075">mtype.h:75</a></div></div>
<div class="ttc" id="amtype_8h_html_afa4c966d04d2ddb261a7cde725eca842a674d4fc8b69d5ad8a6a2154d471ba941"><div class="ttname"><a href="mtype_8h.html#afa4c966d04d2ddb261a7cde725eca842a674d4fc8b69d5ad8a6a2154d471ba941">MF_RIDEABLE_MECH</a></div><div class="ttdeci">@ MF_RIDEABLE_MECH</div><div class="ttdef"><b>Definition:</b> <a href="mtype_8h_source.html#l00115">mtype.h:115</a></div></div>
<div class="ttc" id="anamespaceanonymous__namespace_02rotatable__symbols_8cpp_03_html_a0828f572b03c625d4b291dd36d0d0a4c"><div class="ttname"><a href="namespaceanonymous__namespace_02rotatable__symbols_8cpp_03.html#a0828f572b03c625d4b291dd36d0d0a4c">anonymous_namespace{rotatable_symbols.cpp}::symbols</a></div><div class="ttdeci">std::vector&lt; rotatable_symbol &gt; symbols</div><div class="ttdef"><b>Definition:</b> <a href="rotatable__symbols_8cpp_source.html#l00030">rotatable_symbols.cpp:30</a></div></div>
<div class="ttc" id="anamespaceavatar__action_html_a76ba74774376a08222b8cdcce08f7304"><div class="ttname"><a href="namespaceavatar__action.html#a76ba74774376a08222b8cdcce08f7304">avatar_action::move</a></div><div class="ttdeci">bool move(avatar &amp;you, map &amp;m, const tripoint &amp;d)</div><div class="ttdef"><b>Definition:</b> <a href="avatar__action_8cpp_source.html#l00093">avatar_action.cpp:93</a></div></div>
<div class="ttc" id="anamespacecalendar_html_a56436e146aa8bdd67857ec0886d89ffe"><div class="ttname"><a href="namespacecalendar.html#a56436e146aa8bdd67857ec0886d89ffe">calendar::config</a></div><div class="ttdeci">calendar_config config</div></div>
<div class="ttc" id="anamespacecalendar_html_ae15fcbf1c971589eb49c1a657fb6a580"><div class="ttname"><a href="namespacecalendar.html#ae15fcbf1c971589eb49c1a657fb6a580">calendar::turn</a></div><div class="ttdeci">time_point turn</div><div class="ttdef"><b>Definition:</b> <a href="calendar_8cpp_source.html#l00036">calendar.cpp:36</a></div></div>
<div class="ttc" id="anamespacecata_1_1hash64__detail_html_a5ca825db6fd06946302c60daa97333e4"><div class="ttname"><a href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">cata::hash64_detail::ret</a></div><div class="ttdeci">T ret</div><div class="ttdef"><b>Definition:</b> <a href="hash__utils_8h_source.html#l00097">hash_utils.h:97</a></div></div>
<div class="ttc" id="anamespacecata_html_ad05314667ac5d05f984aeeef26b9a87f"><div class="ttname"><a href="namespacecata.html#ad05314667ac5d05f984aeeef26b9a87f">cata::nullopt</a></div><div class="ttdeci">static constexpr nullopt_t nullopt</div><div class="ttdef"><b>Definition:</b> <a href="optional_8h_source.html#l00022">optional.h:22</a></div></div>
<div class="ttc" id="anamespacecatacurses_html_a576fd20080b8f49e27acf97af45b374b"><div class="ttname"><a href="namespacecatacurses.html#a576fd20080b8f49e27acf97af45b374b">catacurses::newwin</a></div><div class="ttdeci">window newwin(int nlines, int ncols, const point &amp;begin)</div><div class="ttdef"><b>Definition:</b> <a href="ncurses__def_8cpp_source.html#l00034">ncurses_def.cpp:34</a></div></div>
<div class="ttc" id="anamespacecatacurses_html_a929fe85d472028f52d8a5cdfc0d35017"><div class="ttname"><a href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">catacurses::getmaxx</a></div><div class="ttdeci">int getmaxx(const window &amp;win)</div><div class="ttdef"><b>Definition:</b> <a href="ncurses__def_8cpp_source.html#l00058">ncurses_def.cpp:58</a></div></div>
<div class="ttc" id="anamespacecatacurses_html_aa9823d249c21fa50daf277957fabb175"><div class="ttname"><a href="namespacecatacurses.html#aa9823d249c21fa50daf277957fabb175">catacurses::wnoutrefresh</a></div><div class="ttdeci">void wnoutrefresh(const window &amp;win)</div><div class="ttdef"><b>Definition:</b> <a href="ncurses__def_8cpp_source.html#l00043">ncurses_def.cpp:43</a></div></div>
<div class="ttc" id="anamespacecatacurses_html_abde9c157650e464f0a27441d81c84644"><div class="ttname"><a href="namespacecatacurses.html#abde9c157650e464f0a27441d81c84644">catacurses::mvwprintw</a></div><div class="ttdeci">void mvwprintw(const window &amp;win, const point &amp;p, const std::string &amp;text)</div><div class="ttdef"><b>Definition:</b> <a href="ncurses__def_8cpp_source.html#l00103">ncurses_def.cpp:103</a></div></div>
<div class="ttc" id="anamespacecatacurses_html_adc81ca40445dc062af12fb6d7a4793d0"><div class="ttname"><a href="namespacecatacurses.html#adc81ca40445dc062af12fb6d7a4793d0">catacurses::getmaxy</a></div><div class="ttdeci">int getmaxy(const window &amp;win)</div><div class="ttdef"><b>Definition:</b> <a href="ncurses__def_8cpp_source.html#l00063">ncurses_def.cpp:63</a></div></div>
<div class="ttc" id="anamespacedetail_1_1digits_html_aad69d2373aa047bdd9e81494bf3da5ae"><div class="ttname"><a href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">detail::digits::result</a></div><div class="ttdeci">result</div><div class="ttdef"><b>Definition:</b> <a href="fmtlib__format-inl_8h_source.html#l01626">fmtlib_format-inl.h:1626</a></div></div>
<div class="ttc" id="anamespacedetail_html_a955ad02ade4f07084391a60ed80701bf"><div class="ttname"><a href="namespacedetail.html#a955ad02ade4f07084391a60ed80701bf">detail::normalize</a></div><div class="ttdeci">fp normalize(fp value)</div><div class="ttdef"><b>Definition:</b> <a href="fmtlib__format-inl_8h_source.html#l01223">fmtlib_format-inl.h:1223</a></div></div>
<div class="ttc" id="anamespacedetail_html_ad06b74f7502b63cbab323bba1ca3f72b"><div class="ttname"><a href="namespacedetail.html#ad06b74f7502b63cbab323bba1ca3f72b">detail::find</a></div><div class="ttdeci">FMT_CONSTEXPR bool find(Ptr first, Ptr last, T value, Ptr &amp;out)</div><div class="ttdef"><b>Definition:</b> <a href="fmtlib__format_8h_source.html#l03355">fmtlib_format.h:3355</a></div></div>
<div class="ttc" id="anamespaceenchant__vals_html_acd6a6ebb27f9ecb82b3bce1d3aef2998"><div class="ttname"><a href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">enchant_vals::mod</a></div><div class="ttdeci">mod</div><div class="ttdef"><b>Definition:</b> <a href="magic__enchantment_8h_source.html#l00026">magic_enchantment.h:26</a></div></div>
<div class="ttc" id="anamespaceiexamine_html_ab9103bcb0e9cb4755b445e5395a0a62f"><div class="ttname"><a href="namespaceiexamine.html#ab9103bcb0e9cb4755b445e5395a0a62f">iexamine::transform</a></div><div class="ttdeci">void transform(player &amp;p, const tripoint &amp;pos)</div><div class="ttdoc">Transform the examined object into the object specified by its transforms_into property.</div><div class="ttdef"><b>Definition:</b> <a href="iexamine_8cpp_source.html#l01590">iexamine.cpp:1590</a></div></div>
<div class="ttc" id="anamespaceom__direction_html_af97f9dbddaa758278662da3478826c61"><div class="ttname"><a href="namespaceom__direction.html#af97f9dbddaa758278662da3478826c61">om_direction::size</a></div><div class="ttdeci">const size_t size</div><div class="ttdef"><b>Definition:</b> <a href="om__direction_8h_source.html#l00027">om_direction.h:27</a></div></div>
<div class="ttc" id="anamespaceranged_html"><div class="ttname"><a href="namespaceranged.html">ranged</a></div><div class="ttdef"><b>Definition:</b> <a href="animation_8cpp_source.html#l01074">animation.cpp:1075</a></div></div>
<div class="ttc" id="anamespaceranged_html_a32d7ead84f4eb01b4050fdbbca0767ea"><div class="ttname"><a href="namespaceranged.html#a32d7ead84f4eb01b4050fdbbca0767ea">ranged::str_draw_damage_modifier</a></div><div class="ttdeci">float str_draw_damage_modifier(const item &amp;it, const Character &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01008">ranged.cpp:1008</a></div></div>
<div class="ttc" id="anamespaceranged_html_a3fc846128cfc30100d71fbb6e2d482c5"><div class="ttname"><a href="namespaceranged.html#a3fc846128cfc30100d71fbb6e2d482c5">ranged::targetable_creatures</a></div><div class="ttdeci">std::vector&lt; Creature * &gt; targetable_creatures(const Character &amp;c, const int range)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02070">ranged.cpp:2070</a></div></div>
<div class="ttc" id="anamespaceranged_html_a4c8c85e0249f67213d9994612315aa3e"><div class="ttname"><a href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">ranged::get_str_draw_penalty</a></div><div class="ttdeci">float get_str_draw_penalty(const item &amp;it, const Character &amp;p)</div><div class="ttdoc">Penalties potentially incurred by STR_DRAW weapons.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00996">ranged.cpp:996</a></div></div>
<div class="ttc" id="anamespaceranged_html_a5332ed56c9f0b3702e72aecdcaa1e7be"><div class="ttname"><a href="namespaceranged.html#a5332ed56c9f0b3702e72aecdcaa1e7be">ranged::burst_penalty</a></div><div class="ttdeci">int burst_penalty(const Character &amp;p, const item &amp;gun, int gun_recoil)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02132">ranged.cpp:2132</a></div></div>
<div class="ttc" id="anamespaceranged_html_a54895869f69a00b4a74df15057a9a780"><div class="ttname"><a href="namespaceranged.html#a54895869f69a00b4a74df15057a9a780">ranged::throwing_dispersion</a></div><div class="ttdeci">int throwing_dispersion(const Character &amp;c, const item &amp;to_throw, Creature *critter, bool is_blind_throw)</div><div class="ttdoc">Dispersion of a thrown item, against a given target, taking into account whether or not the throw was...</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01062">ranged.cpp:1062</a></div></div>
<div class="ttc" id="anamespaceranged_html_a581c5c797384eeec8c7e3ffe10a82d26"><div class="ttname"><a href="namespaceranged.html#a581c5c797384eeec8c7e3ffe10a82d26">ranged::throw_cost</a></div><div class="ttdeci">int throw_cost(const player &amp;c, const item &amp;to_throw)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00967">ranged.cpp:967</a></div></div>
<div class="ttc" id="anamespaceranged_html_a613a2847b3c06998d6117f2630fc9ed5"><div class="ttname"><a href="namespaceranged.html#a613a2847b3c06998d6117f2630fc9ed5">ranged::str_draw_dispersion_modifier</a></div><div class="ttdeci">float str_draw_dispersion_modifier(const item &amp;it, const Character &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01022">ranged.cpp:1022</a></div></div>
<div class="ttc" id="anamespaceranged_html_a743f9e35b20c136e56ca9e9480fb27bc"><div class="ttname"><a href="namespaceranged.html#a743f9e35b20c136e56ca9e9480fb27bc">ranged::gunmode_checks_weapon</a></div><div class="ttdeci">bool gunmode_checks_weapon(avatar &amp;you, const map &amp;m, std::vector&lt; std::string &gt; &amp;messages, const gun_mode &amp;gmode)</div><div class="ttdoc">Various checks for gunmode when firing a weapon.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03695">ranged.cpp:3695</a></div></div>
<div class="ttc" id="anamespaceranged_html_a7b4da33d1d9391123845f299f1f156dc"><div class="ttname"><a href="namespaceranged.html#a7b4da33d1d9391123845f299f1f156dc">ranged::expected_coverage</a></div><div class="ttdeci">std::map&lt; tripoint, double &gt; expected_coverage(const shape &amp;sh, const map &amp;here, int bash_power)</div><div class="ttdef"><b>Definition:</b> <a href="ranged__aoe_8cpp_source.html#l00129">ranged_aoe.cpp:129</a></div></div>
<div class="ttc" id="anamespaceranged_html_aa7a46e309ff8892e692a92511635a4eb"><div class="ttname"><a href="namespaceranged.html#aa7a46e309ff8892e692a92511635a4eb">ranged::str_draw_range_modifier</a></div><div class="ttdeci">float str_draw_range_modifier(const item &amp;it, const Character &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01034">ranged.cpp:1034</a></div></div>
<div class="ttc" id="anamespaceranged_html_abf8b46e1f1dae2e7a3d4ff75b9495026"><div class="ttname"><a href="namespaceranged.html#abf8b46e1f1dae2e7a3d4ff75b9495026">ranged::handle_gun_damage</a></div><div class="ttdeci">bool handle_gun_damage(Character &amp;shooter, item &amp;it)</div><div class="ttdoc">Returns true if a gun misfires, jams, or has other problems, else returns false.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00589">ranged.cpp:589</a></div></div>
<div class="ttc" id="anamespaceranged_html_ade9b38890f46ab6cbe94e1004f0ea5f1"><div class="ttname"><a href="namespaceranged.html#ade9b38890f46ab6cbe94e1004f0ea5f1">ranged::execute_shaped_attack</a></div><div class="ttdeci">void execute_shaped_attack(const shape &amp;sh, const projectile &amp;proj, Creature &amp;attacker)</div><div class="ttdoc">AoE attack, with area given by shape.</div><div class="ttdef"><b>Definition:</b> <a href="ranged__aoe_8cpp_source.html#l00044">ranged_aoe.cpp:44</a></div></div>
<div class="ttc" id="anamespaceranged_html_ae7778ea8feb8352ac65fe74e81164ebc"><div class="ttname"><a href="namespaceranged.html#ae7778ea8feb8352ac65fe74e81164ebc">ranged::prompt_select_default_ammo_for</a></div><div class="ttdeci">void prompt_select_default_ammo_for(avatar &amp;u, const item &amp;w)</div><div class="ttdoc">Prompts to select default ammo compatible with provided gun.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03754">ranged.cpp:3754</a></div></div>
<div class="ttc" id="anamespaceranged_html_aed4420a1fd77e160a72de2a528e56da5"><div class="ttname"><a href="namespaceranged.html#aed4420a1fd77e160a72de2a528e56da5">ranged::gunmode_checks_common</a></div><div class="ttdeci">bool gunmode_checks_common(avatar &amp;you, const map &amp;m, std::vector&lt; std::string &gt; &amp;messages, const gun_mode &amp;gmode)</div><div class="ttdoc">Common checks for gunmode (when firing a weapon / manually firing turret)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03659">ranged.cpp:3659</a></div></div>
<div class="ttc" id="anamespaceranged_html_afd6b1338d47e5ecd34de75b921c11113"><div class="ttname"><a href="namespaceranged.html#afd6b1338d47e5ecd34de75b921c11113">ranged::throw_dispersion_per_dodge</a></div><div class="ttdeci">int throw_dispersion_per_dodge(const Character &amp;c, bool add_encumbrance)</div><div class="ttdoc">How much dispersion does one point of target's dodge add when throwing at said target?</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01048">ranged.cpp:1048</a></div></div>
<div class="ttc" id="anamespacesfx_html_a1f138eaa92db132e81ce591751c512cc"><div class="ttname"><a href="namespacesfx.html#a1f138eaa92db132e81ce591751c512cc">sfx::get_heard_volume</a></div><div class="ttdeci">int get_heard_volume(const tripoint &amp;source)</div><div class="ttdoc">Functions from sfx that do not use the SDL_mixer API at all.</div><div class="ttdef"><b>Definition:</b> <a href="sounds_8cpp_source.html#l01643">sounds.cpp:1643</a></div></div>
<div class="ttc" id="anamespacesfx_html_a8fa2bb887ac81392fb686cc4079b5d5a"><div class="ttname"><a href="namespacesfx.html#a8fa2bb887ac81392fb686cc4079b5d5a">sfx::play_variant_sound</a></div><div class="ttdeci">void play_variant_sound(const std::string &amp;id, const std::string &amp;variant, int volume, units::angle angle, double pitch_min=-1.0, double pitch_max=-1.0)</div><div class="ttdef"><b>Definition:</b> <a href="sounds_8cpp_source.html#l01599">sounds.cpp:1599</a></div></div>
<div class="ttc" id="anamespacesfx_html_aa186eb63210729f73d7c76dcda527ff5"><div class="ttname"><a href="namespacesfx.html#aa186eb63210729f73d7c76dcda527ff5">sfx::get_heard_angle</a></div><div class="ttdeci">units::angle get_heard_angle(const tripoint &amp;source)</div><div class="ttdef"><b>Definition:</b> <a href="sounds_8cpp_source.html#l01656">sounds.cpp:1656</a></div></div>
<div class="ttc" id="anamespacesfx_html_ae07ec6b40b7da8acd1d5386ea3a8e41f"><div class="ttname"><a href="namespacesfx.html#ae07ec6b40b7da8acd1d5386ea3a8e41f">sfx::generate_gun_sound</a></div><div class="ttdeci">void generate_gun_sound(const player &amp;source_arg, const item &amp;firing)</div><div class="ttdef"><b>Definition:</b> <a href="sounds_8cpp_source.html#l01606">sounds.cpp:1606</a></div></div>
<div class="ttc" id="anamespacesounds_html_a6bb79ae1c9c3dcd8c8e0b28c66b0398d"><div class="ttname"><a href="namespacesounds.html#a6bb79ae1c9c3dcd8c8e0b28c66b0398d">sounds::sound</a></div><div class="ttdeci">void sound(const tripoint &amp;p, int vol, sound_t category, const std::string &amp;description, bool ambient=false, const std::string &amp;id=&quot;&quot;, const std::string &amp;variant=&quot;default&quot;)</div><div class="ttdoc">Sound at (p) of intensity (vol)</div><div class="ttdef"><b>Definition:</b> <a href="sounds_8cpp_source.html#l00177">sounds.cpp:177</a></div></div>
<div class="ttc" id="anamespacesounds_html_af6b3d144906d9ccfda6824fb87e46aa3ac222ae0d4e9c59bd254b72521b9e74ed"><div class="ttname"><a href="namespacesounds.html#af6b3d144906d9ccfda6824fb87e46aa3ac222ae0d4e9c59bd254b72521b9e74ed">sounds::sound_t::combat</a></div><div class="ttdeci">@ combat</div></div>
<div class="ttc" id="anamespacespell__effect_html_a0e09e84c2b7a257a455b3e9fc3593b4b"><div class="ttname"><a href="namespacespell__effect.html#a0e09e84c2b7a257a455b3e9fc3593b4b">spell_effect::spell_effect_cone</a></div><div class="ttdeci">std::set&lt; tripoint &gt; spell_effect_cone(const spell &amp;sp, const tripoint &amp;source, const tripoint &amp;target, int aoe_radius, bool ignore_walls)</div><div class="ttdef"><b>Definition:</b> <a href="magic__spell__effect_8cpp_source.html#l00192">magic_spell_effect.cpp:192</a></div></div>
<div class="ttc" id="anamespacespell__effect_html_aa36a2d7d3cb5678aa8b0eb00c0ba7c0d"><div class="ttname"><a href="namespacespell__effect.html#aa36a2d7d3cb5678aa8b0eb00c0ba7c0d">spell_effect::spell_effect_line</a></div><div class="ttdeci">std::set&lt; tripoint &gt; spell_effect_line(const spell &amp;, const tripoint &amp;source, const tripoint &amp;target, int aoe_radius, bool ignore_walls)</div><div class="ttdef"><b>Definition:</b> <a href="magic__spell__effect_8cpp_source.html#l00236">magic_spell_effect.cpp:236</a></div></div>
<div class="ttc" id="anamespacespell__effect_html_aeba26a51ccbe0af305962188ede8c6cd"><div class="ttname"><a href="namespacespell__effect.html#aeba26a51ccbe0af305962188ede8c6cd">spell_effect::spell_effect_blast</a></div><div class="ttdeci">std::set&lt; tripoint &gt; spell_effect_blast(const spell &amp;, const tripoint &amp;, const tripoint &amp;target, int aoe_radius, bool ignore_walls)</div><div class="ttdef"><b>Definition:</b> <a href="magic__spell__effect_8cpp_source.html#l00179">magic_spell_effect.cpp:179</a></div></div>
<div class="ttc" id="anamespacetarget__handler_html_a10911d1ab9fa4b1484138f1bc379baa5"><div class="ttname"><a href="namespacetarget__handler.html#a10911d1ab9fa4b1484138f1bc379baa5">target_handler::mode_spell</a></div><div class="ttdeci">trajectory mode_spell(avatar &amp;you, spell &amp;casting, bool no_fail, bool no_mana)</div><div class="ttdoc">Casting a spell.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00493">ranged.cpp:493</a></div></div>
<div class="ttc" id="anamespacetarget__handler_html_a15e531943e7385d987d87f82f5957821"><div class="ttname"><a href="namespacetarget__handler.html#a15e531943e7385d987d87f82f5957821">target_handler::mode_fire</a></div><div class="ttdeci">trajectory mode_fire(avatar &amp;you, aim_activity_actor &amp;activity)</div><div class="ttdoc">Firing ranged weapon.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00419">ranged.cpp:419</a></div></div>
<div class="ttc" id="anamespacetarget__handler_html_a3371a56d7b45012072236fb97eda5cc0"><div class="ttname"><a href="namespacetarget__handler.html#a3371a56d7b45012072236fb97eda5cc0">target_handler::mode_turrets</a></div><div class="ttdeci">trajectory mode_turrets(avatar &amp;you, vehicle &amp;veh, const std::vector&lt; vehicle_part * &gt; &amp;turrets)</div><div class="ttdoc">Selecting target for turrets (when using vehicle controls)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00464">ranged.cpp:464</a></div></div>
<div class="ttc" id="anamespacetarget__handler_html_a9f06978559f45ddb20b5a1caec3f9c1f"><div class="ttname"><a href="namespacetarget__handler.html#a9f06978559f45ddb20b5a1caec3f9c1f">target_handler::mode_turret_manual</a></div><div class="ttdeci">trajectory mode_turret_manual(avatar &amp;you, turret_data &amp;turret)</div><div class="ttdoc">Manually firing vehicle turret.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00453">ranged.cpp:453</a></div></div>
<div class="ttc" id="anamespacetarget__handler_html_abf6b4d399e1ef6b51df0dc4621a5720d"><div class="ttname"><a href="namespacetarget__handler.html#abf6b4d399e1ef6b51df0dc4621a5720d">target_handler::mode_throw</a></div><div class="ttdeci">trajectory mode_throw(avatar &amp;you, item &amp;relevant, bool blind_throwing)</div><div class="ttdoc">Throwing item.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00430">ranged.cpp:430</a></div></div>
<div class="ttc" id="anamespacetarget__handler_html_ae136ff6d4342c12df1e97cb622426869"><div class="ttname"><a href="namespacetarget__handler.html#ae136ff6d4342c12df1e97cb622426869">target_handler::mode_shaped</a></div><div class="ttdeci">trajectory mode_shaped(avatar &amp;you, shape_factory &amp;shape_fac, aim_activity_actor &amp;activity)</div><div class="ttdoc">Executing an AoE attack given by shape.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00507">ranged.cpp:507</a></div></div>
<div class="ttc" id="anamespacetarget__handler_html_aea843144f5e69546ddea88eeda177640"><div class="ttname"><a href="namespacetarget__handler.html#aea843144f5e69546ddea88eeda177640">target_handler::trajectory</a></div><div class="ttdeci">std::vector&lt; tripoint &gt; trajectory</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8h_source.html#l00032">ranged.h:32</a></div></div>
<div class="ttc" id="anamespacetarget__handler_html_aeab5385d86293c622a3796625364be16"><div class="ttname"><a href="namespacetarget__handler.html#aeab5385d86293c622a3796625364be16">target_handler::mode_reach</a></div><div class="ttdeci">trajectory mode_reach(avatar &amp;you, item &amp;weapon)</div><div class="ttdoc">Reach attacking.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00442">ranged.cpp:442</a></div></div>
<div class="ttc" id="anamespaceui__manager_html_ae38f3a918052ef286ee60daac47f52d4"><div class="ttname"><a href="namespaceui__manager.html#ae38f3a918052ef286ee60daac47f52d4">ui_manager::redraw</a></div><div class="ttdeci">void redraw()</div><div class="ttdef"><b>Definition:</b> <a href="ui__manager_8cpp_source.html#l00285">ui_manager.cpp:285</a></div></div>
<div class="ttc" id="anamespaceui_html"><div class="ttname"><a href="namespaceui.html">ui</a></div><div class="ttdef"><b>Definition:</b> <a href="overmap__ui_8h_source.html#l00016">overmap_ui.h:17</a></div></div>
<div class="ttc" id="anamespaceunits_html_a144476d36f26d6e1916493c3636d54dc"><div class="ttname"><a href="namespaceunits.html#a144476d36f26d6e1916493c3636d54dc">units::to_milliliter</a></div><div class="ttdeci">constexpr value_type to_milliliter(const quantity&lt; value_type, volume_in_milliliter_tag &gt; &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="units__volume_8h_source.html#l00038">units_volume.h:38</a></div></div>
<div class="ttc" id="anamespaceunits_html_a1bd284bde31c6b9124add6c8362c8a90"><div class="ttname"><a href="namespaceunits.html#a1bd284bde31c6b9124add6c8362c8a90">units::to_radians</a></div><div class="ttdeci">constexpr double to_radians(const units::angle v)</div><div class="ttdef"><b>Definition:</b> <a href="units__angle_8h_source.html#l00025">units_angle.h:25</a></div></div>
<div class="ttc" id="anamespaceunits_html_a2c7fe916bf04655f9fb4f2abdc5d28ed"><div class="ttname"><a href="namespaceunits.html#a2c7fe916bf04655f9fb4f2abdc5d28ed">units::angle</a></div><div class="ttdeci">quantity&lt; double, angle_in_radians_tag &gt; angle</div><div class="ttdef"><b>Definition:</b> <a href="units__angle_8h_source.html#l00017">units_angle.h:17</a></div></div>
<div class="ttc" id="anamespaceunits_html_a5d16607c866588620acb381e7dbbf0a6"><div class="ttname"><a href="namespaceunits.html#a5d16607c866588620acb381e7dbbf0a6">units::volume</a></div><div class="ttdeci">quantity&lt; int, volume_in_milliliter_tag &gt; volume</div><div class="ttdef"><b>Definition:</b> <a href="units__volume_8h_source.html#l00016">units_volume.h:16</a></div></div>
<div class="ttc" id="anamespaceunits_html_a8306911daadc1a4d7a7b46e9786f4a4c"><div class="ttname"><a href="namespaceunits.html#a8306911daadc1a4d7a7b46e9786f4a4c">units::to_gram</a></div><div class="ttdeci">constexpr value_type to_gram(const quantity&lt; value_type, mass_in_milligram_tag &gt; &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="units__mass_8h_source.html#l00067">units_mass.h:67</a></div></div>
<div class="ttc" id="anamespaceunits_html_a8841cc418c4abd052eab82f152a5af07"><div class="ttname"><a href="namespaceunits.html#a8841cc418c4abd052eab82f152a5af07">units::from_arcmin</a></div><div class="ttdeci">constexpr quantity&lt; double, angle_in_radians_tag &gt; from_arcmin(const value_type v)</div><div class="ttdef"><b>Definition:</b> <a href="units__angle_8h_source.html#l00042">units_angle.h:42</a></div></div>
<div class="ttc" id="anamespaceunits_html_a9ce2bc1618fa4acf9f9e98effd9f1ae0"><div class="ttname"><a href="namespaceunits.html#a9ce2bc1618fa4acf9f9e98effd9f1ae0">units::to_degrees</a></div><div class="ttdeci">constexpr double to_degrees(const units::angle v)</div><div class="ttdef"><b>Definition:</b> <a href="units__angle_8h_source.html#l00036">units_angle.h:36</a></div></div>
<div class="ttc" id="anamespaceunits_html_ada24d52c1ffd0df8d52a363d013d3231"><div class="ttname"><a href="namespaceunits.html#ada24d52c1ffd0df8d52a363d013d3231">units::from_kilojoule</a></div><div class="ttdeci">constexpr quantity&lt; value_type, energy_in_joule_tag &gt; from_kilojoule(const value_type v)</div><div class="ttdef"><b>Definition:</b> <a href="units__energy_8h_source.html#l00032">units_energy.h:32</a></div></div>
<div class="ttc" id="anpc_8h_html"><div class="ttname"><a href="npc_8h.html">npc.h</a></div></div>
<div class="ttc" id="aoptional_8h_html"><div class="ttname"><a href="optional_8h.html">optional.h</a></div></div>
<div class="ttc" id="aoptions_8h_html"><div class="ttname"><a href="options_8h.html">options.h</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_a000abea6447dfafd5f9b787aa6753609"><div class="ttname"><a href="output_8cpp.html#a000abea6447dfafd5f9b787aa6753609">TERMX</a></div><div class="ttdeci">int TERMX</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l00047">output.cpp:47</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_a1184e3eda011b110d09bf2dcf08228f5"><div class="ttname"><a href="output_8cpp.html#a1184e3eda011b110d09bf2dcf08228f5">mvwprintz</a></div><div class="ttdeci">void mvwprintz(const catacurses::window &amp;w, const point &amp;p, const nc_color &amp;FG, const std::string &amp;text)</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l02035">output.cpp:2035</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_a2f8515020638461e15374b3bf6555c75"><div class="ttname"><a href="output_8cpp.html#a2f8515020638461e15374b3bf6555c75">fold_and_print_from</a></div><div class="ttdeci">int fold_and_print_from(const catacurses::window &amp;w, const point &amp;begin, int width, int begin_line, const nc_color &amp;base_color, const std::string &amp;text)</div><div class="ttdoc">Like fold_and_print, but starts the output with the N-th line of the folded string.</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l00311">output.cpp:311</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_a567a63be8cb70cc3eb47bf8affced8e5"><div class="ttname"><a href="output_8cpp.html#a567a63be8cb70cc3eb47bf8affced8e5">TERMY</a></div><div class="ttdeci">int TERMY</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l00048">output.cpp:48</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_a9fcad5b904c8019b15fe1ac8e665a1cb"><div class="ttname"><a href="output_8cpp.html#a9fcad5b904c8019b15fe1ac8e665a1cb">print_colored_text</a></div><div class="ttdeci">void print_colored_text(const catacurses::window &amp;w, const point &amp;p, nc_color &amp;color, const nc_color &amp;base_color, const std::string &amp;text, const report_color_error color_error)</div><div class="ttdoc">Print text with embedded color_tags, x, y are in curses system.</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l00185">output.cpp:185</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_aa6093ccb0ebc7f7ee1f11edd5cc2711c"><div class="ttname"><a href="output_8cpp.html#aa6093ccb0ebc7f7ee1f11edd5cc2711c">right_print</a></div><div class="ttdeci">int right_print(const catacurses::window &amp;w, const int line, const int right_indent, const nc_color &amp;FG, const std::string &amp;text)</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l00461">output.cpp:461</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_ab62599a77867b8f416669b92f60f4900"><div class="ttname"><a href="output_8cpp.html#ab62599a77867b8f416669b92f60f4900">query_yn</a></div><div class="ttdeci">bool query_yn(const std::string &amp;text)</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l00698">output.cpp:698</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_ab7abbbd98907f496533db9bc2a02cf4a"><div class="ttname"><a href="output_8cpp.html#ab7abbbd98907f496533db9bc2a02cf4a">trim_and_print</a></div><div class="ttdeci">void trim_and_print(const catacurses::window &amp;w, const point &amp;begin, const int width, const nc_color &amp;base_color, const std::string &amp;text, const report_color_error color_error)</div><div class="ttdoc">Prints a single line of text.</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l00214">output.cpp:214</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_ab9659cbe9ec23a2efd813f795cb7fb73"><div class="ttname"><a href="output_8cpp.html#ab9659cbe9ec23a2efd813f795cb7fb73">fold_and_print</a></div><div class="ttdeci">int fold_and_print(const catacurses::window &amp;w, const point &amp;begin, int width, const nc_color &amp;base_color, const std::string &amp;text, const char split)</div><div class="ttdoc">Fold and print text in the given window.</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l00299">output.cpp:299</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_add34b080694a5b887cf3b201051bf1c0"><div class="ttname"><a href="output_8cpp.html#add34b080694a5b887cf3b201051bf1c0">get_labeled_bar</a></div><div class="ttdeci">std::string get_labeled_bar(const double val, const int width, const std::string &amp;label, char c)</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l01641">output.cpp:1641</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_add4e31deb8a6e0444b89c79343c34a9c"><div class="ttname"><a href="output_8cpp.html#add4e31deb8a6e0444b89c79343c34a9c">insert_table</a></div><div class="ttdeci">void insert_table(const catacurses::window &amp;w, int pad, int line, int columns, const nc_color &amp;FG, const std::string &amp;divider, bool r_align, const std::vector&lt; std::string &gt; &amp;data)</div><div class="ttdoc">Inserts a table into a window, with data right-aligned.</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l01659">output.cpp:1659</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_aedec608a42edd33ec812f7769a9ed0c9"><div class="ttname"><a href="output_8cpp.html#aedec608a42edd33ec812f7769a9ed0c9">wprintz</a></div><div class="ttdeci">void wprintz(const catacurses::window &amp;w, const nc_color &amp;FG, const std::string &amp;text)</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l02043">output.cpp:2043</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_afb5597c87a5847c7d64b878ab3a77d5b"><div class="ttname"><a href="output_8cpp.html#afb5597c87a5847c7d64b878ab3a77d5b">mvwputch</a></div><div class="ttdeci">void mvwputch(const catacurses::window &amp;w, const point &amp;p, nc_color FG, int ch)</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l00477">output.cpp:477</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_afea9968fcee47ebca0e45d27099d1c22"><div class="ttname"><a href="output_8cpp.html#afea9968fcee47ebca0e45d27099d1c22">draw_border</a></div><div class="ttdeci">void draw_border(const catacurses::window &amp;w, nc_color border_color, const std::string &amp;title, nc_color title_color)</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l00575">output.cpp:575</a></div></div>
<div class="ttc" id="aoutput_8h_html"><div class="ttname"><a href="output_8h.html">output.h</a></div></div>
<div class="ttc" id="aoutput_8h_html_a17a93de390fc2504e63ab6dc8cf4753aa334c4a4c42fdb79d7ebc3e73b517e6f8"><div class="ttname"><a href="output_8h.html#a17a93de390fc2504e63ab6dc8cf4753aa334c4a4c42fdb79d7ebc3e73b517e6f8">enumeration_conjunction::none</a></div><div class="ttdeci">@ none</div></div>
<div class="ttc" id="aoutput_8h_html_abc4022ff920f936d2ee400cedc458733"><div class="ttname"><a href="output_8h.html#abc4022ff920f936d2ee400cedc458733">enumerate_as_string</a></div><div class="ttdeci">std::string enumerate_as_string(const _Container &amp;values, enumeration_conjunction conj=enumeration_conjunction::and_)</div><div class="ttdef"><b>Definition:</b> <a href="output_8h_source.html#l00679">output.h:679</a></div></div>
<div class="ttc" id="apanels_8h_html"><div class="ttname"><a href="panels_8h.html">panels.h</a></div></div>
<div class="ttc" id="aplayer_8h_html"><div class="ttname"><a href="player_8h.html">player.h</a></div></div>
<div class="ttc" id="aplayer__activity_8h_html"><div class="ttname"><a href="player__activity_8h.html">player_activity.h</a></div></div>
<div class="ttc" id="apoint_8h_html"><div class="ttname"><a href="point_8h.html">point.h</a></div></div>
<div class="ttc" id="apoint_8h_html_a4b1a6bcaa42d2c06ecc3afc63305bfdf"><div class="ttname"><a href="point_8h.html#a4b1a6bcaa42d2c06ecc3afc63305bfdf">tripoint_zero</a></div><div class="ttdeci">static constexpr tripoint tripoint_zero</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00273">point.h:273</a></div></div>
<div class="ttc" id="aprojectile_8h_html"><div class="ttname"><a href="projectile_8h.html">projectile.h</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a02a98acfc0759dc42a3683ec82f936a9"><div class="ttname"><a href="ranged_8cpp.html#a02a98acfc0759dc42a3683ec82f936a9">ammo_effect_EMP</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_EMP(&quot;EMP&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a02edfa7a6cb1a0f7a67ae1aca7a34753"><div class="ttname"><a href="ranged_8cpp.html#a02edfa7a6cb1a0f7a67ae1aca7a34753">flag_FIRE_TWOHAND</a></div><div class="ttdeci">static const std::string flag_FIRE_TWOHAND(&quot;FIRE_TWOHAND&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a08481f62adb6937636ea44b855311037"><div class="ttname"><a href="ranged_8cpp.html#a08481f62adb6937636ea44b855311037">effect_downed</a></div><div class="ttdeci">static const efftype_id effect_downed(&quot;downed&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a08cb2ed99917b1260118f74991ece915"><div class="ttname"><a href="ranged_8cpp.html#a08cb2ed99917b1260118f74991ece915">flag_VEHICLE</a></div><div class="ttdeci">static const std::string flag_VEHICLE(&quot;VEHICLE&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a08fa47ab74c2457fe092efe94c352dd7"><div class="ttname"><a href="ranged_8cpp.html#a08fa47ab74c2457fe092efe94c352dd7">ammo_effect_WHIP</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_WHIP(&quot;WHIP&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a0919705e5cea2aa623cbda27d0cae0b6"><div class="ttname"><a href="ranged_8cpp.html#a0919705e5cea2aa623cbda27d0cae0b6">bio_targeting</a></div><div class="ttdeci">static const bionic_id bio_targeting(&quot;bio_targeting&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a0c6f7a1d7eeb2c38d69b568d85eb9f0d"><div class="ttname"><a href="ranged_8cpp.html#a0c6f7a1d7eeb2c38d69b568d85eb9f0d">skill_launcher</a></div><div class="ttdeci">static const skill_id skill_launcher(&quot;launcher&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a0ccb4d60ab6785e534c7eaa8ad7d07c6"><div class="ttname"><a href="ranged_8cpp.html#a0ccb4d60ab6785e534c7eaa8ad7d07c6">itype_brass_catcher</a></div><div class="ttdeci">static const itype_id itype_brass_catcher(&quot;brass_catcher&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a0d9e38138df960f8f724b45c5e3c1204"><div class="ttname"><a href="ranged_8cpp.html#a0d9e38138df960f8f724b45c5e3c1204">print_ranged_chance</a></div><div class="ttdeci">static int print_ranged_chance(const player &amp;, const catacurses::window &amp;w, int line_number, input_context &amp;ctxt, const item &amp;, const std::vector&lt; aim_type &gt; &amp;aim_types, const std::function&lt; dispersion_sources(const aim_type &amp;)&gt; &amp;dispersion_fun, const std::function&lt; int(const aim_type &amp;)&gt; &amp;cost_fun, const std::vector&lt; confidence_rating &gt; &amp;confidence_config, double range, double target_size)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01369">ranged.cpp:1369</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a0ea533037e4a6a02394d39e2d62174bc"><div class="ttname"><a href="ranged_8cpp.html#a0ea533037e4a6a02394d39e2d62174bc">fault_gun_dirt</a></div><div class="ttdeci">static const fault_id fault_gun_dirt(&quot;fault_gun_dirt&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a170041722ca59caad52f34270eb5f183"><div class="ttname"><a href="ranged_8cpp.html#a170041722ca59caad52f34270eb5f183">is_driving</a></div><div class="ttdeci">static bool is_driving(const player &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01854">ranged.cpp:1854</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a17d7acb18d1ef9119106898d678fac76"><div class="ttname"><a href="ranged_8cpp.html#a17d7acb18d1ef9119106898d678fac76">ammo_effect_LIGHTNING</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_LIGHTNING(&quot;LIGHTNING&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a1c359a305b979b2e5fc87d15db51e903"><div class="ttname"><a href="ranged_8cpp.html#a1c359a305b979b2e5fc87d15db51e903">itype_adv_UPS_off</a></div><div class="ttdeci">static const itype_id itype_adv_UPS_off(&quot;adv_UPS_off&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a1d5482b7403ee4ac3e70e88ecfee2141"><div class="ttname"><a href="ranged_8cpp.html#a1d5482b7403ee4ac3e70e88ecfee2141">skill_dodge</a></div><div class="ttdeci">static const skill_id skill_dodge(&quot;dodge&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a217238d7885e55ae74878bbb1f99cddd"><div class="ttname"><a href="ranged_8cpp.html#a217238d7885e55ae74878bbb1f99cddd">dispersion_from_skill</a></div><div class="ttdeci">static double dispersion_from_skill(double skill, double weapon_dispersion)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01860">ranged.cpp:1860</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a21b633b2e3ce24798652a8392b2be96e"><div class="ttname"><a href="ranged_8cpp.html#a21b633b2e3ce24798652a8392b2be96e">itype_12mm</a></div><div class="ttdeci">static const itype_id itype_12mm(&quot;12mm&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a26f773999c96865544c00b5496637d56"><div class="ttname"><a href="ranged_8cpp.html#a26f773999c96865544c00b5496637d56">tr_practice_target</a></div><div class="ttdeci">static const trap_str_id tr_practice_target(&quot;tr_practice_target&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a2e072a7b4bbd9c0deff64e0a8f1ffb85"><div class="ttname"><a href="ranged_8cpp.html#a2e072a7b4bbd9c0deff64e0a8f1ffb85">draw_throw_aim</a></div><div class="ttdeci">static int draw_throw_aim(const player &amp;p, const catacurses::window &amp;w, int line_number, input_context &amp;ctxt, const item &amp;weapon, const tripoint &amp;target_pos, bool is_blind_throw)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01588">ranged.cpp:1588</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a2e2f893aee74eb40d2c1609963133838"><div class="ttname"><a href="ranged_8cpp.html#a2e2f893aee74eb40d2c1609963133838">ammo_effect_BOUNCE</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_BOUNCE(&quot;BOUNCE&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a30c9d25adcf2167a8bff0fe6ca21fdaf"><div class="ttname"><a href="ranged_8cpp.html#a30c9d25adcf2167a8bff0fe6ca21fdaf">flag_RELOAD_AND_SHOOT</a></div><div class="ttdeci">static const std::string flag_RELOAD_AND_SHOOT(&quot;RELOAD_AND_SHOOT&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a31e6d6147ad05dd584d1f1e71ac5dce7"><div class="ttname"><a href="ranged_8cpp.html#a31e6d6147ad05dd584d1f1e71ac5dce7">itype_flammable</a></div><div class="ttdeci">static const itype_id itype_flammable(&quot;flammable&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a336ae362f6bd28ffde9cd73ccf9be4ae"><div class="ttname"><a href="ranged_8cpp.html#a336ae362f6bd28ffde9cd73ccf9be4ae">ammo_effect_BURST</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_BURST(&quot;BURST&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a3756f1dde5d862fe1b0f0240dfc13e6a"><div class="ttname"><a href="ranged_8cpp.html#a3756f1dde5d862fe1b0f0240dfc13e6a">flag_STR_DRAW</a></div><div class="ttdeci">static const std::string flag_STR_DRAW(&quot;STR_DRAW&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a3be9304af3e12dfef2f28becb7b93011"><div class="ttname"><a href="ranged_8cpp.html#a3be9304af3e12dfef2f28becb7b93011">effect_on_roof</a></div><div class="ttdeci">static const efftype_id effect_on_roof(&quot;on_roof&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a3eadead4a9aa7fee079c0b1acce7965e"><div class="ttname"><a href="ranged_8cpp.html#a3eadead4a9aa7fee079c0b1acce7965e">skill_gun</a></div><div class="ttdeci">static const skill_id skill_gun(&quot;gun&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a45b1f02f143134444fdec57043934598"><div class="ttname"><a href="ranged_8cpp.html#a45b1f02f143134444fdec57043934598">itype_m235</a></div><div class="ttdeci">static const itype_id itype_m235(&quot;m235&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a463802d3c2fe3f6d4ba8cc36a77912c7"><div class="ttname"><a href="ranged_8cpp.html#a463802d3c2fe3f6d4ba8cc36a77912c7">occupied_tile_fraction</a></div><div class="ttdeci">static double occupied_tile_fraction(m_size target_size)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00521">ranged.cpp:521</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a4823a8b924c5e1c83c8e1e1a316e1ae7"><div class="ttname"><a href="ranged_8cpp.html#a4823a8b924c5e1c83c8e1e1a316e1ae7">ammo_effect_LASER</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_LASER(&quot;LASER&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a4832c47fe321946202cd17b211b27862"><div class="ttname"><a href="ranged_8cpp.html#a4832c47fe321946202cd17b211b27862">ammo_effect_ACT_ON_RANGED_HIT</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_ACT_ON_RANGED_HIT(&quot;ACT_ON_RANGED_HIT&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a4c4dcbdeaad877776816e6f5b2dd1739"><div class="ttname"><a href="ranged_8cpp.html#a4c4dcbdeaad877776816e6f5b2dd1739">calculate_aim_cap</a></div><div class="ttdeci">static double calculate_aim_cap(const player &amp;p, const tripoint &amp;target)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01524">ranged.cpp:1524</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a4de2ef4c2e145815427b09adfaa0def5"><div class="ttname"><a href="ranged_8cpp.html#a4de2ef4c2e145815427b09adfaa0def5">effect_hit_by_player</a></div><div class="ttdeci">static const efftype_id effect_hit_by_player(&quot;hit_by_player&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a512959ad2b35ea057f2fed5445fc23c4"><div class="ttname"><a href="ranged_8cpp.html#a512959ad2b35ea057f2fed5445fc23c4">trait_PYROMANIA</a></div><div class="ttdeci">static const trait_id trait_PYROMANIA(&quot;PYROMANIA&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a55a80a9bbab1925d5462d46d355c2b6e"><div class="ttname"><a href="ranged_8cpp.html#a55a80a9bbab1925d5462d46d355c2b6e">itype_UPS</a></div><div class="ttdeci">static const itype_id itype_UPS(&quot;UPS&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a56ca2e5cfeec3ed46b11661ab0d4a51d"><div class="ttname"><a href="ranged_8cpp.html#a56ca2e5cfeec3ed46b11661ab0d4a51d">ammo_effect_HEAVY_HIT</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_HEAVY_HIT(&quot;HEAVY_HIT&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a588329b70c53194be20a6c9b7798923d"><div class="ttname"><a href="ranged_8cpp.html#a588329b70c53194be20a6c9b7798923d">get_default_aim_type</a></div><div class="ttdeci">static std::vector&lt; aim_type &gt; get_default_aim_type()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01327">ranged.cpp:1327</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a613a8b59e4b2f2aaf05091d354bb4aa3"><div class="ttname"><a href="ranged_8cpp.html#a613a8b59e4b2f2aaf05091d354bb4aa3">time_to_attack</a></div><div class="ttdeci">int time_to_attack(const Character &amp;p, const itype &amp;firing)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01712">ranged.cpp:1712</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a680b9ce8c9824607142f83b2260dd3ef"><div class="ttname"><a href="ranged_8cpp.html#a680b9ce8c9824607142f83b2260dd3ef">ammo_effect_BLACKPOWDER</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_BLACKPOWDER(&quot;BLACKPOWDER&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a6a67c1570499e9c4ab345a0c6f1ba026"><div class="ttname"><a href="ranged_8cpp.html#a6a67c1570499e9c4ab345a0c6f1ba026">fault_gun_blackpowder</a></div><div class="ttdeci">static const fault_id fault_gun_blackpowder(&quot;fault_gun_blackpowder&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a6b4c3a2a360b378de261413fbb7d84f0"><div class="ttname"><a href="ranged_8cpp.html#a6b4c3a2a360b378de261413fbb7d84f0">range_with_even_chance_of_good_hit</a></div><div class="ttdeci">int range_with_even_chance_of_good_hit(int dispersion)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00561">ranged.cpp:561</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a6bfc75cd10b0d4de99dc6dcb44abc85b"><div class="ttname"><a href="ranged_8cpp.html#a6bfc75cd10b0d4de99dc6dcb44abc85b">can_use_bipod</a></div><div class="ttdeci">bool can_use_bipod(const map &amp;m, const tripoint &amp;pos)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00779">ranged.cpp:779</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a7037269f2b6a941bc0e3f2e659450f32"><div class="ttname"><a href="ranged_8cpp.html#a7037269f2b6a941bc0e3f2e659450f32">ammo_effect_SHATTER_SELF</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_SHATTER_SELF(&quot;SHATTER_SELF&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a72d322a82b6cac799c940f935cbee213"><div class="ttname"><a href="ranged_8cpp.html#a72d322a82b6cac799c940f935cbee213">itype_40x46mm</a></div><div class="ttdeci">static const itype_id itype_40x46mm(&quot;40x46mm&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a738f726f320c7f5b5edca445777a14fa"><div class="ttname"><a href="ranged_8cpp.html#a738f726f320c7f5b5edca445777a14fa">bio_railgun</a></div><div class="ttdeci">static const bionic_id bio_railgun(&quot;bio_railgun&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a75bb71c29339b16696e3a2eb384bbc3c"><div class="ttname"><a href="ranged_8cpp.html#a75bb71c29339b16696e3a2eb384bbc3c">calculate_dispersion</a></div><div class="ttdeci">dispersion_sources calculate_dispersion(const map &amp;m, const player &amp;p, const item &amp;gun, int at_recoil, bool burst)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00793">ranged.cpp:793</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a7a08490346831114f00f3e44cbe454e3"><div class="ttname"><a href="ranged_8cpp.html#a7a08490346831114f00f3e44cbe454e3">trait_NORANGEDCRIT</a></div><div class="ttdeci">static const trait_id trait_NORANGEDCRIT(&quot;NO_RANGED_CRIT&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a7c4d782d03c3f30e5b3332260ded8951"><div class="ttname"><a href="ranged_8cpp.html#a7c4d782d03c3f30e5b3332260ded8951">pl_sees</a></div><div class="ttdeci">static bool pl_sees(const Creature &amp;cr)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01517">ranged.cpp:1517</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a7cebe4dcc0fe98d9a37fe19beb640e1f"><div class="ttname"><a href="ranged_8cpp.html#a7cebe4dcc0fe98d9a37fe19beb640e1f">itype_40x53mm</a></div><div class="ttdeci">static const itype_id itype_40x53mm(&quot;40x53mm&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a7dcffd38110cb6a93c24f11258461023"><div class="ttname"><a href="ranged_8cpp.html#a7dcffd38110cb6a93c24f11258461023">do_aim</a></div><div class="ttdeci">static void do_aim(player &amp;p, const item &amp;relevant, const double min_recoil)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01275">ranged.cpp:1275</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a8003de0be6343d0b891adb019a7b51ea"><div class="ttname"><a href="ranged_8cpp.html#a8003de0be6343d0b891adb019a7b51ea">itype_bolt</a></div><div class="ttdeci">static const itype_id itype_bolt(&quot;bolt&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a804a5958c8dea5a130b8a5c7fe686ac6"><div class="ttname"><a href="ranged_8cpp.html#a804a5958c8dea5a130b8a5c7fe686ac6">itype_84x246mm</a></div><div class="ttdeci">static const itype_id itype_84x246mm(&quot;84x246mm&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a86a68d80cad5052d3e456a9fb8b1769d"><div class="ttname"><a href="ranged_8cpp.html#a86a68d80cad5052d3e456a9fb8b1769d">RatingVector</a></div><div class="ttdeci">std::vector&lt; std::tuple&lt; double, char, std::string &gt; &gt; RatingVector</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01334">ranged.cpp:1334</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a8b90a63ce217d881ddad6a7456c4a98e"><div class="ttname"><a href="ranged_8cpp.html#a8b90a63ce217d881ddad6a7456c4a98e">cycle_action</a></div><div class="ttdeci">static void cycle_action(item &amp;weap, const tripoint &amp;pos)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01720">ranged.cpp:1720</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a8c62adc6acdb9a2e731a64f65499bad8"><div class="ttname"><a href="ranged_8cpp.html#a8c62adc6acdb9a2e731a64f65499bad8">confidence_estimate</a></div><div class="ttdeci">static double confidence_estimate(int range, double target_size, const dispersion_sources &amp;dispersion)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01312">ranged.cpp:1312</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a8cd1e1b3b0c3c6b1ba13f05f3831279c"><div class="ttname"><a href="ranged_8cpp.html#a8cd1e1b3b0c3c6b1ba13f05f3831279c">itype_metal_rail</a></div><div class="ttdeci">static const itype_id itype_metal_rail(&quot;metal_rail&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a8f6e1a41d7fec5aac1acdc98363c8cc4"><div class="ttname"><a href="ranged_8cpp.html#a8f6e1a41d7fec5aac1acdc98363c8cc4">ammo_effect_NO_EMBED</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_NO_EMBED(&quot;NO_EMBED&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a916c022e69240915ee6678d0170882d3"><div class="ttname"><a href="ranged_8cpp.html#a916c022e69240915ee6678d0170882d3">flag_CONSUMABLE</a></div><div class="ttdeci">static const std::string flag_CONSUMABLE(&quot;CONSUMABLE&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a99d97c99b6e5d138e7daa56d509e13ed"><div class="ttname"><a href="ranged_8cpp.html#a99d97c99b6e5d138e7daa56d509e13ed">ammo_effect_NO_CRIT</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_NO_CRIT(&quot;NO_CRIT&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a9a327f2be95a30526c2d1ab6a31f72b2"><div class="ttname"><a href="ranged_8cpp.html#a9a327f2be95a30526c2d1ab6a31f72b2">flag_MOUNTED_GUN</a></div><div class="ttdeci">static const std::string flag_MOUNTED_GUN(&quot;MOUNTED_GUN&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a9d14a0cc5b70610323cf40b51929fae5"><div class="ttname"><a href="ranged_8cpp.html#a9d14a0cc5b70610323cf40b51929fae5">make_gun_sound_effect</a></div><div class="ttdeci">void make_gun_sound_effect(const player &amp;p, bool burst, item *weapon)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01769">ranged.cpp:1769</a></div></div>
<div class="ttc" id="aranged_8cpp_html_aa125c6da24f14c1bec090943b0174e58"><div class="ttname"><a href="ranged_8cpp.html#aa125c6da24f14c1bec090943b0174e58">flag_NON_FOULING</a></div><div class="ttdeci">static const std::string flag_NON_FOULING(&quot;NON-FOULING&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_aa3f58e0db88c98c686cbce467d25fd94"><div class="ttname"><a href="ranged_8cpp.html#aa3f58e0db88c98c686cbce467d25fd94">ammo_effect_NO_ITEM_DAMAGE</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_NO_ITEM_DAMAGE(&quot;NO_ITEM_DAMAGE&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_aa629b07204a26cf4e57eabe425b3d5c4"><div class="ttname"><a href="ranged_8cpp.html#aa629b07204a26cf4e57eabe425b3d5c4">ammo_effect_TANGLE</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_TANGLE(&quot;TANGLE&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_aac5abe3e4bd613b31a66a3a04df87a87"><div class="ttname"><a href="ranged_8cpp.html#aac5abe3e4bd613b31a66a3a04df87a87">ammo_effect_EXPLOSIVE</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_EXPLOSIVE(&quot;EXPLOSIVE&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_aaf09bb55e60a45b1eb81e989d0758e93"><div class="ttname"><a href="ranged_8cpp.html#aaf09bb55e60a45b1eb81e989d0758e93">ammo_effect_PLASMA</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_PLASMA(&quot;PLASMA&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ab0db3d2d826960249b5a1d47fa7881ff"><div class="ttname"><a href="ranged_8cpp.html#ab0db3d2d826960249b5a1d47fa7881ff">make_gun_projectile</a></div><div class="ttdeci">static projectile make_gun_projectile(const item &amp;gun)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01667">ranged.cpp:1667</a></div></div>
<div class="ttc" id="aranged_8cpp_html_ab1ce33f7e8ed6c701d44bf39e98de576"><div class="ttname"><a href="ranged_8cpp.html#ab1ce33f7e8ed6c701d44bf39e98de576">print_steadiness</a></div><div class="ttdeci">static int print_steadiness(const catacurses::window &amp;w, int line_number, double steadiness)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01295">ranged.cpp:1295</a></div></div>
<div class="ttc" id="aranged_8cpp_html_ab2dd3d8bd3db68ab02a94d2d26d2fc5a"><div class="ttname"><a href="ranged_8cpp.html#ab2dd3d8bd3db68ab02a94d2d26d2fc5a">flag_NEVER_JAMS</a></div><div class="ttdeci">static const std::string flag_NEVER_JAMS(&quot;NEVER_JAMS&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ab5bc741878d9b8001686d7776457d9f9"><div class="ttname"><a href="ranged_8cpp.html#ab5bc741878d9b8001686d7776457d9f9">ammo_effect_IGNITE</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_IGNITE(&quot;IGNITE&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ab656471d666816a9cd8ae082f81ac021"><div class="ttname"><a href="ranged_8cpp.html#ab656471d666816a9cd8ae082f81ac021">ammo_effect_CUSTOM_EXPLOSION</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_CUSTOM_EXPLOSION(&quot;CUSTOM_EXPLOSION&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ab6ca472fa792b69b4a6afa8ca9e63a58"><div class="ttname"><a href="ranged_8cpp.html#ab6ca472fa792b69b4a6afa8ca9e63a58">flag_UNDERWATER_GUN</a></div><div class="ttdeci">static const std::string flag_UNDERWATER_GUN(&quot;UNDERWATER_GUN&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ab97e95eba84f451228755a351c0476f7"><div class="ttname"><a href="ranged_8cpp.html#ab97e95eba84f451228755a351c0476f7">ammo_effect_NON_FOULING</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_NON_FOULING(&quot;NON-FOULING&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_abca795246deac76d5cf0515c16bb75c8"><div class="ttname"><a href="ranged_8cpp.html#abca795246deac76d5cf0515c16bb75c8">flag_MOUNTABLE</a></div><div class="ttdeci">static const std::string flag_MOUNTABLE(&quot;MOUNTABLE&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ac48fadf8e0cc0bf9f6800029de9084d6"><div class="ttname"><a href="ranged_8cpp.html#ac48fadf8e0cc0bf9f6800029de9084d6">bio_ups</a></div><div class="ttdeci">static const bionic_id bio_ups(&quot;bio_ups&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_aca8ae2b9cbc86602a56a3885b72a4ed1"><div class="ttname"><a href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a></div><div class="ttdeci">static const skill_id skill_throw(&quot;throw&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ace607007c38b8d55a601963b24f89e7e"><div class="ttname"><a href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a></div><div class="ttdeci">static const fault_id fault_gun_chamber_spent(&quot;fault_gun_chamber_spent&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ad23a05e76b668009068f0e453c33692b"><div class="ttname"><a href="ranged_8cpp.html#ad23a05e76b668009068f0e453c33692b">flag_PRIMITIVE_RANGED_WEAPON</a></div><div class="ttdeci">static const std::string flag_PRIMITIVE_RANGED_WEAPON(&quot;PRIMITIVE_RANGED_WEAPON&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ad2f60bde7290b0993994d14fad34a3e9"><div class="ttname"><a href="ranged_8cpp.html#ad2f60bde7290b0993994d14fad34a3e9">ammo_effect_WIDE</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_WIDE(&quot;WIDE&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ad73ddd0cc91027278ca5627eaa4ef206"><div class="ttname"><a href="ranged_8cpp.html#ad73ddd0cc91027278ca5627eaa4ef206">fault_gun_unlubricated</a></div><div class="ttdeci">static const fault_id fault_gun_unlubricated(&quot;fault_gun_unlubricated&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_add0bf5e67088357d1ff569fc62addb60"><div class="ttname"><a href="ranged_8cpp.html#add0bf5e67088357d1ff569fc62addb60">flag_PYROMANIAC_WEAPON</a></div><div class="ttdeci">static const std::string flag_PYROMANIAC_WEAPON(&quot;PYROMANIAC_WEAPON&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_adf294508632caed42c2bd4c1bf7a40d0"><div class="ttname"><a href="ranged_8cpp.html#adf294508632caed42c2bd4c1bf7a40d0">ammo_effect_SHOT</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_SHOT(&quot;SHOT&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ae134db696195500e4ff1835e6f784aca"><div class="ttname"><a href="ranged_8cpp.html#ae134db696195500e4ff1835e6f784aca">AIF_DURATION_LIMIT</a></div><div class="ttdeci">static constexpr int AIF_DURATION_LIMIT</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00154">ranged.cpp:154</a></div></div>
<div class="ttc" id="aranged_8cpp_html_ae3075e5ce833b51beabbbf41bec72156"><div class="ttname"><a href="ranged_8cpp.html#ae3075e5ce833b51beabbbf41bec72156">itype_66mm</a></div><div class="ttdeci">static const itype_id itype_66mm(&quot;66mm&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ae485e14f2f0d97810da8125353dfa101"><div class="ttname"><a href="ranged_8cpp.html#ae485e14f2f0d97810da8125353dfa101">get_colored_bar</a></div><div class="ttdeci">static std::string get_colored_bar(const double val, const int width, const std::string &amp;label, RatingVector::iterator begin, RatingVector::iterator end)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01335">ranged.cpp:1335</a></div></div>
<div class="ttc" id="aranged_8cpp_html_ae89306fd36cf36b57fe05dad0db3f71b"><div class="ttname"><a href="ranged_8cpp.html#ae89306fd36cf36b57fe05dad0db3f71b">itype_UPS_off</a></div><div class="ttdeci">static const itype_id itype_UPS_off(&quot;UPS_off&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_aeac06317fd010c6001b6b71968bc15c1"><div class="ttname"><a href="ranged_8cpp.html#aeac06317fd010c6001b6b71968bc15c1">flag_RESTRICT_HANDS</a></div><div class="ttdeci">static const std::string flag_RESTRICT_HANDS(&quot;RESTRICT_HANDS&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_aebe27b2e9dd96af665d642596a9b8b43"><div class="ttname"><a href="ranged_8cpp.html#aebe27b2e9dd96af665d642596a9b8b43">print_aim</a></div><div class="ttdeci">static int print_aim(const player &amp;p, const catacurses::window &amp;w, int line_number, input_context &amp;ctxt, const item &amp;weapon, const double target_size, const tripoint &amp;pos, double predicted_recoil)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01540">ranged.cpp:1540</a></div></div>
<div class="ttc" id="aranged_8cpp_html_af6105e558342bb67286a7f70682f652f"><div class="ttname"><a href="ranged_8cpp.html#af6105e558342bb67286a7f70682f652f">itype_arrow</a></div><div class="ttdeci">static const itype_id itype_arrow(&quot;arrow&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_afa18fa10e4bc2e18f3911cebb559b7bd"><div class="ttname"><a href="ranged_8cpp.html#afa18fa10e4bc2e18f3911cebb559b7bd">ammo_effect_RECYCLED</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_RECYCLED(&quot;RECYCLED&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_afee8dcfd12a225c469ee6171063d7594"><div class="ttname"><a href="ranged_8cpp.html#afee8dcfd12a225c469ee6171063d7594">skill_driving</a></div><div class="ttdeci">static const skill_id skill_driving(&quot;driving&quot;)</div></div>
<div class="ttc" id="aranged_8h_html"><div class="ttname"><a href="ranged_8h.html">ranged.h</a></div></div>
<div class="ttc" id="arng_8cpp_html_aad28bdad07401a34ecf9912708f8b750"><div class="ttname"><a href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a></div><div class="ttdeci">bool one_in(int chance)</div><div class="ttdef"><b>Definition:</b> <a href="rng_8cpp_source.html#l00065">rng.cpp:65</a></div></div>
<div class="ttc" id="arng_8cpp_html_acd19ae79e3590a99c9eaf0389318b686"><div class="ttname"><a href="rng_8cpp.html#acd19ae79e3590a99c9eaf0389318b686">roll_remainder</a></div><div class="ttdeci">int roll_remainder(double value)</div><div class="ttdef"><b>Definition:</b> <a href="rng_8cpp_source.html#l00096">rng.cpp:96</a></div></div>
<div class="ttc" id="arng_8h_html"><div class="ttname"><a href="rng_8h.html">rng.h</a></div></div>
<div class="ttc" id="arng_8h_html_a12244355ee77108f1b08618e9962e4d1"><div class="ttname"><a href="rng_8h.html#a12244355ee77108f1b08618e9962e4d1">random_entry</a></div><div class="ttdeci">V random_entry(const C &amp;container, D default_value)</div><div class="ttdoc">Returns a random entry in the container.</div><div class="ttdef"><b>Definition:</b> <a href="rng_8h_source.html#l00088">rng.h:88</a></div></div>
<div class="ttc" id="askill_8h_html"><div class="ttname"><a href="skill_8h.html">skill.h</a></div></div>
<div class="ttc" id="asounds_8h_html"><div class="ttname"><a href="sounds_8h.html">sounds.h</a></div></div>
<div class="ttc" id="astring__formatter_8h_html"><div class="ttname"><a href="string__formatter_8h.html">string_formatter.h</a></div></div>
<div class="ttc" id="astring__formatter_8h_html_a9b089d0b697443b096063219dab08ef5"><div class="ttname"><a href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a></div><div class="ttdeci">std::string string_format(std::string format, Args &amp;&amp;...args)</div><div class="ttdoc">Simple wrapper over string_formatter::parse.</div><div class="ttdef"><b>Definition:</b> <a href="string__formatter_8h_source.html#l00418">string_formatter.h:418</a></div></div>
<div class="ttc" id="astring__id_8h_html"><div class="ttname"><a href="string__id_8h.html">string_id.h</a></div></div>
<div class="ttc" id="astructaim__type_html"><div class="ttname"><a href="structaim__type.html">aim_type</a></div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00189">character.h:189</a></div></div>
<div class="ttc" id="astructammo__effect_html"><div class="ttname"><a href="structammo__effect.html">ammo_effect</a></div><div class="ttdef"><b>Definition:</b> <a href="ammo__effect_8h_source.html#l00016">ammo_effect.h:16</a></div></div>
<div class="ttc" id="astructcommon__ranged__data_html_a497cd4533098e79f14f8a97fcec6ca1a"><div class="ttname"><a href="structcommon__ranged__data.html#a497cd4533098e79f14f8a97fcec6ca1a">common_ranged_data::dispersion</a></div><div class="ttdeci">int dispersion</div><div class="ttdoc">Dispersion &quot;bonus&quot; from gun.</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00420">itype.h:420</a></div></div>
<div class="ttc" id="astructcommon__ranged__data_html_a94254f1acb94261bb47c4b7aaa3b0c89"><div class="ttname"><a href="structcommon__ranged__data.html#a94254f1acb94261bb47c4b7aaa3b0c89">common_ranged_data::damage</a></div><div class="ttdeci">damage_instance damage</div><div class="ttdoc">Damage, armor piercing and multipliers for each.</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00412">itype.h:412</a></div></div>
<div class="ttc" id="astructconfidence__rating_html"><div class="ttname"><a href="structconfidence__rating.html">confidence_rating</a></div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01288">ranged.cpp:1288</a></div></div>
<div class="ttc" id="astructconfidence__rating_html_a3e948736e9d479abfa280833019cad36"><div class="ttname"><a href="structconfidence__rating.html#a3e948736e9d479abfa280833019cad36">confidence_rating::symbol</a></div><div class="ttdeci">char symbol</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01290">ranged.cpp:1290</a></div></div>
<div class="ttc" id="astructconfidence__rating_html_a47c7756df867e77f46be130c7bb02e5c"><div class="ttname"><a href="structconfidence__rating.html#a47c7756df867e77f46be130c7bb02e5c">confidence_rating::label</a></div><div class="ttdeci">std::string label</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01292">ranged.cpp:1292</a></div></div>
<div class="ttc" id="astructconfidence__rating_html_a95391c9a8078562cb5f37dacf9ff0267"><div class="ttname"><a href="structconfidence__rating.html#a95391c9a8078562cb5f37dacf9ff0267">confidence_rating::aim_level</a></div><div class="ttdeci">double aim_level</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01289">ranged.cpp:1289</a></div></div>
<div class="ttc" id="astructconfidence__rating_html_afe2900a64ed6d6d39f4f2322216abf36"><div class="ttname"><a href="structconfidence__rating.html#afe2900a64ed6d6d39f4f2322216abf36">confidence_rating::color</a></div><div class="ttdeci">std::string color</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01291">ranged.cpp:1291</a></div></div>
<div class="ttc" id="astructdamage__instance_html"><div class="ttname"><a href="structdamage__instance.html">damage_instance</a></div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00051">damage.h:51</a></div></div>
<div class="ttc" id="astructdamage__instance_html_a17fd21018ff56a2bd330302c1ec1bc77"><div class="ttname"><a href="structdamage__instance.html#a17fd21018ff56a2bd330302c1ec1bc77">damage_instance::end</a></div><div class="ttdeci">std::vector&lt; damage_unit &gt;::iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="damage_8cpp_source.html#l00130">damage.cpp:130</a></div></div>
<div class="ttc" id="astructdamage__instance_html_a2cc3ee4ff8f77ab6cd74168b1999246a"><div class="ttname"><a href="structdamage__instance.html#a2cc3ee4ff8f77ab6cd74168b1999246a">damage_instance::damage_units</a></div><div class="ttdeci">std::vector&lt; damage_unit &gt; damage_units</div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00052">damage.h:52</a></div></div>
<div class="ttc" id="astructdamage__instance_html_a6cc673dba3d2de116c2579c3eda7ed23"><div class="ttname"><a href="structdamage__instance.html#a6cc673dba3d2de116c2579c3eda7ed23">damage_instance::mult_damage</a></div><div class="ttdeci">void mult_damage(double multiplier, bool pre_armor=false)</div><div class="ttdef"><b>Definition:</b> <a href="damage_8cpp_source.html#l00048">damage.cpp:48</a></div></div>
<div class="ttc" id="astructdamage__instance_html_a96f6f6d008ed8744ce549cefcfec3951"><div class="ttname"><a href="structdamage__instance.html#a96f6f6d008ed8744ce549cefcfec3951">damage_instance::total_damage</a></div><div class="ttdeci">float total_damage() const</div><div class="ttdef"><b>Definition:</b> <a href="damage_8cpp_source.html#l00075">damage.cpp:75</a></div></div>
<div class="ttc" id="astructdamage__instance_html_a9fecfb3aaaa2d93dc882893cf9a71e2e"><div class="ttname"><a href="structdamage__instance.html#a9fecfb3aaaa2d93dc882893cf9a71e2e">damage_instance::begin</a></div><div class="ttdeci">std::vector&lt; damage_unit &gt;::iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="damage_8cpp_source.html#l00120">damage.cpp:120</a></div></div>
<div class="ttc" id="astructdamage__instance_html_ae17bfa13ed37fd55281fa769a152e941"><div class="ttname"><a href="structdamage__instance.html#ae17bfa13ed37fd55281fa769a152e941">damage_instance::add</a></div><div class="ttdeci">void add(const damage_instance &amp;added_di)</div><div class="ttdef"><b>Definition:</b> <a href="damage_8cpp_source.html#l00093">damage.cpp:93</a></div></div>
<div class="ttc" id="astructdamage__unit_html"><div class="ttname"><a href="structdamage__unit.html">damage_unit</a></div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00035">damage.h:35</a></div></div>
<div class="ttc" id="astructdamage__unit_html_ab4d1b13f7ebe2f16a43038e1441ec2b5"><div class="ttname"><a href="structdamage__unit.html#ab4d1b13f7ebe2f16a43038e1441ec2b5">damage_unit::res_pen</a></div><div class="ttdeci">float res_pen</div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00038">damage.h:38</a></div></div>
<div class="ttc" id="astructdealt__projectile__attack_html"><div class="ttname"><a href="structdealt__projectile__attack.html">dealt_projectile_attack</a></div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00070">projectile.h:70</a></div></div>
<div class="ttc" id="astructdrawsq__params_html"><div class="ttname"><a href="structdrawsq__params.html">drawsq_params</a></div><div class="ttdoc">Draw parameters used by map::drawsq() and similar methods.</div><div class="ttdef"><b>Definition:</b> <a href="map_8h_source.html#l00180">map.h:180</a></div></div>
<div class="ttc" id="astructdrawsq__params_html_a07e0031d80c902338e81e0625215c8ee"><div class="ttname"><a href="structdrawsq__params.html#a07e0031d80c902338e81e0625215c8ee">drawsq_params::highlight</a></div><div class="ttdeci">constexpr drawsq_params &amp; highlight(bool v)</div><div class="ttdoc">Highlight the tile.</div><div class="ttdef"><b>Definition:</b> <a href="map_8h_source.html#l00198">map.h:198</a></div></div>
<div class="ttc" id="astructdrawsq__params_html_a62c9449e7c7cf3d1a7828e2c65100ac8"><div class="ttname"><a href="structdrawsq__params.html#a62c9449e7c7cf3d1a7828e2c65100ac8">drawsq_params::center</a></div><div class="ttdeci">constexpr drawsq_params &amp; center(const tripoint &amp;p)</div><div class="ttdoc">Set view center.</div><div class="ttdef"><b>Definition:</b> <a href="map_8h_source.html#l00283">map.h:283</a></div></div>
<div class="ttc" id="astructislot__ammo_html"><div class="ttname"><a href="structislot__ammo.html">islot_ammo</a></div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00672">itype.h:672</a></div></div>
<div class="ttc" id="astructislot__ammo_html_a4e55e746a4e82e094d70ed42f1cf1ac1"><div class="ttname"><a href="structislot__ammo.html#a4e55e746a4e82e094d70ed42f1cf1ac1">islot_ammo::dont_recover_one_in</a></div><div class="ttdeci">int dont_recover_one_in</div><div class="ttdoc">Chance to fail to recover the ammo used.</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00695">itype.h:695</a></div></div>
<div class="ttc" id="astructislot__ammo_html_acd114e30cfafd26d8644a2b43d29ceb9"><div class="ttname"><a href="structislot__ammo.html#acd114e30cfafd26d8644a2b43d29ceb9">islot_ammo::drop</a></div><div class="ttdeci">itype_id drop</div><div class="ttdoc">Control chance for and state of any items dropped at ranged target.</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00685">itype.h:685</a></div></div>
<div class="ttc" id="astructislot__ammo_html_ad7649b801b4ed0d8bec314b40f18f1db"><div class="ttname"><a href="structislot__ammo.html#ad7649b801b4ed0d8bec314b40f18f1db">islot_ammo::drop_active</a></div><div class="ttdeci">bool drop_active</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00687">itype.h:687</a></div></div>
<div class="ttc" id="astructislot__gun_html"><div class="ttname"><a href="structislot__gun.html">islot_gun</a></div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00459">itype.h:459</a></div></div>
<div class="ttc" id="astructislot__gun_html_a014b797e92e543ea47be93a1d6771a90"><div class="ttname"><a href="structislot__gun.html#a014b797e92e543ea47be93a1d6771a90">islot_gun::blackpowder_tolerance</a></div><div class="ttdeci">int blackpowder_tolerance</div><div class="ttdoc">One in X chance for gun to require major cleanup after firing blackpowder shot.</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00502">itype.h:502</a></div></div>
<div class="ttc" id="astructislot__gun_html_a40255e8d661dc99204ed70dbe6013a02"><div class="ttname"><a href="structislot__gun.html#a40255e8d661dc99204ed70dbe6013a02">islot_gun::durability</a></div><div class="ttdeci">int durability</div><div class="ttdoc">Gun durability, affects gun being damaged during shooting.</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00471">itype.h:471</a></div></div>
<div class="ttc" id="astructislot__gun_html_a5a7e4998071d2cd8f7ecd9504003968b"><div class="ttname"><a href="structislot__gun.html#a5a7e4998071d2cd8f7ecd9504003968b">islot_gun::clip</a></div><div class="ttdeci">int clip</div><div class="ttdoc">For guns with an integral magazine what is the capacity?</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00475">itype.h:475</a></div></div>
<div class="ttc" id="astructislot__gun_html_a68eca15622f086d544820aabcb2a865a"><div class="ttname"><a href="structislot__gun.html#a68eca15622f086d544820aabcb2a865a">islot_gun::min_cycle_recoil</a></div><div class="ttdeci">int min_cycle_recoil</div><div class="ttdoc">Minimum ammo recoil for gun to be able to fire more than once per attack.</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00506">itype.h:506</a></div></div>
<div class="ttc" id="astructislot__gun_html_acedd47c3f7557f9b7b839af476c5989e"><div class="ttname"><a href="structislot__gun.html#acedd47c3f7557f9b7b839af476c5989e">islot_gun::reload_time</a></div><div class="ttdeci">int reload_time</div><div class="ttdoc">Reload time, in moves.</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00479">itype.h:479</a></div></div>
<div class="ttc" id="astructitem_1_1sound__data_html"><div class="ttname"><a href="structitem_1_1sound__data.html">item::sound_data</a></div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l01843">item.h:1843</a></div></div>
<div class="ttc" id="astructitype_html"><div class="ttname"><a href="structitype.html">itype</a></div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00836">itype.h:836</a></div></div>
<div class="ttc" id="astructitype_html_a15ce9f3914d2afb7992e4683a0996791"><div class="ttname"><a href="structitype.html#a15ce9f3914d2afb7992e4683a0996791">itype::explosion</a></div><div class="ttdeci">explosion_data explosion</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00945">itype.h:945</a></div></div>
<div class="ttc" id="astructitype_html_a3d7692cff108d3b8c59ca0847d25a45c"><div class="ttname"><a href="structitype.html#a3d7692cff108d3b8c59ca0847d25a45c">itype::phase</a></div><div class="ttdeci">phase_id phase</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00942">itype.h:942</a></div></div>
<div class="ttc" id="astructitype_html_a623ec8243b1e599086fa3a23c3179370"><div class="ttname"><a href="structitype.html#a623ec8243b1e599086fa3a23c3179370">itype::gun</a></div><div class="ttdeci">cata::value_ptr&lt; islot_gun &gt; gun</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00857">itype.h:857</a></div></div>
<div class="ttc" id="astructitype_html_a7cb80d77696cefb42ac6e75756b47e60"><div class="ttname"><a href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">itype::ammo</a></div><div class="ttdeci">cata::value_ptr&lt; islot_ammo &gt; ammo</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00862">itype.h:862</a></div></div>
<div class="ttc" id="astructitype_html_ab8196084d50fd9a33d6d93c290501b4f"><div class="ttname"><a href="structitype.html#ab8196084d50fd9a33d6d93c290501b4f">itype::has_flag</a></div><div class="ttdeci">bool has_flag(const std::string &amp;flag) const</div><div class="ttdef"><b>Definition:</b> <a href="itype_8cpp_source.html#l00071">itype.cpp:71</a></div></div>
<div class="ttc" id="astructitype_html_abc2596bacfc718fba56ab8076bab5d6b"><div class="ttname"><a href="structitype.html#abc2596bacfc718fba56ab8076bab5d6b">itype::get_id</a></div><div class="ttdeci">const itype_id &amp; get_id() const</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l01070">itype.h:1070</a></div></div>
<div class="ttc" id="astructitype_html_ad35fbe0013544c1c396944b20b264421"><div class="ttname"><a href="structitype.html#ad35fbe0013544c1c396944b20b264421">itype::nname</a></div><div class="ttdeci">std::string nname(unsigned int quantity) const</div><div class="ttdef"><b>Definition:</b> <a href="itype_8cpp_source.html#l00046">itype.cpp:46</a></div></div>
<div class="ttc" id="astructitype_html_af4d6fc9396d1e09f23d2008f974ac757"><div class="ttname"><a href="structitype.html#af4d6fc9396d1e09f23d2008f974ac757">itype::color</a></div><div class="ttdeci">nc_color color</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l01006">itype.h:1006</a></div></div>
<div class="ttc" id="astructlabel_html"><div class="ttname"><a href="structlabel.html">label</a></div><div class="ttdoc">Struct used for storing labels (easier to json opposed to a std::map&lt;point, std::string&gt;)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00578">vehicle.h:578</a></div></div>
<div class="ttc" id="astructmtype_html_abe1e1f1cacb0be37406c667e226003c4"><div class="ttname"><a href="structmtype.html#abe1e1f1cacb0be37406c667e226003c4">mtype::mech_weapon</a></div><div class="ttdeci">itype_id mech_weapon</div><div class="ttdoc">If this monster is a rideable mech with built-in weapons, this is the weapons id.</div><div class="ttdef"><b>Definition:</b> <a href="mtype_8h_source.html#l00365">mtype.h:365</a></div></div>
<div class="ttc" id="astructpoint_html"><div class="ttname"><a href="structpoint.html">point</a></div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00035">point.h:35</a></div></div>
<div class="ttc" id="astructpoint_html_a9a82ca9504acabb1e30569f89c805471"><div class="ttname"><a href="structpoint.html#a9a82ca9504acabb1e30569f89c805471">point::y</a></div><div class="ttdeci">int y</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00039">point.h:39</a></div></div>
<div class="ttc" id="astructpoint_html_ad679b07fb69d55f5ad454d0f1f2891d5"><div class="ttname"><a href="structpoint.html#ad679b07fb69d55f5ad454d0f1f2891d5">point::x</a></div><div class="ttdeci">int x</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00038">point.h:38</a></div></div>
<div class="ttc" id="astructprojectile_html"><div class="ttname"><a href="structprojectile.html">projectile</a></div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00020">projectile.h:20</a></div></div>
<div class="ttc" id="astructprojectile_html_a05d90cbb1c83669dd7c23477c8f35963"><div class="ttname"><a href="structprojectile.html#a05d90cbb1c83669dd7c23477c8f35963">projectile::add_effect</a></div><div class="ttdeci">void add_effect(const ammo_effect_str_id &amp;id)</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00058">projectile.h:58</a></div></div>
<div class="ttc" id="astructprojectile_html_a2bbf20562006058aa939aa5339860ba7"><div class="ttname"><a href="structprojectile.html#a2bbf20562006058aa939aa5339860ba7">projectile::set_drop</a></div><div class="ttdeci">void set_drop(const item &amp;it)</div><div class="ttdoc">Copies item it as a drop for this projectile.</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8cpp_source.html#l00053">projectile.cpp:53</a></div></div>
<div class="ttc" id="astructprojectile_html_a312bc9a78fe7a5fdefb44e3755154db3"><div class="ttname"><a href="structprojectile.html#a312bc9a78fe7a5fdefb44e3755154db3">projectile::range</a></div><div class="ttdeci">int range</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00026">projectile.h:26</a></div></div>
<div class="ttc" id="astructprojectile_html_a3eb9cbe946d6bf2131eeae97d2d1230d"><div class="ttname"><a href="structprojectile.html#a3eb9cbe946d6bf2131eeae97d2d1230d">projectile::set_custom_explosion</a></div><div class="ttdeci">void set_custom_explosion(const explosion_data &amp;ex)</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8cpp_source.html#l00086">projectile.cpp:86</a></div></div>
<div class="ttc" id="astructprojectile_html_a82d8f657f8cfc4e180c15bfab8ca8a6e"><div class="ttname"><a href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">projectile::impact</a></div><div class="ttdeci">damage_instance impact</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00021">projectile.h:21</a></div></div>
<div class="ttc" id="astructprojectile_html_aa2af53bce63feecb719ef1edba54689e"><div class="ttname"><a href="structprojectile.html#aa2af53bce63feecb719ef1edba54689e">projectile::speed</a></div><div class="ttdeci">int speed</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00025">projectile.h:25</a></div></div>
<div class="ttc" id="astructrl__vec3d_html"><div class="ttname"><a href="structrl__vec3d.html">rl_vec3d</a></div><div class="ttdef"><b>Definition:</b> <a href="point__float_8h_source.html#l00037">point_float.h:37</a></div></div>
<div class="ttc" id="astructrl__vec3d_html_ace319a14c1ba51cb637cdd28d8cddc8c"><div class="ttname"><a href="structrl__vec3d.html#ace319a14c1ba51cb637cdd28d8cddc8c">rl_vec3d::rotated</a></div><div class="ttdeci">rl_vec3d rotated(float angle) const</div><div class="ttdef"><b>Definition:</b> <a href="line_8cpp_source.html#l00655">line.cpp:655</a></div></div>
<div class="ttc" id="astructtarget__ui_1_1turret__with__lof_html"><div class="ttname"><a href="structtarget__ui_1_1turret__with__lof.html">target_ui::turret_with_lof</a></div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00284">ranged.cpp:284</a></div></div>
<div class="ttc" id="astructtarget__ui_1_1turret__with__lof_html_a4422bb428b5d266bad798974571c9baf"><div class="ttname"><a href="structtarget__ui_1_1turret__with__lof.html#a4422bb428b5d266bad798974571c9baf">target_ui::turret_with_lof::line</a></div><div class="ttdeci">std::vector&lt; tripoint &gt; line</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00286">ranged.cpp:286</a></div></div>
<div class="ttc" id="astructtarget__ui_1_1turret__with__lof_html_aaa416c09474e4040a712a05bbb5e99cf"><div class="ttname"><a href="structtarget__ui_1_1turret__with__lof.html#aaa416c09474e4040a712a05bbb5e99cf">target_ui::turret_with_lof::turret</a></div><div class="ttdeci">vehicle_part * turret</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00285">ranged.cpp:285</a></div></div>
<div class="ttc" id="astructtime__info__t_html"><div class="ttname"><a href="structtime__info__t.html">time_info_t</a></div><div class="ttdef"><b>Definition:</b> <a href="skill_8h_source.html#l00023">skill.h:23</a></div></div>
<div class="ttc" id="astructtime__info__t_html_a1cb4c0bb33cbe25f4e889533d8ae1721"><div class="ttname"><a href="structtime__info__t.html#a1cb4c0bb33cbe25f4e889533d8ae1721">time_info_t::time_reduction_per_level</a></div><div class="ttdeci">int time_reduction_per_level</div><div class="ttdef"><b>Definition:</b> <a href="skill_8h_source.html#l00029">skill.h:29</a></div></div>
<div class="ttc" id="astructtime__info__t_html_a562e779c37f25968ccd5f5298a8c308c"><div class="ttname"><a href="structtime__info__t.html#a562e779c37f25968ccd5f5298a8c308c">time_info_t::min_time</a></div><div class="ttdeci">int min_time</div><div class="ttdef"><b>Definition:</b> <a href="skill_8h_source.html#l00025">skill.h:25</a></div></div>
<div class="ttc" id="astructtime__info__t_html_ab3676d37128ef1625abe58686c8c2bfb"><div class="ttname"><a href="structtime__info__t.html#ab3676d37128ef1625abe58686c8c2bfb">time_info_t::base_time</a></div><div class="ttdeci">int base_time</div><div class="ttdef"><b>Definition:</b> <a href="skill_8h_source.html#l00027">skill.h:27</a></div></div>
<div class="ttc" id="astructtripoint_html"><div class="ttname"><a href="structtripoint.html">tripoint</a></div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00147">point.h:147</a></div></div>
<div class="ttc" id="astructtripoint_html_a89f6c0a16e2bfd7ce4f1f1d20404c4d7"><div class="ttname"><a href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">tripoint::y</a></div><div class="ttdeci">int y</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00151">point.h:151</a></div></div>
<div class="ttc" id="astructtripoint_html_ac944c0e329b5eba2602f7a52f66bbbb9"><div class="ttname"><a href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">tripoint::z</a></div><div class="ttdeci">int z</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00152">point.h:152</a></div></div>
<div class="ttc" id="astructtripoint_html_accc0725c936dbebb2486f969f39e2e5f"><div class="ttname"><a href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">tripoint::xy</a></div><div class="ttdeci">constexpr point xy() const</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00220">point.h:220</a></div></div>
<div class="ttc" id="astructtripoint_html_affdc0d5b75024cbfacd208a495def3dc"><div class="ttname"><a href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">tripoint::x</a></div><div class="ttdeci">int x</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00150">point.h:150</a></div></div>
<div class="ttc" id="astructvehicle__part_html"><div class="ttname"><a href="structvehicle__part.html">vehicle_part</a></div><div class="ttdoc">Structure, describing vehicle part (i.e., wheel, seat)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00185">vehicle.h:185</a></div></div>
<div class="ttc" id="atranslations_8cpp_html_a176e288c640c6506a86330cb10fbe13a"><div class="ttname"><a href="translations_8cpp.html#a176e288c640c6506a86330cb10fbe13a">to_translation</a></div><div class="ttdeci">translation to_translation(const std::string &amp;raw)</div><div class="ttdoc">Shorthands for translation::to_translation.</div><div class="ttdef"><b>Definition:</b> <a href="translations_8cpp_source.html#l00384">translations.cpp:384</a></div></div>
<div class="ttc" id="atranslations_8cpp_html_af0c79b5c75a7cf2df78663485b03ed9a"><div class="ttname"><a href="translations_8cpp.html#af0c79b5c75a7cf2df78663485b03ed9a">pgettext</a></div><div class="ttdeci">const char * pgettext(const char *context, const char *msgid)</div><div class="ttdef"><b>Definition:</b> <a href="translations_8cpp_source.html#l00041">translations.cpp:41</a></div></div>
<div class="ttc" id="atranslations_8h_html"><div class="ttname"><a href="translations_8h.html">translations.h</a></div></div>
<div class="ttc" id="atranslations_8h_html_a9e39a96618079002323c6e554271d3e2"><div class="ttname"><a href="translations_8h.html#a9e39a96618079002323c6e554271d3e2">translate_marker_context</a></div><div class="ttdeci">#define translate_marker_context(c, x)</div><div class="ttdoc">Same as translate_marker, but also provides a context (string literal).</div><div class="ttdef"><b>Definition:</b> <a href="translations_8h_source.html#l00038">translations.h:38</a></div></div>
<div class="ttc" id="atranslations_8h_html_aa829053017e23ef22d44dccecba63a34"><div class="ttname"><a href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a></div><div class="ttdeci">#define _(msg)</div><div class="ttdef"><b>Definition:</b> <a href="translations_8h_source.html#l00116">translations.h:116</a></div></div>
<div class="ttc" id="atrap_8h_html"><div class="ttname"><a href="trap_8h.html">trap.h</a></div></div>
<div class="ttc" id="atype__id_8h_html"><div class="ttname"><a href="type__id_8h.html">type_id.h</a></div></div>
<div class="ttc" id="atype__id_8h_html_a569ce0271cf4ab170e63bb05658be142"><div class="ttname"><a href="type__id_8h.html#a569ce0271cf4ab170e63bb05658be142">material_id</a></div><div class="ttdeci">string_id&lt; material_type &gt; material_id</div><div class="ttdef"><b>Definition:</b> <a href="type__id_8h_source.html#l00085">type_id.h:85</a></div></div>
<div class="ttc" id="aui_8h_html_a06d5f3667ed71fa40939c4e7367e30ce"><div class="ttname"><a href="ui_8h.html#a06d5f3667ed71fa40939c4e7367e30ce">MENU_AUTOASSIGN</a></div><div class="ttdeci">const int MENU_AUTOASSIGN</div><div class="ttdef"><b>Definition:</b> <a href="ui_8h_source.html#l00031">ui.h:31</a></div></div>
<div class="ttc" id="aui__manager_8h_html"><div class="ttname"><a href="ui__manager_8h.html">ui_manager.h</a></div></div>
<div class="ttc" id="aunits_8h_html"><div class="ttname"><a href="units_8h.html">units.h</a></div></div>
<div class="ttc" id="aunits__angle_8h_html"><div class="ttname"><a href="units__angle_8h.html">units_angle.h</a></div></div>
<div class="ttc" id="aunits__utility_8h_html"><div class="ttname"><a href="units__utility_8h.html">units_utility.h</a></div></div>
<div class="ttc" id="avalue__ptr_8h_html"><div class="ttname"><a href="value__ptr_8h.html">value_ptr.h</a></div></div>
<div class="ttc" id="avehicle_8h_html"><div class="ttname"><a href="vehicle_8h.html">vehicle.h</a></div></div>
<div class="ttc" id="avehicle_8h_html_ad9a221cee9ae7a69d6f09d4de701f02ca100b8cad7cf2a56f6df78f171f97a1ec"><div class="ttname"><a href="vehicle_8h.html#ad9a221cee9ae7a69d6f09d4de701f02ca100b8cad7cf2a56f6df78f171f97a1ec">part_status_flag::any</a></div><div class="ttdeci">@ any</div></div>
<div class="ttc" id="avpart__position_8h_html"><div class="ttname"><a href="vpart__position_8h.html">vpart_position.h</a></div></div>
<div class="ttc" id="avpart__position_8h_html_a67bd76da258293f1443f1356308381dc"><div class="ttname"><a href="vpart__position_8h.html#a67bd76da258293f1443f1356308381dc">veh_pointer_or_null</a></div><div class="ttdeci">vehicle * veh_pointer_or_null(const optional_vpart_position &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="vpart__position_8h_source.html#l00154">vpart_position.h:154</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="ranged_8cpp.html">ranged.cpp</a></li>
    <li class="footer">Generated on Sun Sep 11 2022 00:04:47 for Cataclysm BN by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
